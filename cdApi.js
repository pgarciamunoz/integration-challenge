/* dd: 2022-11-21__13-57-44 */
// self file should be used by the customer for api handling
// to get data from customer to java script or perform actions
// basic functions to be always used - getCustomerConfigLocation, getCustomerSessionID
// It is needed for ANY integration, and the functions should be selected and adjusted for each one individually.
! function (e) {
    "use strict";
    // generic function to be used for calling metatags for data like csid or confLocation
    // should be deleted if not used
    function getMetatagContent(name) {
        var elem = document.getElementsByName(name)[0];
        if (elem) {
            return elem.getAttribute('content');
        }
        return "";
    }

    // Generic function to get data from the browser "sessionStorage":
    function getSessionKey(key) {
        var val = sessionStorage.getItem(key);
        if (val) {
            return val;
        } else {
            sessionStorage.setItem(key, 'clientDevLocalTest_' + key + '_' + Date.now());
            return sessionStorage.getItem(key);
        }
    }

    //getPost URL is used in cases where API call is fired from the client-side.
    // used in performInit in fast integration - sends the message to server side
    // can be deleted if not used
    function getPostUrl(url, method, data, onSuccess, onError) {
        var httpRequest = createHttpRequest();
        if (httpRequest instanceof self.XMLHttpRequest) {
            httpRequest.open(method, url, true);
            httpRequest.onreadystatechange = function () {
                if (httpRequest.readyState == 4) {
                    if (httpRequest.status == 204) {
                        return;
                    }
                    if (httpRequest.status == 200) {
                        onSuccess && onSuccess(httpRequest.responseText);
                    } else { onError && onError(); }
                }
            };
            httpRequest.send(data);
        }
        else {
            httpRequest.onload = function () {
                onSuccess && onSuccess(httpRequest.responseText);
            };
            httpRequest.onerror = function () {
                onError && onError();
            };
            httpRequest.onprogress = function () {
            };
            httpRequest.ontimeout = function () {
            };
            httpRequest.open(method, url, true);
            setTimeout(function () {
                httpRequest.send(data);
            }, 0);
        }
    }
    function createHttpRequest() {
        if (self.XMLHttpRequest && XMLHttpRequest.prototype.hasOwnProperty('withCredentials')) {
            return new XMLHttpRequest();
        }
        else if (self.XDomainRequest) {
            return new XDomainRequest();
        }
        else if (self.XMLHttpRequest) {
            return new XMLHttpRequest();
        }
        else {
            throw new Error('There is no supported http request object');
        }
    }

    //Use self function if the flush() function is part of the scope
    function performFlush() {
        if (document.readyState === 'complete') {
            subscribeForEvents();
        } else {
            document.addEventListener('readystatechange', function () {
                if (document.readyState === 'complete') {
                    subscribeForEvents();
                }
            });
        }
    }
    // self function comes with the performFlush() function. Here you define the events to which you want to register to trigger a flush.

    function subscribeForEvents() {
        [
            document.getElementById('psw'),
            document.getElementById('natali')
        ].forEach((checkElement) => {
            if (checkElement) {
                checkElement.addEventListener(
                    "mouseenter",
                    function() {
                        try {
                            cdApi.client.flush();
                        } catch (e) {}
                    }, {
                        capture: true
                    }
                );
    
                checkElement.addEventListener(
                    "mousedown",
                    function() {
                        try {
                            cdApi.client.flush();
                        } catch (e) {}
                    }, {
                        capture: true
                    }
                );
    
                checkElement.addEventListener(
                    "keydown",
                    function(event) {
                        if (event.keyCode == 13 || event.keyCode == 32) {
                            try {
                                cdApi.client.flush();
                            } catch (e) {}
                        }
                    }, {
                        capture: true
                    }
                );
    
                checkElement.addEventListener(
                    "touchstart",
                    function() {
                        try {
                            cdApi.client.flush();
                        } catch (e) {}
                    }, {
                        capture: true
                    }
                );
                checkElement.addEventListener('blur', function(event) {
                    if (event.keyCode == 13 || event.keyCode == 32) {
                        console.log('Keydown Preview Event - Flushing Data');
                        cdApi.client.flush();
                    }
                }, {
                    capture: true
                });
            }
        });
    };

    // Create the "cdApi" object in the browser:
    self.cdApi = {
        //Map of events and their subscribed listeners
        _eventListeners: {},
        configurationKeys: {
            // serverURL: "serverURL",
            // customerID: "customerID",
            wupServerURL:"wupServerURL",
            logServerURL: "logServerURL",
            enableFramesProcessing: "enableFramesProcessing",
            enableCustomElementsProcessing: "enableCustomElementsProcessing",
            enableSameSiteNoneAndSecureCookies:"enableSameSiteNoneAndSecureCookies",
            clientSettings: "clientSettings"
        },

        getConfigurations: function (callback) {
            var configurations = {}

            // configurations[cdApi.configurationKeys.serverURL] = "REPLACE_WITH_WUP_ENDPOINT";
            // configurations[cdApi.configurationKeys.customerID] = 'REPLACE_WITH_CID';
            configurations[cdApi.configurationKeys.wupServerURL] = "https://wup-4ff4f23f.eu.v2.we-stats.com/client/v3/web/wup?cid=dummy";
            configurations[cdApi.configurationKeys.logServerURL] = "https://logs-4ff4f23f.eu.v2.we-stats.com/api/v1/sendLogs";
            configurations[cdApi.configurationKeys.enableFramesProcessing] = true;
            configurations[cdApi.configurationKeys.enableSameSiteNoneAndSecureCookies] = true;
            configurations[cdApi.configurationKeys.enableCustomElementsProcessing] = true;
            configurations[cdApi.configurationKeys.clientSettings] = {
                enableFlush: true
            }

            callback(configurations);
        },
        /**
         * Handle messages arriving from the SDK library
         * @param e
         */

        onMessage: function (e) {
            var eventListeners = cdApi._eventListeners[e.data.type];
            //If there are no listeners we abort at self point
            if (!eventListeners) {
                return;
            }
            for (var i = 0; i < eventListeners.length; i++) {
                eventListeners[i](e.data.event);
            }
        },

        listenToEvents: function () {
            window.addEventListener ?
                window.addEventListener('message', cdApi.onMessage, true) :
                window.attachEvent('onmessage', cdApi.onMessage);
        },

        //** Note below are 4 examples of setting the getCustomerSessionID
        //1. Capturing the session Id from a metatag or any other HTML element
        //2. Capturing the session Id from a script variable
        //3. Capturing the session Id with an AJAX call to the web site server
        //4. Capturing the Session Id from a cookie
        //Naturally only one should be used. The remaining code should be deleted.
        //Appendix B: Example cdApi file
        //Confidential BioCatch API Reference for JavaScript for Web Page 11

        getCustomerSessionID: function (callback) {
            /**
             * Example 1: providing the customer session id by reading it from a metatag (or other html element)
             * in the page. The getMetatagContent is defined inside the function for example simplicity but it
             * can be also outside of the file.
             */
            callback(getMetatagContent('bcsid'));
            //e((t = "bcsid", sessionStorage.getItem(t) || (sessionStorage.setItem(t, "noSessionIDgenerated_" + t + "_" + Date.now()), sessionStorage.getItem(t))))
            /**
             * Example 2: providing the customer session id by reading it from JavaScript variable somewhere in the website
             * code. Assuming you have an object named BankXXX, the example read it from a variable. Can be also a function
             * or any JavaScript way to retrieve the data
             */
            // callback(BankXXX.sessionID);
            /**
             * Example 3: providing the customer session id from the server in an async manner using Ajax.
             */

            // We defined a function named getPostUrl for doing Ajax.
            // JQuery can be used instead as well.
            // var onSuccess = function (sid) {
            //         callback(sid); // call BioCatch callback
            //     };
            // var onError = function (err) {
            //     //decide what you should do. Probably retry
            // };
            // // call the server to get the session id
            // getPostUrl("/getSessionId", "GET", null, onSuccess, onError);
            /**
             * Example 4: providing the customer session id by reading it from a cookie named 'bankSID'.
             * We are using our own read cookie function. JQuery can be used instead
             */
            // var getCookie = function (key) {
            //     let result = new RegExp('(?:^|; )' + encodeURIComponent(key) + '=([^;]*)').exec(document.cookie);
            //     return (result ? decodeURIComponent(result[1]) : "");
            // };
            // callback(getCookie('bankSID'));
        },

        // Get the score-manager (API) address.
        // Required only to "performInit" - so if the init is server-to-server - NOT needed.
        getServerApiAddress: function (callback) {
            callback(getMetatagContent('bcServerApiAddress'));
        },


        // in case the customer wants to be notified on the hearthbeatstate state - starting/started
        getCdHeartbeatStatus: function (callback) {
            function onNotification(e) {
                var msg = e.data;
                if (msg.type == 'cdHeartbeat') {
                    callback(msg.data);
                }
            }

            window.addEventListener ?
                window.addEventListener('message', onNotification, true) :
                window.attachEvent('onmessage', onNotification);
        },

        // in case the customer wants to be notified on the SDK state - starting/started
        getSdkState: function (callback) {
            function onNotification(e) {
                var msg = e.data;
                if (msg.type == 'cdStateChangedEvent') {
                    callback(msg.event['state']);
                    if (msg.event['state'] == 'started') {
                        window.removeEventListener('message', onNotification, true);
                    }
                }
            }

            window.addEventListener ?
                window.addEventListener('message', onNotification, true) :
                window.attachEvent('onmessage', onNotification);
        },

        // in case the customer wants to be notified on reset session - session number regeneration
        registerSessionNumberChange: function (callback) {
            function onNotification(e) {
                var msg = e.data;
                if (msg.type == 'SNumNotification') {
                    callback(msg.cdSNum);
                }
            }

            window.addEventListener ?
                window.addEventListener('message', onNotification, true) :
                window.attachEvent('onmessage', onNotification);
        },
        /**
         * Add a listener for the specified event
         * @param eventType - The event to listen to
         * @param listenerFunction - The listener function
         */
        addEventListener: function (eventType, listenerFunction) {
            var n = cdApi._eventListeners[eventType];
            n || (n = [], cdApi._eventListeners[eventType] = n), n.push(listenerFunction)
        },
        /**
         * Remove a listener from the specified event
         * @param eventType - The event to remove the listener from
         * @param listenerFunction - The listener function to remove
         */
        removeEventListener: function (eventType, listenerFunction) {
            var listenersList = cdApi._eventListeners[eventType];

            //Nothing is subscribed for self event
            if (!listenersList) {
                return;
            }

            for (var i = 0; i < listenersList.length; i++) {
                if (listenersList[i] === listenerFunction) {
                    listenersList.splice(i);
                }
            }
            // window.postMessage({
            //     type: 'RemoveEventListenerCommand',
            //     eventType: eventType,
            //     listenerFunction: listenerFunction
            // }, window.location.href);
        },
        // api for customer to change context - notify the js on context change and send data
        // This is the best practice to send us the contexts information.
        // If the context is not from the "allowed contexts" list - it prompts an error in console.
        changeContext: function (contextName) {
            window.postMessage({ type: 'ContextChange', context: contextName }, window.location.href);
        },
        /**
         * Start a new session
         */
        startNewSession: function () {
            window.postMessage({ type: 'ResetSession', resetReason: 'customerApi' }, window.location.href);
        },
        // customer api for stopping the js from collecting data
        // May be used by the customer (e.g. in case of "heavey" page loads etc.)
        pauseCollection: function () {
            window.postMessage({ type: 'cdChangeState', toState: 'pause' }, window.location.href);
        },

        resumeCollection: function () {
            window.postMessage({ type: 'cdChangeState', toState: 'run' }, window.location.href);
        },

        sendMetadata: function (data) {
            window.postMessage({ type: 'cdCustomerMetadata', data: data }, window.location.href);
        },

        setCustomerSessionId: function (csid) {
            window.postMessage({ type: 'cdSetCsid', csid: csid }, window.location.href);
        },
         setCustomerBrand: function (brand) {
            window.postMessage({type: 'cdSetCustomerBrand', brand: brand}, window.location.href);
        }


     
      
    },
        //Register to receive events
        cdApi.listenToEvents();
        performFlush();
}();var cdwpb;!function(){var r={440:function(e,t,r){"use strict";function apply(e){function Hf(e,t){for(var r=0,n=i.length,o=[];r<n;r++)i[r][e]==t&&o.push(i[r]);return o}function If(e,t){for(var r,n=i.length;n--;)(r=i[n]).entryType!=e||void 0!==t&&r.name!=t||i.splice(n,1)}var t=Date.now?Date.now():+new Date,n=e.performance||{},i=[],o={};n.now||(n.now=n.webkitNow||n.mozNow||n.msNow||function(){return(Date.now?Date.now():+new Date)-t}),n.mark||(n.mark=n.webkitMark||function(e){var t={name:e,entryType:"mark",startTime:n.now(),duration:0};i.push(t),o[e]=t}),n.measure||(n.measure=n.webkitMeasure||function(e,t,r){if(void 0!==r&&void 0===o[r])throw new SyntaxError("Failed to execute 'measure' on 'Performance': The mark '"+r+"' does not exist.");if(void 0!==t&&void 0===o[t])throw new SyntaxError("Failed to execute 'measure' on 'Performance': The mark '"+t+"' does not exist.");t=o[t]?o[t].startTime:0,r=o[r]?o[r].startTime:n.now(),i.push({name:e,entryType:"measure",startTime:t,duration:r-t})}),n.getEntriesByType||(n.getEntriesByType=n.webkitGetEntriesByType||function(e){return Hf("entryType",e)}),n.getEntriesByName||(n.getEntriesByName=n.webkitGetEntriesByName||function(e){return Hf("name",e)}),n.clearMarks||(n.clearMarks=n.webkitClearMarks||function(e){If("mark",e)}),n.clearMeasures||(n.clearMeasures=n.webkitClearMeasures||function(e){If("measure",e)}),e.performance=n,"function"==typeof define&&r.amdO&&define("performance",[],function(){return n})}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Polyfills_apply(){var n,t,r;function Kg(e){return"function"==typeof e||"[object Function]"===t.call(e)}function Lg(e){return e=Number(e),isNaN(e)?0:0!==e&&isFinite(e)?(0<e?1:-1)*Math.floor(Math.abs(e)):e}function Ng(e){return e=Lg(e),Math.min(Math.max(e,0),r)}Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push(t);return r}),Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),1}catch(e){return}}()||(n=Object.defineProperty,Object.defineProperty=function(e,t,r){if(n)try{return n(e,t,r)}catch(e){}if(e!==Object(e))throw TypeError("Object.defineProperty called on non-object");return Object.prototype.__defineGetter__&&"get"in r&&Object.prototype.__defineGetter__.call(e,t,r.get),Object.prototype.__defineSetter__&&"set"in r&&Object.prototype.__defineSetter__.call(e,t,r.set),"value"in r&&(e[t]=r.value),e}),"function"!=typeof Object.defineProperties&&(Object.defineProperties=function(e,t){if(e!==Object(e))throw TypeError("Object.defineProperties called on non-object");for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&Object.defineProperty(e,r,t[r]);return e}),"function"!=typeof Object.create&&(Object.create=function(e,t){if("object"!==_typeof(e))throw TypeError();function Ctor(){}Ctor.prototype=e;var r=new Ctor;if(e&&(r.constructor=Ctor),void 0!==t){if(t!==Object(t))throw TypeError();Object.defineProperties(r,t)}return r}),Object.keys||(Object.keys=function(e){if(e!==Object(e))throw TypeError("Object.keys called on non-object");var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push(t);return r}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var r,n;if(null==self)throw new TypeError(" self is null or not defined");var o,i=Object(self),s=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(r=t),n=0;n<s;)n in i&&(o=i[n],e.call(r,o,n,i)),n++}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof self)throw TypeError("Bind must be called on a function");function Ig(){return n.apply(self.prototype&&self instanceof nop?self:e,r.concat(t.call(arguments)))}var t=[].slice,r=t.call(arguments,1),n=self;function nop(){}return nop.prototype=n.prototype,Ig.prototype=new nop,Ig}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return self.replace(/^\s+|\s+$/g,"")}),Array.from||(Array.from=(t=Object.prototype.toString,r=Math.pow(2,53)-1,function from(e){var t=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var r,n=1<arguments.length?arguments[1]:void 0;if(void 0!==n){if(!Kg(n))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(r=arguments[2])}for(var o,i=Ng(t.length),s=Kg(self)?Object(new self(i)):new Array(i),a=0;a<i;)o=t[a],s[a]=n?void 0===r?n(o,a):n.call(r,o,a):o,a+=1;return s.length=i,s})),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function value(e){if(null==self)throw new TypeError('"self" is null or not defined');var t=Object(self),r=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n=arguments[1],o=0;o<r;){var i=t[o];if(e.call(n,i,o,t))return i;o++}},configurable:!0,writable:!0}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function value(e,t){if(null==self)throw new TypeError('"self" is null or not defined');var r=Object(self),n=r.length>>>0;if(0==n)return!1;var t=0|t,o=Math.max(0<=t?t:n-Math.abs(t),0);for(;o<n;){if(function sameValueZero(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}(r[o],e))return!0;o++}return!1},configurable:!0,writable:!0}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(self.document||self.ownerDocument).querySelectorAll(e),r=t.length;0<=--r&&t.item(r)!==self;);return-1<r}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function assign(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])}return r},writable:!0,configurable:!0}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return self.substr(!t||t<0?0:+t,e.length)===e}),String.prototype.includes||(String.prototype.includes=function(e,t){if(e instanceof RegExp)throw TypeError("first argument must not be a RegExp");return void 0===t&&(t=0),-1!==self.indexOf(e,t)}),self.MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver}function WeakMapPolyfill_typeof(e){return(WeakMapPolyfill_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function WeakMapPolyfill_apply(e){var r,n;function isObject(e){return Object(e)===e}function checkInstance(e,t){if(!isObject(e)||!r.call(e,"_id"))throw new TypeError(t+" method called on incompatible receiver "+WeakMapPolyfill_typeof(e))}function rand(){return Math.random().toString().substring(2)}function WeakMap(){if(void 0===self)throw new TypeError("Constructor WeakMap requires 'new'");if(n(self,"_id",function genId(e){return e+"_"+rand()+"."+rand()}("_WeakMap")),0<arguments.length)throw new TypeError("WeakMap iterable is not supported")}e.WeakMap||(r=Object.prototype.hasOwnProperty,n=function defineProperty(e,t,r){Object.defineProperty?Object.defineProperty(e,t,{configurable:!0,writable:!0,value:r}):e[t]=r},e.WeakMap=(n(WeakMap.prototype,"delete",function(e){if(checkInstance(self,"delete"),!isObject(e))return!1;var t=e[self._id];return!(!t||t[0]!==e)&&(delete e[self._id],!0)}),n(WeakMap.prototype,"get",function(e){if(checkInstance(self,"get"),isObject(e)){var t=e[self._id];return t&&t[0]===e?t[1]:void 0}}),n(WeakMap.prototype,"has",function(e){if(checkInstance(self,"has"),!isObject(e))return!1;var t=e[self._id];return!(!t||t[0]!==e)}),n(WeakMap.prototype,"set",function(e,t){if(checkInstance(self,"set"),!isObject(e))throw new TypeError("Invalid value used as weak map key");var r=e[self._id];return r&&r[0]===e?r[1]=t:n(e,self._id,[e,t]),self}),n(WeakMap,"_polyfill",!0),WeakMap))}r.d(t,{default:function(){return Ei}});var i="getConfigurations",n="client",C={resetSessionApiThreshold:"resetSessionApiThreshold",dataWupDispatchRateSettings:"dataWupDispatchRateSettings",logWupDispatchRateSettings:"logWupDispatchRateSettings",forceDynamicDataWupDispatchSettings:"forceDynamicDataWupDispatchSettings",wupStatisticsLogIntervalMs:"wupStatisticsLogIntervalMs",serverCommunicationSettings:"serverCommunicationSettings",wupResponseTimeout:"wupResponseTimeout",wupMessageRequestTimeout:"wupMessageRequestTimeout",logMessageRequestTimeout:"logMessageRequestTimeout",collectKeyRegionValue:"collectKeyRegionValue",crossDomainsList:"crossDomainsList",crossDomainsTimeout:"crossDomainsTimeout",isMutationObserver:"isMutationObserver",isEnabled:"isEnabled",slaveChannelHandshakeTimeout:"slaveChannelHandshakeTimeout",slaveAliveMessageInterval:"slaveAliveMessageInterval",collectCustomElementAttribute:"collectCustomElementAttribute",customElementAttribute:"customElementAttribute",enableFramesProcessing:"enableFramesProcessing",enableSameSiteNoneAndSecureCookies:"enableSameSiteNoneAndSecureCookies",wupServerURL:"wupServerURL",logAddress:"logAddress",shouldMaskClickEventValueField:"shouldMaskClickEventValueField",isCaptureKeyEvents:"isCaptureKeyEvents",locationEventsTimeoutMsec:"locationEventsTimeoutMsec",heartBeatMessageInterval:"heartBeatMessageInterval",isMotionAroundTouchEnabled:"isMotionAroundTouchEnabled",motionPaddingAroundTouchMSec:"motionPaddingAroundTouchMSec",isMotionOnSessionStart:"isMotionOnSessionStart",motionPaddingOnSessionStartMSec:"motionPaddingOnSessionStartMSec",isVMDetection:"isVMDetection",isScrollCollect:"isScrollCollect",isContextPropsFeature:"isContextPropsFeature",isCrossDomain:"isCrossdomain",gyroEventsThreshold:"gyroEventsThreshold",gyroEventsSamplePeriod:"gyroEventsSamplePeriod",dataQPassWorkerInterval:"dataQPassWorkerInterval",accelerometerEventsSamplePeriod:"accelerometerEventsSamplePeriod",orientationEventsThreshold:"orientationEventsThreshold",orientationEventsSamplePeriod:"orientationEventsSamplePeriod",isAudioDetection:"isAudioDetection",stateChangeEnabled:"stateChangeEnabled",logLevel:"logLevel",enableCustomElementsProcessing:"enableCustomElementsProcessing",keyEventsMaskSpecialChars:"keyEventsMaskSpecialChars",collectSelectElementBlurAndFocusEvents:"collectSelectElementBlurAndFocusEvents",allowedUnmaskedValuesList:"allowedUnmaskedValuesList",enableUnmaskedValues:"enableUnmaskedValues",wupMessageNumToRetry:"wupMessageNumToRetry",wupMessageRetryInterval:"wupMessageRetryInterval",wupIncrementalGrowthBetweenFailures:"wupIncrementalGrowthBetweenFailures",wupMaxIntervalBetweenFailures:"wupMaxIntervalBetweenFailures",logMessageNumToRetry:"logMessageNumToRetry",logMessageRetryInterval:"logMessageRetryInterval",logIncrementalGrowthBetweenFailures:"logIncrementalGrowthBetweenFailures",logMaxIntervalBetweenFailures:"logMaxIntervalBetweenFailures",cdsNumExpirationTime:"cdsNumExpirationTime",maskElementsAttributes:"maskElementsAttributes"};function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function ElementSettings(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ElementSettings),self._customElementAttribute=e?e[C.customElementAttribute]:null,self._attributesToMask=e?e[C.maskElementsAttributes]:null}return function _createClass(e,t,r){t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ElementSettings,[{key:"getCustomElementAttribute",value:function getCustomElementAttribute(){return self._customElementAttribute}},{key:"getAttributesToMask",value:function getAttributesToMask(){return self._attributesToMask}}]),ElementSettings}(),s={wupServerURL:"wupServerURL",logServerURL:"logServerURL",enableFramesProcessing:"enableFramesProcessing",enableCustomElementsProcessing:"enableCustomElementsProcessing",enableSameSiteNoneAndSecureCookies:"enableSameSiteNoneAndSecureCookies",serverURL:"serverURL",customerID:"customerID",useUrlWorker:"useUrlWorker",workerUrl:"workerUrl",clientSettings:"clientSettings",collectionSettings:"collectionSettings",elementSettings:"elementSettings",enableCustomElementDetector:"enableCustomElementDetector",attributeSettings:"attributeSettings",isWupServerURLProxy:"isWupServerURLProxy"};function CollectionSettings_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=function(){function CollectionSettings(e){!function CollectionSettings_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CollectionSettings),self._elementSettings=new o(e&&e[s.elementSettings])}return function CollectionSettings_createClass(e,t,r){t&&CollectionSettings_defineProperties(e.prototype,t),r&&CollectionSettings_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CollectionSettings,[{key:"getElementSettings",value:function getElementSettings(){return self._elementSettings}}]),CollectionSettings}();function StartupConfigurations_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function StartupConfigurations(e,t,r,n,o,i,s,a,u,c){!function StartupConfigurations_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,StartupConfigurations),self._wupServerURL=e,self._logServerURL=t,self._enableFramesProcessing=r,self._enableCustomElementsProcessing=n,self._enableSameSiteNoneAndSecureCookies=o,self._useUrlWorker=i,self._workerUrl=s,self._isWupServerURLProxy=a,self._clientSettings=u,self._collectionSettings=c||new l}return function StartupConfigurations_createClass(e,t,r){t&&StartupConfigurations_defineProperties(e.prototype,t),r&&StartupConfigurations_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(StartupConfigurations,[{key:"getWupServerURL",value:function getWupServerURL(){return self._wupServerURL}},{key:"getLogServerURL",value:function getLogServerURL(){return self._logServerURL}},{key:"getEnableFramesProcessing",value:function getEnableFramesProcessing(){return self._enableFramesProcessing}},{key:"getEnableCustomElementsProcessing",value:function getEnableCustomElementsProcessing(){return self._enableCustomElementsProcessing}},{key:"getEnableSameSiteNoneAndSecureCookies",value:function getEnableSameSiteNoneAndSecureCookies(){return self._enableSameSiteNoneAndSecureCookies}},{key:"getUseUrlWorker",value:function getUseUrlWorker(){return self._useUrlWorker}},{key:"getWorkerUrl",value:function getWorkerUrl(){return self._workerUrl}},{key:"getIsWupServerURLProxy",value:function getIsWupServerURLProxy(){return self._isWupServerURLProxy}},{key:"getClientSettings",value:function getClientSettings(){return self._clientSettings}},{key:"getCollectionSettings",value:function getCollectionSettings(){return self._collectionSettings}}]),StartupConfigurations}(),u={DEBUG:10,INFO:20,WARN:30,ERROR:40,CRITICAL:50,OFF:80};function Logger_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Logger_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Logger_createClass(e,t,r){return t&&Logger_defineProperties(e.prototype,t),r&&Logger_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var w=function(){function Log(){Logger_classCallCheck(self,Log)}return Logger_createClass(Log,null,[{key:"setLogger",value:function setLogger(e){self._logger=e}},{key:"isDebug",value:function isDebug(){if(self._logger)return self._logger.isDebug()}},{key:"error",value:function error(e,t){self._logger&&self._logger.error(e,t||null)}},{key:"warn",value:function warn(e,t){self._logger&&self._logger.warn(e,t||null)}},{key:"trace",value:function trace(e){self._logger&&self._logger.trace(e)}},{key:"debug",value:function debug(e){self._logger&&self._logger.debug(e)}},{key:"info",value:function info(e){self._logger&&self._logger.info(e)}}]),Log}(),f=function(){function Logger(e,t){Logger_classCallCheck(self,Logger),self._logBridge=e,self._logLevel=t||u.INFO}return Logger_createClass(Logger,[{key:"trace",value:function trace(e){self._sendToLogBridge(e,u.DEBUG)}},{key:"debug",value:function debug(e){self._sendToLogBridge(e,u.DEBUG)}},{key:"info",value:function info(e){self._sendToLogBridge(e,u.INFO)}},{key:"warn",value:function warn(e,t){self._sendToLogBridge(e,u.WARN,t)}},{key:"error",value:function error(e,t){self._sendToLogBridge(e,u.ERROR,t)}},{key:"isDebug",value:function isDebug(){return self._logLevel===u.DEBUG}},{key:"updateLogConfig",value:function updateLogConfig(e){self._logLevel=e.get(C.logLevel)||self._logLevel,self._logBridge.setLogLevel(self._logLevel),self._logBridge.clearLogEntriesByLogLevel(self._logLevel)}},{key:"_sendToLogBridge",value:function _sendToLogBridge(e,t,r){t>=self._logLevel&&(r&&r.stack&&(e+=" ;stack: ".concat(r.stack)),self._logBridge.log(e,t))}}]),Logger}();function URLFieldsExtractor_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=function(){function URLFieldsExtractor(){!function URLFieldsExtractor_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,URLFieldsExtractor)}return function URLFieldsExtractor_createClass(e,t,r){t&&URLFieldsExtractor_defineProperties(e.prototype,t),r&&URLFieldsExtractor_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(URLFieldsExtractor,null,[{key:"extract",value:function extract(e){if(!e)throw new Error("Invalid wupServerURL. Parameter is empty");var t={};if(t.cid=self.getCID(e),t.serverURL=self.getServerURL(e),!t.serverURL)throw new Error("Invalid field. Failed extracting the address parameter: ".concat(e));if(!t.cid)throw new Error("Invalid field. Failed extracting the cid parameter: ".concat(e));return t}},{key:"getCID",value:function getCID(e){e=URLFieldsExtractor.extractCid(e);return e||null}},{key:"extractCid",value:function extractCid(e){var t=e.indexOf("cid=");if(-1===t)return null;t+=4;var r=-1===(r=e.indexOf("&",t))?void 0:r;return e.substring(t,r)}},{key:"getServerURL",value:function getServerURL(e){var t=e.indexOf("/client/v",e);return(t=-1===t?null:t)?e.substring(0,t):null}}]),URLFieldsExtractor}();function HttpRequestFactory_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var p=function(){function HttpRequestFactory(){!function HttpRequestFactory_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,HttpRequestFactory)}return function HttpRequestFactory_createClass(e,t,r){t&&HttpRequestFactory_defineProperties(e.prototype,t),r&&HttpRequestFactory_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(HttpRequestFactory,null,[{key:"create",value:function create(){if(self.XMLHttpRequest&&Object.prototype.hasOwnProperty.call(XMLHttpRequest.prototype,"withCredentials"))return new XMLHttpRequest;if(self.XDomainRequest)return new XDomainRequest;if(!self.XMLHttpRequest)throw new Error("There is no supported http request object");return new XMLHttpRequest}}]),HttpRequestFactory}(),d=60,h=1,v=44640,y=1,_=0,g=-1;function CDUtils_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var m,b,E,P=(m=null,function(o,e,i){function ek(){return e}var s,t;(function testNativeCode(){return-1<e.toString().indexOf("[native code]")})()?i(ek()):(s=0,t=function timerFunction(){if(m.contentWindow){for(var e=m.contentWindow,t=o.split("."),r=e,n=0;n<t.length;n++)r=r[t[n]];i(r)}else s<45?(setTimeout(timerFunction,s),s++):i(ek())},m||((m=document.createElement("IFRAME")).setAttribute("sandbox","allow-same-origin"),m.style.display="none",document.documentElement.appendChild(m)),t())}),S=function(){function CDUtils(){!function CDUtils_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CDUtils)}return function CDUtils_createClass(e,t,r){t&&CDUtils_defineProperties(e.prototype,t),r&&CDUtils_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CDUtils,null,[{key:"isUndefinedNull",value:function isUndefinedNull(e){return null==e||void 0===e}},{key:"addEventListener",value:function addEventListener(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],i=5<arguments.length&&void 0!==arguments[5]&&arguments[5];self.isPassiveSupported?e.addEventListener(t,r,{capture:n,passive:o,once:i}):e.addEventListener?e.addEventListener(t,r,n):e.attachEvent("on"+t,r)}},{key:"removeEventListener",value:function removeEventListener(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3];e.removeEventListener?e.removeEventListener(t,r,n):e.detachEvent("on"+t,r)}},{key:"hasProtocol",value:function hasProtocol(e){return e.toLowerCase().startsWith("http://")||e.toLowerCase().startsWith("https://")}},{key:"clearTextFromNumbers",value:function clearTextFromNumbers(e){return e?e.replace(/(\d)/g,"*"):""}},{key:"maskText",value:function maskText(e){return self.isUndefinedNull(e)?"":e.replace(/[\d]/g,"1").replace(/[a-zA-Z]/g,"a").replace(/[^a-zA-Z\d\u0000-\u0080]/g,"*")}},{key:"getDropDownListValues",value:function getDropDownListValues(e){for(var t=[],r=0;r<e.length;r++){var n=e.options[r].text||e.options[r].value||"";t.push(CDUtils.maskText(n))}return t}},{key:"getDocUrl",value:function getDocUrl(){var e=window.location;return e.protocol+"//"+e.hostname+(e.port?":"+e.port:"")+CDUtils.clearTextFromNumbers(e.pathname)}},{key:"getHash",value:function getHash(e){for(var t=0,r=0,n=e.length;r<n;r++)t=(t<<5)-t+e.charCodeAt(r),t&=t;return t}},{key:"getTruncatedHash",value:function getTruncatedHash(e,t){return e?self.murmurhash3(e).toString().substring(t):""}},{key:"murmurhash3",value:function murmurhash3(e,t){for(var r,n,o=3&e.length,i=e.length-o,s=t,a=3432918353,u=461845907,c=0;c<i;)n=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,s=27492+(65535&(r=5*(65535&(s=(s^=n=(65535&(n=(n=(65535&n)*a+(((n>>>16)*a&65535)<<16)&4294967295)<<15|n>>>17))*u+(((n>>>16)*u&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(r>>>16)&65535)<<16);switch(n=0,o){case 3:n^=(255&e.charCodeAt(c+2))<<16;break;case 2:n^=(255&e.charCodeAt(c+1))<<8;break;case 1:s^=n=(65535&(n=(n=(65535&(n^=255&e.charCodeAt(c)))*a+(((n>>>16)*a&65535)<<16)&4294967295)<<15|n>>>17))*u+(((n>>>16)*u&65535)<<16)&4294967295}return s^=e.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,(s^=s>>>16)>>>0}},{key:"generateUUID",value:function generateUUID(){var r=CDUtils.dateNow();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"===e?t:3&t|8).toString(16)})}},{key:"convertToArrayByMap",value:function convertToArrayByMap(e,t){for(var r=[null],n=0,o=e.length;n<o;n++)r[n+1]=t[e[n]];return r}},{key:"getPostUrl",value:function getPostUrl(e,t,r,n,o,i,s){var a=p.create();a instanceof self.XMLHttpRequest?(a.open(t,e,!0),void 0!==s&&(a.timeout=s),a.withCredentials=!1!==i,"POST"===t&&a.setRequestHeader("Content-Type","application/json; charset=utf-8"),a.onreadystatechange=function(){4===a.readyState&&204!==a.status&&(200===a.status?n&&n(a.responseText):o&&o(a.responseText))},a.ontimeout=function(){o&&o("timeout",r)},a.send(r)):(a.onload=function(){n&&n(a.responseText)},a.onerror=function(){o&&o()},a.onprogress=function(){},a.ontimeout=function(){},a.open(t,e,!0),setTimeout(function(){a.send(r)},0))}},{key:"minutesToMilliseconds",value:function minutesToMilliseconds(e){return 60*e*1e3}},{key:"cutDecimalPointDigits",value:function cutDecimalPointDigits(e,t){t=Math.pow(10,t);return Math.round(e*t)/t}}]),CDUtils}();function URLBuilder_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}_defineProperty(S,"scriptVersion","2.27.0.1257.6ffd198"),_defineProperty(S,"isPassiveSupported",function isPassiveSupported(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function get(){e=!0}});window.addEventListener("test",null,t)}catch(e){}return e}()),_defineProperty(S,"dateNow",Date.now),_defineProperty(S,"setZeroTimeout",(b=[],E="Window_"+S.generateUUID(),S.addEventListener(window,"message",function receiveMessage(e){e.data===E&&(e.stopPropagation&&e.stopPropagation(),e.returnValue&&(e.returnValue=!1),e.cancelBubble&&(e.cancelBubble=!0),b.shift()())},!0),function(e){b.push(e),window.postMessage(E,self.location.href)})),_defineProperty(S,"asyncCall",function(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var o=self;S.setZeroTimeout(function(){o.apply(e||window,r)})}),_defineProperty(S,"StorageUtils",{counter:0,getAndUpdateEventSequenceNumber:function getAndUpdateEventSequenceNumber(){return self.counter++},deserialize:function deserialize(t){if("string"!=typeof t)return null;try{return JSON.parse(t)}catch(e){return t||null}},getFromLocalStorage:function getFromLocalStorage(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;try{var r=self.deserialize(window.localStorage.getItem(e));return r?r.exp&&S.dateNow()-r.time>r.exp?(self.removeFromLocalStorage(e),null):void 0===t||t?r.val:r:null}catch(e){return null}},saveToLocalStorage:function saveToLocalStorage(e,t,r){var n={val:t};r&&(n.exp=r,n.time=S.dateNow());try{window.localStorage.setItem(e,JSON.stringify(n))}catch(e){return null}return n},removeFromLocalStorage:function removeFromLocalStorage(e){try{window.localStorage.removeItem(e)}catch(e){return null}},setExpirationInLocalStorage:function setExpirationInLocalStorage(e,t){var r=self.getFromLocalStorage(e);return""===r||null===r?y:self.saveToLocalStorage(e,r,t)?_:g},getFromSessionStorage:function getFromSessionStorage(e){try{var t=self.deserialize(window.sessionStorage.getItem(e));return t?t:null}catch(e){return null}},saveToSessionStorage:function saveToSessionStorage(e,t){try{return t?(window.sessionStorage.setItem(e,JSON.stringify(t)),t):window.sessionStorage.removeItem(e)}catch(e){return null}},removeFromSessionStorage:function removeFromSessionStorage(e){try{window.sessionStorage.removeItem(e)}catch(e){return null}},getCookie:function getCookie(e){e=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie);return e?decodeURIComponent(e[1]):""},setCookie:function setCookie(e,t,r,n){var o,i="";r&&((o=new Date).setTime(o.getTime()+r),i="; expires="+o.toUTCString());for(var s=0,a=location.hostname,u=a.split("."),c="",l=!1;s<=u.length-1&&!l;)"localhost"===(a=u.slice(-1-++s).join("."))?c="":""!==a&&(c="; domain=."+a),l=self.setCookieWithAttributes(e,t,i,c,n);return l||(c="",l=self.setCookieWithAttributes(e,t,i,c,n)),l},setCookieWithAttributes:function setCookieWithAttributes(e,t,r,n,o){n=encodeURIComponent(e)+"="+encodeURIComponent(t)+r+n+"; path=/;";return document.cookie=o?n+" ".concat("SameSite=None;"," ").concat("Secure"):n,self.getCookie(e)===t},setExpirationInCookie:function setExpirationInCookie(e,t){var r=self.getCookie(e);return""===r||null===r?y:self.setCookie(e,r,t)?_:g},removeCookie:function removeCookie(e){try{document.cookie=e+"=; Max-Age=0"}catch(e){return null}},validateBcId:function validateBcId(e){return/^([0-9]{13,}-)?[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)?e:null}}),_defineProperty(S,"getNativeWindowFn",P),_defineProperty(S,"JQueryUtils",{isJQueryAvailable:function isJQueryAvailable(){return void 0!==window.jQuery},addEventListener:function addEventListener(e,t,r){jQuery(e).on(t,r)},removeEventListener:function removeEventListener(e,t,r){jQuery(e).off(t,r)}}),function dateNowFixer(){Date.now?P("Date.now",Date.now,function(e){S.dateNow=e}):S.dateNow=function now(){return(new Date).getTime()}}();var k=function(){function URLBuilder(){!function URLBuilder_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,URLBuilder)}return function URLBuilder_createClass(e,t,r){t&&URLBuilder_defineProperties(e.prototype,t),r&&URLBuilder_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(URLBuilder,null,[{key:"build",value:function build(e,t){var r="/client/v3.1/web/wup";if(!e)throw new Error("Invalid server URL. Parameter is empty");return(S.hasProtocol(e)?"":"".concat("https","://")).concat(e).concat(r,"?cid=").concat(t)}},{key:"buildCustomServerUrl",value:function buildCustomServerUrl(e){if(!e)throw new Error("Invalid server URL. Parameter is empty");return S.hasProtocol(e)?e:"".concat("https","://").concat(e)}}]),URLBuilder}();function CDAPIException_typeof(e){return(CDAPIException_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function CDAPIException_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createSuper(r){var n=_isNativeReflectConstruct();return function _createSuperInternal(){var e,t=_getPrototypeOf(r);return function _possibleConstructorReturn(e,t){{if(t&&("object"===CDAPIException_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function _assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function _wrapNativeSuper(e){if(null===e||!function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,Wrapper)}function Wrapper(){return _construct(e,arguments,_getPrototypeOf(self).constructor)}return Wrapper.prototype=Object.create(e.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,e)})(e)}function _construct(e,t,r){return(_construct=_isNativeReflectConstruct()?Reflect.construct.bind():function _construct(e,t,r){var n=[null];n.push.apply(n,t);n=new(Function.bind.apply(e,n));return r&&_setPrototypeOf(n,r.prototype),n}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var O=function(){!function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}(CDAPIException,_wrapNativeSuper(Error));var e=_createSuper(CDAPIException);function CDAPIException(){return function CDAPIException_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CDAPIException),e.apply(self,arguments)}return function CDAPIException_createClass(e,t,r){return t&&CDAPIException_defineProperties(e.prototype,t),r&&CDAPIException_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(CDAPIException)}(),B="enableRestart",M="enableFlush",R="enableCustomElements";function CdApiFacade_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var D=function(){function CdApiFacade(e){!function CdApiFacade_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CdApiFacade),self._utils=e}return function CdApiFacade_createClass(e,t,r){t&&CdApiFacade_defineProperties(e.prototype,t),r&&CdApiFacade_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CdApiFacade,[{key:"getCustomerSessionID",value:function getCustomerSessionID(t){self._getFromApiOrEmpty("getCustomerSessionID",function(e){t(e)})}},{key:"getLogServerAddress",value:function getLogServerAddress(t){self._getFromApiOrEmpty("getLogServerAddress",function(e){t(e)})}},{key:"getServerAddress",value:function getServerAddress(t){self._getFromApiOrEmpty("getCustomerConfigLocation",function(e){t(e)})}},{key:"getConfigurations",value:function getConfigurations(n){var e=self,o=null;self.isApiAvailable(i)?self._getFromApiOrEmpty(i,function(e){var t=null;if(e){if(e.isWupServerURLProxy)o=e.wupServerURL;else if(e[s.wupServerURL]){var r=c.extract(e[s.wupServerURL]);o=k.build(r.serverURL,r.cid)}else{if(!e[s.customerID]||!e[s.serverURL])throw new Error("Invalid serverURL or cid. Parameter is empty");o=k.build(e[s.serverURL],e[s.customerID])}t=new a(o,e[s.logServerURL],e[s.enableFramesProcessing],e[s.enableCustomElementsProcessing],e[s.enableSameSiteNoneAndSecureCookies],e[s.useUrlWorker]||!1,e[s.workerUrl]||"",e[s.isWupServerURLProxy]||!1,e[s.clientSettings],new l(e[s.collectionSettings]))}n(t)}):self.getLogServerAddress(function(t){e.getServerAddress(function(e){e=c.extract(e);o=k.build(e.serverURL,e.cid),n(new a(o,t,null,!1,"",null))})})}},{key:"createClientInterface",value:function createClientInterface(t,e){if(!self.isCDAPIAvailable())throw w.error("Failed setting client facade. cdApi is unavailable."),new O("Failed setting client facade. cdApi is unavailable.");var r={};e[B]&&(r.restart=function(){t.restart()}),e[M]&&(r.flush=function(){t.flush()}),e[R]&&(r.submitCustomElement=function(e){t.submitCustomElement(e)}),window.cdApi[n]=r}},{key:"isCDAPIAvailable",value:function isCDAPIAvailable(){return!!window.cdApi}},{key:"isApiAvailable",value:function isApiAvailable(e){return!!window.cdApi&&!!window.cdApi[e]}},{key:"_getFromApiOrEmpty",value:function _getFromApiOrEmpty(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(!window.cdApi)return 20<=r?void w.error("Failed getting cdApi after all retries."):(0===r&&w.warn("cdApi not found in retry ".concat(r)),r++,void setTimeout(self._getFromApiOrEmpty.bind(self,t,e,r),100));if(!window.cdApi[t])return w.warn("User did not implement cdApi method: ".concat(t)),void e("");try{window.cdApi[t](e)}catch(e){throw w.error("An error has occurred while calling cdApi ".concat(t," function. Exception was thrown from client implementation."),e),e}}}]),CdApiFacade}();function SupportedBrowserChecker_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var F=function(){function SupportedBrowserChecker(){!function SupportedBrowserChecker_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,SupportedBrowserChecker)}return function SupportedBrowserChecker_createClass(e,t,r){t&&SupportedBrowserChecker_defineProperties(e.prototype,t),r&&SupportedBrowserChecker_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(SupportedBrowserChecker,null,[{key:"isSupported",value:function isSupported(){return!("undefined"==typeof WeakMap||!window.Worker||!window.MutationObserver)}}]),SupportedBrowserChecker}(),T="startNewSessionCommand",I="resumeSessionCommand",x="changeContextCommand",L="updateCsidCommand",j="updatePsidCommand",A="updateLogUrl",U="sendDataCommand",N="sendLogCommand",W="updateBrandCommand",H={stopped:"stopped",starting:"starting",started:"started",paused:"paused",faulted:"faulted"},t=r(599),Q=r.n(t);function CDPort_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var z=function(){function CDPort(e){!function CDPort_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CDPort),self._portNativeWorker=e}return function CDPort_createClass(e,t,r){t&&CDPort_defineProperties(e.prototype,t),r&&CDPort_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CDPort,[{key:"postMessage",value:function postMessage(){self._portNativeWorker.postMessage.apply(self._portNativeWorker,arguments)}},{key:"close",value:function close(){self._portNativeWorker.terminate()}},{key:"setonmessage",value:function setonmessage(e){self._portNativeWorker.onmessage=e}}]),CDPort}();function WorkerWrapper_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var q=function(){function WorkerWrapper(e){!function WorkerWrapper_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WorkerWrapper),self._nativeWorker=e,self.port=new z(self._nativeWorker)}return function WorkerWrapper_createClass(e,t,r){t&&WorkerWrapper_defineProperties(e.prototype,t),r&&WorkerWrapper_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WorkerWrapper,[{key:"close",value:function close(){self.port.close()}}]),WorkerWrapper}();function WorkerWrapperFactory_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var K=function(){function WorkerWrapperFactory(e,t){!function WorkerWrapperFactory_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WorkerWrapperFactory),self._useUrlWorker=e,self._workerUrl=t}return function WorkerWrapperFactory_createClass(e,t,r){t&&WorkerWrapperFactory_defineProperties(e.prototype,t),r&&WorkerWrapperFactory_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WorkerWrapperFactory,[{key:"create",value:function create(){return self._useUrlWorker?self._createWorkerFromUrl():self._createInlineWorker()}},{key:"_createInlineWorker",value:function _createInlineWorker(){var e=new(Q());return w.info("Created a dedicated worker."),new q(e)}},{key:"_createWorkerFromUrl",value:function _createWorkerFromUrl(){try{var e=new Worker(self._workerUrl);return w.info("Created worker from url - ".concat(self._workerUrl)),new q(e)}catch(e){throw w.error("Failed to construct worker from url."),e}}}]),WorkerWrapperFactory}();function CDMap_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var V=function(){function CDMap(){!function CDMap_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CDMap),self._pairs=[],self.size=0}return function CDMap_createClass(e,t,r){t&&CDMap_defineProperties(e.prototype,t),r&&CDMap_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CDMap,[{key:"has",value:function has(e){return-1<self._indexOf(e)}},{key:"get",value:function get(e){e=self._indexOf(e);if(-1<e)return self._pairs[e][1]}},{key:"set",value:function set(e,t){var r=self._indexOf(e);-1<r?self._pairs[r][1]=t:(self._pairs.push([e,t]),self.size++)}},{key:"delete",value:function _delete(e){e=self._indexOf(e);return-1<e&&(self._pairs.splice(e,1),self.size--,!0)}},{key:"forEach",value:function forEach(e){for(var t=0;t<self._pairs.length;t++)e(self._pairs[t][1],self._pairs[t][0])}},{key:"clear",value:function clear(){self._pairs=[]}},{key:"_indexOf",value:function _indexOf(e){for(var t=0;t<self._pairs.length;t++)if(self._pairs[t][0]===e)return t;return-1}}]),CDMap}(),G=function create(){return new(self.Map||V)};function CDSet_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Z=function(){function CDSet(){!function CDSet_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CDSet),self._set=[],self.size=0}return function CDSet_createClass(e,t,r){t&&CDSet_defineProperties(e.prototype,t),r&&CDSet_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CDSet,[{key:"add",value:function add(e){return self._set.push(e),self.size++,self}},{key:"has",value:function has(e){return-1<self._set.indexOf(e)}},{key:"delete",value:function _delete(e){for(var t=0;t<self._set.length;t++)if(self._set[t]===e)return self._set.splice(t,1),self.size--,!0;return!1}},{key:"forEach",value:function forEach(e){for(var t=0;t<self._set.length;t++)e(self._set[t])}},{key:"clear",value:function clear(){self._set=[]}}]),CDSet}(),Y=function create(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=new(self.Set||Z),r=0;r<e.length;r++)t.add(e[r]);return t};function WorkerCommunicator_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var J=function(){function WorkerCommunicator(){!function WorkerCommunicator_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WorkerCommunicator),self._msgListeners=G()}return function WorkerCommunicator_createClass(e,t,r){t&&WorkerCommunicator_defineProperties(e.prototype,t),r&&WorkerCommunicator_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WorkerCommunicator,[{key:"setMessagingPort",value:function setMessagingPort(e){var o=self;(self._messagePort=e).setonmessage(function(e){var t=e.data,r=[],n=o._msgListeners.get(t.msgType);n&&n.forEach(function(e){e.callback(t.data),e.isOneTime&&r.push(e)}),r.forEach(function(e){n.delete(e)})})}},{key:"sendAsync",value:function sendAsync(e,t,r,n,o){n&&r&&self.addMessageListener(r,n,o),self._messagePort.postMessage({msgType:e,data:t})}},{key:"addMessageListener",value:function addMessageListener(e,t,r){var n=null;self._msgListeners.has(e)?n=self._msgListeners.get(e):(n=Y(),self._msgListeners.set(e,n)),n.add({callback:t,isOneTime:r})}}]),WorkerCommunicator}();function DataQ_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var X=function(){function DataQ(e,t,r,n,o,i){var s=self;!function DataQ_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,DataQ),self._serverWorkerCommunicator=t,self._contextManager=r,self._passToWorkerInterval=i||0,self._intervalConfigKey=n,self._msgToWorker=o,self._Q=[],self._passToWorkerInterval&&(self._intervalId=setInterval(self._sendQToServerWorker.bind(self),self._passToWorkerInterval)),e.addEventListener(window,"beforeunload",function(){s._onUnload()},!0)}return function DataQ_createClass(e,t,r){t&&DataQ_defineProperties(e.prototype,t),r&&DataQ_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(DataQ,[{key:"addToQueue",value:function addToQueue(e,t,r,n){(r=!(null!=r&&!0!==r))&&t.push&&(t[0]=self._contextManager.contextId),0!==self._passToWorkerInterval?(self._Q.push({eventName:e,data:t,shouldFlush:n}),n&&self._sendQToServerWorker()):self._serverWorkerCommunicator.sendAsync(self._msgToWorker,{eventName:e,data:t,shouldFlush:n})}},{key:"updateWithConfig",value:function updateWithConfig(e){e=e.get(self._intervalConfigKey);void 0!==e&&e!==self._passToWorkerInterval&&(self._passToWorkerInterval=e,clearInterval(self._intervalId),self._intervalId=null,0!==self._passToWorkerInterval&&(self._intervalId=setInterval(self._sendQToServerWorker.bind(self),self._passToWorkerInterval)))}},{key:"flushAllMessages",value:function flushAllMessages(){self._Q.push({eventName:"flushData"}),self._sendQToServerWorker()}},{key:"_sendQToServerWorker",value:function _sendQToServerWorker(){try{self._Q.length&&(self._serverWorkerCommunicator.sendAsync(self._msgToWorker,self._Q),self._Q=[])}catch(e){w.error("Failed sending data to worker. ".concat(e)),self._sendQInSingleMessagesToServerWorker()}}},{key:"_sendQInSingleMessagesToServerWorker",value:function _sendQInSingleMessagesToServerWorker(){for(var e=0;e<self._Q.length;e++)try{self._serverWorkerCommunicator.sendAsync(self._msgToWorker,self._Q[e])}catch(e){w.error("Failed sending single message data to worker. ".concat(e))}self._Q=[]}},{key:"_onUnload",value:function _onUnload(){self.flushAllMessages()}},{key:"filterOut",value:function filterOut(e){self._Q=self._Q.filter(e)}}]),DataQ}();function PerfMonitor_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var $=function(){function PerfMonitor(e){!function PerfMonitor_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,PerfMonitor),self._perfDataQ=e,self._now=window.performance&&window.performance.now?window.performance.now.bind(window.performance):S.dateNow.bind(Date),self._monitors=G()}return function PerfMonitor_createClass(e,t,r){t&&PerfMonitor_defineProperties(e.prototype,t),r&&PerfMonitor_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(PerfMonitor,[{key:"startMonitor",value:function startMonitor(e){w.debug("PerfMonitor:startMonitor on ".concat(e)),self._monitors.set(e,self._now())}},{key:"stopMonitor",value:function stopMonitor(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"main";self._monitors.has(e)&&(t=self._now()-self._monitors.get(e),self._perfDataQ.addToQueue("perf",{orig:r,name:e,val:t}),w.debug("PerfMonitor:stopMonitor on ".concat(e,": time = ").concat(t)),self._monitors.delete(e))}},{key:"cancelMonitor",value:function cancelMonitor(e){w.debug("PerfMonitor:cancelMonitor on ".concat(e)),self._monitors.has(e)&&self._monitors.delete(e)}},{key:"reportMonitor",value:function reportMonitor(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"main";w.debug("PerfMonitor:reportMonitor on ".concat(e)),self._perfDataQ.addToQueue("perf",{orig:r,name:e,val:t})}}]),PerfMonitor}();function SiteMapper_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ee=function(){function SiteMapper(e,t,r,n,o){var i=!(5<arguments.length&&void 0!==arguments[5])||arguments[5],s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:200;!function SiteMapper_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,SiteMapper),self._mutationObserver=e,self._siteMapKey=n,self._keyUrl=n+"_isUrlNonMasked",self._stopOnFirstMappingMatch=i,self._siteMap=null,self._observers=[],self._utils=t,self._domUtils=r,self._onMatchCB=o,self._maxMappings=s,self._maxTriggers=10}return function SiteMapper_createClass(e,t,r){t&&SiteMapper_defineProperties(e.prototype,t),r&&SiteMapper_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(SiteMapper,[{key:"updateObserver",value:function updateObserver(e){self._onMatchCB=e}},{key:"_observeChange",value:function _observeChange(e,t){if(e)try{var r,n=window.document.querySelector(e);n?((r=new self._mutationObserver(function(e){0<e.length&&t()})).observe(n,{childList:!0,characterData:!0,attributes:!0,subtree:!0}),self._observers.push(r)):w.error("Selector:".concat(JSON.stringify(e)," not found on page. Check ").concat(self._siteMapKey," configuration"))}catch(e){w.error("SiteMapper._observeChange: ".concat(e.message),e)}}},{key:"initTracking",value:function initTracking(){function Mr(){try{for(var e=0;e<n._siteMap.mappings.length;e++){var t=n._siteMap.mappings[e];if(!t.url||-1<n._url.indexOf(t.url))if(t.selector){var r=window.document.querySelector(t.selector);if(r)if(t.byText){if((void 0!==r.innerText&&-1!==r.innerText.indexOf(t.byText)||r.value===t.byText||r.textContent===t.byText)&&(n._onMatchCB(t),n._stopOnFirstMappingMatch))return}else if(n._onMatchCB(t),n._stopOnFirstMappingMatch)return}else if(-1<n._url.indexOf(t.url)&&(n._onMatchCB(t),n._stopOnFirstMappingMatch))return}}catch(e){w.error("SiteMapper:testQuerySelector failed. ex: ".concat(e.message),e)}}var e,n=self;self._siteMap||((e=self._utils.StorageUtils.getFromSessionStorage(self._siteMapKey))&&e.triggers.length<=self._maxTriggers&&e.mappings.length<=self._maxMappings&&(self._siteMap=e),self._isNonMaskedUrl=self._utils.StorageUtils.getFromSessionStorage(self._keyUrl)),self._siteMap&&(self._url=self._isNonMaskedUrl?window.document.location.href:self._utils.getDocUrl(),self._domUtils.onDocumentBody(window,function(){n._mutationObserver&&n._siteMap.triggers.forEach(function(e){(!e.url||-1<n._url.indexOf(e.url))&&n._observeChange(e.selector,Mr)}),Mr()}))}},{key:"onConfigUpdate",value:function onConfigUpdate(e){try{var t;!self._siteMap&&e.get(self._siteMapKey)&&(self.stopTracking(),t=e.get(self._siteMapKey)&&JSON.parse(e.get(self._siteMapKey)),self._isNonMaskedUrl=e.get("useNonMaskedUrlInMappings"),t&&t.triggers.length<=self._maxTriggers&&t.mappings.length<=self._maxMappings?(self._siteMap=t,self._utils.StorageUtils.saveToSessionStorage(self._siteMapKey,self._siteMap),self._utils.StorageUtils.saveToSessionStorage(self._keyUrl,self._isNonMaskedUrl),self.initTracking()):w.warn("Configuration ".concat(self._siteMapKey," contains an illegal amount of triggers or mappings. Max Allowed Triggers: ").concat(self._maxTriggers,", ")+"Max Allowed Mappings: ".concat(self._maxMappings)))}catch(e){w.error("An error occurred while loading ".concat(self._siteMapKey," configuration. Make sure the configuration value is valid. ").concat(e.message),e)}}},{key:"stopTracking",value:function stopTracking(){for(var e=0;e<self._observers.length;e++)self._observers[e].disconnect();self._observers=[],self._siteMap=null}}]),SiteMapper}();function CDEvent_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var te=function(){function CDEvent(){!function CDEvent_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CDEvent),self._listeners=[]}return function CDEvent_createClass(e,t,r){t&&CDEvent_defineProperties(e.prototype,t),r&&CDEvent_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CDEvent,[{key:"subscribe",value:function subscribe(e){self._listeners.push(e)}},{key:"publish",value:function publish(e){for(var t=0,r=self._listeners.length;t<r;t++)self._listeners[t](e)}},{key:"unsubscribe",value:function unsubscribe(e){for(var t=0,r=self._listeners.length;t<r;t++)if(e===self._listeners[t]){self._listeners.splice(t,1);break}}}]),CDEvent}();function ContextMgr_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ne=function(){function ContextMgr(e,t,r,n){!function ContextMgr_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ContextMgr),self._utils=e,self._storageUtilsWrapper=n,self._contextSiteMapper=t,self.contextName="",self.referrer="",self.historyLen=-1,self.onContextChange=new te,self._contextSiteMapper.updateObserver(self.onSiteMapperMatch.bind(self)),self._workerComm=r,self._contextIdKey="cdContextId"}return function ContextMgr_createClass(e,t,r){t&&ContextMgr_defineProperties(e.prototype,t),r&&ContextMgr_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ContextMgr,[{key:"contextData",value:function contextData(){return{contextId:self.contextId,url:self.url,name:self.contextName,referrer:self.referrer,hLength:self.historyLen,timestamp:self.timestamp}}},{key:"setContext",value:function setContext(e){self.contextName=e.name,self._genContext(),self.url=e.url,self.referrer=e.referrer,self.historyLen=e.hLength,self.timestamp=e.timestamp,self._publishContext()}},{key:"changeContext",value:function changeContext(e){e?e!==self.contextName?(self.contextName=e,self._updateContext(),self._publishContext(),w.info("Context changed to ".concat(e))):w.warn("Received context ".concat(e," but self is already the current context. Aborting operation.")):w.error("Received an invalid context name ".concat(e,". Aborting context change operation"))}},{key:"onSiteMapperMatch",value:function onSiteMapperMatch(e){e.contextName!==self.contextName&&self.changeContext(e.contextName)}},{key:"_updateContext",value:function _updateContext(){self._genContext(),self.url=self._utils.getDocUrl(),self.referrer=self._utils.clearTextFromNumbers(document.referrer),self.historyLen=window.history.length,self.timestamp=self._utils.dateNow()}},{key:"_genContext",value:function _genContext(){self.contextId=self._storageUtilsWrapper.getCookie(self._contextIdKey),self.contextId&&!isNaN(self.contextId)||(self.contextId=self._storageUtilsWrapper.getFromLocalStorage(self._contextIdKey),self.contextId&&!isNaN(self.contextId)||(self.contextId=0)),self.contextId=parseInt(self.contextId);var e=self.contextId+1;self._storageUtilsWrapper.saveToLocalStorage(self._contextIdKey,e)||w.error("Failed saving contextId ".concat(self.contextId," to local storage.")),self._storageUtilsWrapper.setCookie(self._contextIdKey,e.toString())||w.error("Failed saving contextId ".concat(self.contextId," to cookie."))}},{key:"_publishContext",value:function _publishContext(){var e={contextName:self.contextName};self._workerComm.sendAsync(x,e),self.onContextChange.publish(self.contextData())}},{key:"initContextHandling",value:function initContextHandling(){self._contextSiteMapper.initTracking()}},{key:"clearContextHandling",value:function clearContextHandling(){self._contextSiteMapper.stopTracking()}},{key:"onConfigUpdate",value:function onConfigUpdate(e){self._contextSiteMapper.onConfigUpdate(e)}},{key:"onSessionReset",value:function onSessionReset(){self._publishContext()}}]),ContextMgr}();function GlobalExceptionHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var oe=function(){function GlobalExceptionHandler(e,t){!function GlobalExceptionHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,GlobalExceptionHandler),self._cdUtils=e,self._scriptName=t,self._cdUtils.addEventListener(window,"error",self._handleException.bind(self))}return function GlobalExceptionHandler_createClass(e,t,r){t&&GlobalExceptionHandler_defineProperties(e.prototype,t),r&&GlobalExceptionHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(GlobalExceptionHandler,[{key:"_handleException",value:function _handleException(e){self._scriptName&&self._scriptName===e.filename&&(e=self._buildErrorMessage(e),w.error("caught unhandled exception. ".concat(e)))}},{key:"_buildErrorMessage",value:function _buildErrorMessage(e){if(!e.error)return e.message;var t=e.error.toString(),r=e.error.stack||"";return"".concat(t,", Line: ").concat(e.lineno,", Column: ").concat(e.colno,". Stacktrace: ").concat(r)}}]),GlobalExceptionHandler}();function MessageBus_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ie=function(){function MessageBus(){!function MessageBus_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,MessageBus),self.subscribers=G()}return function MessageBus_createClass(e,t,r){t&&MessageBus_defineProperties(e.prototype,t),r&&MessageBus_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(MessageBus,[{key:"subscribe",value:function subscribe(e,t){var r,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o=!1;self.subscribers.has(e)?(r=self.subscribers.get(e))&&r.forEach(function(e){t===e.handler&&(o=!0)}):(r=Y(),self.subscribers.set(e,r)),o||r.add({handler:t,isOneTime:n})}},{key:"unsubscribe",value:function unsubscribe(e,t){var r;e&&self.subscribers.has(e)&&((r=self.subscribers.get(e))&&r.forEach(function(e){t===e.handler&&r.delete(e)}),0===r.size&&self.subscribers.delete(e))}},{key:"publish",value:function publish(e,t){if(!e)throw new Error("invalid argument messageType must be defined");self._notifySubscribers(e,t)}},{key:"_notifySubscribers",value:function _notifySubscribers(e,t){var r=self.subscribers.get(e);r&&r.forEach(function(e){e.handler(t),e.isOneTime&&r.delete(e)})}}]),MessageBus}();function CidCache_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var se=function(){function CidCache(){!function CidCache_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CidCache),self._cid=null}return function CidCache_createClass(e,t,r){t&&CidCache_defineProperties(e.prototype,t),r&&CidCache_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CidCache,[{key:"get",value:function get(){return self._cid}},{key:"set",value:function set(e){if(!e)throw new Error("Invalid cid value of undefined");self._cid=e}}]),CidCache}(),ae={NewSessionStartedEvent:"NewSessionStartedEvent",ConfigurationLoadedEvent:"ConfigurationLoadedEvent",ServerStateUpdatedEvent:"ServerStateUpdatedEvent",HeartBeatStatusEvent:"HeartBeatStatusEvent",ServerRestoredMuidEvent:"ServerRestoredMuidEvent"};function ServerStateMgr_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ue=function(){function ServerStateMgr(e,t){!function ServerStateMgr_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ServerStateMgr),self._workerComm=e,self._utils=t,self._currState=null,e.addMessageListener(ae.ServerStateUpdatedEvent,self._onStateUpdateFromWorker.bind(self)),t.addEventListener(window,"storage",self._onStateUpdateFromStorage.bind(self),!0)}return function ServerStateMgr_createClass(e,t,r){t&&ServerStateMgr_defineProperties(e.prototype,t),r&&ServerStateMgr_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ServerStateMgr,[{key:"getServerState",value:function getServerState(e){if(self._utils.isUndefinedNull(e))throw new Error("Invalid sid param of ".concat(e));return self._currState=self._currState||self._utils.StorageUtils.getFromLocalStorage("cdSrvrState"),self._currState&&self._currState.sid!==e?null:self._currState}},{key:"onSessionIdChange",value:function onSessionIdChange(){self._utils.StorageUtils.removeFromLocalStorage("cdSrvrState"),self._currState=null}},{key:"_onStateUpdateFromWorker",value:function _onStateUpdateFromWorker(e){self._updateServerState(e)}},{key:"_updateServerState",value:function _updateServerState(e){self._currState=e,self._utils.StorageUtils.saveToLocalStorage("cdSrvrState",e)}},{key:"_onStateUpdateFromStorage",value:function _onStateUpdateFromStorage(e){e&&e.storageArea&&e.storageArea.cdSrvrState&&(e=JSON.parse(e.storageArea.cdSrvrState),self._workerComm.sendAsync("stateUpdateFromStorage",{requestId:e.val.requestId,sts:e.val.sts,std:e.val.std}))}}]),ServerStateMgr}();function ConfigurationRepository_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ce={defaultDynamicWupDispatchRateConfiguration:{type:"dynamic"},defaultIncrementalWupDispatchRateConfiguration:{type:"incremental",initialRateValueMs:500,incrementStepMs:500,incrementStopMs:5e3,incrementStartWupSendCount:20}},le=function(){function ConfigurationRepository(){!function ConfigurationRepository_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ConfigurationRepository),self._requireParseFields=G(),self._requireParseFields.set(C.dataWupDispatchRateSettings,C.dataWupDispatchRateSettings),self._requireParseFields.set(C.logWupDispatchRateSettings,C.logWupDispatchRateSettings),self._requireParseFields.set(C.crossDomainsList,C.crossDomainsList),self._requireParseFields.set(C.allowedUnmaskedValuesList,C.allowedUnmaskedValuesList),self._requireParseFields.set(C.serverCommunicationSettings,C.serverCommunicationSettings),self._configurationList={},self.configDefault={logLevel:u.INFO,isCrossdomain:!1,crossDomainsList:[],crossDomainsTimeout:5e3,orientationEventsSamplePeriod:300,orientationEventsThreshold:1,stateChangeEnabled:!1,accelerometerEventsSamplePeriod:0,dataQPassWorkerInterval:500,gyroEventsSamplePeriod:0,gyroEventsThreshold:.3,isContextPropsFeature:!0,isEnabled:!0,isResetEveryLoad:!1,isScrollCollect:!0,isVMDetection:!0,isAudioDetection:!1,wupStatisticsLogIntervalMs:3e4,heartBeatMessageInterval:5e3,resetSessionApiThreshold:2e4,wupMessageRequestTimeout:5e3,logMessageRequestTimeout:5e3,slaveChannelHandshakeTimeout:6e4,slaveAliveMessageInterval:100,forceDynamicDataWupDispatchSettings:!0,dataWupDispatchRateSettings:ce.defaultDynamicWupDispatchRateConfiguration,logWupDispatchRateSettings:{type:"constant",initialRateValueMs:2500},serverCommunicationSettings:{queueLoadThreshold:100},collectKeyRegionValue:!1,isMutationObserver:!0,collectCustomElementAttribute:!0,shouldMaskClickEventValueField:!0,isCaptureKeyEvents:!1,locationEventsTimeoutMsec:1e4,isMotionAroundTouchEnabled:!0,motionPaddingAroundTouchMSec:3e3,isMotionOnSessionStart:!0,motionPaddingOnSessionStartMSec:2e4,keyEventsMaskSpecialChars:!1,collectSelectElementBlurAndFocusEvents:!1,enableUnmaskedValues:!1,allowedUnmaskedValuesList:[],wupMessageNumToRetry:5,wupMessageRetryInterval:1e3,wupIncrementalGrowthBetweenFailures:3500,wupMaxIntervalBetweenFailures:16e3,logMessageNumToRetry:5,logMessageRetryInterval:1e3,logIncrementalGrowthBetweenFailures:3500,logMaxIntervalBetweenFailures:16e3,cdsNumExpirationTime:60},self.loadConfigurations(self.configDefault)}return function ConfigurationRepository_createClass(e,t,r){t&&ConfigurationRepository_defineProperties(e.prototype,t),r&&ConfigurationRepository_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ConfigurationRepository,[{key:"isConfigurationUpdatedFromServer",value:function isConfigurationUpdatedFromServer(){return!self._isDefaultConfiguration}},{key:"loadConfigurations",value:function loadConfigurations(n){var o=self;n&&(self._isDefaultConfiguration=n===self.configDefault,Object.keys(n).forEach(function(e){var t,r=n[e];!o._requireParseFields.has(e)||(t=o._tryParseConfigurationValue(r))&&(r=t),o._configurationList[e]=r}))}},{key:"get",value:function get(e){return self._configurationList[e]}},{key:"set",value:function set(e,t){self._configurationList[e]=t}},{key:"getAll",value:function getAll(){return self._configurationList}},{key:"_tryParseConfigurationValue",value:function _tryParseConfigurationValue(e){if("string"!=typeof e)return null;try{return JSON.parse(e)}catch(e){}return null}}]),ConfigurationRepository}(),fe={TouchEvent:"touchEvent",KeyEvent:"keyEvent",ConfigurationLoadedEvent:"ConfigurationLoadedEvent",NewSessionStartedEvent:"NewSessionStartedEvent",WupDispatchRateUpdatedEvent:"WupDispatchRateUpdatedEvent",ApiContextChangeEvent:"ApiContextChangeEvent",ApiResetSessionEvent:"ApiResetSessionEvent",ApiCustomerMetadataEvent:"ApiCustomerMetadataEvent",ApiChangeStateEvent:"ApiChangeStateEvent",ApiSetCsidEvent:"ApiSetCsidEvent",ApiSetPsidEvent:"ApiSetPsidEvent",ApiSetCustomerBrand:"ApiSetCustomerBrand",ServerStateUpdatedEvent:"ServerStateUpdatedEvent",ServerRestoredMuidEvent:"ServerRestoredMuidEvent",StateChangedEvent:"StateChangedEvent",MutationSingleEvent:"MutationSingleEvent",MutationAddedNodes:"MutationAddedNodes",MutationRemovedNodes:"MutationRemovedNodes",StandardInputEvent:"StandardInputEvent",StandardInputFocusEvent:"StandardInputFocusEvent",StandardInputBlurEvent:"StandardInputBlurEvent",StandardOnClickEvent:"StandardOnClickEvent",StandardOnSelectEvent:"StandardOnSelectEvent",ElementFocusEvent:"ElementFocusEvent",ElementBlurEvent:"ElementBlurEvent",StandardOnFormSubmitEvent:"StandardOnFormSubmitEvent",SyntheticInputMaskEvent:"SyntheticInputMaskEvent",CutEvent:"CutEvent",CopyEvent:"CopyEvent",PasteEvent:"PasteEvent",DeviceOrientationEvent:"DeviceOrientationEvent",BeforeInstallPromptEvent:"BeforeInstallPromptEvent",FocusEvent:"FocusEvent",BlurEvent:"BlurEvent",ResizeEvent:"ResizeEvent",DOMContentLoadedEvent:"DOMContentLoadedEvent",VisibilityChangeEvent:"VisibilityChangeEvent",ScrollEvent:"ScrollEvent",WindowMessageEvent:"WindowMessageEvent",WorkerSystemStatusEvent:"WorkerSystemStatusEvent",CustomElementDetectedEvent:"CustomElementDetectedEvent",CustomElementAddedEvent:"CustomElementAddedEvent",CustomElementRemovedEvent:"CustomElementRemovedEvent",CustomElementInaccessible:"CustomElementInaccessible",CustomElementSubmitted:"CustomElementSubmitted",BrowserContextAdded:"BrowserContextAdded",RunDefaultFeatures:"RunDefaultFeatures",StopDefaultFeatures:"StopDefaultFeatures"};function ConfigurationService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var pe=function(){function ConfigurationService(e,t,r,n,o){if(!function ConfigurationService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ConfigurationService),!r)throw new Error("messageBus param must be defined");self._configurationLoadedCallback=null,self._utils=e,self._configurationRepository=t,self._messageBus=r,self._cidCache=n,o&&o.addMessageListener(ae.ConfigurationLoadedEvent,self._onConfigurationLoadedEvent.bind(self))}return function ConfigurationService_createClass(e,t,r){t&&ConfigurationService_defineProperties(e.prototype,t),r&&ConfigurationService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ConfigurationService,[{key:"updateLogUrlToWorker",value:function updateLogUrlToWorker(e,t,r,n){n&&self._configurationRepository.set("logAddress",n),self._configurationRepository.get("logAddress")&&(t={logAddress:"".concat(self._configurationRepository.get("logAddress"),"?cid=").concat(self._cidCache.get(),"&cdsnum=").concat(e,"&csid=").concat(t,"&ds=js&sdkVer=").concat(self._utils.scriptVersion)},r.sendAsync(A,t))}},{key:"setServerUrl",value:function setServerUrl(e){self._configurationRepository.set("serverAddress",e);var t=e.indexOf("cid=")+4,r=-1===(r=e.indexOf("&",t))?void 0:r;self._cidCache.set(e.substring(t,r))}},{key:"setConfigurationLoadedCallback",value:function setConfigurationLoadedCallback(e){self._configurationLoadedCallback=e}},{key:"_onConfigurationLoadedEvent",value:function _onConfigurationLoadedEvent(e){self._configurationRepository.loadConfigurations(e),self._configurationLoadedCallback&&self._configurationLoadedCallback(self._configurationRepository.get(C.isEnabled)),self._messageBus.publish(fe.ConfigurationLoadedEvent,self._configurationRepository)}}]),ConfigurationService}();function DataCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var de=function(){function DataCollector(){!function DataCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,DataCollector)}return function DataCollector_createClass(e,t,r){t&&DataCollector_defineProperties(e.prototype,t),r&&DataCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(DataCollector,[{key:"startFeature",value:function startFeature(){}},{key:"stopFeature",value:function stopFeature(){}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){}},{key:"sendToQueue",value:function sendToQueue(){}},{key:"getEventTimestamp",value:function getEventTimestamp(){return S.dateNow()}},{key:"getTimestampFromEvent",value:function getTimestampFromEvent(e){return e.timeStamp?S.cutDecimalPointDigits(e.timeStamp,3):0}}]),DataCollector}(),he={false:0,true:1,undefined:2,null:2};function TouchEventCollector_typeof(e){return(TouchEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function TouchEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function TouchEventCollector_setPrototypeOf(e,t){return(TouchEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function TouchEventCollector_createSuper(r){var n=function TouchEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=TouchEventCollector_getPrototypeOf(r);return function TouchEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===TouchEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return TouchEventCollector_assertThisInitialized(e)}(self,n?(e=TouchEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function TouchEventCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function TouchEventCollector_getPrototypeOf(e){return(TouchEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ve={configKey:"isTouchEvents",isDefault:!0,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!0,runInSlave:!0,runInUns:!1,isRunning:!1,instance:null},ye={pointerdown:"touchstart",pointerup:"touchend",pointermove:"touchmove",MSPointerDown:"touchstart",MSPointerUp:"touchend",MSPointerMove:"touchmove"},_e={touchstart:0,touchmove:1,touchend:2,touchcancel:3},ge=["eventSequence","timestamp","eventType","isTrusted","elementHash","clientX","clientY","touchIndex","touchSizeMajor","touchSizeMinor","pageX","pageY","screenX","screenY","relativeTime","touchPressure"],me=function(){!function TouchEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&TouchEventCollector_setPrototypeOf(e,t)}(TouchEventCollector,de);var i=TouchEventCollector_createSuper(TouchEventCollector);function TouchEventCollector(e,t,r,n){var o;return function TouchEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,TouchEventCollector),(o=i.call(self))._utils=e,o._dataQ=r,o._elements=t,o._msgBus=n,o._onAllBrowsersTouchEventBinded=o._onAllBrowsersTouchEvent.bind(TouchEventCollector_assertThisInitialized(o)),o}return function TouchEventCollector_createClass(e,t,r){t&&TouchEventCollector_defineProperties(e.prototype,t),r&&TouchEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(TouchEventCollector,[{key:"startFeature",value:function startFeature(e){self._bind(e)}},{key:"stopFeature",value:function stopFeature(e){self._unbind(e)}},{key:"_addToCommunicationQueue",value:function _addToCommunicationQueue(e,t,r,n){e!==_e.touchstart&&e!==_e.touchend||self._msgBus.publish(fe.TouchEvent,{action:e});var o=self.getEventTimestamp(n),i=he[n.isTrusted],s=self._elements.getElement(n.target),a=self._utils.StorageUtils.getAndUpdateEventSequenceNumber();self._utils.isUndefinedNull(e)&&(e=-1),self._utils.isUndefinedNull(t)&&(t=-1);n=self.getTimestampFromEvent(n);self._dataQ.addToQueue("touch_events",self._utils.convertToArrayByMap(ge,{eventSequence:a,timestamp:o,eventType:e,isTrusted:i,elementHash:s,clientX:r.clientX?Math.round(r.clientX):0,clientY:r.clientY?Math.round(r.clientY):0,touchIndex:t,touchSizeMajor:r.radiusX?2*r.radiusX:0,touchSizeMinor:r.radiusY?2*r.radiusY:0,pageX:r.pageX||0,pageY:r.pageY||0,screenX:r.screenX||0,screenY:r.screenY||0,relativeTime:n,touchPressure:r.force||-1}))}},{key:"_bind",value:function _bind(e){var t,r=e.getDocument();if(window.TouchEvent?t=["touchstart","touchmove","touchend","touchcancel"]:window.PointerEvent&&(t=["pointerdown","pointermove","pointerup"]),self._listeningToEvents=t,self._listeningToEvents)for(var n=0;n<self._listeningToEvents.length;n++)self._utils.addEventListener(r,self._listeningToEvents[n],self._onAllBrowsersTouchEventBinded)}},{key:"_unbind",value:function _unbind(e){var t=e.getDocument();if(self._listeningToEvents)for(var r=0;r<self._listeningToEvents.length;r++)self._utils.removeEventListener(t,self._listeningToEvents[r],self._onAllBrowsersTouchEventBinded)}},{key:"_onAllBrowsersTouchEvent",value:function _onAllBrowsersTouchEvent(e){return self._onIeTouchEvent(e),self._onTouchEvent(e),!0}},{key:"_onTouchEvent",value:function _onTouchEvent(e){if((null===e.pointerType||void 0===e.pointerType)&&void 0!==e.changedTouches)for(var t=_e[e.type],r=0;r<e.changedTouches.length;r++){var n=e.changedTouches[r],o=n.identifier%1e4;self._addToCommunicationQueue(t,o,n,e)}}},{key:"_onIeTouchEvent",value:function _onIeTouchEvent(e){var t,r;null!=e.pointerType&&("touch"!==e.pointerType&&"pen"!==e.pointerType&&e.pointerType!==e.MSPOINTER_TYPE_TOUCH&&e.pointerType!==e.MSPOINTER_TYPE_PEN||(r=ye[e.type]||"touchcancel",t=e.pointerId?e.pointerId%1e4:0,r=_e[r],self._addToCommunicationQueue(r,t,e,e)))}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return ve}}]),TouchEventCollector}();function SameCharService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var be={true:1,false:0,undefined:-1},Ce=function(){function SameCharService(){!function SameCharService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,SameCharService),self._elementList=new WeakMap}return function SameCharService_createClass(e,t,r){t&&SameCharService_defineProperties(e.prototype,t),r&&SameCharService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(SameCharService,[{key:"update",value:function update(e,t){self._elementList.set(e,t)}},{key:"compare",value:function compare(e,t){return be[t===self._elementList.get(e)]}}]),SameCharService}(),we={IntlBackslash:"0",Digit1:"0",Digit2:"0",Digit3:"0",Digit4:"1",Digit5:"1",Digit6:"1",Digit7:"1",Digit8:"2",Digit9:"2",Digit0:"2",KeyQ:"3",KeyW:"3",KeyE:"3",KeyA:"3",KeyS:"3",KeyD:"3",KeyZ:"3",KeyX:"3",KeyC:"3",KeyR:"4",KeyT:"4",KeyF:"4",KeyG:"4",KeyV:"4",KeyB:"4",KeyY:"5",KeyU:"5",KeyH:"5",KeyJ:"5",KeyN:"5",KeyM:"5",KeyI:"6",KeyO:"6",KeyP:"6",KeyK:"6",KeyL:"6",Comma:"6",Period:"6",Semicolon:"7",Minus:"7",Equal:"7",Slash:"7",BracketLeft:"7",Backslash:"7",BracketRight:"7",Quote:"7",NumLock:"8",NumpadDivide:"8",NumpadMultiply:"8",NumpadSubtract:"8",NumpadAdd:"8",NumpadEnter:"8",NumpadDecimal:"8",Numpad0:"8",Numpad1:"8",Numpad2:"8",Numpad3:"8",Numpad4:"8",Numpad5:"8",Numpad6:"8",Numpad7:"8",Numpad8:"8",Numpad9:"8"};function KeyEventCollector_typeof(e){return(KeyEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function KeyEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function KeyEventCollector_setPrototypeOf(e,t){return(KeyEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function KeyEventCollector_createSuper(r){var n=function KeyEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=KeyEventCollector_getPrototypeOf(r);return function KeyEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===KeyEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return KeyEventCollector_assertThisInitialized(e)}(self,n?(e=KeyEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function KeyEventCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function KeyEventCollector_getPrototypeOf(e){return(KeyEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ee={configKey:"isKeyEvents",isDefault:!0,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!0,runInSlave:!0,runInUns:!1,isRunning:!1,instance:null},Pe={keyup:0,keydown:1,keypress:2},Se=["eventSequence","timestamp","eventType","isTrusted","elementHash","charCode","character","keyComboType","isCtrl","isShift","isAlt","isMetaKey","keyLocation","code","key","isRepeat","keyRegion","relativeTime","isSameKey"],ke=function(){!function KeyEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&KeyEventCollector_setPrototypeOf(e,t)}(KeyEventCollector,de);var u=KeyEventCollector_createSuper(KeyEventCollector);function KeyEventCollector(e,t,r,n,o,i,s){var a;return function KeyEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,KeyEventCollector),(a=u.call(self))._configurationRepository=e,a._utils=t,a._elements=r,a._dataQueue=n,a._msgBus=o,a._sameCharService=i,a._maskingService=s,a.comboCodes=["c","v","a","x","z","p","s"],a._onKeyEvent=a._onKeyEvent.bind(KeyEventCollector_assertThisInitialized(a)),a._useCaptureEvents=a._configurationRepository.get(C.isCaptureKeyEvents),a}return function KeyEventCollector_createClass(e,t,r){t&&KeyEventCollector_defineProperties(e.prototype,t),r&&KeyEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(KeyEventCollector,[{key:"startFeature",value:function startFeature(e){try{var t=e.getDocument();self._bind(t,self._onKeyEvent,self._useCaptureEvents)}catch(e){w.error("KeyEvents:startFeature failed, msg: ".concat(e.message),e)}}},{key:"stopFeature",value:function stopFeature(e){try{var t=e.getDocument();self._unbind(t,self._onKeyEvent,self._useCaptureEvents)}catch(e){w.error("KeyEvents:stopFeature failed, msg: ".concat(e.message),e)}}},{key:"updateFeatureConfig",value:function updateFeatureConfig(e){try{var t,r;self._configurationRepository.get(C.isCaptureKeyEvents)!==self._useCaptureEvents&&(t=e.getDocument(),r=self._configurationRepository.get(C.isCaptureKeyEvents),self._unbind(t,self._onKeyEvent,self._useCaptureEvents),self._bind(t,self._onKeyEvent,r),self._useCaptureEvents=r)}catch(e){w.error("KeyEvents:startFeature failed, msg: ".concat(e.message),e)}}},{key:"_bind",value:function _bind(e,t,r){e.addEventListener("keyup",t,r),e.addEventListener("keydown",t,r),e.addEventListener("keypress",t,r)}},{key:"_unbind",value:function _unbind(e,t,r){e.removeEventListener("keyup",t,r),e.removeEventListener("keydown",t,r),e.removeEventListener("keypress",t,r)}},{key:"_onKeyEvent",value:function _onKeyEvent(e){var t=Pe[e.type];t!==Pe.keydown&&t!==Pe.keyup||self._msgBus.publish(fe.KeyEvent,{action:t}),self._handleKeyEvent(e,"key_events")}},{key:"_handleKeyEvent",value:function _handleKeyEvent(e,t){var r=Pe[e.type];self._utils.isUndefinedNull(r)&&(r=-1);var n=self._utils.StorageUtils.getAndUpdateEventSequenceNumber(),o=self.getEventTimestamp(e),i=e.key||self._maskingService.getKeyFromLegacyProperties(e),s=e.code||"",a=self._maskingService.maskKey(i,s),u=1<a.key.length?"":a.key,c=self._elements.getElement(e.target),l=self._getComboType(e,i),f=he[e.isTrusted],p="Meta"===e.key||"OS"===e.key||"Win"===e.key||e.metaKey||91===e.keyCode||92===e.keyCode,d=self._configurationRepository.get(C.collectKeyRegionValue)?self._getKeyRegion(s):"-1",i=self.getTimestampFromEvent(e),s=be.undefined;"keypress"===e.type&&(s=self._sameCharService.compare(e.target,e.key),self._sameCharService.update(e.target,e.key)),w.isDebug()&&w.trace("onKeyEvent: got event: ".concat(r,", at time:").concat(o,", key: ").concat(a.key,", code:").concat(a.code,", old charCode:").concat(a.charCode)),self._dataQueue.addToQueue(t,self._utils.convertToArrayByMap(Se,{eventType:r,eventSequence:n,timestamp:o,charCode:a.charCode,character:u,elementHash:c,keyComboType:l,isTrusted:f,isCtrl:e.ctrlKey||!1,isShift:e.shiftKey||!1,isAlt:e.altKey||!1,isMetaKey:p||!1,keyLocation:e.location||0,code:a.code||"",key:a.key||"",location:e.location||"",isRepeat:e.repeat||!1,keyRegion:d,relativeTime:i,isSameKey:s}))}},{key:"_getKeyRegion",value:function _getKeyRegion(e){return we[e]||"-1"}},{key:"_getComboType",value:function _getComboType(e,t){return(e.ctrlKey||e.metaKey)&&void 0!==t?self.comboCodes.indexOf(t):-1}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return Ee}}]),KeyEventCollector}();function SensorsDataQueue_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Oe=function(){function SensorsDataQueue(e,t,r,n,o){!function SensorsDataQueue_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,SensorsDataQueue),self._historyBuffer=[],self._isTouchInProgress=!1,self._touchStartCount=0,self._isPostTouch=!1,self._touchEndTime=0,self._sensorGateKeeper=o,self._dataQueue=t,self._configurationRepository=e,self._msgBus=r,self._utils=n,self._msgBus.subscribe(fe.TouchEvent,self._onTouch.bind(self)),self._msgBus.subscribe(fe.KeyEvent,self._onTouch.bind(self)),self._isMotionAroundTouchEnabled=self._configurationRepository.get(C.isMotionAroundTouchEnabled),self._aroundTouchInterval=self._configurationRepository.get(C.motionPaddingAroundTouchMSec)}return function SensorsDataQueue_createClass(e,t,r){t&&SensorsDataQueue_defineProperties(e.prototype,t),r&&SensorsDataQueue_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(SensorsDataQueue,[{key:"addToQueue",value:function addToQueue(e,t,r,n){var o=self._utils.dateNow();if(self._isPostTouch&&o-self._touchEndTime>self._aroundTouchInterval&&(w.debug("SensorsDataQueue: stopped post touch events, time has passed (".concat(self._aroundTouchInterval," millisec)")),self._isPostTouch=!1),!self._isMotionAroundTouchEnabled||self._isTouchInProgress||self._isPostTouch||self._sensorGateKeeper.isOpen())self._dataQueue.addToQueue(e,t,r,n);else{self._historyBuffer.push({name:e,data:t,addCtxId:r,isImmediateWup:n,timestamp:o});for(var i=0,s=self._historyBuffer.length;i<s;i++){if(!(o-self._historyBuffer[0].timestamp>self._aroundTouchInterval))break;self._historyBuffer.shift()}}}},{key:"onConfigUpdate",value:function onConfigUpdate(){self._aroundTouchInterval=void 0!==self._configurationRepository.get(C.motionPaddingAroundTouchMSec)?self._configurationRepository.get(C.motionPaddingAroundTouchMSec):self._aroundTouchInterval,self._isMotionAroundTouchEnabled=void 0!==self._configurationRepository.get(C.isMotionAroundTouchEnabled)?self._configurationRepository.get(C.isMotionAroundTouchEnabled):self._isMotionAroundTouchEnabled}},{key:"_sendBuffer",value:function _sendBuffer(){var e=self._utils.dateNow();w.debug("sending history sensors buffer ts=".concat(e));for(var t=0,r=self._historyBuffer.length;t<r;t++)e-self._historyBuffer[t].timestamp<=self._aroundTouchInterval&&self._dataQueue.addToQueue(self._historyBuffer[t].name,self._historyBuffer[t].data,self._historyBuffer[t].addCtxId,self._historyBuffer[t].isImmediateWup);self._historyBuffer=[]}},{key:"_onTouch",value:function _onTouch(e){return self._isMotionAroundTouchEnabled&&(self._isTouchInProgress||e.action!==_e.touchstart&&e.action!==Pe.keydown?e.action===_e.touchend||e.action===Pe.keyup?(self._touchStartCount--,self._touchStartCount<=0&&(self._isTouchInProgress=!1,self._isPostTouch=!0,self._touchEndTime=self._utils.dateNow(),w.debug("stopped touch event in sensors data q ts=".concat(self._utils.dateNow())))):e.action!==_e.touchstart&&e.action!==Pe.keydown||self._touchStartCount++:(w.debug("Started touch event in sensors data q ts=".concat(self._utils.dateNow())),self._isTouchInProgress=!0,self._touchStartCount=1,self._sendBuffer())),!1}}]),SensorsDataQueue}();function XPathHashProducer_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Be=function(){function XPathHashProducer(){!function XPathHashProducer_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,XPathHashProducer),self._initialize()}return function XPathHashProducer_createClass(e,t,r){t&&XPathHashProducer_defineProperties(e.prototype,t),r&&XPathHashProducer_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(XPathHashProducer,[{key:"_initialize",value:function _initialize(){self._nodeParentHash=new WeakMap,self._nodeNameOccurencesPerParent=[],self._nodeNameOccurencesPerParent.push({})}},{key:"getUniqueElementName",value:function getUniqueElementName(e){return e.nodeName.toLowerCase()+(e.id||"")+(e.name||"")+(e.href||"")+(e.getAttribute&&e.getAttribute("class")||"")+(e.title||"")}},{key:"produce",value:function produce(e){var t,r=[],n=e,o=(e.id||"")+(e.name||"")+(e.nodeName||"")+(e.className||"")+(e.title||"")+(e.href||"");if(e.parentNode&&self._nodeParentHash.has(e.parentNode)){var i=e.nodeName.toLowerCase(),s=self._nodeParentHash.get(e.parentNode),a=s.occurrencesIndex,u=0;return self._nodeNameOccurencesPerParent[a]&&(void 0!==self._nodeNameOccurencesPerParent[a][i]?(u=++self._nodeNameOccurencesPerParent[a][i],self._nodeNameOccurencesPerParent[a][i]=u):self._nodeNameOccurencesPerParent[a][i]=0),o+=s.hash+","+self.getUniqueElementName(e)+(u||"")}t=e.parentNode||!1;for(var c=0;e&&1===e.nodeType;e=e.parentNode){for(var l=0,f=e.previousSibling;f;f=f.previousSibling)f.nodeType!==Node.DOCUMENT_TYPE_NODE&&f.nodeName===e.nodeName&&(c=++l);var p=self.getUniqueElementName(e),d=l||"";r.splice(0,0,p+d)}o+=r.length?"/"+r.join():"";s=[];return 0<r.length&&(s=r.slice(0,r.length-1)),t&&((u={})[n.nodeName.toLowerCase()]=c,u=self._nodeNameOccurencesPerParent.push(u)-1,self._nodeParentHash.set(t,{hash:"/"+s.join(),occurrencesIndex:u})),o}}]),XPathHashProducer}();function ElementsCollector_typeof(e){return(ElementsCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ElementsCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ElementsCollector_setPrototypeOf(e,t){return(ElementsCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function ElementsCollector_createSuper(r){var n=function ElementsCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=ElementsCollector_getPrototypeOf(r);return function ElementsCollector_possibleConstructorReturn(e,t){{if(t&&("object"===ElementsCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function ElementsCollector_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=ElementsCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function ElementsCollector_getPrototypeOf(e){return(ElementsCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Me=function(){!function ElementsCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ElementsCollector_setPrototypeOf(e,t)}(ElementsCollector,de);var i=ElementsCollector_createSuper(ElementsCollector);function ElementsCollector(e,t,r,n){var o;return function ElementsCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ElementsCollector),(o=i.call(self))._configurationRepository=e,o._utils=t,o._dataQueue=r,o._contextMgr=n,o._elementHashWMap=new WeakMap,o._collectPosition=!0,o._collectClassName=!0,o._collectTitle=!0,o._collectHref=!0,o._collectCustomElementAttribute=!0,o._customElementAttribute=o._configurationRepository.get(C.customElementAttribute),o._attributeMaskedList=o._configurationRepository.get(C.maskElementsAttributes),o._maxElemValLength=30,o._XPathHashProducer=new Be,o._allowedUnmaskedValuesList=o._configurationRepository.get(C.allowedUnmaskedValuesList),o._enableUnmaskedValues=o._configurationRepository.get(C.enableUnmaskedValues),o}return function ElementsCollector_createClass(e,t,r){t&&ElementsCollector_defineProperties(e.prototype,t),r&&ElementsCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ElementsCollector,[{key:"getElement",value:function getElement(e){if(self._utils.isUndefinedNull(e)||e===document||e===document.body)return-1;var t,r=-1;return self._elementHashWMap.has(e)?r=self._elementHashWMap.get(e).hash:(r=(t=self._XPathHashProducer.produce(e))?self._utils.getHash(t):-1,self._elementHashWMap.set(e,{hash:r,contextList:[self._contextMgr.contextName]}),self._sendElementToServer(e,r)),r}},{key:"resendElementPerContext",value:function resendElementPerContext(e){var t,r;self._elementHashWMap.has(e)?(r=(t=self._elementHashWMap.get(e)).hash,t.contextList.indexOf(self._contextMgr.contextName)<0&&(t.contextList.push(self._contextMgr.contextName),self._elementHashWMap.set(e,{hash:t.hash,contextList:t.contextList}),self._sendElementToServer(e,r))):w.error("received for resendElementPerContext bad element, not in hash map. id=".concat(e.id))}},{key:"isListed",value:function isListed(e){return self._elementHashWMap.has(e)}},{key:"getElementData",value:function getElementData(e){return self._elementHashWMap.get(e)}},{key:"getElementContextList",value:function getElementContextList(e){return self._elementHashWMap.get(e).contextList}},{key:"_sendElementToServer",value:function _sendElementToServer(e,t){var r=self._collectPosition?e.getBoundingClientRect&&e.getBoundingClientRect():null,n=-1,o=-1,i=-1,s=-1;r&&(n=Math.round(r.left),o=Math.round(r.top),i=Math.round(r.right-r.left),s=Math.round(r.bottom-r.top));var a=self._verifyNoPrivateData(e.id||""),u=self._verifyNoPrivateData(e.name||"");self._attributeMaskedList=self._configurationRepository.get(C.maskElementsAttributes)||{};var c=self._attributeMaskedList&&self._attributeMaskedList[e.id]||"",l=self._attributeMaskedList&&self._attributeMaskedList[e.name]||"",f=self._collectClassName&&e.getAttribute&&self._verifyNoPrivateData(e.getAttribute("class"))||"",p=self._collectTitle&&self._verifyNoPrivateData(e.title)||"",d=self._verifyNoPrivateData(e.nodeName)||"",h=self._collectHref&&self._verifyNoPrivateData(e.href)||"";0<h.length&&(h=self._utils.clearTextFromNumbers(h));var v=self._collectCustomElementAttribute&&e.getAttribute&&self._verifyNoPrivateData(e.getAttribute(self._customElementAttribute))||"",y=self._attributeMaskedList[v]||"",_="";"SELECT"===e.nodeName&&(_=self._utils.getDropDownListValues(e).join(";"));var g=e.value||e.textContent||e.innerHTML||"",m="";self._enableUnmaskedValues&&Array.isArray(self._allowedUnmaskedValuesList)&&0<self._allowedUnmaskedValuesList.length&&self._allowedUnmaskedValuesList.forEach(function(e){"string"!=typeof e?w.error("Unsupported allowedUnmaksedValuesList value was provided: ".concat(e.toString())):e.toLowerCase()===g.trim().toLowerCase()&&(m=e)}),g=g.length>self._maxElemValLength?"":self._utils.maskText(g.toString());var b=self._utils.isUndefinedNull(e.checked)?-1:e.checked?1:0,r=self.getEventTimestamp();self._dataQueue.addToQueue("elements",[self._contextMgr.contextId,t,d||"",c||a||"",l||u||"",e.type||"",n||0,o||0,i||0,s||0,f||"",h||"",p||"",e.alt||"",_||"",g||"",b,r,y||v,m],!1),w.isDebug()&&w.debug("adding element id:"+a+", name:"+u+", type:"+e.type+", width:"+i+", height:"+s+", left:"+n+", top:"+o+", hash: "+t)}},{key:"_verifyNoPrivateData",value:function _verifyNoPrivateData(e){return/\d\d\d/.test(e)?self._utils.clearTextFromNumbers(e):e}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){self._collectPosition="boolean"==typeof self._configurationRepository.get("isElementsPosition")?self._configurationRepository.get("isElementsPosition"):self._collectPosition,self._collectClassName="boolean"==typeof self._configurationRepository.get("isElementsClassName")?self._configurationRepository.get("isElementsClassName"):self._collectClassName,self._collectTitle="boolean"==typeof self._configurationRepository.get("isElementsTitle")?self._configurationRepository.get("isElementsTitle"):self._collectTitle,self._collectHref="boolean"==typeof self._configurationRepository.get("isElementsHref")?self._configurationRepository.get("isElementsHref"):self._collectHref,self._collectCustomElementAttribute="boolean"==typeof self._configurationRepository.get(C.collectCustomElementAttribute)?self._configurationRepository.get(C.collectCustomElementAttribute):self._collectCustomElementAttribute,self._customElementAttribute="string"==typeof self._configurationRepository.get(C.customElementAttribute)?self._configurationRepository.get(C.customElementAttribute):self._customElementAttribute,self._maxElemValLength=self._configurationRepository.get("maxElValLen")?self._configurationRepository.get("maxElValLen"):self._maxElemValLength,self._allowedUnmaskedValuesList=self._configurationRepository.get("allowedUnmaskedValuesList")?self._configurationRepository.get("allowedUnmaskedValuesList"):self._allowedUnmaskedValuesList,self._enableUnmaskedValues=self._configurationRepository.get("enableUnmaskedValues")?self._configurationRepository.get("enableUnmaskedValues"):self._enableUnmaskedValues}}]),ElementsCollector}(),Re={rtcframe:"cd__rtcframe",fontDetectionFrame:"cd__fontDetectionFrame",ignorePrefixFrame:"cd__frame__"};function FramesDetector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var De=function(){function FramesDetector(e,t){!function FramesDetector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,FramesDetector),self._elementsMutationObserverFactory=e,self._domUtils=t,self._windowMutationObservers=G(),self._loadedFrames=G(),self._framesToIgnore=Y(),self._frameSelector="frame, iframe",self._frameLoadedCallback=self._onFrameLoad.bind(self),self.frameAdded=new te,self.frameRemoved=new te,self.frameInaccessible=new te}return function FramesDetector_createClass(e,t,r){t&&FramesDetector_defineProperties(e.prototype,t),r&&FramesDetector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(FramesDetector,[{key:"frames",get:function get(){var r=[];return self._loadedFrames.forEach(function(e,t){r.push(t)}),r}},{key:"start",value:function start(e){var t=self;self._monitorWindow(e),self._findFrames(e.document).forEach(function(e){t._processNewFrame(e)})}},{key:"stop",value:function stop(){self._windowMutationObservers.forEach(function(e){e.disconnect()}),self._windowMutationObservers.clear(),self._loadedFrames.clear(),self._framesToIgnore.clear()}},{key:"addToIgnoreList",value:function addToIgnoreList(e){self._framesToIgnore.add(e)}},{key:"_monitorWindow",value:function _monitorWindow(e){var t;self._windowMutationObservers.has(e)||((t=new self._elementsMutationObserverFactory.create(e,self.MutationObserver)).observe(e.document),t.nodeAdded.subscribe(self._processAddedNode.bind(self)),t.nodeRemoved.subscribe(self._processRemovedNode.bind(self)),self._windowMutationObservers.set(e,t))}},{key:"_unMonitorWindow",value:function _unMonitorWindow(e){var t=self._windowMutationObservers.get(e);t&&t.disconnect(),self._windowMutationObservers.delete(e)}},{key:"_processAddedNode",value:function _processAddedNode(e){var t=self;self._domUtils.matches(e,self._frameSelector)?self._processNewFrame(e):e.hasChildNodes()&&self._findFrames(e).forEach(function(e){t._processNewFrame(e)})}},{key:"_processNewFrame",value:function _processNewFrame(e){self._framesToIgnore.has(e.id)||e.id.startsWith(Re.ignorePrefixFrame)||self._loadedFrames.has(e)||(self._domUtils.addEventListener(e,"load",self._frameLoadedCallback),self._domUtils.canAccessIFrame(e)?self._domUtils.isWindowDocumentReady(e.contentWindow)&&self._addFrame(e):self.frameInaccessible.publish(e))}},{key:"_addFrame",value:function _addFrame(e){var t=self;self._monitorWindow(e.contentWindow),self._findFrames(e.contentWindow.document).forEach(function(e){t._processNewFrame(e)}),self._loadedFrames.set(e,e.contentDocument),self.frameAdded.publish(e)}},{key:"_processRemovedNode",value:function _processRemovedNode(e){var t=self;self._domUtils.matches(e,self._frameSelector)?self._removeFrame(e):e.hasChildNodes()&&self._findFrames(e).forEach(function(e){t._removeFrame(e)})}},{key:"_removeFrame",value:function _removeFrame(e){self._unMonitorWindow(e.contentWindow),self._domUtils.removeEventListener(e,"load",self._frameLoadedCallback),self._loadedFrames.delete(e)&&self.frameRemoved.publish(e)}},{key:"_onFrameLoad",value:function _onFrameLoad(e){e=e.target;self._loadedFrames.has(e)&&self._removeFrame(e),self._processNewFrame(e)}},{key:"_findFrames",value:function _findFrames(e){for(var t=[],r=[],n=e.querySelectorAll(self._frameSelector),o=0;o<n.length;o++)r.push(n[o]);for(var i=0;i<r.length;i++){var s,a=r[i];t.push(a),self._domUtils.canAccessIFrame(a)?0<(s=self._findFrames(a.contentWindow.document)).length&&(t=t.concat(s)):self.frameInaccessible.publish(a)}return t}}]),FramesDetector}();function FramesHandlerBase_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Fe=function(){function FramesHandlerBase(){!function FramesHandlerBase_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,FramesHandlerBase)}return function FramesHandlerBase_createClass(e,t,r){t&&FramesHandlerBase_defineProperties(e.prototype,t),r&&FramesHandlerBase_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(FramesHandlerBase,[{key:"startFeatures",value:function startFeatures(){}},{key:"startFeature",value:function startFeature(){}},{key:"stopFeatures",value:function stopFeatures(){}},{key:"stopFeature",value:function stopFeature(){}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){}}]),FramesHandlerBase}();function BrowserContext_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Te=function(){function BrowserContext(e){!function BrowserContext_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,BrowserContext),self.context=e||window.self}return function BrowserContext_createClass(e,t,r){t&&BrowserContext_defineProperties(e.prototype,t),r&&BrowserContext_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(BrowserContext,[{key:"Context",get:function get(){return self.context}},{key:"getDocument",value:function getDocument(){return self.context.document}}]),BrowserContext}();function FrameContext_typeof(e){return(FrameContext_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function FrameContext_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function FrameContext_setPrototypeOf(e,t){return(FrameContext_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function FrameContext_createSuper(r){var n=function FrameContext_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=FrameContext_getPrototypeOf(r);return function FrameContext_possibleConstructorReturn(e,t){{if(t&&("object"===FrameContext_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function FrameContext_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=FrameContext_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function FrameContext_getPrototypeOf(e){return(FrameContext_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ie=function(){!function FrameContext_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&FrameContext_setPrototypeOf(e,t)}(FrameContext,Te);var e=FrameContext_createSuper(FrameContext);function FrameContext(){return function FrameContext_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,FrameContext),e.apply(self,arguments)}return function FrameContext_createClass(e,t,r){t&&FrameContext_defineProperties(e.prototype,t),r&&FrameContext_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(FrameContext,[{key:"getDocument",value:function getDocument(){return self.context.document||self.context.contentDocument}}]),FrameContext}();function FramesHandler_typeof(e){return(FramesHandler_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function FramesHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function FramesHandler_setPrototypeOf(e,t){return(FramesHandler_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function FramesHandler_createSuper(r){var n=function FramesHandler_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=FramesHandler_getPrototypeOf(r);return function FramesHandler_possibleConstructorReturn(e,t){{if(t&&("object"===FramesHandler_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return FramesHandler_assertThisInitialized(e)}(self,n?(e=FramesHandler_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function FramesHandler_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function FramesHandler_getPrototypeOf(e){return(FramesHandler_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var xe=function(){!function FramesHandler_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&FramesHandler_setPrototypeOf(e,t)}(FramesHandler,Fe);var i=FramesHandler_createSuper(FramesHandler);function FramesHandler(e,t,r,n){var o;return function FramesHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,FramesHandler),(o=i.call(self))._framesCache=e,o._framesDetector=t,o._framesDetector.frameAdded.subscribe(o._onFrameAdded.bind(FramesHandler_assertThisInitialized(o))),o._framesDetector.frameRemoved.subscribe(o._onFrameRemoved.bind(FramesHandler_assertThisInitialized(o))),o._framesDetector.frameInaccessible.subscribe(o._onFrameInaccessible.bind(FramesHandler_assertThisInitialized(o))),o._featuresList=[],o._domUtils=r,o._utils=n,o._framesDetector.addToIgnoreList(Re.rtcframe),o._framesDetector.addToIgnoreList(Re.fontDetectionFrame),o._framesDetector.start(window.self),o._buildFramesCache(),o}return function FramesHandler_createClass(e,t,r){t&&FramesHandler_defineProperties(e.prototype,t),r&&FramesHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(FramesHandler,[{key:"startFeatures",value:function startFeatures(e){try{if(self._buildFeaturesMap(e),0===self._featuresList.length)return;w.debug("startFeatures:Running features on ".concat(self._framesCache.count," frames")),self._startFeaturesOnFrames(self._framesCache.contexts,e)}catch(e){w.debug("Failed to start features in FrameHandler.startFeatures: ".concat(e.message),e)}}},{key:"startFeature",value:function startFeature(e){try{self._featuresList.push(e),e.isRunning=!0,self._startFeaturesOnFrames(self._framesCache.contexts,[e])}catch(e){w.debug("Failed to start feature in FrameHandler.startFeature: ".concat(e.message),e)}}},{key:"stopFeatures",value:function stopFeatures(e){try{self._stopFeaturesOnFrames(e,self._framesCache.contexts)}catch(e){w.debug("Failed to stop features in FrameHandler.stopFeatures: ".concat(e.message),e)}}},{key:"stopFeature",value:function stopFeature(e){try{e.isRunning=!1,self._stopFeaturesOnFrames([e],self._framesCache.contexts)}catch(e){w.debug("Failed to stop feature in FrameHandler.stopFeature: ".concat(e.message),e)}}},{key:"updateFeatureConfig",value:function updateFeatureConfig(e){e.instance.updateFeatureConfig&&self._updateFeaturesConfigOnFrames([e],self._framesCache.contexts)}},{key:"_onFrameAdded",value:function _onFrameAdded(t){try{w.debug("Frame:".concat(t.name,", id:").concat(t.id,". was loaded.")),self._framesCache.exists(t)?self._framesCache.unRegisterContextFeatures(t,self._featuresList):self._framesCache.add(t),self._startFeaturesOnFrames([t],self._featuresList)}catch(e){w.warn("Failed to start features on frame ".concat(t.id,": ").concat(e.message),e)}}},{key:"_onFrameRemoved",value:function _onFrameRemoved(t){try{w.debug("Frame:".concat(t.name,", id:").concat(t.id,". was removed.")),self._stopFeaturesOnFrames(self._featuresList,[t])}catch(e){w.warn("Failed to stop features on frame ".concat(t.id,": ").concat(e.message),e)}}},{key:"_onFrameInaccessible",value:function _onFrameInaccessible(e){w.debug("Frame:".concat(e.name,", id:").concat(e.id,". was detected as inaccessible."))}},{key:"_buildFeaturesMap",value:function _buildFeaturesMap(e){var t=self;self._featuresList=[],e.forEach(function(e){t._featuresList.push(e)})}},{key:"_buildFramesCache",value:function _buildFramesCache(){var t=self;self._framesDetector.frames.forEach(function(e){t._framesCache.exists(e)||t._framesCache.add(e)})}},{key:"_startFeaturesOnFrames",value:function _startFeaturesOnFrames(e,n){var o=self;e.forEach(function(t){try{if(!o._domUtils.canAccessIFrame(t))return;for(var e=0;e<n.length;e++){var r=n[e];r.shouldRun&&!o._framesCache.hasFeature(t,r)&&(o._framesCache.registerContextFeature(t,r),o._domUtils.isWindowDocumentReady(t.contentWindow)&&(w.debug("_startFeaturesOnFrames: run feature on frame:".concat(t.name,", id:").concat(t.id,". feature:").concat(r.configKey)),o._utils.asyncCall.call(o._runFeatureOnFrame,o,t,r),r.isRunning=!0))}}catch(e){w.error("An error has occurred while starting features on frame ".concat(t.name," with id: ").concat(t.id,". Error: ").concat(e.message),e)}})}},{key:"_runFeatureOnFrame",value:function _runFeatureOnFrame(t,r){try{self._domUtils.canAccessIFrame(t)?r.instance.startFeature(new Ie(t.contentWindow)):w.debug("Not starting features on frame ".concat(t.name," with id: ").concat(t.id," as it is not accessible"))}catch(e){w.error("An error has occurred while starting feature ".concat(r.configKey," on frame ").concat(t.name," with id: ").concat(t.id,". Error: ").concat(e.message),e)}}},{key:"_stopFeaturesOnFrames",value:function _stopFeaturesOnFrames(n,e){var o=self;try{e.forEach(function(t){try{if(!o._domUtils.canAccessIFrame(t))return;if(t.contentWindow&&t.contentWindow.document)for(var e=0,r=n.length;e<r;e++)o._framesCache.hasFeature(t,n[e])&&o._utils.asyncCall.call(o._stopFeatureOnFrame,o,t,n[e]),n[e].isRunning=!1}catch(e){w.error("An error has occurred while stopping features on frame ".concat(t.name," with id: ").concat(t.id,". Error: ").concat(e.message),e)}o._framesCache.exists(t)&&o._framesCache.unRegisterContextFeatures(t,n),o._framesCache.remove(t)})}catch(e){w.warn("Failed stopping features on frames ".concat(e.message),e)}}},{key:"_stopFeatureOnFrame",value:function _stopFeatureOnFrame(t,r){try{self._domUtils.canAccessIFrame(t)?r.instance.stopFeature(new Ie(t.contentWindow)):w.debug("Not stopping feature ".concat(r.configKey," on frame ").concat(t.name," with id: ").concat(t.id," as it is not accessible"))}catch(e){w.error("An error has occurred while stopping feature ".concat(r.configKey," ").concat(func," on frame ").concat(t.name," with id: ").concat(t.id,". Error: ").concat(e.message),e)}}},{key:"_updateFeaturesConfigOnFrames",value:function _updateFeaturesConfigOnFrames(n,e){var o=self;e.forEach(function(t){try{if(!o._domUtils.canAccessIFrame(t))return;for(var e=0,r=n.length;e<r;e++)o._framesCache.hasFeature(t,n[e])&&o._utils.asyncCall.call(o._updateFeatureConfigOnFrame,o,t,n[e])}catch(e){w.error("An error has occurred while updating features configuration on frame ".concat(t.name," with id: ").concat(t.id,". Error: ").concat(e.message),e)}})}},{key:"_updateFeatureConfigOnFrame",value:function _updateFeatureConfigOnFrame(t,r){try{self._domUtils.canAccessIFrame(t)?r.instance.updateFeatureConfig(new Ie(t.contentWindow)):w.debug("Not updating feature ".concat(r.configKey," config on frame ").concat(t.name," with id: ").concat(t.id," as it is not accessible"))}catch(e){w.error("An error has occurred while updating feature ".concat(r.configKey," config on frame ").concat(t.name," with id: ").concat(t.id,". Error: ").concat(e.message),e)}}}]),FramesHandler}();function NullFramesHandler_typeof(e){return(NullFramesHandler_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function NullFramesHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function NullFramesHandler_setPrototypeOf(e,t){return(NullFramesHandler_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function NullFramesHandler_createSuper(r){var n=function NullFramesHandler_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=NullFramesHandler_getPrototypeOf(r);return function NullFramesHandler_possibleConstructorReturn(e,t){{if(t&&("object"===NullFramesHandler_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function NullFramesHandler_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=NullFramesHandler_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function NullFramesHandler_getPrototypeOf(e){return(NullFramesHandler_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Le=function(){!function NullFramesHandler_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&NullFramesHandler_setPrototypeOf(e,t)}(NullFramesHandler,Fe);var e=NullFramesHandler_createSuper(NullFramesHandler);function NullFramesHandler(){return function NullFramesHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,NullFramesHandler),e.apply(self,arguments)}return function NullFramesHandler_createClass(e,t,r){return t&&NullFramesHandler_defineProperties(e.prototype,t),r&&NullFramesHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(NullFramesHandler)}();function BrowserContextsCache_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var je=function(){function BrowserContextsCache(){!function BrowserContextsCache_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,BrowserContextsCache),self._contexts=G()}return function BrowserContextsCache_createClass(e,t,r){t&&BrowserContextsCache_defineProperties(e.prototype,t),r&&BrowserContextsCache_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(BrowserContextsCache,[{key:"contexts",get:function get(){var r=[];return self._contexts.forEach(function(e,t){r.push(t)}),r}},{key:"browserContexts",get:function get(){var t=[];return self._contexts.forEach(function(e){t.push(e.browserContext)}),t}},{key:"count",get:function get(){return self._contexts.size}},{key:"add",value:function add(e){self._contexts.set(e,{registered:!0,features:G()})}},{key:"addBrowserContext",value:function addBrowserContext(e){self._contexts.set(e.Context,{registered:!0,features:G(),browserContext:e})}},{key:"remove",value:function remove(e){self.exists(e)&&0===self._contexts.get(e).features.size&&self._contexts.delete(e)}},{key:"get",value:function get(e){return self._contexts.get(e)}},{key:"exists",value:function exists(e){return self._contexts.has(e)&&self._contexts.get(e).registered}},{key:"registerContextFeature",value:function registerContextFeature(e,t){self.exists(e)&&self._contexts.get(e).features.set(t.configKey,!0)}},{key:"unRegisterContextFeature",value:function unRegisterContextFeature(e,t){self.exists(e,t)&&self._contexts.get(e).features.delete(t.configKey)}},{key:"unRegisterContextFeatures",value:function unRegisterContextFeatures(e,t){for(var r=0;r<t.length;r++){var n=t[r];self.unRegisterContextFeature(e,n)}}},{key:"hasFeature",value:function hasFeature(e,t){return self.exists(e)&&self._contexts.get(e).features.has(t.configKey)}}]),BrowserContextsCache}();function NodesRemovedMutationEvent_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function NodesRemovedMutationEvent_createClass(e,t,r){return t&&NodesRemovedMutationEvent_defineProperties(e.prototype,t),r&&NodesRemovedMutationEvent_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var Ae=NodesRemovedMutationEvent_createClass(function NodesRemovedMutationEvent(e,t){!function NodesRemovedMutationEvent_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,NodesRemovedMutationEvent),self.browserContext=e,self.removedNodes=t});function NodesAddedMutationEvent_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function NodesAddedMutationEvent_createClass(e,t,r){return t&&NodesAddedMutationEvent_defineProperties(e.prototype,t),r&&NodesAddedMutationEvent_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var Ue=NodesAddedMutationEvent_createClass(function NodesAddedMutationEvent(e,t){!function NodesAddedMutationEvent_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,NodesAddedMutationEvent),self.browserContext=e,self.addedNodes=t});function ElementsMutationObserver_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ne=function(){function ElementsMutationObserver(e,t){!function ElementsMutationObserver_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ElementsMutationObserver),function ElementsMutationObserver_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"ignoreNodeTypes",Y([Node.COMMENT_NODE,Node.TEXT_NODE,Node.ATTRIBUTE_NODE,Node.CDATA_SECTION_NODE])),self._mutationObserver=new t(self._mutationObserved.bind(self,e)),self.nodesAdded=new te,self.nodesRemoved=new te,self.nodeAdded=new te,self.nodeRemoved=new te}return function ElementsMutationObserver_createClass(e,t,r){t&&ElementsMutationObserver_defineProperties(e.prototype,t),r&&ElementsMutationObserver_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ElementsMutationObserver,[{key:"observe",value:function observe(e){self._mutationObserver.observe(e,{childList:!0,subtree:!0})}},{key:"disconnect",value:function disconnect(){self._mutationObserver.disconnect()}},{key:"_mutationObserved",value:function _mutationObserved(t,e){var r=self;e.forEach(function(e){r._processMutation(t,e)})}},{key:"_processMutation",value:function _processMutation(e,t){var r=self._processNodes(t.addedNodes,self.nodeAdded),t=self._processNodes(t.removedNodes,self.nodeRemoved);self._publishNodesMutationEvents(e,r,t)}},{key:"_publishNodesMutationEvents",value:function _publishNodesMutationEvents(e,t,r){0<t.length&&self.nodesAdded.publish(new Ue(e,t)),0<r.length&&self.nodesRemoved.publish(new Ae(e,r))}},{key:"_processNodes",value:function _processNodes(e,t){for(var r=[],n=0;n<e.length;n++){var o=e[n];self._isValidNodeType(o)&&(r.push(o),t.publish(o))}return r}},{key:"_isValidNodeType",value:function _isValidNodeType(e){return!1===self.ignoreNodeTypes.has(e.nodeType)}}]),ElementsMutationObserver}();function ElementsMutationObserverFactory_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var We=function(){function ElementsMutationObserverFactory(){!function ElementsMutationObserverFactory_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ElementsMutationObserverFactory)}return function ElementsMutationObserverFactory_createClass(e,t,r){t&&ElementsMutationObserverFactory_defineProperties(e.prototype,t),r&&ElementsMutationObserverFactory_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ElementsMutationObserverFactory,[{key:"create",value:function create(e,t){return new Ne(e,t)}}]),ElementsMutationObserverFactory}();function FramesHandlerFactory_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var He=function(){function FramesHandlerFactory(e,t,r){!function FramesHandlerFactory_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,FramesHandlerFactory),self._configurationRepository=e,self._domUtils=t,self._utils=r}return function FramesHandlerFactory_createClass(e,t,r){t&&FramesHandlerFactory_defineProperties(e.prototype,t),r&&FramesHandlerFactory_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(FramesHandlerFactory,[{key:"create",value:function create(){if(self._configurationRepository.get(C.enableFramesProcessing)){var e=new je,t=new De(new We,self._domUtils);return new xe(e,t,self._domUtils,self._utils)}return new Le}}]),FramesHandlerFactory}();function FeatureService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Qe=function(){function FeatureService(e,t,r,n,o,i){!function FeatureService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,FeatureService),self._features=e,self._frameHandler=t,self._configurationRepository=r,self._domUtils=n,self._cdUtils=o,self._browserContextsCache=i,self.buildFrameRelatedLists()}return function FeatureService_createClass(e,t,r){t&&FeatureService_defineProperties(e.prototype,t),r&&FeatureService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(FeatureService,[{key:"buildFrameRelatedLists",value:function buildFrameRelatedLists(){self._frameRelatedDefaultFeatures=self._collectFrameRelated(self._features.getDefaultFeatures()),self._frameRelatedNonDefaultFeatures=self._collectFrameRelated(self._features.getNonDefaultFeatures())}},{key:"runDefault",value:function runDefault(){w.info("Running default features"),self._runFeatures(self._features.getDefaultFeatures(),self._frameRelatedDefaultFeatures)}},{key:"stopDefault",value:function stopDefault(){w.info("Stopping default features"),self._stopFeatures(self._features.getDefaultFeatures(),self._frameRelatedDefaultFeatures)}},{key:"runPerSessionFeatures",value:function runPerSessionFeatures(){w.info("Running per session features"),self._configurationRepository.isConfigurationUpdatedFromServer()?self._startFeatures(self._features.getPerSessionFeatures()):w.info("We didn't receive configurations from the server yet. Skipping per session features start until configuration arrives.")}},{key:"stopPerSessionFeatures",value:function stopPerSessionFeatures(){w.info("Stopping per session features"),self._stopFeatures(self._features.getPerSessionFeatures())}},{key:"runNonDefault",value:function runNonDefault(){w.info("Running non default features"),self._configurationRepository.isConfigurationUpdatedFromServer()?self._runFeatures(self._features.getNonDefaultFeatures(),self._frameRelatedNonDefaultFeatures):w.info("We didn't receive configurations from the server yet. Skipping non default features start until configuration arrives.")}},{key:"stopNonDefault",value:function stopNonDefault(){w.info("Stopping non default features"),self._stopFeatures(self._features.getNonDefaultFeatures(),self._frameRelatedNonDefaultFeatures)}},{key:"runPerContextFeatures",value:function runPerContextFeatures(e){w.info("Running per context features"),self._configurationRepository.isConfigurationUpdatedFromServer()?(self._runFeatures(self._features.getPerContextFeatures()),"cd_auto"!==e.name&&self._frameRelatedDefaultFeatures&&self._frameHandler.startFeatures(self._frameRelatedDefaultFeatures)):w.info("We didn't receive configurations from the server yet. Skipping per context features start until configuration arrives.")}},{key:"stopPerContextFeatures",value:function stopPerContextFeatures(){w.info("Stopping per context features"),self._stopFeatures(self._features.getPerContextFeatures())}},{key:"stopAllFeatures",value:function stopAllFeatures(){w.info("Stopping all features"),self.stopDefault(),self.stopNonDefault(),self.stopPerSessionFeatures(),self.stopPerContextFeatures()}},{key:"updateRunByConfig",value:function updateRunByConfig(e){w.info("Updating features configuration"),self._updateFeatures(self._features.getDefaultFeatures(),e),self._updateFeatures(self._features.getNonDefaultFeatures(),e),self._updateFeatures(self._features.getPerContextFeatures(),e)}},{key:"runFeaturesOnBrowserContext",value:function runFeaturesOnBrowserContext(t){var r=self,n=self._features.getDefaultFeatures();n&&(self._browserContextsCache.unRegisterContextFeatures(t.Context,n),Object.keys(n).forEach(function(e){e=n[e];e.shouldRun&&e.isFrameRelated&&(e.isRunning=!0,e.instance&&r._cdUtils.asyncCall.call(e.instance.startFeature,e.instance,t))}))}},{key:"stopFeaturesOnBrowserContextRemove",value:function stopFeaturesOnBrowserContextRemove(t){var r=self,n=self._features.getDefaultFeatures();n&&(self._browserContextsCache.unRegisterContextFeatures(t.Context,n),Object.keys(n).forEach(function(e){e=n[e];e.shouldRun&&e.isFrameRelated&&e.isRunning&&e.instance&&r._cdUtils.asyncCall.call(e.instance.stopFeature,e.instance,t)}))}},{key:"_runFeatures",value:function _runFeatures(t,e){var r=self;t&&Object.keys(t).forEach(function(e){e=t[e];e.shouldRun&&(r._cdUtils.asyncCall.call(e.instance.startFeature,e.instance,new Te(window.self)),e.isRunning=!0)}),e&&(self._frameHandler.startFeatures(e),self._domUtils.onPageLoad(window,function(){r._frameHandler.startFeatures(e)}))}},{key:"_stopFeatures",value:function _stopFeatures(t,e){var r=self;t&&Object.keys(t).forEach(function(e){e=t[e];e.instance.stopFeature&&r._cdUtils.asyncCall.call(e.instance.stopFeature,e.instance,new Te(window.self)),e.isRunning=!1}),e&&self._frameHandler.stopFeatures(e)}},{key:"_actOnFeature",value:function _actOnFeature(e,t){e.isFrameRelated&&self._frameHandler[t](e),e.instance[t]&&self._cdUtils.asyncCall.call(e.instance[t],e.instance,new Te(window.self))}},{key:"_startFeatures",value:function _startFeatures(r){var n=self;r&&Object.keys(r).forEach(function(e){var t=r[e],e=n._configurationRepository.get(t.configKey);"boolean"==typeof e&&(t.shouldRun=e),t.shouldRun&&(n._actOnFeature(t,"startFeature"),t.isRunning=!0)})}},{key:"_startFeatureOnBrowserContexts",value:function _startFeatureOnBrowserContexts(t){var r=self;t.isFrameRelated&&self._browserContextsCache.browserContexts.forEach(function(e){t.shouldRun&&!r._browserContextsCache.hasFeature(e.Context,t)&&(r._browserContextsCache.registerContextFeature(e.Context,t),r._cdUtils.asyncCall.call(t.instance.startFeature,t.instance,e),t.isRunning=!0)})}},{key:"_stopFeatureOnBrowserContexts",value:function _stopFeatureOnBrowserContexts(t){var r=self;t.isFrameRelated&&self._browserContextsCache.browserContexts.forEach(function(e){r._browserContextsCache.hasFeature(e.Context,t)&&r._cdUtils.asyncCall.call(t.instance.stopFeature,t.instance,e),t.isRunning=!1,r._browserContextsCache.exists(e.Context)&&r._browserContextsCache.unRegisterContextFeature(e.Context,t),r._browserContextsCache.remove(e.Context)})}},{key:"_updateFeatureConfigOnBrowserContexts",value:function _updateFeatureConfigOnBrowserContexts(t){var r=self;t.isFrameRelated&&self._browserContextsCache.browserContexts.forEach(function(e){r._browserContextsCache.hasFeature(e.Context,t)&&r._cdUtils.asyncCall.call(t.instance.updateFeatureConfig,t.instance,e)})}},{key:"_updateFeatures",value:function _updateFeatures(r,n){var o=self;r&&Object.keys(r).forEach(function(e){var t=r[e],e=n.get(t.configKey);"boolean"==typeof e&&(t.shouldRun=e),t.isRunning&&!t.shouldRun?(o._actOnFeature(t,"stopFeature"),o._stopFeatureOnBrowserContexts(t),t.isRunning=!1):!t.isRunning&&t.shouldRun&&(o._actOnFeature(t,"startFeature"),o._startFeatureOnBrowserContexts(t),t.isRunning=!0),t.isRunning&&(o._actOnFeature(t,"updateFeatureConfig"),o._updateFeatureConfigOnBrowserContexts(t))})}},{key:"_collectFrameRelated",value:function _collectFrameRelated(t){var r=[];return t&&Object.keys(t).forEach(function(e){e=t[e];e.isFrameRelated&&r.push(e)}),r}}]),FeatureService}();function PauseResumeManager_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ze={RUNNING:0,PAUSED:1},qe=function(){function PauseResumeManager(e,t,r){!function PauseResumeManager_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,PauseResumeManager),self._featureMgr=e,self._dataQ=r,self._configurationRepository=t,self._pauseResumeEnabled=t.get(C.stateChangeEnabled)||!1,self._sdkState=ze.RUNNING}return function PauseResumeManager_createClass(e,t,r){t&&PauseResumeManager_defineProperties(e.prototype,t),r&&PauseResumeManager_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(PauseResumeManager,[{key:"onResume",value:function onResume(){self._sdkState===ze.PAUSED?(w.info("Resuming JS SDK"),self._featureMgr.updateRunByConfig(self._configurationRepository),self._sdkState=ze.RUNNING):w.warn("PauseResumeManager:onResume - resume api called when SDK already running")}},{key:"onPause",value:function onPause(){self._sdkState===ze.RUNNING?(w.info("Pausing JS SDK"),self._featureMgr.stopAllFeatures(),self._sdkState=ze.PAUSED):w.warn("Pause api called when SDK already paused")}},{key:"onStateChange",value:function onStateChange(e){e.toState&&self._verifyApiAllowed(e.toState)&&("pause"===e.toState?self.onPause():"run"===e.toState?self.onResume():w.warn("stateChange api called with non valid toState: "+e.toState))}},{key:"isCustomerApiEnabled",value:function isCustomerApiEnabled(){return self._sdkState===ze.RUNNING}},{key:"_verifyApiAllowed",value:function _verifyApiAllowed(e){return!!self._pauseResumeEnabled||(self._dataQ.addToQueue("forbidden_api_call",[null,e]),!1)}},{key:"onConfigUpdate",value:function onConfigUpdate(){self._pauseResumeEnabled=self._configurationRepository.get(C.stateChangeEnabled)||!1,!1===self._configurationRepository.get("isEnabled")&&self.onPause()}}]),PauseResumeManager}(),Ke="ContextChange",Ve="ResetSession",Ge="cdCustomerMetadata",Ze="cdChangeState",Ye="cdSetCsid",Je="cdSetPsid",Xe="cdSetCustomerBrand";function CustomerApiBridge_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var $e=function(){function CustomerApiBridge(e,t,r,n){!function CustomerApiBridge_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CustomerApiBridge),self._pauseResumeMgr=e,self._messageBus=t,self._cdApiFacade=r,self._utils=n,self._createCommandToBusMessageMapping()}return function CustomerApiBridge_createClass(e,t,r){t&&CustomerApiBridge_defineProperties(e.prototype,t),r&&CustomerApiBridge_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CustomerApiBridge,[{key:"enableApi",value:function enableApi(){w.info("Enabling api calls"),self._onApiMessageBinded=self._onApiMessage.bind(self),self._utils.addEventListener(window,"message",self._onApiMessageBinded,!0)}},{key:"disableApi",value:function disableApi(){w.info("Disabling api calls"),self._utils.removeEventListener(window,"message",self._onApiMessageBinded,!0)}},{key:"getCustomerSessionID",value:function getCustomerSessionID(t){self._cdApiFacade.getCustomerSessionID(function(e){t(e)})}},{key:"getLogServerAddress",value:function getLogServerAddress(t){self._cdApiFacade.getLogServerAddress(function(e){t(e)})}},{key:"getServerAddress",value:function getServerAddress(t){self._cdApiFacade.getServerAddress(function(e){t(e)})}},{key:"getConfigurations",value:function getConfigurations(t){self._cdApiFacade.getConfigurations(function(e){t(e)})}},{key:"notifySessionReset",value:function notifySessionReset(e){self._pauseResumeMgr.isCustomerApiEnabled()&&window.postMessage({type:"SNumNotification",cdSNum:e},window.location.href)}},{key:"isApiAvailable",value:function isApiAvailable(e){return self._cdApiFacade.isApiAvailable(e)}},{key:"_onApiMessage",value:function _onApiMessage(e){var t=e.data,r=t.type;if(void 0===r)try{r=(t=JSON.parse(t)).type}catch(e){}(r===Ze||self._pauseResumeMgr.isCustomerApiEnabled()&&self._apiCommandToBusMessageMapping[r])&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),self._messageBus.publish(self._apiCommandToBusMessageMapping[r],t))}},{key:"_createCommandToBusMessageMapping",value:function _createCommandToBusMessageMapping(){self._apiCommandToBusMessageMapping={},self._apiCommandToBusMessageMapping[Ke]=fe.ApiContextChangeEvent,self._apiCommandToBusMessageMapping[Ve]=fe.ApiResetSessionEvent,self._apiCommandToBusMessageMapping[Ge]=fe.ApiCustomerMetadataEvent,self._apiCommandToBusMessageMapping[Ze]=fe.ApiChangeStateEvent,self._apiCommandToBusMessageMapping[Ye]=fe.ApiSetCsidEvent,self._apiCommandToBusMessageMapping[Je]=fe.ApiSetPsidEvent,self._apiCommandToBusMessageMapping[Xe]=fe.ApiSetCustomerBrand}}]),CustomerApiBridge}();function MuidManager_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var et=function(){function MuidManager(e,t,r){!function MuidManager_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,MuidManager),self.muid=null,self._utils=e,self._storageUtilsWrapper=r,self._dataQ=t,self.EXPIRATION=e.minutesToMilliseconds(525600)}return function MuidManager_createClass(e,t,r){t&&MuidManager_defineProperties(e.prototype,t),r&&MuidManager_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(MuidManager,[{key:"initMuid",value:function initMuid(){var e=self._storageUtilsWrapper.getCookie("bmuid"),t=self._storageUtilsWrapper.getFromLocalStorage("bmuid");self.muid=e||t,self.muid=self._utils.StorageUtils.validateBcId(self.muid),self.muid||(self.muid=self._utils.dateNow()+"-"+self._utils.generateUUID().toUpperCase(),w.info("Generated a new muid: ".concat(self.muid))),self._storageUtilsWrapper.setCookie("bmuid",self.muid,self.EXPIRATION),self._storageUtilsWrapper.saveToLocalStorage("bmuid",self.muid),self._dataQ.addToQueue("static_fields",["muid",self.muid],!1),w.info("Muid is: ".concat(self.muid))}},{key:"updateMuid",value:function updateMuid(e){self.muid=e,self.muid=self._utils.StorageUtils.validateBcId(self.muid),self.muid?(self._storageUtilsWrapper.setCookie("bmuid",self.muid,self.EXPIRATION),self._storageUtilsWrapper.saveToLocalStorage("bmuid",self.muid),self._dataQ.addToQueue("static_fields",["muid",self.muid],!1),w.info("Restored MUID is: ".concat(self.muid))):w.warn("Invalid format of restored MUID")}}]),MuidManager}();function PsidCache_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var tt=function(){function PsidCache(){!function PsidCache_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,PsidCache),self._psid=null}return function PsidCache_createClass(e,t,r){t&&PsidCache_defineProperties(e.prototype,t),r&&PsidCache_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(PsidCache,[{key:"get",value:function get(){return self._psid}},{key:"set",value:function set(e){if(void 0===e)throw new Error("Invalid psid value of undefined");self._psid=e}}]),PsidCache}();function PsidService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var rt=function(){function PsidService(e,t){!function PsidService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,PsidService),self._psidCache=e,self._workerCommunicator=t}return function PsidService_createClass(e,t,r){t&&PsidService_defineProperties(e.prototype,t),r&&PsidService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(PsidService,[{key:"set",value:function set(e){if(void 0===e)throw new Error("Invalid psid value of undefined");self._psidCache.set(e),self._workerCommunicator.sendAsync(j,{psid:e})}}]),PsidService}();function SidRepository_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var nt=function(){function SidRepository(e,t,r){!function SidRepository_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,SidRepository),self.sidKey="cdSNum",self._utils=e,self._storageUtilsWrapper=t,self.COOKIE_EXPIRATION_IN_MILLISECONDS=self.getExpirationTime(r)}return function SidRepository_createClass(e,t,r){t&&SidRepository_defineProperties(e.prototype,t),r&&SidRepository_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(SidRepository,[{key:"onConfigUpdate",value:function onConfigUpdate(e){e=self.getExpirationTime(e);self._setExpirationTime(e)&&(self.COOKIE_EXPIRATION_IN_MILLISECONDS=e)}},{key:"getExpirationTime",value:function getExpirationTime(e){e=e.get(C.cdsNumExpirationTime);return self._utils.minutesToMilliseconds(self._validateCDSNumExpirationTime(e))}},{key:"_validateCDSNumExpirationTime",value:function _validateCDSNumExpirationTime(e){return e<h||v<e?d:e}},{key:"_setExpirationTime",value:function _setExpirationTime(e){return self._storageUtilsWrapper.setExpirationInCookie(self.sidKey,e)===g?(w.warn("Failed set expiration time ".concat(e," in cookie.")),!1):self._storageUtilsWrapper.setExpirationInLocalStorage(self.sidKey,e)!==g||(w.warn("Failed set expiration time ".concat(e," in local storage.")),self._storageUtilsWrapper.setExpirationInCookie(self.sidKey,self._utils.minutesToMilliseconds(d)),!1)}},{key:"get",value:function get(){var e=self._storageUtilsWrapper.getCookie(self.sidKey);if(!(t=self._validateSid(e))){w.info("Sid was not found in cookie. Trying to get it from the local storage.");var t,e=self._storageUtilsWrapper.getFromLocalStorage(self.sidKey);if(!(t=self._validateSid(e)))return w.info("Sid was not found in local storage."),null}return t}},{key:"set",value:function set(e){var t=e;(t=self._validateSid(t))?(self._storageUtilsWrapper.saveToLocalStorage(self.sidKey,t,self.COOKIE_EXPIRATION_IN_MILLISECONDS)||w.error("Failed saving sid ".concat(e," to local storage.")),self._storageUtilsWrapper.setCookie(self.sidKey,t,self.COOKIE_EXPIRATION_IN_MILLISECONDS)||w.error("Failed saving sid ".concat(e," to cookie."))):w.error("Sid ".concat(e," is invalid. Will not save it."))}},{key:"_validateSid",value:function _validateSid(e){return e||null}}]),SidRepository}();function CsidCache_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ot=function(){function CsidCache(){!function CsidCache_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CsidCache),self._csid=null}return function CsidCache_createClass(e,t,r){t&&CsidCache_defineProperties(e.prototype,t),r&&CsidCache_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CsidCache,[{key:"get",value:function get(){return self._csid}},{key:"set",value:function set(e){if(void 0===e)throw new Error("Invalid csid value of undefined");self._csid=e}}]),CsidCache}();function CsidService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var it=function(){function CsidService(e,t,r){!function CsidService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CsidService),self._customerApi=e,self._csidCache=t,self._workerCommunicator=r}return function CsidService_createClass(e,t,r){t&&CsidService_defineProperties(e.prototype,t),r&&CsidService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CsidService,[{key:"set",value:function set(e){if(void 0===e)throw new Error("Invalid csid value of undefined");self._csidCache.set(e),self._workerCommunicator.sendAsync(L,{csid:e})}},{key:"get",value:function get(e){self._customerApi.isApiAvailable("getCustomerSessionID")?self._getCsidWithRetries(0,e):w.debug("getCustomerSessionID API is unavailable. Hopefully self is because the setCustomerSessionId API is being used")}},{key:"_getCsidWithRetries",value:function _getCsidWithRetries(t,r){var n=self;try{self._customerApi.getCustomerSessionID(function(e){return e?(w.debug("Got csid after ".concat(t," retries. csid: ").concat(e)),n._csidCache.set(e),void r()):20<=t?void w.info("Did not get a csid after all retries."):(t++,void setTimeout(n._getCsidWithRetries.bind(n,t,r),200))})}catch(e){w.error("Failed to get csid: ".concat(e.message,". retryCount: ").concat(t,"."),e),++t<=20&&setTimeout(self._getCsidWithRetries.bind(self,t,r),200)}}}]),CsidService}(),st={none:"none",init:"init",configuration:"config",configurationFromSlave:"configFromSlave",customerApi:"customerApi",pageTimeout:"timeout",unknown:"unknown"};function SessionService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var at=function(){function SessionService(e,t,r,n,o,i,s,a,u,c,l,f,p,d,h){!function SessionService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,SessionService),self._messageBus=e,self._configurationService=t,self._configurationRepository=r,self._utils=n,self._domUtils=o,self._workerComm=i,self._contextMgr=s,self._muidMgr=a,self._serverStateMgr=u,self._resetSessionSiteMapper=c,self._sidRepository=l,self._csidService=f,self._csidCache=p,self._psidCache=d,self._brandService=h,self.lastExternalResetCallTime=null,self.sessionId=null,self._resetSessionSiteMapper.updateObserver(self._onSiteMapperMatch.bind(self)),i.addMessageListener(ae.NewSessionStartedEvent,self._onNewSessionStartedEvent.bind(self))}return function SessionService_createClass(e,t,r){t&&SessionService_defineProperties(e.prototype,t),r&&SessionService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(SessionService,[{key:"resumeOrStartSession",value:function resumeOrStartSession(){var e=self._getSessionId();e?self._resumeSession(e):self._startNewSession()}},{key:"onConfigUpdate",value:function onConfigUpdate(e){self._resetSessionSiteMapper.onConfigUpdate(e),self._configurationRepository.get("logAddress")&&self._configurationService.updateLogUrlToWorker(self.sessionId,self._csidCache.get(),self._workerComm)}},{key:"resetSession",value:function resetSession(e){self.onResetSession(e)}},{key:"onResetSession",value:function onResetSession(e){e=e.resetReason||st.unknown;st.hasOwnProperty(e)||(e=st.customerApi),w.info("Received a Reset Session event, reason: ".concat(e)),self._utils.dateNow()-self.lastExternalResetCallTime>self._configurationRepository.get(C.resetSessionApiThreshold)?(self._startNewSession(),self._configurationService.updateLogUrlToWorker(self.sessionId,self._csidCache.get(),self._workerComm),self.lastExternalResetCallTime=self._utils.dateNow()):w.info("Ignoring external reset session call since resetSessionApiThreshold hasn't passed")}},{key:"_startNewSession",value:function _startNewSession(){w.info("Starting a new session. Previous session was ".concat(self.sessionId)),self.sessionId=null,self._csidCache.set(null),self._psidCache.set(null),self._serverStateMgr.onSessionIdChange(),self._onStartedNewSession()}},{key:"_resumeSession",value:function _resumeSession(e){w.info("Resuming an existing session with sid ".concat(e)),self.sessionId=e,self._saveSidToStorage(self.sessionId),self._handleBrandResume(),self._onResumedSession(),self._handleCsid()}},{key:"_getSessionId",value:function _getSessionId(){w.info("Attempting to get sid from storage");var e=self._sidRepository.get();return e&&w.info("Read sid ".concat(e," from storage")),e}},{key:"_saveSidToStorage",value:function _saveSidToStorage(e){w.info("Saving sid ".concat(e," to storage")),self._sidRepository.set(e)}},{key:"_onStartedNewSession",value:function _onStartedNewSession(){var e;self._configurationRepository.get("serverAddress")&&(e={serverAddress:self._configurationRepository.get("serverAddress"),csid:self._csidCache.get(),psid:self._psidCache.get(),muid:self._muidMgr.muid,context_name:self._contextMgr.contextName},self._workerComm.sendAsync(T,e),self._configurationService.updateLogUrlToWorker(self.sessionId,self._csidCache.get(),self._workerComm))}},{key:"_onResumedSession",value:function _onResumedSession(){var e;self._configurationRepository.get("serverAddress")&&(e=self._serverStateMgr.getServerState(self.sessionId),e={serverAddress:self._configurationRepository.get("serverAddress"),csid:self._csidCache.get(),psid:self._psidCache.get(),cdsnum:self.sessionId,muid:self._muidMgr.muid,context_name:self._contextMgr.contextName,serverState:e},self._workerComm.sendAsync(I,e),self._configurationService.updateLogUrlToWorker(self.sessionId,self._csidCache.get(),self._workerComm))}},{key:"_handleCsid",value:function _handleCsid(){var e=self;self._domUtils.onDocumentBody(self,function(){w.debug("SessionService:_sessionIdRegeneration, onDocumentBody callback: cdSNum: ".concat(e.sessionId)),e._csidService.get(function(){w.info("Received csid from client. csid: ".concat(e._csidCache.get(),", sid:").concat(e.sessionId)),e._sendCsidToServer()})})}},{key:"_sendCsidToServer",value:function _sendCsidToServer(){self._configurationRepository.get("serverAddress")&&(w.info("Sending csid to worker. csid: ".concat(self._csidCache.get(),", sid:").concat(self.sessionId)),self._workerComm.sendAsync(L,{csid:self._csidCache.get()}),self._configurationService.updateLogUrlToWorker(self.sessionId,self._csidCache.get(),self._workerComm))}},{key:"_handleBrandResume",value:function _handleBrandResume(){self._brandService.update()}},{key:"_onSiteMapperMatch",value:function _onSiteMapperMatch(){self.onResetSession({resetReason:st.configuration})}},{key:"_onNewSessionStartedEvent",value:function _onNewSessionStartedEvent(e){self.sessionId=e,self._saveSidToStorage(self.sessionId),self._configurationService.updateLogUrlToWorker(self.sessionId,self._csidCache.get(),self._workerComm),self._notifyNewSessionStarted(),self._handleCsid(),w.info("A new session ".concat(e," has started"))}},{key:"_notifyNewSessionStarted",value:function _notifyNewSessionStarted(){self._messageBus.publish(fe.NewSessionStartedEvent,self.sessionId)}}]),SessionService}();function MetadataService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ut=function(){function MetadataService(e,t){!function MetadataService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,MetadataService),function MetadataService_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"_dataQ",void 0),self._configurationRepository=e,self._dataQ=t,self._isEnabled=self._configurationRepository.get("isCustMetadata")}return function MetadataService_createClass(e,t,r){t&&MetadataService_defineProperties(e.prototype,t),r&&MetadataService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(MetadataService,[{key:"onCustomerMetadata",value:function onCustomerMetadata(e){void 0!==self._isEnabled&&null!=self._isEnabled&&!0!==self._isEnabled||(w.debug("HandleMetadata:onCustomerMetadata. data="+JSON.stringify(e.data)),e.data&&self._dataQ.addToQueue("customer_metadata",[null,e.data]))}},{key:"onConfigUpdate",value:function onConfigUpdate(){self._isEnabled=self._configurationRepository.get("isCustMetadata")}}]),MetadataService}(),ct="updateSlaveConf",lt="updateSlaveState";function SlaveListener_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ft=function(){function SlaveListener(e,t,r,n,o,i){!function SlaveListener_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,SlaveListener),self._slaves=[],self._dataQ=e,self._configurationRepository=t,self._utils=r,self._logPerfDataQ=n,self._contextMgr=o,self._sessionService=i,self.onResetSessionTrigger=new te,self.onMouseChallengeTrigger=new te,self._msgRouter={dataFromSlave:self._onDataFromSlave,registerSlave:self._onRegisterSlave,logPerfSlave:self._onLogPerfSlave,updateMasterContext:self._onUpdateMasterContext,resetSessionTriggerFromSlave:self._onResetSessionTriggerFromSlave,mouseChallengeTriggerFromSlave:self._onMouseChallengeTriggerFromSlave}}return function SlaveListener_createClass(e,t,r){t&&SlaveListener_defineProperties(e.prototype,t),r&&SlaveListener_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(SlaveListener,[{key:"listen",value:function listen(){var r=self;w.debug("SlaveListener:listen"),self._utils.addEventListener(window,"message",function(e){var t=e.data.msgType;t&&r._msgRouter[t]&&r._msgRouter[t].call(r,e)})}},{key:"sendToSlaves",value:function sendToSlaves(t,r){w.debug("SlaveListener:sendToSlaves"),self._slaves.forEach(function(e){e.source.postMessage({msgType:t,data:r},e.origin)})}},{key:"onConfigUpdate",value:function onConfigUpdate(){w.debug("SlaveListener:onConfigUpdate, updating ".concat(self._slaves.length," slaves")),self.sendToSlaves(ct,self._configurationRepository.getAll())}},{key:"notifyStateChange",value:function notifyStateChange(e){w.info("SlaveListener:notifyStateChange, updating ".concat(self._slaves.length," slaves that the new state is ").concat(e.toState)),self.sendToSlaves(lt,e)}},{key:"_onDataFromSlave",value:function _onDataFromSlave(e){e=e.data;"flushData"!==e.data.eventName&&(self._isScriptVersionMessage(e)?e.data.eventName&&self._dataQ.addToQueue(e.data.eventName,e.data.data,!1):e.data.eventName&&self._dataQ.addToQueue(e.data.eventName,e.data.data))}},{key:"_isScriptVersionMessage",value:function _isScriptVersionMessage(e){return"static_fields"===e.data.eventName&&"dataFromSlave"===e.msgType&&(e.data&&e.data.data&&("slave_version_client"===e.data.data[0]||"device_source"===e.data.data[0]))}},{key:"_onRegisterSlave",value:function _onRegisterSlave(e){w.info("SlaveListener:_onRegisterSlave - slave registered, origin ".concat(e.origin)),self._slaves.push({source:e.source,origin:e.origin}),e.source.postMessage({msgType:"updateSlaveConf",data:self._configurationRepository.getAll()},e.origin)}},{key:"_onLogPerfSlave",value:function _onLogPerfSlave(e){e=e.data;"flushData"!==e.data.eventName&&e.data.eventName&&self._logPerfDataQ.addToQueue(e.data.eventName,e.data.data)}},{key:"_onUpdateMasterContext",value:function _onUpdateMasterContext(e){w.debug("SlaveListener:_onUpdateMasterContext");e=e.data;self._contextMgr.setContext(e.data)}},{key:"_onResetSessionTriggerFromSlave",value:function _onResetSessionTriggerFromSlave(e){w.debug("SlaveListener:_onResetSessionTriggerFromSlave");e=e.data;self.onResetSessionTrigger.publish(e.data)}},{key:"_onMouseChallengeTriggerFromSlave",value:function _onMouseChallengeTriggerFromSlave(e){w.debug("SlaveListener:_onMouseChallengeTriggerFromSlave");e=e.data;self.onMouseChallengeTrigger.publish(e.data)}}]),SlaveListener}();function FeaturesBuilder_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var pt=function(){function FeaturesBuilder(e,t,r,n,o,i,s,a,u,c,l,f,p,d){!function FeaturesBuilder_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,FeaturesBuilder),self._features=e,self._configurationRepository=t,self._utils=r,self._elements=n,self._mutationObserver=o,self._dataQ=i,self._sessionService=s,self._muidMgr=a,self._perfMonitor=u,self._sensorDataQ=c,self._msgBus=l,self._cidCache=f,self._sameCharService=p,self._maskingService=d}return function FeaturesBuilder_createClass(e,t,r){t&&FeaturesBuilder_defineProperties(e.prototype,t),r&&FeaturesBuilder_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(FeaturesBuilder,[{key:"buildFeatures",value:function buildFeatures(){var r=self;!function buildFeaturesInList(t){t&&Object.keys(t).forEach(function(e){t[e].init.apply(r)})}(self._features.list)}}]),FeaturesBuilder}();function ContextApiHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var dt=function(){function ContextApiHandler(e,t){!function ContextApiHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ContextApiHandler),self._contextMgr=e,self._dataQ=t,self._contextMgr.onContextChange.subscribe(self.sendContextToServer.bind(self)),self.handleContextChange({context:"cd_auto"})}return function ContextApiHandler_createClass(e,t,r){t&&ContextApiHandler_defineProperties(e.prototype,t),r&&ContextApiHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ContextApiHandler,[{key:"handleContextChange",value:function handleContextChange(e){self._contextMgr.changeContext(e.context||e.activityType)}},{key:"sendContextToServer",value:function sendContextToServer(e){e&&self._dataQ.addToQueue("contextChange",[null,e.url,e.name,e.timestamp,e.referrer,e.hLength])}}]),ContextApiHandler}();function StateService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}dt.apiName="ContextChange";var ht=function(){function StateService(e){!function StateService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,StateService),self._messageBus=e,self._state=H.stopped}return function StateService_createClass(e,t,r){t&&StateService_defineProperties(e.prototype,t),r&&StateService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(StateService,[{key:"getState",value:function getState(){return self._state}},{key:"updateState",value:function updateState(e){var t=H[e];if(!t)throw new Error("Unknown state ".concat(e));self._state=t,self._messageBus.publish(fe.StateChangedEvent,{state:t})}}]),StateService}(),vt="cdNewSessionStartedEvent",yt="cdStateChangedEvent",_t="cdHeartbeat",gt="RestoredMuidEvent";function ClientEventService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var mt=function(){function ClientEventService(){!function ClientEventService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ClientEventService)}return function ClientEventService_createClass(e,t,r){t&&ClientEventService_defineProperties(e.prototype,t),r&&ClientEventService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ClientEventService,[{key:"publishNewSessionStartedEvent",value:function publishNewSessionStartedEvent(e){window.postMessage({type:vt,event:{sessionID:e}},window.location.href)}},{key:"publishStateChangedEvent",value:function publishStateChangedEvent(e){window.postMessage({type:yt,event:{state:e}},window.location.href)}},{key:"publishRestoredMuidEvent",value:function publishRestoredMuidEvent(e){window.postMessage({type:gt,event:{muid:e}},window.location.href)}}]),ClientEventService}();function ApiContextChangeEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var bt=function(){function ApiContextChangeEventHandler(e,t){!function ApiContextChangeEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ApiContextChangeEventHandler),self._messageBus=e,self._contextMgr=t,self._messageBus.subscribe(fe.ApiContextChangeEvent,self._handle.bind(self))}return function ApiContextChangeEventHandler_createClass(e,t,r){t&&ApiContextChangeEventHandler_defineProperties(e.prototype,t),r&&ApiContextChangeEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ApiContextChangeEventHandler,[{key:"_handle",value:function _handle(e){self._contextMgr.changeContext(e.context||e.activityType)}}]),ApiContextChangeEventHandler}();function ApiResetSessionEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ct=function(){function ApiResetSessionEventHandler(e,t){!function ApiResetSessionEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ApiResetSessionEventHandler),self._messageBus=e,self._sessionService=t,self._messageBus.subscribe(fe.ApiResetSessionEvent,self._handle.bind(self))}return function ApiResetSessionEventHandler_createClass(e,t,r){t&&ApiResetSessionEventHandler_defineProperties(e.prototype,t),r&&ApiResetSessionEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ApiResetSessionEventHandler,[{key:"_handle",value:function _handle(e){self._sessionService.onResetSession(e)}}]),ApiResetSessionEventHandler}();function ApiCustomerMetadataEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var wt=function(){function ApiCustomerMetadataEventHandler(e,t){!function ApiCustomerMetadataEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ApiCustomerMetadataEventHandler),self._messageBus=e,self._handleMetadata=t,self._messageBus.subscribe(fe.ApiCustomerMetadataEvent,self._handle.bind(self))}return function ApiCustomerMetadataEventHandler_createClass(e,t,r){t&&ApiCustomerMetadataEventHandler_defineProperties(e.prototype,t),r&&ApiCustomerMetadataEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ApiCustomerMetadataEventHandler,[{key:"_handle",value:function _handle(e){self._handleMetadata.onCustomerMetadata(e)}}]),ApiCustomerMetadataEventHandler}();function ApiChangeStateEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Et=function(){function ApiChangeStateEventHandler(e,t,r){!function ApiChangeStateEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ApiChangeStateEventHandler),self._messageBus=e,self._pauseResumeManager=t,self._slaveListener=r,self._messageBus.subscribe(fe.ApiChangeStateEvent,self._handle.bind(self))}return function ApiChangeStateEventHandler_createClass(e,t,r){t&&ApiChangeStateEventHandler_defineProperties(e.prototype,t),r&&ApiChangeStateEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ApiChangeStateEventHandler,[{key:"_handle",value:function _handle(e){self._pauseResumeManager.onStateChange(e),self._slaveListener.notifyStateChange(e)}}]),ApiChangeStateEventHandler}();function ApiSetCsidEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Pt=function(){function ApiSetCsidEventHandler(e,t){!function ApiSetCsidEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ApiSetCsidEventHandler),self._messageBus=e,self._csidService=t,self._messageBus.subscribe(fe.ApiSetCsidEvent,self._handle.bind(self))}return function ApiSetCsidEventHandler_createClass(e,t,r){t&&ApiSetCsidEventHandler_defineProperties(e.prototype,t),r&&ApiSetCsidEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ApiSetCsidEventHandler,[{key:"_handle",value:function _handle(e){e.csid?self._csidService.set(e.csid):w.warn("Received an invalid csid of ".concat(e.csid,". Ignoring api call"))}}]),ApiSetCsidEventHandler}();function ApiSetPsidEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var St=function(){function ApiSetPsidEventHandler(e,t){!function ApiSetPsidEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ApiSetPsidEventHandler),self._messageBus=e,self._psidService=t,self._messageBus.subscribe(fe.ApiSetPsidEvent,self._handle.bind(self))}return function ApiSetPsidEventHandler_createClass(e,t,r){t&&ApiSetPsidEventHandler_defineProperties(e.prototype,t),r&&ApiSetPsidEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ApiSetPsidEventHandler,[{key:"_handle",value:function _handle(e){e.psid?self._psidService.set(e.psid):w.warn("Received an invalid psid of ".concat(e.psid,". Ignoring api call"))}}]),ApiSetPsidEventHandler}();function NewSessionStartedEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var kt=function(){function NewSessionStartedEventHandler(e,t,r,n,o,i){!function NewSessionStartedEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,NewSessionStartedEventHandler),self._messageBus=e,self._featureService=t,self._customerApiBridge=r,self._contextMgr=n,self._clientEventService=o,self._sessionInfoService=i,self._messageBus.subscribe(fe.NewSessionStartedEvent,self._handle.bind(self))}return function NewSessionStartedEventHandler_createClass(e,t,r){t&&NewSessionStartedEventHandler_defineProperties(e.prototype,t),r&&NewSessionStartedEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(NewSessionStartedEventHandler,[{key:"_handle",value:function _handle(e){self._sessionInfoService.markStartTime(),self._featureService.runPerSessionFeatures(),self._customerApiBridge.notifySessionReset(e),self._contextMgr.onSessionReset(),self._clientEventService.publishNewSessionStartedEvent(e)}}]),NewSessionStartedEventHandler}();function ConfigurationLoadedEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ot=function(){function ConfigurationLoadedEventHandler(e,t,r,n,o,i,s,a,u,c,l,f,p,d,h){!function ConfigurationLoadedEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ConfigurationLoadedEventHandler),self._messageBus=e,self._featureService=t,self._dataQ=r,self._pauseResumeMgr=n,self._handleMetadata=o,self._logger=i,self._contextMgr=s,self._sessionService=a,self._sensorDataQ=u,self._slaveListener=c,self._stateService=l,self._performanceMonitor=f,self._heartBeatMessageService=p,self._sensorGateKeeper=d,self._sidRepository=h,self._messageBus.subscribe(fe.ConfigurationLoadedEvent,self._handle.bind(self))}return function ConfigurationLoadedEventHandler_createClass(e,t,r){t&&ConfigurationLoadedEventHandler_defineProperties(e.prototype,t),r&&ConfigurationLoadedEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ConfigurationLoadedEventHandler,[{key:"_handle",value:function _handle(e){w.info("Configurations were loaded from the server."),self._performanceMonitor.stopMonitor("t.timeTillServerConfig"),self._featureService.updateRunByConfig(e),self._dataQ.updateWithConfig(e),self._pauseResumeMgr.onConfigUpdate(e),self._handleMetadata.onConfigUpdate(e),self._logger.updateLogConfig(e),self._contextMgr.onConfigUpdate(e),self._sessionService.onConfigUpdate(e),self._sensorDataQ.onConfigUpdate(e),self._slaveListener.onConfigUpdate(e),self._heartBeatMessageService.updateConfig(e),self._sensorGateKeeper.configure(),self._sidRepository.onConfigUpdate(e),self._stateService.updateState(H.started),w.info("Successfully configured system")}}]),ConfigurationLoadedEventHandler}();function StateChangedEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Bt=function(){function StateChangedEventHandler(e,t){!function StateChangedEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,StateChangedEventHandler),self._messageBus=e,self._clientEventService=t,self._messageBus.subscribe(fe.StateChangedEvent,self._handle.bind(self))}return function StateChangedEventHandler_createClass(e,t,r){t&&StateChangedEventHandler_defineProperties(e.prototype,t),r&&StateChangedEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(StateChangedEventHandler,[{key:"_handle",value:function _handle(e){w.info("SDK state changed to ".concat(e.state)),self._clientEventService.publishStateChangedEvent(e.state)}}]),StateChangedEventHandler}();function ApiSetCustomerBrandEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Mt=function(){function ApiSetCustomerBrandEventHandler(e,t){!function ApiSetCustomerBrandEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ApiSetCustomerBrandEventHandler),self._messageBus=e,self._brandService=t,self._messageBus.subscribe(fe.ApiSetCustomerBrand,self._handle.bind(self))}return function ApiSetCustomerBrandEventHandler_createClass(e,t,r){t&&ApiSetCustomerBrandEventHandler_defineProperties(e.prototype,t),r&&ApiSetCustomerBrandEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ApiSetCustomerBrandEventHandler,[{key:"_handle",value:function _handle(e){e.brand?self._brandService.set(e.brand):w.warn("Received an empty brand name. Ignoring the API call")}}]),ApiSetCustomerBrandEventHandler}();function DOMUtils_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Rt=function(){function DOMUtils(){!function DOMUtils_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,DOMUtils)}return function DOMUtils_createClass(e,t,r){t&&DOMUtils_defineProperties(e.prototype,t),r&&DOMUtils_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(DOMUtils,null,[{key:"addEventListener",value:function addEventListener(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],i=5<arguments.length&&void 0!==arguments[5]&&arguments[5];self.isPassiveSupported?e.addEventListener(t,r,{capture:n,passive:o,once:i}):e.addEventListener?e.addEventListener(t,r,n):e.attachEvent("on"+t,r)}},{key:"removeEventListener",value:function removeEventListener(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3];e.removeEventListener?e.removeEventListener(t,r,n):e.detachEvent("on"+t,r)}},{key:"outerHTML",value:function outerHTML(e){return e.outerHTML||(new XMLSerializer).serializeToString(e)}},{key:"onDocumentBody",value:function onDocumentBody(e,t){e.document.body?t():window.addEventListener?window.addEventListener("DOMContentLoaded",t,!0):window.attachEvent("onload",t)}},{key:"onPageLoad",value:function onPageLoad(e,t){DOMUtils.addEventListener(e,"load",t,!0),(e.contentWindow&&"complete"===e.contentWindow.document.readyState||e.document&&"complete"===e.document.readyState)&&t()}},{key:"waitUntilDocumentIsReady",value:function waitUntilDocumentIsReady(r){var n=self;return new Promise(function(e,t){try{n.onWindowDocumentReady(r,function(){e()})}catch(e){t(e)}})}},{key:"onWindowDocumentReady",value:function onWindowDocumentReady(e,t){var r,n=window.addEventListener?"DOMContentLoaded":"load";"complete"===e.document.readyState||"interactive"===e.document.readyState?t():(r=function onLoadedWindowEvent(){DOMUtils.removeEventListener(e,n,r,!0),t()},DOMUtils.addEventListener(e,n,r,!0))}},{key:"isWindowDocumentReady",value:function isWindowDocumentReady(e){return e&&"complete"===e.document.readyState}},{key:"canAccessIFrame",value:function canAccessIFrame(e){var t=null;try{t=(e.contentDocument||e.contentWindow.document).body.innerHTML}catch(e){}return null!==t}},{key:"matches",value:function matches(e,t){return(e.matches||e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){var t=self.document||self.ownerDocument;if(!t)return!1;for(var r=t.querySelectorAll(e),n=r.length;0<=--n;)if((r.item?r.item(n):r[n])===self)break;return-1<n}).call(e,t)}},{key:"isWebWorkerFetchSupported",value:function isWebWorkerFetchSupported(){var e="Request"in self,t="fetch"in self;if(!e)return!1;e="keepalive"in Request.prototype;return t&&e}}]),DOMUtils}();function HeartBeatService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}!function DOMUtils_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(Rt,"isPassiveSupported",function DOMUtils_isPassiveSupported(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function get(){e=!0}});window.addEventListener("test",null,t)}catch(e){}return e}());var Dt=function(){function HeartBeatService(e,t,r){!function HeartBeatService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,HeartBeatService),self._heartBeatErrorsState=t,self._heartBeatPostMessageInterval=r,e.addMessageListener(ae.HeartBeatStatusEvent,self._handle.bind(self))}return function HeartBeatService_createClass(e,t,r){t&&HeartBeatService_defineProperties(e.prototype,t),r&&HeartBeatService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(HeartBeatService,[{key:"start",value:function start(){self._clear(),self._periodicPostMessageIntervalId=setInterval(self._postHeartBeatMessage.bind(self),self._heartBeatPostMessageInterval)}},{key:"stop",value:function stop(){self._clear()}},{key:"updateConfig",value:function updateConfig(e){self._heartBeatPostMessageInterval=e.get(C.heartBeatMessageInterval),self.start()}},{key:"_clear",value:function _clear(){self._periodicPostMessageIntervalId&&clearInterval(self._periodicPostMessageIntervalId)}},{key:"_handle",value:function _handle(e){self._heartBeatErrorsState.updateState(e)}},{key:"_postHeartBeatMessage",value:function _postHeartBeatMessage(){self._heartBeatErrorsState.hasErrors()?window.postMessage({type:_t,data:self._heartBeatErrorsState.getErrors()},window.location.href):window.postMessage({type:_t,data:"Ok"},window.location.href)}}]),HeartBeatService}();var Ft="oK",Tt="Error";function HeartBeatErrorsState_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var It=function(){function HeartBeatErrorsState(){!function HeartBeatErrorsState_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,HeartBeatErrorsState),self.errors={}}return function HeartBeatErrorsState_createClass(e,t,r){t&&HeartBeatErrorsState_defineProperties(e.prototype,t),r&&HeartBeatErrorsState_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(HeartBeatErrorsState,[{key:"updateState",value:function updateState(e){var t=e.category,r=e.status;self._isErrorRecovery(t,r)?(w.info("Received heart beat recovery event",e),delete self.errors[t]):self._isNewError(t,r)&&(w.info("Received heart beat error event",e),self.errors[t]=t)}},{key:"_isErrorRecovery",value:function _isErrorRecovery(e,t){return void 0!==self.errors[e]&&t===Ft}},{key:"_isNewError",value:function _isNewError(e,t){return void 0===self.errors[e]&&t===Tt}},{key:"getErrors",value:function getErrors(){var t=self;return Object.keys(self.errors).map(function(e){return"ERROR(".concat(t.errors[e],")")})}},{key:"hasErrors",value:function hasErrors(){return 0<Object.keys(self.errors).length}}]),HeartBeatErrorsState}();function SessionInfoService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var xt=function(){function SessionInfoService(){!function SessionInfoService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,SessionInfoService),self.markStartTime()}return function SessionInfoService_createClass(e,t,r){t&&SessionInfoService_defineProperties(e.prototype,t),r&&SessionInfoService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(SessionInfoService,[{key:"markStartTime",value:function markStartTime(){self.startTime=S.dateNow()}},{key:"getStartTime",value:function getStartTime(){return self.startTime}}]),SessionInfoService}();function SensorGateKeeper_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Lt=function(){function SensorGateKeeper(e,t){!function SensorGateKeeper_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,SensorGateKeeper),self.configurationRepository=t,self.sessionInfoService=e,self.isMotionOnSessionStart=self.configurationRepository.get(C.isMotionOnSessionStart),self.motionPaddingOnSessionStartMSec=self.configurationRepository.get(C.motionPaddingOnSessionStartMSec)}return function SensorGateKeeper_createClass(e,t,r){t&&SensorGateKeeper_defineProperties(e.prototype,t),r&&SensorGateKeeper_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(SensorGateKeeper,[{key:"configure",value:function configure(){self.isMotionOnSessionStart=self.configurationRepository.get(C.isMotionOnSessionStart),self.motionPaddingOnSessionStartMSec=self.configurationRepository.get(C.motionPaddingOnSessionStartMSec),self.isMotionOnSessionStart&&w.info("Motion on session start is enabled, collecting motion events for ".concat(self.motionPaddingOnSessionStartMSec/1e3," seconds."))}},{key:"isOpen",value:function isOpen(){return self.isMotionOnSessionStart&&S.dateNow()-self.motionPaddingOnSessionStartMSec<self.sessionInfoService.getStartTime()}}]),SensorGateKeeper}();function CustomElementsOpenContext_typeof(e){return(CustomElementsOpenContext_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function CustomElementsOpenContext_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function CustomElementsOpenContext_setPrototypeOf(e,t){return(CustomElementsOpenContext_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function CustomElementsOpenContext_createSuper(r){var n=function CustomElementsOpenContext_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=CustomElementsOpenContext_getPrototypeOf(r);return function CustomElementsOpenContext_possibleConstructorReturn(e,t){{if(t&&("object"===CustomElementsOpenContext_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function CustomElementsOpenContext_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=CustomElementsOpenContext_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function CustomElementsOpenContext_getPrototypeOf(e){return(CustomElementsOpenContext_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var jt=function(){!function CustomElementsOpenContext_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&CustomElementsOpenContext_setPrototypeOf(e,t)}(CustomElementsOpenContext,Te);var e=CustomElementsOpenContext_createSuper(CustomElementsOpenContext);function CustomElementsOpenContext(){return function CustomElementsOpenContext_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CustomElementsOpenContext),e.apply(self,arguments)}return function CustomElementsOpenContext_createClass(e,t,r){t&&CustomElementsOpenContext_defineProperties(e.prototype,t),r&&CustomElementsOpenContext_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CustomElementsOpenContext,[{key:"getDocument",value:function getDocument(){return self.context.shadowRoot}}]),CustomElementsOpenContext}();function CustomElementsClosedContext_typeof(e){return(CustomElementsClosedContext_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function CustomElementsClosedContext_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function CustomElementsClosedContext_setPrototypeOf(e,t){return(CustomElementsClosedContext_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function CustomElementsClosedContext_createSuper(r){var n=function CustomElementsClosedContext_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=CustomElementsClosedContext_getPrototypeOf(r);return function CustomElementsClosedContext_possibleConstructorReturn(e,t){{if(t&&("object"===CustomElementsClosedContext_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function CustomElementsClosedContext_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=CustomElementsClosedContext_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function CustomElementsClosedContext_getPrototypeOf(e){return(CustomElementsClosedContext_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var At=function(){!function CustomElementsClosedContext_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&CustomElementsClosedContext_setPrototypeOf(e,t)}(CustomElementsClosedContext,Te);var e=CustomElementsClosedContext_createSuper(CustomElementsClosedContext);function CustomElementsClosedContext(){return function CustomElementsClosedContext_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CustomElementsClosedContext),e.apply(self,arguments)}return function CustomElementsClosedContext_createClass(e,t,r){t&&CustomElementsClosedContext_defineProperties(e.prototype,t),r&&CustomElementsClosedContext_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CustomElementsClosedContext,[{key:"getDocument",value:function getDocument(){return self.context}}]),CustomElementsClosedContext}();function BrowserContextMutationObserver_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ut=function(){function BrowserContextMutationObserver(e,t,r){!function BrowserContextMutationObserver_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,BrowserContextMutationObserver),self._elementsMutationObserverFactory=e,self._windowMutationObservers=t,self._messageBus=r,self._messageBus.subscribe(fe.BrowserContextAdded,self._processNewContext.bind(self))}return function BrowserContextMutationObserver_createClass(e,t,r){t&&BrowserContextMutationObserver_defineProperties(e.prototype,t),r&&BrowserContextMutationObserver_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(BrowserContextMutationObserver,[{key:"_processNewContext",value:function _processNewContext(e){self.monitorWindow(e)}},{key:"monitorWindow",value:function monitorWindow(e){var t;self._windowMutationObservers.has(e)||((t=new self._elementsMutationObserverFactory(e,self.MutationObserver)).observe(e.getDocument()),t.nodesAdded.subscribe(self._nodesAddedMutationObserved.bind(self)),t.nodesRemoved.subscribe(self._nodesRemovedMutationObserved.bind(self)),self._windowMutationObservers.set(e,t))}},{key:"unMonitorWindow",value:function unMonitorWindow(e){var t=self._windowMutationObservers.get(e);t&&(t.nodesAdded.unsubscribe(self._nodesAddedMutationObserved.bind(self)),t.nodesRemoved.unsubscribe(self._nodesRemovedMutationObserved.bind(self)),t.disconnect()),self._windowMutationObservers.delete(e)}},{key:"_nodesAddedMutationObserved",value:function _nodesAddedMutationObserved(e){self._messageBus.publish(fe.MutationAddedNodes,e)}},{key:"_nodesRemovedMutationObserved",value:function _nodesRemovedMutationObserved(e){self._messageBus.publish(fe.MutationRemovedNodes,e)}}]),BrowserContextMutationObserver}();function CustomElementEventMessage_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function CustomElementEventMessage_createClass(e,t,r){return t&&CustomElementEventMessage_defineProperties(e.prototype,t),r&&CustomElementEventMessage_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var Nt="added",Wt="removed",Ht=CustomElementEventMessage_createClass(function CustomElementEventMessage(e,t){!function CustomElementEventMessage_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CustomElementEventMessage),self.browserContext=e,self.message=t});function CustomElementsDetector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Qt=function(){function CustomElementsDetector(e,t,r){!function CustomElementsDetector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CustomElementsDetector),self._domUtils=t,self._messageBus=r,self._loadedCustomElements=G(),self._windowMutationObservers=G(),self._messageBus.subscribe(fe.MutationAddedNodes,self._processAddedNodes.bind(self)),self._messageBus.subscribe(fe.MutationRemovedNodes,self._processRemovedNodes.bind(self)),self._messageBus.subscribe(fe.CustomElementSubmitted,self._processSubmittedCustomElement.bind(self)),self._browserContextMutationObserver=new Ut(e,self._windowMutationObservers,self._messageBus)}return function CustomElementsDetector_createClass(e,t,r){t&&CustomElementsDetector_defineProperties(e.prototype,t),r&&CustomElementsDetector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CustomElementsDetector,[{key:"customElements",get:function get(){var r=[];return self._loadedCustomElements.forEach(function(e,t){r.push(t)}),r}},{key:"hasCustomElement",value:function hasCustomElement(e){return!!self._loadedCustomElements.has(e)}},{key:"addCustomElementToLoadedList",value:function addCustomElementToLoadedList(e,t){self._loadedCustomElements.set(e,t)}},{key:"start",value:function start(e){var t=self;self._browserContextMutationObserver.monitorWindow(e),self._findCustomElementsInBrowserContext(e.getDocument()).forEach(function(e){t._processNewElement(e)})}},{key:"stop",value:function stop(){self._windowMutationObservers.forEach(function(e){e.disconnect()})}},{key:"_processSubmittedCustomElement",value:function _processSubmittedCustomElement(e){self._loadedCustomElements.has(e)||self._addCustomElement(e,new At(e),"closed")}},{key:"_processNewElement",value:function _processNewElement(e){self._loadedCustomElements.has(e)||(null!=e.shadowRoot?self._addCustomElement(e,new jt(e)):self._messageBus.publish(fe.CustomElementInaccessible,e))}},{key:"_addCustomElement",value:function _addCustomElement(e,t){"open"===(2<arguments.length&&void 0!==arguments[2]?arguments[2]:"open")&&self._browserContextMutationObserver.monitorWindow(t),self._loadedCustomElements.set(e,t),self._messageBus.publish(fe.CustomElementDetectedEvent,new Ht(t,Nt))}},{key:"_removeCustomElement",value:function _removeCustomElement(e){var t=self._loadedCustomElements.get(e);self._browserContextMutationObserver.unMonitorWindow(e.shadowRoot),self._loadedCustomElements.delete(e)&&self._messageBus.publish(fe.CustomElementDetectedEvent,new Ht(t,Wt))}},{key:"_processAddedNodes",value:function _processAddedNodes(e){var t=self;self._findCustomElementsInBrowserContext(e.browserContext.getDocument()).forEach(function(e){t._processNewElement(e)})}},{key:"_processRemovedNodes",value:function _processRemovedNodes(e){for(var t=self,r=e.removedNodes,n=[],o=0;o<r.length;o++){var i,s=r[o];s.hasChildNodes()?0<(i=self._findCustomElementsInBrowserContext(s)).length&&(n=n.concat(i)):self._isCustomElement(s)&&s.shadowRoot&&n.push(s)}0!==n.length&&n.forEach(function(e){t._removeCustomElement(e)})}},{key:"_isCustomElement",value:function _isCustomElement(e){return"string"==typeof e.localName&&0<e.localName.indexOf("-")}},{key:"_findCustomElementsInBrowserContext",value:function _findCustomElementsInBrowserContext(e){var t=[],r=e.querySelectorAll("*");if(0===r.length)return t;for(var n=0;n<r.length;n++){var o,i=r[n];self._isCustomElement(i)&&(t.push(i),i.shadowRoot?(o=self._findCustomElementsInBrowserContext(i.shadowRoot),t=t.concat(o)):self._messageBus.publish(fe.CustomElementInaccessible,i))}return t}}]),CustomElementsDetector}();function CustomElementDetectedEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var zt=function(){function CustomElementDetectedEventHandler(e,t,r){!function CustomElementDetectedEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CustomElementDetectedEventHandler),self._browserContextsCache=e,self._messageBus=r,self._featureService=t,self._messageBus.subscribe(fe.CustomElementDetectedEvent,self._handle.bind(self))}return function CustomElementDetectedEventHandler_createClass(e,t,r){t&&CustomElementDetectedEventHandler_defineProperties(e.prototype,t),r&&CustomElementDetectedEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CustomElementDetectedEventHandler,[{key:"_handle",value:function _handle(e){var t=e.browserContext,e=e.message;e===Nt?self._handleCustomElementAdded(t):e===Wt&&self._handleCustomElementRemoved(t)}},{key:"_handleCustomElementAdded",value:function _handleCustomElementAdded(e){self._browserContextsCache.exists(e.Context)||self._browserContextsCache.addBrowserContext(e),self._featureService.runFeaturesOnBrowserContext(e)}},{key:"_handleCustomElementRemoved",value:function _handleCustomElementRemoved(e){self._featureService.stopFeaturesOnBrowserContextRemove(e),self._browserContextsCache.remove(e.Context)}}]),CustomElementDetectedEventHandler}();function StartupConfigurationLoader_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var qt=function(){function StartupConfigurationLoader(e,t){!function StartupConfigurationLoader_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,StartupConfigurationLoader),self._configurationRepository=e,self._startUpConfigurations=t}return function StartupConfigurationLoader_createClass(e,t,r){t&&StartupConfigurationLoader_defineProperties(e.prototype,t),r&&StartupConfigurationLoader_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(StartupConfigurationLoader,[{key:"loadStartUpConfigurations",value:function loadStartUpConfigurations(){self._setConfigurationOrDefault(C.enableFramesProcessing,self._startUpConfigurations.getEnableFramesProcessing(),!0),self._setConfigurationOrDefault(C.enableCustomElementsProcessing,self._startUpConfigurations.getEnableCustomElementsProcessing(),!1),self._setConfigurationOrDefault(C.customElementAttribute,self._startUpConfigurations.getCollectionSettings().getElementSettings().getCustomElementAttribute(),"data-automation-id"),self._setConfigurationOrDefault(C.enableSameSiteNoneAndSecureCookies,self._startUpConfigurations.getEnableSameSiteNoneAndSecureCookies(),!0),self._setConfigurationOrDefault(C.maskElementsAttributes,self._startUpConfigurations.getCollectionSettings().getElementSettings().getAttributesToMask(),[])}},{key:"_setConfigurationOrDefault",value:function _setConfigurationOrDefault(e,t,r){S.isUndefinedNull(t)?self._configurationRepository.set(e,r):self._configurationRepository.set(e,t)}}]),StartupConfigurationLoader}(),Kt={Enter:13,ArrowUp:38,ArrowDown:40,ArrowLeft:37,ArrowRight:39,Escape:27," ":32,Control:17,Alt:18,Tab:9,Shift:16,CapsLock:20,Meta:91,Backspace:8,Home:36,End:35,Insert:45,Delete:46,PageUp:33,PageDown:34,PrintScreen:44,NumLock:144,Clear:144,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,10:121,F11:122,F12:123};function MaskingService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Vt=function(){function MaskingService(e){!function MaskingService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,MaskingService),self._configurationRepository=e,self._attributesToMask=!!self._configurationRepository.get(C.maskElementsAttributes)&&self._maskArrayValues(self._configurationRepository.get(C.maskElementsAttributes)),self._attributesToMask&&self._configurationRepository.set(C.maskElementsAttributes,self._attributesToMask),self.specailConfigurationChars=Y([",","."," ","@",";",":","-","+","$"]),self.specailChars=Y(["_","!","%","^","&","*","#","(",")","=","{","}","[","]","’","\\","|","/","?",">","<","~",'"',"±","§"]),self.kanjiNumbers=Y(["〇","零","一","二","三","四","五","六","七","八","九","十","百","千","万"]),self.chineseCapitalNumbers=Y(["零","壹","貳","贰","參","叁","肆","伍","陸","陆","柒","捌","玖","拾","佰","仟","萬"]),self.suzhouNumbers=Y(["〇","〡","〢","〣","〤","〥","〦","〧","〨","〩","〸","〹","〺"]),self.maskedCodeMapping={original:function original(e,t,r){return{code:e,charCode:t,key:r}},numpadKey:function numpadKey(e){return{code:"Numpad",charCode:96,key:e}},letter:function letter(){return{code:"Key",charCode:65,key:"A"}},digit:function digit(){return{code:"Digit",charCode:49,key:"1"}},specialChar:function specialChar(){return{code:"SpecialChar",charCode:42,key:"*"}},other:function other(){return{code:"Other",charCode:66,key:"B"}}}}return function MaskingService_createClass(e,t,r){t&&MaskingService_defineProperties(e.prototype,t),r&&MaskingService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(MaskingService,[{key:"maskKey",value:function maskKey(e,t){if(Kt[e]){var r=Kt[e];return self.maskedCodeMapping.original(t,r,e)}return self._isANumberOrDigit(e)?t.includes("Numpad")?self.maskedCodeMapping.numpadKey("1"):self.maskedCodeMapping.digit():self._isALetter(e)?self.maskedCodeMapping.letter():!self._configurationRepository.get(C.keyEventsMaskSpecialChars)&&self.specailConfigurationChars.has(e)?self.maskedCodeMapping.original(t,e.charCodeAt(0),e):self.specailChars.has(e)||self.specailConfigurationChars.has(e)?t.includes("Numpad")?self.maskedCodeMapping.numpadKey("*"):self.maskedCodeMapping.specialChar():self.maskedCodeMapping.other()}},{key:"getKeyFromLegacyProperties",value:function getKeyFromLegacyProperties(e){e=e.keyCode||e.which;return 0===e||void 0===e?"":String.fromCharCode(e)}},{key:"_isALetter",value:function _isALetter(e){return/^[a-zA-Z]$/.test(e)||self._isJapaneseOrChineseLetter(e)||self._isHebrewLetter(e)}},{key:"_isANumberOrDigit",value:function _isANumberOrDigit(e){return/[0-9]/.test(e)||self.kanjiNumbers.has(e)||self.chineseCapitalNumbers.has(e)||self.suzhouNumbers.has(e)}},{key:"_isJapaneseOrChineseLetter",value:function _isJapaneseOrChineseLetter(e){return self._isCJKUnifiedIdeographs(e)||self._isCJKUnifiedIdeographsExtenA(e)||self._isCJKUnifiedIdeographsExtenB(e)||self._isSmallKatakanaLetter(e)}},{key:"_isCJKUnifiedIdeographsExtenB",value:function _isCJKUnifiedIdeographsExtenB(e){return/[\u3041-\u309F]/.test(e)}},{key:"_isSmallKatakanaLetter",value:function _isSmallKatakanaLetter(e){return/[\u30A1-\u30FF]/.test(e)}},{key:"_isCJKUnifiedIdeographsExtenA",value:function _isCJKUnifiedIdeographsExtenA(e){return/[\u3400-\u4DB5]/.test(e)}},{key:"_isCJKUnifiedIdeographs",value:function _isCJKUnifiedIdeographs(e){return/[\u4E00-\u9FCC]/.test(e)}},{key:"_isHebrewLetter",value:function _isHebrewLetter(e){return/[\u05D0-\u05EA]/.test(e)}},{key:"maskText",value:function maskText(e){if(S.isUndefinedNull(e))return"";e=e.replace(/[\d]/g,"1").replace(/[\u3007\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D\u5341\u767E\u5343\u4E07]/g,"1").replace(/[\u96F6\u58F9\u8CB3\u8D30\u53C3\u53C1\u8086\u4F0D\u9678\u9646\u67D2\u634C\u7396\u62FE\u4F70\u4EDF\u842C\u3021-\u3029\u3038\u3039\u303A]/g,"1").replace(/[a-zA-Z]/g,"a").replace(/[\u05D0-\u05EA]/g,"a").replace(/[\u4E00-\u9FCC\u3400-\u4DB5\u3041-\u309F\u30A1-\u30FF]/g,"a").replace(/[\\_!%^&*#()={}\[\]’|/?><~"±§`'׳]/g,"*");return self._configurationRepository.get(C.keyEventsMaskSpecialChars)?e.replace(/[,.@;:+$ -]/g,"*").replace(/[^a1*]/g,"B"):e.replace(/[^a1*,.@;:+$ -]/g,"B")}},{key:"_maskArrayValues",value:function _maskArrayValues(e){var t=self;if(!Array.isArray(e))return self._configurationRepository.set(C.maskElementsAttributes,[]),w.warn("collectionSetting- Invalid array of attributes to mask"),!1;var r={};return e.forEach(function(e){r[e]=t.maskText(e)}),r}}]),MaskingService}();function LogAggregator_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Gt=function(){function LogAggregator(){!function LogAggregator_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,LogAggregator),self.reset()}return function LogAggregator_createClass(e,t,r){t&&LogAggregator_defineProperties(e.prototype,t),r&&LogAggregator_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(LogAggregator,[{key:"setLogLevel",value:function setLogLevel(e){self._logLevel=e}},{key:"add",value:function add(e){e=e.data;if(!e)throw new Error("Unable to add log message. Missing data field");(!e.level||e.level>=self._logLevel)&&self._Q.push(e)}},{key:"take",value:function take(){var e=self._Q;return self.reset(),e}},{key:"reset",value:function reset(){self._Q=[],self.setLogLevel(u.INFO)}},{key:"isEmpty",value:function isEmpty(){return 0===self._Q.length}},{key:"filterOutByLogLevel",value:function filterOutByLogLevel(n){self._Q=self._Q.filter(function(e,t,r){return e.level>=n})}}]),LogAggregator}();function LogBridge_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Zt=function(){function LogBridge(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";!function LogBridge_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,LogBridge),self.sn=0,self.url=t,self.logAggregator=e,self.msgPrefix=r}return function LogBridge_createClass(e,t,r){t&&LogBridge_defineProperties(e.prototype,t),r&&LogBridge_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(LogBridge,[{key:"log",value:function log(e,t){self.logAggregator.add({eventName:"log",data:{msg:self.msgPrefix+e,url:self.url,level:t,sn:self.sn++}})}},{key:"setLogLevel",value:function setLogLevel(e){self.logAggregator instanceof Gt&&self.logAggregator.setLogLevel(e)}},{key:"clearLogEntriesByLogLevel",value:function clearLogEntriesByLogLevel(e){self.logAggregator.filterOutByLogLevel(e)}}]),LogBridge}();function LogDataQ_typeof(e){return(LogDataQ_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function LogDataQ_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function LogDataQ_setPrototypeOf(e,t){return(LogDataQ_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function LogDataQ_createSuper(r){var n=function LogDataQ_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=LogDataQ_getPrototypeOf(r);return function LogDataQ_possibleConstructorReturn(e,t){{if(t&&("object"===LogDataQ_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function LogDataQ_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=LogDataQ_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function LogDataQ_getPrototypeOf(e){return(LogDataQ_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Yt=function(){!function LogDataQ_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&LogDataQ_setPrototypeOf(e,t)}(LogDataQ,X);var e=LogDataQ_createSuper(LogDataQ);function LogDataQ(){return function LogDataQ_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,LogDataQ),e.apply(self,arguments)}return function LogDataQ_createClass(e,t,r){t&&LogDataQ_defineProperties(e.prototype,t),r&&LogDataQ_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(LogDataQ,[{key:"add",value:function add(e){self.addToQueue(e.eventName,e.data)}},{key:"filterOutByLogLevel",value:function filterOutByLogLevel(t){self.filterOut(function(e){return e.data.level>=t})}}]),LogDataQ}();function StorageUtilsWrapper_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Jt=function(){function StorageUtilsWrapper(e,t){!function StorageUtilsWrapper_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,StorageUtilsWrapper),self.isSecureSameSite=t.get(C.enableSameSiteNoneAndSecureCookies),self._utils=e}return function StorageUtilsWrapper_createClass(e,t,r){t&&StorageUtilsWrapper_defineProperties(e.prototype,t),r&&StorageUtilsWrapper_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(StorageUtilsWrapper,[{key:"getCookie",value:function getCookie(e){return self._utils.StorageUtils.getCookie(e)}},{key:"setCookie",value:function setCookie(e,t,r){return self._utils.StorageUtils.setCookie(e,t,r,self.isSecureSameSite)}},{key:"setExpirationInCookie",value:function setExpirationInCookie(e,t){return self._utils.StorageUtils.setExpirationInCookie(e,t)}},{key:"getFromLocalStorage",value:function getFromLocalStorage(e){return self._utils.StorageUtils.getFromLocalStorage(e)}},{key:"saveToLocalStorage",value:function saveToLocalStorage(e,t,r){return self._utils.StorageUtils.saveToLocalStorage(e,t,r)}},{key:"setExpirationInLocalStorage",value:function setExpirationInLocalStorage(e,t){return self._utils.StorageUtils.setExpirationInLocalStorage(e,t)}},{key:"removeFromLocalStorage",value:function removeFromLocalStorage(e){return self._utils.StorageUtils.removeFromLocalStorage(e)}},{key:"removeCookie",value:function removeCookie(e){return self._utils.StorageUtils.removeCookie(e)}}]),StorageUtilsWrapper}();function BrandService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Xt=function(){function BrandService(e,t){!function BrandService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,BrandService),self._workerCommunicator=e,self._brandRepository=t}return function BrandService_createClass(e,t,r){t&&BrandService_defineProperties(e.prototype,t),r&&BrandService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(BrandService,[{key:"set",value:function set(e){self._validateBrand(e)&&(self._brandRepository.set(e),self._workerCommunicator.sendAsync(W,{brand:e}))}},{key:"update",value:function update(){var e=self._brandRepository.get();e&&self.set(e)}},{key:"_validateBrand",value:function _validateBrand(e){return 200<e.length?(w.warn("The received brand name length is greater than 200. It is illegal. Ignoring the API call"),!1):!!/^[a-zA-Z0-9.\-,_ ]+$/.test(e)||(w.warn("The received brand contains illegal characters. The legal characters are: A-Za-z0-9.-,_ and space. Ignoring the API call"),!1)}}]),BrandService}();function BrandRepository_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var $t=function(){function BrandRepository(e,t){!function BrandRepository_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,BrandRepository),self.brandKey="brand",self._utils=e,self._storageUtilsWrapper=t,self.COOKIE_EXPIRATION_IN_MILLISECONDS=self._utils.minutesToMilliseconds(525600)}return function BrandRepository_createClass(e,t,r){t&&BrandRepository_defineProperties(e.prototype,t),r&&BrandRepository_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(BrandRepository,[{key:"get",value:function get(){var e=self._storageUtilsWrapper.getCookie(self.brandKey);if(!(t=self._validateBrand(e))){w.debug("Brand was not found in cookie. Trying to get it from the local storage.");var t,e=self._storageUtilsWrapper.getFromLocalStorage(self.brandKey);if(!(t=self._validateBrand(e)))return w.debug("Brand was not found in local storage."),null}return t}},{key:"set",value:function set(e){var t=self._validateBrand(e);t?(self._storageUtilsWrapper.saveToLocalStorage(self.brandKey,t)||w.error("Failed saving brand ".concat(e," to local storage.")),self._storageUtilsWrapper.setCookie(self.brandKey,t,self.COOKIE_EXPIRATION_IN_MILLISECONDS)||w.error("Failed saving brand ".concat(e," to cookie."))):w.error("Brand ".concat(e," is invalid. Will not save it."))}},{key:"_validateBrand",value:function _validateBrand(e){return e||null}}]),BrandRepository}();function RestoredMuidEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var er=function(){function RestoredMuidEventHandler(e,t,r,n){!function RestoredMuidEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,RestoredMuidEventHandler),self._messageBus=e,self._muid=t,self._clientEventService=r,self._workerCommunicator=n,self._messageBus.subscribe(fe.ServerRestoredMuidEvent,self._handler.bind(self),!0),self._workerCommunicator.addMessageListener(ae.ServerRestoredMuidEvent,self._publish.bind(self),!0)}return function RestoredMuidEventHandler_createClass(e,t,r){t&&RestoredMuidEventHandler_defineProperties(e.prototype,t),r&&RestoredMuidEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(RestoredMuidEventHandler,[{key:"_handler",value:function _handler(e){self._muid.updateMuid(e),self._clientEventService.publishRestoredMuidEvent(e)}},{key:"_publish",value:function _publish(e){self._messageBus.publish(fe.ServerRestoredMuidEvent,e)}}]),RestoredMuidEventHandler}();function SystemBootstrapper_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var tr=function(){function SystemBootstrapper(){!function SystemBootstrapper_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,SystemBootstrapper),self._serverWorker=null,self._serverWorkerCommunicator=null,self._configurationService=null,self._featureBuilder=null,self._featureService=null,self._dataQ=null,self._frameHandler=null,self._eventHandlers=[],self._contextMgr=null,self._runWorker=function(e){return new K(e.getUseUrlWorker(),e.getWorkerUrl()).create()}}return function SystemBootstrapper_createClass(e,t,r){t&&SystemBootstrapper_defineProperties(e.prototype,t),r&&SystemBootstrapper_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(SystemBootstrapper,[{key:"start",value:function start(e,t,r){self._loadSystem(e,t,r)}},{key:"stop",value:function stop(){self._serverWorker&&self._serverWorker.close(),self.heartBeatService&&self.heartBeatService.stop()}},{key:"registerPostLoadEvents",value:function registerPostLoadEvents(){self._slaveListener.onResetSessionTrigger.subscribe(self._sessionService.resetSession.bind(self._sessionService))}},{key:"flushAllMessages",value:function flushAllMessages(){self._dataQ.flushAllMessages()}},{key:"getServerWorkerCommunicator",value:function getServerWorkerCommunicator(){return self._serverWorkerCommunicator}},{key:"getFeatureBuilder",value:function getFeatureBuilder(){return self._featureBuilder}},{key:"getFeatureService",value:function getFeatureService(){return self._featureService}},{key:"getConfigurationService",value:function getConfigurationService(){return self._configurationService}},{key:"getConfigurationRepository",value:function getConfigurationRepository(){return self._configurationRepository}},{key:"getSessionService",value:function getSessionService(){return self._sessionService}},{key:"getContextMgr",value:function getContextMgr(){return self._contextMgr}},{key:"getMuidMgr",value:function getMuidMgr(){return self._muidManager}},{key:"getApiBridge",value:function getApiBridge(){return self._customerApiBridge}},{key:"getPerfMonitor",value:function getPerfMonitor(){return self._perfMonitor}},{key:"getServerStateMgr",value:function getServerStateMgr(){return self._serverStateMgr}},{key:"getMessageBus",value:function getMessageBus(){return self._msgBus}},{key:"_loadSystem",value:function _loadSystem(e,t,r){self._runServerWorker(r),self._serverWorkerCommunicator=new J,self._serverWorkerCommunicator.setMessagingPort(self._serverWorker.port);var n=new Yt(Rt,self._serverWorkerCommunicator,null,"logPerfQPassWorkerInterval",N);self._perfMonitor=new $(n),self._configurationRepository=new le,new qt(self._configurationRepository,r).loadStartUpConfigurations();var o=new Jt(S,self._configurationRepository),i=new ee(self.MutationObserver,S,Rt,"contextConfiguration",null,!0,400);self._contextMgr=new ne(S,i,self._serverWorkerCommunicator,o);var s=new Zt(n,self._contextMgr.url),a=new f(s);w.setLogger(a),self._currScriptName=document.currentScript?document.currentScript.src:"",self._globalexceptionHandler=new oe(S,self._currScriptName),self._msgBus=new ie,self._dataQ=new X(Rt,self._serverWorkerCommunicator,self._contextMgr,"dataQPassWorkerInterval",U),self._cidCache=new se,self._serverStateMgr=new ue(self._serverWorkerCommunicator,S),self._sessionInfoService=new xt,self._sensorGateKeeper=new Lt(self._sessionInfoService,self._configurationRepository),self._configurationService=new pe(S,self._configurationRepository,self._msgBus,self._cidCache,self._serverWorkerCommunicator),self._sensorDataQ=new Oe(self._configurationRepository,self._dataQ,self._msgBus,S,self._sensorGateKeeper),self._elementsUtils=new Me(self._configurationRepository,S,self._dataQ,self._contextMgr);var u=new je,c=new He(self._configurationRepository,Rt,S);self._frameHandler=c.create(),self._featureService=new Qe(e,self._frameHandler,self._configurationRepository,Rt,S,u);var l=new Qt(Ne,S,self._msgBus);self._pauseResumeMgr=new qe(self._featureService,self._configurationRepository,self._dataQ),self._customerApiBridge=new $e(self._pauseResumeMgr,self._msgBus,t,S),self._muidManager=new et(S,self._dataQ,o),self._psidCache=new tt;i=new rt(self._psidCache,self._serverWorkerCommunicator),s=new ee(self.MutationObserver,S,Rt,"resetSessionConfig"),c=new nt(S,o,self._configurationRepository);self._csidCache=new ot;t=new it(self._customerApiBridge,self._csidCache,self._serverWorkerCommunicator),o=new $t(S,o);self._brandService=new Xt(self._serverWorkerCommunicator,o),self._sessionService=new at(self._msgBus,self._configurationService,self._configurationRepository,S,Rt,self._serverWorkerCommunicator,self._contextMgr,self._muidManager,self._serverStateMgr,s,c,t,self._csidCache,self._psidCache,self._brandService),self._metadataService=new ut(self._configurationRepository,self._dataQ),self._slaveListener=new ft(self._dataQ,self._configurationRepository,S,n,self._contextMgr),self._slaveListener.listen(),self._sameChar=new Ce,self._maskingService=new Vt(self._configurationRepository),self._featureBuilder=new pt(e,self._configurationRepository,S,self._elementsUtils,self.MutationObserver,self._dataQ,self._sessionService,self._muidManager,self._perfMonitor,self._sensorDataQ,self._msgBus,self._cidCache,self._sameChar,self._maskingService),self._contextApiHandler=new dt(self._contextMgr,self._dataQ),self._contextMgr.onContextChange.subscribe(self._featureService.runPerContextFeatures.bind(self._featureService)),self._stateService=new ht(self._msgBus);e=new mt;self.heartBeatService=new Dt(self._serverWorkerCommunicator,new It,self._configurationRepository.get(C.heartBeatMessageInterval)),self.heartBeatService.start(),self._eventHandlers.push(new er(self._msgBus,self._muidManager,e,self._serverWorkerCommunicator)),self._eventHandlers.push(new bt(self._msgBus,self._contextMgr)),self._eventHandlers.push(new Ct(self._msgBus,self._sessionService)),self._eventHandlers.push(new wt(self._msgBus,self._metadataService)),self._eventHandlers.push(new Et(self._msgBus,self._pauseResumeMgr,self._slaveListener)),self._eventHandlers.push(new Pt(self._msgBus,t)),self._eventHandlers.push(new St(self._msgBus,i)),self._eventHandlers.push(new Mt(self._msgBus,self._brandService)),self._eventHandlers.push(new Bt(self._msgBus,e)),self._eventHandlers.push(new Ot(self._msgBus,self._featureService,self._dataQ,self._pauseResumeMgr,self._metadataService,a,self._contextMgr,self._sessionService,self._sensorDataQ,self._slaveListener,self._stateService,self._perfMonitor,self.heartBeatService,self._sensorGateKeeper,c)),self._eventHandlers.push(new kt(self._msgBus,self._featureService,self._customerApiBridge,self._contextMgr,e,self._sessionInfoService)),self._configurationRepository.get(C.enableCustomElementsProcessing)&&(l.start(new Te(window.self)),self._eventHandlers.push(new zt(u,self._featureService,self._msgBus))),r.getLogServerURL()&&self._configurationService.updateLogUrlToWorker(self._sessionService.sessionId,self._csidCache.get(),self._serverWorkerCommunicator,r.getLogServerURL()),self._stateService.updateState(H.starting)}},{key:"_runServerWorker",value:function _runServerWorker(e){self._serverWorker=self._runWorker(e)}}]),SystemBootstrapper}();function ElementEventCollector_typeof(e){return(ElementEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){ElementEventCollector_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function ElementEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ElementEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ElementEventCollector_createClass(e,t,r){return t&&ElementEventCollector_defineProperties(e.prototype,t),r&&ElementEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function ElementEventCollector_setPrototypeOf(e,t){return(ElementEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function ElementEventCollector_createSuper(r){var n=function ElementEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=ElementEventCollector_getPrototypeOf(r);return function ElementEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===ElementEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return ElementEventCollector_assertThisInitialized(e)}(self,n?(e=ElementEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function ElementEventCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function ElementEventCollector_getPrototypeOf(e){return(ElementEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ElementEventCollector_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var rr={configKey:"isElementsEvent",isDefault:!0,shouldRunPerContext:!0,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,instance:null},nr={input:0,initial:1,focus:2,blur:3,change:4,click:5,submit:6},or=["eventSequence","timestamp","eventType","isTrusted","elementHash","length","elementValues","selected","hashedValue","relativeTime"],ir=function(){!function ElementEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ElementEventCollector_setPrototypeOf(e,t)}(ElementEventCollector,de);var t=ElementEventCollector_createSuper(ElementEventCollector);function ElementEventCollector(e){var n;return ElementEventCollector_classCallCheck(self,ElementEventCollector),ElementEventCollector_defineProperty(ElementEventCollector_assertThisInitialized(n=t.call(self)),"mutationMessageHandler",function(e){e.browserContext&&(n._inputEvents.addOnLoadInputData(e.browserContext,!0),n._inputEvents.bind(e.browserContext),n._clickEvents.bind(e.browserContext),n._selectElementEvents.bind(e.browserContext),n._formEvents.bind(e.browserContext))}),ElementEventCollector_defineProperty(ElementEventCollector_assertThisInitialized(n),"startFeature",function(e){n._inputEvents.addOnLoadInputData(e,!1),n._inputEvents.bind(e),n._clickEvents.bind(e),n._selectElementEvents.bind(e),n._formEvents.bind(e),n._configurationRepository.get(C.isMutationObserver)&&n._mutationEmitter&&(n._mutationEmitter.startObserver(e),n._jQueryElementListenerSiteMapper.initTracking())}),ElementEventCollector_defineProperty(ElementEventCollector_assertThisInitialized(n),"_onSiteMapperMatch",function(e){var t=e.selector;if(t)try{var r=window.document.querySelector(t);if(!r)return void w.error("ElementEvents._onSiteMapperMatch - selector:".concat(JSON.stringify(t)," not found on page"));n._domUtils.matches(r,n._inputSelectors)?n._jqueryEventHandler.bindInputEvents(r):n._domUtils.matches(r,n._onClickSelectors)?n._jqueryEventHandler.bindOnClickEvents(r):n._domUtils.matches(r,n._onSelectSelectors)?n._jqueryEventHandler.bindOnChangeEvents(r):n._domUtils.matches(r,n._onFormSelectors)?n._jqueryEventHandler.bindOnFormsEvents(r):w.error("ElementEvents._onSiteMapperMatch - Unable to match the element with selector:\n                ".concat(JSON.stringify(t)," to any selectors group. Aborting jQuery element listening process."))}catch(e){w.error("ElementEvents._onSiteMapperMatch - ".concat(e.message),e)}else w.warn("ElementEvents._onSiteMapperMatch - No selector defined for match. Aborting jQuery element listening process.")}),n._configurationRepository=e.configurationRepository,n._utils=e.utils,n._domUtils=e.domUtils,n._dataQ=e.dataQ,n._elements=e.elements,n._jQueryElementListenerSiteMapper=e.jQueryElementListenerSiteMapper,n._jQueryElementListenerSiteMapper.updateObserver(n._onSiteMapperMatch),n._messageBus=e.messageBus,n._mutationEmitter=e.mutationEmitter,n._messageBus.subscribe(fe.MutationSingleEvent,n.mutationMessageHandler),n._StandardInputEventsEmitter=e.StandardInputEventsEmitter,n._SyntheticMaskInputEventsHandler=e.SyntheticMaskInputEventsHandler,n._SyntheticAutotabInputEventsHandler=e.SyntheticAutotabInputEventsHandler,n._maskingService=e.maskingService,n._inputEvents=new e.InputEvents(n._elements,n.sendToQueue.bind(ElementEventCollector_assertThisInitialized(n)),n._utils,n._messageBus,n._StandardInputEventsEmitter,n._SyntheticMaskInputEventsHandler,n._SyntheticAutotabInputEventsHandler,n._maskingService),n._inputSelectors=e.inputSelectors,n._StandardOnClickEventsEmitter=e.StandardOnClickEventsEmitter,n._clickEvents=new e.ClickEvents(n.sendToQueue.bind(ElementEventCollector_assertThisInitialized(n)),n._utils,n._messageBus,n._configurationRepository,n._StandardOnClickEventsEmitter),n._onClickSelectors=e.onClickSelectors,n._StandardOnChangeEventsEmitter=e.StandardOnChangeEventsEmitter,n._elementFocusEventEmitter=e.ElementFocusEventsEmitter,n._elementBlurEventEmitter=e.ElementBlurEventsEmitter,n._selectElementEvents=new e.SelectElementEvents(n.sendToQueue.bind(ElementEventCollector_assertThisInitialized(n)),n._utils,n._messageBus,n._StandardOnChangeEventsEmitter,n._elementFocusEventEmitter,n._elementBlurEventEmitter,n._configurationRepository),n._onSelectSelectors=e.onSelectSelectors,n._StandardOnFormEventsEmitter=e.StandardOnFormEventsEmitter,n._formEvents=new e.FormEvents(n.sendToQueue.bind(ElementEventCollector_assertThisInitialized(n)),n._messageBus,n._StandardOnFormEventsEmitter),n._onFormSelectors=e.onFormSelectors,n._jqueryEventHandler=e.JqueryElementsHandler,n._maxElemValLength=200,n._isHashedValue=n._configurationRepository.get("isElementHashedValue")||!1,n._hashTruncationLength=n._configurationRepository.get("elementHashTruncationLength")||2,n}return ElementEventCollector_createClass(ElementEventCollector,[{key:"stopFeature",value:function stopFeature(e){self._inputEvents.unbind(e),self._clickEvents.unbind(e),self._selectElementEvents.unbind(e),self._formEvents.unbind(e),self._jQueryElementListenerSiteMapper.stopTracking(),self._mutationEmitter.stopObserver(e)}},{key:"updateFeatureConfig",value:function updateFeatureConfig(e){self._configurationRepository.get("isMutationObserver")&&self._mutationEmitter&&(self._mutationEmitter.startObserver(e),self._jQueryElementListenerSiteMapper.onConfigUpdate(self._configurationRepository)),self._isHashedValue=void 0!==self._configurationRepository.get("isElementHashedValue")?self._configurationRepository.get("isElementHashedValue"):self._isHashedValue,self._hashTruncationLength=void 0!==self._configurationRepository.get("elementHashTruncationLength")?self._configurationRepository.get("elementHashTruncationLength"):self._hashTruncationLength,self._elements.updateFeatureConfig(),self._clickEvents.updateSettings(),self._selectElementEvents.updateSettings(e)}},{key:"sendToQueue",value:function sendToQueue(e,t){var r=he[e.isTrusted],n=self.getEventTimestamp(e),o=self.getTimestampFromEvent(e),i=nr[e.type];self._utils.isUndefinedNull(i)&&(i=-1);var s=self._elements.getElement(e.target),a=self._utils.StorageUtils.getAndUpdateEventSequenceNumber();(t=t||{}).elementValues&&t.elementValues.length>self._maxElemValLength&&(t.elementValues="");e=(self._isHashedValue?e.target.value||e.target.innerHTML:"")?self._utils.getTruncatedHash(e.target.value,self._hashTruncationLength):"",o=_objectSpread(_objectSpread({},t),{eventType:i,eventSequence:a,timestamp:n,elementHash:s,isTrusted:r,hashedValue:e,relativeTime:o});self._dataQ.addToQueue("element_events",self._utils.convertToArrayByMap(or,o),!0)}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return rr}},{key:"Builder",get:function get(){return function(){function Builder(e,t,r,n,o){ElementEventCollector_classCallCheck(self,Builder),self.configurationRepository=e,self.utils=t,self.domUtils=r,self.elements=n,self.dataQ=o}return ElementEventCollector_createClass(Builder,[{key:"withMessageBus",value:function withMessageBus(e){return self.messageBus=e,self}},{key:"withMutationEmitter",value:function withMutationEmitter(e){return self.mutationEmitter=e,self}},{key:"withjQueryElementListenerSiteMapper",value:function withjQueryElementListenerSiteMapper(e){return self.jQueryElementListenerSiteMapper=e,self}},{key:"withjQueryElementsHandler",value:function withjQueryElementsHandler(e){return self.JqueryElementsHandler=e,self}},{key:"withInputEvents",value:function withInputEvents(e,t,r){return self.InputEvents=e,self.inputSelectors=t,self.maskingService=r,self}},{key:"withStandardInputEventsEmitter",value:function withStandardInputEventsEmitter(e){return self.StandardInputEventsEmitter=e,self}},{key:"withSyntheticMaskInputEventsHandler",value:function withSyntheticMaskInputEventsHandler(e){return self.SyntheticMaskInputEventsHandler=e,self}},{key:"withSyntheticAutotabInputEventsHandler",value:function withSyntheticAutotabInputEventsHandler(e){return self.SyntheticAutotabInputEventsHandler=e,self}},{key:"withClickEvents",value:function withClickEvents(e,t){return self.ClickEvents=e,self.onClickSelectors=t,self}},{key:"withStandardOnClickEventsEmitter",value:function withStandardOnClickEventsEmitter(e){return self.StandardOnClickEventsEmitter=e,self}},{key:"withSelectElementEvents",value:function withSelectElementEvents(e,t){return self.SelectElementEvents=e,self.onSelectSelectors=t,self}},{key:"withStandardOnChangeEventsEmitter",value:function withStandardOnChangeEventsEmitter(e){return self.StandardOnChangeEventsEmitter=e,self}},{key:"withElementFocusEventsEmitter",value:function withElementFocusEventsEmitter(e){return self.ElementFocusEventsEmitter=e,self}},{key:"withElementBlurEventsEmitter",value:function withElementBlurEventsEmitter(e){return self.ElementBlurEventsEmitter=e,self}},{key:"withFormEvents",value:function withFormEvents(e,t){return self.FormEvents=e,self.onFormSelectors=t,self}},{key:"withStandardOnFormEventsEmitter",value:function withStandardOnFormEventsEmitter(e){return self.StandardOnFormEventsEmitter=e,self}},{key:"build",value:function build(){return new ElementEventCollector(self)}}]),Builder}()}}]),ElementEventCollector}();function ClipboardEventCollector_typeof(e){return(ClipboardEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ClipboardEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ClipboardEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ClipboardEventCollector_createClass(e,t,r){return t&&ClipboardEventCollector_defineProperties(e.prototype,t),r&&ClipboardEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function ClipboardEventCollector_setPrototypeOf(e,t){return(ClipboardEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function ClipboardEventCollector_createSuper(r){var n=function ClipboardEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=ClipboardEventCollector_getPrototypeOf(r);return function ClipboardEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===ClipboardEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return ClipboardEventCollector_assertThisInitialized(e)}(self,n?(e=ClipboardEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function ClipboardEventCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function ClipboardEventCollector_getPrototypeOf(e){return(ClipboardEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ClipboardEventCollector_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var sr={configKey:"isClipboardEvent",isDefault:!0,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,instance:null},ar={copy:0,paste:1,cut:2},ur=["eventSequence","timestamp","clipboardEventType","elementHash","copiedText"],cr=function(){!function ClipboardEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ClipboardEventCollector_setPrototypeOf(e,t)}(ClipboardEventCollector,de);var t=ClipboardEventCollector_createSuper(ClipboardEventCollector);function ClipboardEventCollector(e){var s;return ClipboardEventCollector_classCallCheck(self,ClipboardEventCollector),ClipboardEventCollector_defineProperty(ClipboardEventCollector_assertThisInitialized(s=t.call(self)),"startFeature",function(e){try{var t=e.getDocument();s._cutEventEmitter.start(t),s._messageBus.subscribe(fe.CutEvent,s._handleClipboardEvent),s._copyEventEmitter.start(t),s._messageBus.subscribe(fe.CopyEvent,s._handleClipboardEvent),s._pasteEventEmitter.start(t),s._messageBus.subscribe(fe.PasteEvent,s._handleClipboardEvent)}catch(e){w.error("Failed starting the ClipboardEvents feature. msg: ".concat(e.message),e)}}),ClipboardEventCollector_defineProperty(ClipboardEventCollector_assertThisInitialized(s),"_handleClipboardEvent",function(e){s._sendToQueue(e)}),ClipboardEventCollector_defineProperty(ClipboardEventCollector_assertThisInitialized(s),"_sendToQueue",function(e){try{var t=s.getEventTimestamp(e),r=s._elements.getElement(e.target),n=s._utils.StorageUtils.getAndUpdateEventSequenceNumber(),o=e.clipboardData?e.clipboardData.getData("text"):window.clipboardData?window.clipboardData.getData("text"):"";""!==(o=o||"")&&(o=o.replace(/[\d]/g,"1").replace(/[a-zA-Z]/g,"a").replace(/[^a-zA-Z\d]/g,"*"));var i=ar[e.type];s._utils.isUndefinedNull(i)&&(i=-1),s._dataQueue.addToQueue("clipboard_events",s._utils.convertToArrayByMap(ur,{eventSequence:n,timestamp:t,elementHash:r,copiedText:o,clipboardEventType:i}))}catch(e){w.error("Failed handling ClipboardEvent. msg: ".concat(e.message),e)}}),s._utils=e.utils,s._dataQueue=e.dataQueue,s._elements=e.elements,s._messageBus=e.messageBus,s._cutEventEmitter=e.cutEventEmitter,s._copyEventEmitter=e.copyEventEmitter,s._pasteEventEmitter=e.pasteEventEmitter,s}return ClipboardEventCollector_createClass(ClipboardEventCollector,[{key:"stopFeature",value:function stopFeature(e){try{var t=e.getDocument();self._cutEventEmitter.stop(t),self._messageBus.unsubscribe(fe.CutEvent,self._handleClipboardEvent),self._copyEventEmitter.stop(t),self._messageBus.unsubscribe(fe.CopyEvent,self._handleClipboardEvent),self._pasteEventEmitter.stop(t),self._messageBus.unsubscribe(fe.PasteEvent,self._handleClipboardEvent)}catch(e){w.error("Failed stopping the ClipboardEvents feature. msg: ".concat(e.message),e)}}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return sr}},{key:"Builder",get:function get(){return function(){function Builder(e,t,r){ClipboardEventCollector_classCallCheck(self,Builder),self.utils=e,self.dataQueue=r,self.elements=t}return ClipboardEventCollector_createClass(Builder,[{key:"withMessageBus",value:function withMessageBus(e){return self.messageBus=e,self}},{key:"withCutEventEmitter",value:function withCutEventEmitter(e){return self.cutEventEmitter=e,self}},{key:"withCopyEventEmitter",value:function withCopyEventEmitter(e){return self.copyEventEmitter=e,self}},{key:"withPasteEventEmitter",value:function withPasteEventEmitter(e){return self.pasteEventEmitter=e,self}},{key:"build",value:function build(){return new ClipboardEventCollector(self)}}]),Builder}()}}]),ClipboardEventCollector}();function OrientationEventCollector_typeof(e){return(OrientationEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function OrientationEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function OrientationEventCollector_setPrototypeOf(e,t){return(OrientationEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function OrientationEventCollector_createSuper(r){var n=function OrientationEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=OrientationEventCollector_getPrototypeOf(r);return function OrientationEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===OrientationEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return OrientationEventCollector_assertThisInitialized(e)}(self,n?(e=OrientationEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function OrientationEventCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function OrientationEventCollector_getPrototypeOf(e){return(OrientationEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var lr={configKey:"isOrientationEvents",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!1,runInSlave:!1,runInUns:!1,isRunning:!1,instance:null},fr=function(){!function OrientationEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&OrientationEventCollector_setPrototypeOf(e,t)}(OrientationEventCollector,de);var i=OrientationEventCollector_createSuper(OrientationEventCollector);function OrientationEventCollector(e,t,r,n,o){var s;return function OrientationEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,OrientationEventCollector),function OrientationEventCollector_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(OrientationEventCollector_assertThisInitialized(s=i.call(self)),"_handleDeviceOrientationEvent",function(e){var t,r,n,o,i=s._utils.dateNow();e&&i-s._lastTime>s._samplePeriod&&(t=e.absolute||!1,r=s._utils.isUndefinedNull(e.alpha)?0:s._utils.cutDecimalPointDigits(e.alpha,4),n=s._utils.isUndefinedNull(e.beta)?0:s._utils.cutDecimalPointDigits(e.beta,4),o=s._utils.isUndefinedNull(e.gamma)?0:s._utils.cutDecimalPointDigits(e.gamma,4),r===s._lastAlpha&&n===s._lastBeta&&o===s._lastGamma||(w.isDebug()&&w.debug("OrientationEvents:_onOrientationEvent, sending data: timestamp: ".concat(i,"\n                alpha,betta,gamma: ").concat(r,",").concat(n,",").concat(o,",prevTime:").concat(s._lastTime)),s._lastTime=i,s._lastAlpha=r,s._lastBeta=n,s._lastGamma=o,e=s._utils.StorageUtils.getAndUpdateEventSequenceNumber(),s._dataQ.addToQueue("orientation_events",[null,e,i,t,r,n,o])))}),s._dataQ=r,s._configurationRepository=e,s._utils=t,s._samplePeriod=s._configurationRepository.get(C.orientationEventsSamplePeriod)||0,s._lastAlpha=0,s._lastBeta=0,s._lastGamma=0,s._lastTime=0,s._messageBus=n,s._deviceOrientationEventEmitter=o,s}return function OrientationEventCollector_createClass(e,t,r){t&&OrientationEventCollector_defineProperties(e.prototype,t),r&&OrientationEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(OrientationEventCollector,[{key:"startFeature",value:function startFeature(){window.DeviceOrientationEvent&&(self._deviceOrientationEventEmitter.start(),self._messageBus.subscribe(fe.DeviceOrientationEvent,self._handleDeviceOrientationEvent))}},{key:"stopFeature",value:function stopFeature(){window.DeviceOrientationEvent&&(self._deviceOrientationEventEmitter.stop(),self._messageBus.unsubscribe(fe.DeviceOrientationEvent,self._handleDeviceOrientationEvent))}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){var e=self._configurationRepository.get(C.orientationEventsSamplePeriod);self._samplePeriod=void 0!==e?e:self._samplePeriod}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return lr}}]),OrientationEventCollector}();function BeforeInstallPromptEventCollector_typeof(e){return(BeforeInstallPromptEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function BeforeInstallPromptEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function BeforeInstallPromptEventCollector_setPrototypeOf(e,t){return(BeforeInstallPromptEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function BeforeInstallPromptEventCollector_createSuper(r){var n=function BeforeInstallPromptEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=BeforeInstallPromptEventCollector_getPrototypeOf(r);return function BeforeInstallPromptEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===BeforeInstallPromptEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return BeforeInstallPromptEventCollector_assertThisInitialized(e)}(self,n?(e=BeforeInstallPromptEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function BeforeInstallPromptEventCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function BeforeInstallPromptEventCollector_getPrototypeOf(e){return(BeforeInstallPromptEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var pr={configKey:"isBeforeInstallPrompt",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!1,isFrameRelated:!1,runInUns:!1,isRunning:!1,instance:null},dr=["eventSequence","timestamp","platforms","relativeTime"],hr=function(){!function BeforeInstallPromptEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&BeforeInstallPromptEventCollector_setPrototypeOf(e,t)}(BeforeInstallPromptEventCollector,de);var i=BeforeInstallPromptEventCollector_createSuper(BeforeInstallPromptEventCollector);function BeforeInstallPromptEventCollector(e,t,r,n){var o;return function BeforeInstallPromptEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,BeforeInstallPromptEventCollector),function BeforeInstallPromptEventCollector_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(BeforeInstallPromptEventCollector_assertThisInitialized(o=i.call(self)),"_onBeforeInstallPrompt",function(e){var t=o._utils.StorageUtils.getAndUpdateEventSequenceNumber(),r=o.getEventTimestamp(),n=o.getTimestampFromEvent(e),e=e.platforms?e.platforms.join(","):"";o._dataQueue.addToQueue("before_install_prompt",o._utils.convertToArrayByMap(dr,{eventSequence:t,timestamp:r,platforms:e,relativeTime:n}))}),o._messageBus=r,o._eventEmitter=n,o._dataQueue=e,o._utils=t,o}return function BeforeInstallPromptEventCollector_createClass(e,t,r){t&&BeforeInstallPromptEventCollector_defineProperties(e.prototype,t),r&&BeforeInstallPromptEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(BeforeInstallPromptEventCollector,[{key:"startFeature",value:function startFeature(){self._eventEmitter.start(window),self._messageBus.subscribe(fe.BeforeInstallPromptEvent,self._onBeforeInstallPrompt)}},{key:"stopFeature",value:function stopFeature(){self._eventEmitter.stop(window),self._messageBus.unsubscribe(fe.BeforeInstallPromptEvent,self._onBeforeInstallPrompt)}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return pr}}]),BeforeInstallPromptEventCollector}();function WindowEventCollector_typeof(e){return(WindowEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function WindowEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function WindowEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function WindowEventCollector_createClass(e,t,r){return t&&WindowEventCollector_defineProperties(e.prototype,t),r&&WindowEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function WindowEventCollector_setPrototypeOf(e,t){return(WindowEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function WindowEventCollector_createSuper(r){var n=function WindowEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=WindowEventCollector_getPrototypeOf(r);return function WindowEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===WindowEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return WindowEventCollector_assertThisInitialized(e)}(self,n?(e=WindowEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function WindowEventCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function WindowEventCollector_getPrototypeOf(e){return(WindowEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function WindowEventCollector_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var vr={configKey:"isWindowEvents",isDefault:!0,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,instance:null},yr={DOMContentLoaded:0,scroll:1,resize:2,focus:3,blur:4,tabFocus:5,tabBlur:6},_r=["eventSequence","timestamp","eventType","isTrusted","screenWidth","screenHeight","clientWidth","clientHeight","documentWidth","documentHeight","scrollTop","scrollLeft","windowInnerWidth","windowInnerHeight","windowOuterWidth","windowOuterHeight"],gr=function(){!function WindowEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&WindowEventCollector_setPrototypeOf(e,t)}(WindowEventCollector,de);var t=WindowEventCollector_createSuper(WindowEventCollector);function WindowEventCollector(e){var o;return WindowEventCollector_classCallCheck(self,WindowEventCollector),WindowEventCollector_defineProperty(WindowEventCollector_assertThisInitialized(o=t.call(self)),"startFeature",function(e){try{o._resizeEventEmitter.start(e.Context),o._messageBus.subscribe(fe.ResizeEvent,o._onWindowEvent),o._focusEventEmitter.start(e.Context),o._messageBus.subscribe(fe.FocusEvent,o._onWindowEvent),o._blurEventEmitter.start(e.Context),o._messageBus.subscribe(fe.BlurEvent,o._onWindowEvent),o._domContentLoadedEventEmitter.start(e.getDocument()),o._messageBus.subscribe(fe.DOMContentLoadedEvent,o._onWindowEvent),o._visibilityChangeEventEmitter.start(e.getDocument()),o._messageBus.subscribe(fe.VisibilityChangeEvent,o._onWindowEvent),o._configurationRepository.get(C.isScrollCollect)&&(o._scrollEventEmitter.start(e.Context),o._messageBus.subscribe(fe.ScrollEvent,o._onWindowEvent))}catch(e){w.error("Failed starting the WindowEventCollector. msg: ".concat(e.message),e)}}),WindowEventCollector_defineProperty(WindowEventCollector_assertThisInitialized(o),"stopFeature",function(e){try{o._resizeEventEmitter.stop(e.Context),o._messageBus.unsubscribe(fe.ResizeEvent,o._onWindowEvent),o._focusEventEmitter.stop(e.Context),o._messageBus.unsubscribe(fe.FocusEvent,o._onWindowEvent),o._blurEventEmitter.stop(e.Context),o._messageBus.unsubscribe(fe.BlurEvent,o._onWindowEvent),o._domContentLoadedEventEmitter.stop(e.getDocument()),o._messageBus.unsubscribe(fe.DOMContentLoadedEvent,o._onWindowEvent),o._visibilityChangeEventEmitter.stop(e.getDocument()),o._messageBus.unsubscribe(fe.VisibilityChangeEvent,o._onWindowEvent),o._configurationRepository.get(C.isScrollCollect)&&(o._scrollEventEmitter.stop(e.Context),o._messageBus.unsubscribe(fe.ScrollEvent,o._onWindowEvent))}catch(e){w.error("Failed stopping the ClipboardEvents feature. msg: ".concat(e.message),e)}}),WindowEventCollector_defineProperty(WindowEventCollector_assertThisInitialized(o),"updateFeatureConfig",function(e){o._configurationRepository.get(C.isScrollCollect)?o._configurationRepository.get(C.isScrollCollect)&&(o._scrollEventEmitter.start(e.Context),o._messageBus.subscribe(fe.ScrollEvent,o._onWindowEvent)):(o._scrollEventEmitter.stop(e.Context),o._messageBus.unsubscribe(fe.ScrollEvent,o._onWindowEvent))}),WindowEventCollector_defineProperty(WindowEventCollector_assertThisInitialized(o),"_onWindowEvent",function(e){try{o._sendToQueue(e)}catch(e){w.error("An error has occurred while sending window event. ".concat(e.message),e)}}),WindowEventCollector_defineProperty(WindowEventCollector_assertThisInitialized(o),"_sendToQueue",function(e){if(!e)throw new Error("Invalid window event received.");var t,r=he[void 0];"DOMContentLoaded"===e.type?t=(new Date).getTime():(t=o.getEventTimestamp(e),r=he[e.isTrusted]),w.isDebug()&&(w.trace("got event "+e.type+" at time "+t),w.trace("adding to queue - screen(width,height): "+screen.width+","+screen.height+" window(width,height): "+window.innerWidth+","+window.innerHeight));var n=o._utils.StorageUtils.getAndUpdateEventSequenceNumber(),e="visibilitychange"!==e.type?e.type:"hidden"===document.visibilityState?"tabBlur":"tabFocus",e=yr[e];null!=e&&void 0!==e||(e=-1),o._dataQueue.addToQueue("window_events",o._utils.convertToArrayByMap(_r,{eventType:e,eventSequence:n,timestamp:t,screenWidth:screen.width?Math.round(screen.width):-1,screenHeight:screen.height?Math.round(screen.height):-1,clientWidth:window.innerWidth?Math.round(window.innerWidth):-1,clientHeight:window.innerHeight?Math.round(window.innerHeight):-1,documentWidth:document.body&&document.body.clientWidth?Math.round(document.body.clientWidth):-1,documentHeight:document.body&&document.body.clientHeight?Math.round(document.body.clientHeight):-1,scrollTop:document.body&&document.body.scrollTop?Math.round(document.body.scrollTop):0,scrollLeft:document.body&&document.body.scrollLeft?Math.round(document.body.scrollLeft):0,windowInnerWidth:window.innerWidth?Math.round(window.innerWidth):-1,windowInnerHeight:window.innerHeight?Math.round(window.innerHeight):-1,windowOuterWidth:window.outerWidth?Math.round(window.outerWidth):-1,windowOuterHeight:window.outerHeight?Math.round(window.outerHeight):-1,isTrusted:r}))}),o._configurationRepository=e.configurationRepository,o._utils=e.utils,o._dataQueue=e.dataQueue,o._messageBus=e.messageBus,o._focusEventEmitter=e.focusEventEmitter,o._blurEventEmitter=e.blurEventEmitter,o._resizeEventEmitter=e.resizeEventEmitter,o._domContentLoadedEventEmitter=e.domContentLoadedEventEmitter,o._visibilityChangeEventEmitter=e.visibilityChangeEventEmitter,o._scrollEventEmitter=e.scrollEventEmitter,o}return WindowEventCollector_createClass(WindowEventCollector,null,[{key:"getDefaultSettings",value:function getDefaultSettings(){return vr}},{key:"Builder",get:function get(){return function(){function Builder(e,t,r){WindowEventCollector_classCallCheck(self,Builder),self.configurationRepository=e,self.utils=t,self.dataQueue=r}return WindowEventCollector_createClass(Builder,[{key:"withMessageBus",value:function withMessageBus(e){return self.messageBus=e,self}},{key:"withFocusEventEmitter",value:function withFocusEventEmitter(e){return self.focusEventEmitter=e,self}},{key:"withBlurEventEmitter",value:function withBlurEventEmitter(e){return self.blurEventEmitter=e,self}},{key:"withResizeEventEmitter",value:function withResizeEventEmitter(e){return self.resizeEventEmitter=e,self}},{key:"withDOMContentLoadedEventEmitter",value:function withDOMContentLoadedEventEmitter(e){return self.domContentLoadedEventEmitter=e,self}},{key:"withVisibilityChangeEventEmitter",value:function withVisibilityChangeEventEmitter(e){return self.visibilityChangeEventEmitter=e,self}},{key:"withScrollEventEmitter",value:function withScrollEventEmitter(e){return self.scrollEventEmitter=e,self}},{key:"build",value:function build(){return new WindowEventCollector(self)}}]),Builder}()}}]),WindowEventCollector}();function AccelerometerEventCollector_typeof(e){return(AccelerometerEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function AccelerometerEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function AccelerometerEventCollector_setPrototypeOf(e,t){return(AccelerometerEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function AccelerometerEventCollector_createSuper(r){var n=function AccelerometerEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=AccelerometerEventCollector_getPrototypeOf(r);return function AccelerometerEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===AccelerometerEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return AccelerometerEventCollector_assertThisInitialized(e)}(self,n?(e=AccelerometerEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function AccelerometerEventCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function AccelerometerEventCollector_getPrototypeOf(e){return(AccelerometerEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var mr={configKey:"isAccelerometerEvents",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!1,runInSlave:!1,runInUns:!1,isRunning:!1,instance:null},br=function(){!function AccelerometerEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&AccelerometerEventCollector_setPrototypeOf(e,t)}(AccelerometerEventCollector,de);var o=AccelerometerEventCollector_createSuper(AccelerometerEventCollector);function AccelerometerEventCollector(e,t,r){var n;return function AccelerometerEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,AccelerometerEventCollector),(n=o.call(self))._configurationRepository=e,n._utils=t,n._dataQueue=r,n._storageUtils=n._utils.StorageUtils,n._samplePeriod=n._configurationRepository.get(C.accelerometerEventsSamplePeriod)||0,n._samplePeriodGyro=n._configurationRepository.get(C.gyroEventsSamplePeriod)||0,n._lastX=0,n._lastY=0,n._lastZ=0,n._lastTime=0,n._lastAlpha=0,n._lastBeta=0,n._lastGamma=0,n._lastTimeGyro=0,n._onAccelerometerventFunc=n._onAccelerometerEvent.bind(AccelerometerEventCollector_assertThisInitialized(n)),n}return function AccelerometerEventCollector_createClass(e,t,r){t&&AccelerometerEventCollector_defineProperties(e.prototype,t),r&&AccelerometerEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(AccelerometerEventCollector,[{key:"_onAccelerometerEvent",value:function _onAccelerometerEvent(e){var t,r,n,o,i=self._utils.dateNow();return e&&e.accelerationIncludingGravity&&i-self._lastTime>self._samplePeriod&&(n=e.accelerationIncludingGravity.x,o=e.accelerationIncludingGravity.y,t=e.accelerationIncludingGravity.z,self._utils.isUndefinedNull(n)&&self._utils.isUndefinedNull(o)&&self._utils.isUndefinedNull(t)||(n=self._utils.isUndefinedNull(n)?-1:self._utils.cutDecimalPointDigits(n,4),o=self._utils.isUndefinedNull(o)?-1:self._utils.cutDecimalPointDigits(o,4),t=self._utils.isUndefinedNull(t)?-1:self._utils.cutDecimalPointDigits(t,4),n===self._lastX&&o===self._lastY&&t===self._lastZ||(r=self._storageUtils.getAndUpdateEventSequenceNumber(),self._lastTime=i,self._lastX=n,self._lastY=o,self._lastZ=t,self._dataQueue.addToQueue("accelerometer_events",[null,r,i,n,o,t]),w.isDebug()&&w.debug("AccelerometerEvents:_onAccelerometerEvent, sending data: timestamp:".concat(i," x,y,z:").concat(n,",").concat(o,",").concat(t,", prevTime:").concat(self._lastTime))))),e&&e.rotationRate&&i-self._lastTimeGyro>self._samplePeriodGyro&&(r=e.rotationRate.alpha,n=e.rotationRate.beta,o=e.rotationRate.gamma,self._utils.isUndefinedNull(r)&&self._utils.isUndefinedNull(n)&&self._utils.isUndefinedNull(o)||(t=e.absolute||!1,r=self._utils.isUndefinedNull(r)?0:self._utils.cutDecimalPointDigits(r,4),n=self._utils.isUndefinedNull(n)?0:self._utils.cutDecimalPointDigits(n,4),o=self._utils.isUndefinedNull(o)?0:self._utils.cutDecimalPointDigits(o,4),r===self._lastAlpha&&n===self._lastBeta&&o===self._lastGamma||(self._lastTimeGyro=i,self._lastAlpha=r,self._lastBeta=n,self._lastGamma=o,e=self._utils.StorageUtils.getAndUpdateEventSequenceNumber(),self._dataQueue.addToQueue("gyro_events",[null,e,i,t,r,n,o]),w.isDebug()&&w.debug("GyroEvents:_onGyroEvent, sending data: timestamp:".concat(i," alpha,betta,gamma:").concat(r,",").concat(n,",").concat(o,", prevTime: ").concat(self._lastTimeGyro))))),!0}},{key:"startFeature",value:function startFeature(){window.DeviceMotionEvent&&self._utils.addEventListener(window,"devicemotion",self._onAccelerometerventFunc)}},{key:"stopFeature",value:function stopFeature(){window.DeviceMotionEvent&&self._utils.removeEventListener(window,"devicemotion",self._onAccelerometerventFunc)}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){self._samplePeriod=void 0!==self._configurationRepository.get(C.accelerometerEventsSamplePeriod)?self._configurationRepository.get(C.accelerometerEventsSamplePeriod):self._samplePeriod,self._samplePeriodGyro=void 0!==self._configurationRepository.get(C.gyroEventsSamplePeriod)?self._configurationRepository.get(C.gyroEventsSamplePeriod):self._samplePeriodGyro}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return mr}}]),AccelerometerEventCollector}();function PinchZoomEventCollector_typeof(e){return(PinchZoomEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function PinchZoomEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function PinchZoomEventCollector_setPrototypeOf(e,t){return(PinchZoomEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function PinchZoomEventCollector_createSuper(r){var n=function PinchZoomEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=PinchZoomEventCollector_getPrototypeOf(r);return function PinchZoomEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===PinchZoomEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return PinchZoomEventCollector_assertThisInitialized(e)}(self,n?(e=PinchZoomEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function PinchZoomEventCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function PinchZoomEventCollector_getPrototypeOf(e){return(PinchZoomEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nc(e,t,n){function getDistance(e,t){var r=t[n[0]]-e[n[0]],e=t[n[1]]-e[n[1]];return Math.sqrt(r*r+e*e)}return{getScale:function _getScale(){return getDistance(e[0],e[1])/getDistance(t[0],t[1])},getFocusPoint:function getFocusPoint(){return function _getFocusPoint(e,t){return{x:(e[n[0]]+t[n[0]])/2,y:(e[n[1]]+t[n[1]])/2}}(e[1],e[0])}}}var Cr=["clientX","clientY"],wr=["screenX","screenY"],Er={pointerdown:0,pointermove:1,pointerup:2},Pr={configKey:"isPinchZoomEvents",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!0,runInSlave:!0,runInUns:!1,isRunning:!1,instance:null},Sr=["eventSequence","timestamp","focusX","focusY","scaleFactor"],kr=function(){!function PinchZoomEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&PinchZoomEventCollector_setPrototypeOf(e,t)}(PinchZoomEventCollector,de);var i=PinchZoomEventCollector_createSuper(PinchZoomEventCollector);function PinchZoomEventCollector(e,t,r,n){var o;return function PinchZoomEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,PinchZoomEventCollector),(o=i.call(self))._utils=e,o._dataQ=r,o._elements=t,o._msgBus=n,o._evGesturesCache=[],o._prevEventDiff=-1,o._prevEvGestureSet=[],o._prevTouchEvents=[],o._onAllBrowsersPinchZoomEventBinded=o._onAllBrowsersPinchZoomEvent.bind(PinchZoomEventCollector_assertThisInitialized(o)),o}return function PinchZoomEventCollector_createClass(e,t,r){t&&PinchZoomEventCollector_defineProperties(e.prototype,t),r&&PinchZoomEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(PinchZoomEventCollector,[{key:"startFeature",value:function startFeature(e){self._bind(e)}},{key:"stopFeature",value:function stopFeature(e){self._unbind(e)}},{key:"_addToCommunicationQueue",value:function _addToCommunicationQueue(e,t,r,n){e!==Er.pointerdown&&e!==Er.pointerup||self._msgBus.publish("pinchEvent",{action:e});e=self.getEventTimestamp(n),n=self._utils.StorageUtils.getAndUpdateEventSequenceNumber();self._dataQ.addToQueue("pinch_events",self._utils.convertToArrayByMap(Sr,{eventSequence:n,timestamp:e,focusX:r.x,focusY:r.y,scaleFactor:t}))}},{key:"_bind",value:function _bind(e){var t,r=e.getDocument();if(window.PointerEvent?t=["pointerdown","pointermove","pointerup"]:window.TouchEvent&&(t=["touchstart","touchend","touchcancel","touchmove"]),self._listeningToEvents=t,self._listeningToEvents)for(var n=0;n<self._listeningToEvents.length;n++)self._utils.addEventListener(r,self._listeningToEvents[n],self._onAllBrowsersPinchZoomEventBinded)}},{key:"_unbind",value:function _unbind(e){var t=e.getDocument();if(self._listeningToEvents)for(var r=0;r<self._listeningToEvents.length;r++)self._utils.removeEventListener(t,self._listeningToEvents[r],self._onAllBrowsersPinchZoomEventBinded);self._evGesturesCache=[],self._prevEventDiff=-1}},{key:"_onAllBrowsersPinchZoomEvent",value:function _onAllBrowsersPinchZoomEvent(e){switch(e.type){case"pointerdown":self._onPointerDownEvent(e);break;case"pointermove":self._onPointerMoveEvent(e);break;case"pointerup":self._onPointerUpEvent(e);break;case"touchstart":self._onTouchStartEvent(e);break;case"touchend":self._onTouchEndEvent();break;case"touchmove":self._onTouchMoveEvent(e)}return!0}},{key:"_onPointerDownEvent",value:function _onPointerDownEvent(e){self._evGesturesCache.push(e)}},{key:"_onPointerMoveEvent",value:function _onPointerMoveEvent(e){for(var t,r,n,o=0;o<self._evGesturesCache.length;o++)if(e.pointerId===self._evGesturesCache[o].pointerId){self._evGesturesCache[o]=e;break}2===self._evGesturesCache.length&&self._evGesturesCache[0].pointerId!==self._evGesturesCache[1].pointerId?(t=Math.abs(self._evGesturesCache[0].clientX-self._evGesturesCache[1].clientX),0<self._prevEventDiff&&(self._prevEventDiff,self._prevEventDiff,2===self._prevEvGestureSet.length&&(n=(r=nc(self._evGesturesCache,self._prevEvGestureSet,Cr)).getScale(),self._addToCommunicationQueue(Er[e.type],n,r.getFocusPoint(),e))),self._prevEventDiff=t,self._prevEvGestureSet=self._evGesturesCache.slice(0)):2<self._evGesturesCache.length&&(self._evGesturesCache=[],self._prevEvGestureSet=[])}},{key:"_onPointerUpEvent",value:function _onPointerUpEvent(e){for(var t=0;t<self._evGesturesCache.length;t++)if(self._evGesturesCache[t].pointerId===e.pointerId){self._evGesturesCache.splice(t,1);break}self._evGesturesCache.length<2&&(self._prevEventDiff=-1,self._prevEvGestureSet=[])}},{key:"_onTouchStartEvent",value:function _onTouchStartEvent(e){self._prevTouchEvents[0]=e.touches.item(0),self._prevTouchEvents[1]=e.touches.item(1)}},{key:"_onTouchEndEvent",value:function _onTouchEndEvent(){self._prevTouchEvents=[]}},{key:"_onTouchMoveEvent",value:function _onTouchMoveEvent(e){var t,r;2===e.touches.length&&(2===self._prevTouchEvents.length&&(r=[e.touches.item(0),e.touches.item(1)],r=(t=nc(r,self._prevTouchEvents.splice(0),wr)).getScale(),self._addToCommunicationQueue(Er[e.type],r,t.getFocusPoint(),e)),self._prevTouchEvents[0]=e.touches.item(0),self._prevTouchEvents[1]=e.touches.item(1))}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return Pr}}]),PinchZoomEventCollector}();function ScriptEventCollector_typeof(e){return(ScriptEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ScriptEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ScriptEventCollector_setPrototypeOf(e,t){return(ScriptEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function ScriptEventCollector_createSuper(r){var n=function ScriptEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=ScriptEventCollector_getPrototypeOf(r);return function ScriptEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===ScriptEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return ScriptEventCollector_assertThisInitialized(e)}(self,n?(e=ScriptEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function ScriptEventCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function ScriptEventCollector_getPrototypeOf(e){return(ScriptEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Or={load:0},Br={configKey:"isScriptExecuteEve",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!1,runInSlave:!1,runInUns:!1,isRunning:!1,instance:null},Rr=["eventSequence","timestamp","eventType","scriptId","namespaceURI","outerHTML","scriptSource","scriptType"],Dr=function(){!function ScriptEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ScriptEventCollector_setPrototypeOf(e,t)}(ScriptEventCollector,de);var n=ScriptEventCollector_createSuper(ScriptEventCollector);function ScriptEventCollector(e,t){var r;return function ScriptEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ScriptEventCollector),(r=n.call(self))._onScriptExecuteEventFunc=r._onScriptExecuteEvent.bind(ScriptEventCollector_assertThisInitialized(r)),r._dataQueue=t,r._utils=e,r}return function ScriptEventCollector_createClass(e,t,r){t&&ScriptEventCollector_defineProperties(e.prototype,t),r&&ScriptEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ScriptEventCollector,[{key:"_onScriptExecuteEvent",value:function _onScriptExecuteEvent(e){if(e&&e.target&&("load"!==e.type||"script"===e.target.nodeName.toLowerCase()))try{var t=self.getEventTimestamp(e),r=self._utils.StorageUtils.getAndUpdateEventSequenceNumber(),n=Or[e.type];self._utils.isUndefinedNull(n)&&(n=-1),w.isDebug()&&w.trace("got event "+e.type+", "+n+", scriptSrc: "+e.target.src+" at time "+t),self._dataQueue.addToQueue("script_events",self._utils.convertToArrayByMap(Rr,{eventSequence:r,timestamp:t,eventType:n,scriptId:e.target.id||"",namespaceURI:e.target.namespaceURI||"",outerHTML:e.target.outerHTML||"",scriptSource:e.target.src||"",scriptType:e.target.type||""}))}catch(e){w.error("error on getScriptExecuteEvent ".concat(e.toString()))}}},{key:"startFeature",value:function startFeature(){self._utils.addEventListener(document,"load",self._onScriptExecuteEventFunc,!0)}},{key:"stopFeature",value:function stopFeature(){self._utils.removeEventListener(document,"load",self._onScriptExecuteEventFunc,!0)}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return Br}}]),ScriptEventCollector}();function NetInfoEventCollector_typeof(e){return(NetInfoEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function NetInfoEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function NetInfoEventCollector_setPrototypeOf(e,t){return(NetInfoEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function NetInfoEventCollector_createSuper(r){var n=function NetInfoEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=NetInfoEventCollector_getPrototypeOf(r);return function NetInfoEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===NetInfoEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function NetInfoEventCollector_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=NetInfoEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function NetInfoEventCollector_getPrototypeOf(e){return(NetInfoEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Fr={configKey:"isNetInfoEvents",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!1,runInSlave:!1,runInUns:!1,isRunning:!1,instance:null},Tr=["eventSequence","timestamp","connectionType","effectiveType","downlinkMax","downlink","rtt","isSaveData"],Ir=function(){!function NetInfoEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&NetInfoEventCollector_setPrototypeOf(e,t)}(NetInfoEventCollector,de);var n=NetInfoEventCollector_createSuper(NetInfoEventCollector);function NetInfoEventCollector(e,t){var r;return function NetInfoEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,NetInfoEventCollector),(r=n.call(self))._dataQueue=t,r._utils=e,r._connection=navigator.connection||navigator.mozConnection||navigator.webkitConnection,r}return function NetInfoEventCollector_createClass(e,t,r){t&&NetInfoEventCollector_defineProperties(e.prototype,t),r&&NetInfoEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(NetInfoEventCollector,[{key:"onChangeNetworkInfo",value:function onChangeNetworkInfo(){w.debug("NetInfoEvents:onChangeNetworkInfo");var e=self._utils.isUndefinedNull(self._connection.saveData)?"":self._connection.saveData.toString(),t=self.getEventTimestamp(),r=self._utils.StorageUtils.getAndUpdateEventSequenceNumber();self._dataQueue.addToQueue("net_info_events",self._utils.convertToArrayByMap(Tr,{eventSequence:r,timestamp:t,connectionType:self._connection.type||"",effectiveType:self._connection.effectiveType||"",downlinkMax:self._connection.downlinkMax?self._connection.downlinkMax.toString():"",downlink:self._connection.downlink?self._connection.downlink.toString():"",rtt:self._connection.rtt?self._connection.rtt.toString():"",isSaveData:e}))}},{key:"startFeature",value:function startFeature(){self._connection&&(self._connection.addEventListener("change",self.onChangeNetworkInfo.bind(self),!0),self.onChangeNetworkInfo())}},{key:"stopFeature",value:function stopFeature(){self._connection&&self._connection.removeEventListener("change",self.onChangeNetworkInfo.bind(self))}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return Fr}}]),NetInfoEventCollector}();function DeviceOrientationCollector_typeof(e){return(DeviceOrientationCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function DeviceOrientationCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function DeviceOrientationCollector_setPrototypeOf(e,t){return(DeviceOrientationCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function DeviceOrientationCollector_createSuper(r){var n=function DeviceOrientationCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=DeviceOrientationCollector_getPrototypeOf(r);return function DeviceOrientationCollector_possibleConstructorReturn(e,t){{if(t&&("object"===DeviceOrientationCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return DeviceOrientationCollector_assertThisInitialized(e)}(self,n?(e=DeviceOrientationCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function DeviceOrientationCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function DeviceOrientationCollector_getPrototypeOf(e){return(DeviceOrientationCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var xr={configKey:"isDeviceOrientationEvents",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!1,runInSlave:!1,runInUns:!1,isRunning:!1,instance:null},Lr={undefined:0,"portrait-primary":1,"landscape-primary":2,"portrait-secondary":3,"landscape-secondary":4},jr=["eventSequence","timestamp","orientation"],Ar=function(){!function DeviceOrientationCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&DeviceOrientationCollector_setPrototypeOf(e,t)}(DeviceOrientationCollector,de);var n=DeviceOrientationCollector_createSuper(DeviceOrientationCollector);function DeviceOrientationCollector(e,t){var r;return function DeviceOrientationCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,DeviceOrientationCollector),(r=n.call(self))._dataQ=t,r._utils=e,r._onDeviceOrientationEventFunc=r._onDeviceOrientationEvent.bind(DeviceOrientationCollector_assertThisInitialized(r)),screen.mozOrientation&&screen.addEventListener?(r._eventTarget=screen,r._eventName="mozorientationchange"):screen.msOrientation&&screen.addEventListener?(r._eventTarget=screen,r._eventName="msorientationchange"):(r._eventTarget=window,r._eventName="orientationchange"),r}return function DeviceOrientationCollector_createClass(e,t,r){t&&DeviceOrientationCollector_defineProperties(e.prototype,t),r&&DeviceOrientationCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(DeviceOrientationCollector,[{key:"startFeature",value:function startFeature(){self._utils.addEventListener(self._eventTarget,self._eventName,self._onDeviceOrientationEventFunc),self._handleDeviceOrientationEvent(screen)}},{key:"stopFeature",value:function stopFeature(){self._utils.removeEventListener(self._eventTarget,self._eventName,self._onDeviceOrientationEventFunc)}},{key:"_onDeviceOrientationEvent",value:function _onDeviceOrientationEvent(e){e=e&&e.target?e.target.screen||e.target:screen;self._handleDeviceOrientationEvent(e)}},{key:"_handleDeviceOrientationEvent",value:function _handleDeviceOrientationEvent(e){var t,r,n=e.mozOrientation||e.msOrientation||e.orientation;void 0!==n?(t=n.type||n,void 0!==(r=Lr[t])?self._lastDeviceOrientationType!==r&&(e=self.getEventTimestamp(),n=self._utils.StorageUtils.getAndUpdateEventSequenceNumber(),self._lastDeviceOrientationType=r,w.trace("onDeviceOrientationEvent: Orientation changed to ".concat(r," at time ").concat(e)),self._dataQ.addToQueue("screen_orientation",self._utils.convertToArrayByMap(jr,{eventSequence:n,timestamp:e,orientation:r}))):w.error("onDeviceOrientationEvent: Unknown orientation ".concat(t," value."))):w.debug("onDeviceOrientationEvent: Unable to find orientation data.")}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return xr}}]),DeviceOrientationCollector}();function TapEventCollector_typeof(e){return(TapEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function TapEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function TapEventCollector_setPrototypeOf(e,t){return(TapEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function TapEventCollector_createSuper(r){var n=function TapEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=TapEventCollector_getPrototypeOf(r);return function TapEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===TapEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return TapEventCollector_assertThisInitialized(e)}(self,n?(e=TapEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function TapEventCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function TapEventCollector_getPrototypeOf(e){return(TapEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ur={configKey:"isTapEvents",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!0,runInSlave:!0,runInUns:!1,isRunning:!1,instance:null},Nr=20,Wr=500,Hr=["eventSequence","timestamp","screenX","screenY","pageX","pageY","clientX","clientY","isTrusted","elementHash","touchIndex","touchSizeMajor","touchSizeMinor"],Qr=["eventSequence","timestamp","screenX","screenY","pageX","pageY","clientX","clientY","isTrusted","elementHash","touchIndex","touchSizeMajor","touchSizeMinor"],zr=function(){!function TapEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&TapEventCollector_setPrototypeOf(e,t)}(TapEventCollector,de);var i=TapEventCollector_createSuper(TapEventCollector);function TapEventCollector(e,t,r,n){var o;return function TapEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,TapEventCollector),(o=i.call(self))._configurationRepository=e,o._utils=t,o._dataQ=n,o._elements=r,o._activeTouchActions={},o._tapMaxSlop=o._configurationRepository.get("tapEventsTapMaxSlop")||Nr,o._longPressTimeout=o._configurationRepository.get("tapEventsLongPressTimeout")||Wr,o._handleStartEventBind=o._handleStartEvent.bind(TapEventCollector_assertThisInitialized(o)),o._handleMoveEventBind=o._handleMoveEvent.bind(TapEventCollector_assertThisInitialized(o)),o._handleEndEventBind=o._handleEndEvent.bind(TapEventCollector_assertThisInitialized(o)),o._handleCancelEventBind=o._handleCancelEvent.bind(TapEventCollector_assertThisInitialized(o)),o._eventDefinitions=TapEventCollector.getSupportedTouchEvents(),o}return function TapEventCollector_createClass(e,t,r){t&&TapEventCollector_defineProperties(e.prototype,t),r&&TapEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(TapEventCollector,[{key:"startFeature",value:function startFeature(e){self._bind(e)}},{key:"stopFeature",value:function stopFeature(e){self._unbind(e)}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){self._tapMaxSlop=void 0!==self._configurationRepository.get("tapEventsTapMaxSlop")?self._configurationRepository.get("tapEventsTapMaxSlop"):self._tapMaxSlop,self._longPressTimeout=void 0!==self._configurationRepository.get("tapEventsLongPressTimeout")?self._configurationRepository.get("tapEventsLongPressTimeout"):self._longPressTimeout}},{key:"_bind",value:function _bind(e){self._eventDefinitions?(e=e.getDocument(),self._utils.addEventListener(e,self._eventDefinitions.startEvent,self._handleStartEventBind),self._utils.addEventListener(e,self._eventDefinitions.moveEvent,self._handleMoveEventBind),self._utils.addEventListener(e,self._eventDefinitions.endEvent,self._handleEndEventBind),self._utils.addEventListener(e,self._eventDefinitions.cancelEvent,self._handleCancelEventBind)):w.debug("TapEvents:_bind - No event definitions. Might be a legacy browser. Aborting bind operation.")}},{key:"_unbind",value:function _unbind(e){self._eventDefinitions&&(e=e.getDocument(),self._utils.removeEventListener(e,self._eventDefinitions.startEvent,self._handleStartEventBind),self._utils.removeEventListener(e,self._eventDefinitions.moveEvent,self._handleMoveEventBind),self._utils.removeEventListener(e,self._eventDefinitions.endEvent,self._handleEndEventBind),self._utils.removeEventListener(e,self._eventDefinitions.cancelEvent,self._handleCancelEventBind))}},{key:"_handleStartEvent",value:function _handleStartEvent(e){for(var t=self._getEventData(e),r=0;r<t.length;r++)self._activeTouchActions[t[r].identifier]={startTime:self.getEventTimestamp(),startX:t[r].touchData.pageX,startY:t[r].touchData.pageY,offsetX:0,offsetY:0}}},{key:"_handleMoveEvent",value:function _handleMoveEvent(e){for(var t=self._getEventData(e),r=0;r<t.length;r++){var n=self._activeTouchActions[t[r].identifier];n&&(n.offsetX=Math.abs(t[r].touchData.pageX-n.startX),n.offsetY=Math.abs(t[r].touchData.pageY-n.startY))}}},{key:"_handleEndEvent",value:function _handleEndEvent(e){for(var t=self._getEventData(e),r=0;r<t.length;r++){var n=self._activeTouchActions[t[r].identifier];n&&(n.offsetX<self._tapMaxSlop&&n.offsetY<self._tapMaxSlop&&(self.getEventTimestamp()-n.startTime<self._longPressTimeout?self._sendEvent("tap_events",Hr,t[r].identifier,t[r].touchData,t[r].eventArgs):self._sendEvent("longpress_events",Qr,t[r].identifier,t[r].touchData,t[r].eventArgs)),delete self._activeTouchActions[t[r].identifier])}}},{key:"_handleCancelEvent",value:function _handleCancelEvent(e){for(var t=self._getEventData(e),r=0;r<t.length;r++)delete self._activeTouchActions[t[r].identifier]}},{key:"_getEventData",value:function _getEventData(e){if(void 0!==e.changedTouches){for(var t=[],r=0;r<e.changedTouches.length;r++){var n=e.changedTouches[r],o=n.identifier;t.push({identifier:o,touchData:n,eventArgs:e})}return t}if(null!=e.pointerType&&("touch"===e.pointerType||"pen"===e.pointerType||e.pointerType===e.MSPOINTER_TYPE_TOUCH||e.pointerType===e.MSPOINTER_TYPE_PEN))return[{identifier:e.pointerId||0,touchData:e,eventArgs:e}];return[]}},{key:"_sendEvent",value:function _sendEvent(e,t,r,n,o){var i=self.getEventTimestamp(),s=he[o.isTrusted],a=self._elements.getElement(o.target),o=self._utils.StorageUtils.getAndUpdateEventSequenceNumber();self._utils.isUndefinedNull(r)&&(r=0),self._dataQ.addToQueue(e,self._utils.convertToArrayByMap(t,{eventSequence:o,timestamp:i,screenX:n.screenX?Math.round(n.screenX):0,screenY:n.screenY?Math.round(n.screenY):0,pageX:n.pageX||0,pageY:n.pageY||0,clientX:n.clientX||0,clientY:n.clientY||0,isTrusted:s,elementHash:a,touchIndex:r%1e4,touchSizeMajor:n.radiusX?2*n.radiusX:0,touchSizeMinor:n.radiusY?2*n.radiusY:0}))}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return Ur}},{key:"getSupportedTouchEvents",value:function getSupportedTouchEvents(){return window.TouchEvent?{startEvent:"touchstart",moveEvent:"touchmove",endEvent:"touchend",cancelEvent:"touchcancel"}:window.PointerEvent?{startEvent:"pointerdown",moveEvent:"pointermove",endEvent:"pointerup",cancelEvent:"pointercancel"}:void w.debug("TapEvents:_createEventsToListenList - No touch support for browser.")}}]),TapEventCollector}();function StorageEventCollector_typeof(e){return(StorageEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function StorageEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function StorageEventCollector_setPrototypeOf(e,t){return(StorageEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function StorageEventCollector_createSuper(r){var n=function StorageEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=StorageEventCollector_getPrototypeOf(r);return function StorageEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===StorageEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return StorageEventCollector_assertThisInitialized(e)}(self,n?(e=StorageEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function StorageEventCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function StorageEventCollector_getPrototypeOf(e){return(StorageEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var qr={configKey:"isStorageEvents",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!1,isFrameRelated:!1,runInSlave:!1,runInUns:!1,isRunning:!1,instance:null},Kr=0,Vr=["eventSequence","timestamp","keys","action","tabsOpened"],Gr=function(){!function StorageEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&StorageEventCollector_setPrototypeOf(e,t)}(StorageEventCollector,de);var i=StorageEventCollector_createSuper(StorageEventCollector);function StorageEventCollector(e,t,r,n){var o;return function StorageEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,StorageEventCollector),(o=i.call(self))._utils=e,o._dataQ=r,o._elements=t,o._msgBus=n,o._onAllStorageEventBinded=o._onAllStorageEvent.bind(StorageEventCollector_assertThisInitialized(o)),o}return function StorageEventCollector_createClass(e,t,r){t&&StorageEventCollector_defineProperties(e.prototype,t),r&&StorageEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(StorageEventCollector,[{key:"startFeature",value:function startFeature(e){self._bind(e)}},{key:"stopFeature",value:function stopFeature(e){self._unbind(e)}},{key:"_addToCommunicationQueue",value:function _addToCommunicationQueue(e,t,r,n,o){e===Kr&&self._msgBus.publish("storageEvent",{action:e});e=self.getEventTimestamp(o),o=self._utils.StorageUtils.getAndUpdateEventSequenceNumber();self._dataQ.addToQueue("storage_events",self._utils.convertToArrayByMap(Vr,{eventSequence:o,timestamp:e,keys:t,action:r,tabsOpened:n}))}},{key:"_bind",value:function _bind(e){var t,r=e.Context;if((r.localStorage||r.sessionStorage)&&(t=["storage"]),self._listeningToEvents=t,0<self._listeningToEvents.length)for(var n=0;n<self._listeningToEvents.length;n++)self._utils.addEventListener(r,self._listeningToEvents[n],self._onAllStorageEventBinded,!0)}},{key:"_unbind",value:function _unbind(e){if(self._listeningToEvents)for(var t=0;t<self._listeningToEvents.length;t++)self._utils.removeEventListener(e.Context,self._listeningToEvents[t],self._onAllStorageEventBinded,!0)}},{key:"_onAllStorageEvent",value:function _onAllStorageEvent(e){return"storage"===e.type&&self._onStorageEvent(e),!0}},{key:"_onStorageEvent",value:function _onStorageEvent(e){var t=!1,r=null,n=null;null===e.key&&(r=null),n="string"==typeof e.key&&null===e.newValue?(r=e.key,"delete"):(r=e.key,"update");var o=self._utils.StorageUtils.getFromLocalStorage("cdTabList");o&&"object"===StorageEventCollector_typeof(o[0])&&(t=!0),t=t?1:0,self._addToCommunicationQueue(e.type,r,n,t,e)}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return qr}}]),StorageEventCollector}();function PrintEventCollector_typeof(e){return(PrintEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function PrintEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function PrintEventCollector_setPrototypeOf(e,t){return(PrintEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function PrintEventCollector_createSuper(r){var n=function PrintEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=PrintEventCollector_getPrototypeOf(r);return function PrintEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===PrintEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return PrintEventCollector_assertThisInitialized(e)}(self,n?(e=PrintEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function PrintEventCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function PrintEventCollector_getPrototypeOf(e){return(PrintEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Zr={configKey:"isPrintEvents",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!1,isFrameRelated:!1,runInSlave:!1,runInUns:!1,isRunning:!1,instance:null},Yr=1,Jr=0,Xr=["eventSequence","timestamp","printDialogState"],$r=function(){!function PrintEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&PrintEventCollector_setPrototypeOf(e,t)}(PrintEventCollector,de);var n=PrintEventCollector_createSuper(PrintEventCollector);function PrintEventCollector(e,t){var r;return function PrintEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,PrintEventCollector),(r=n.call(self))._utils=e,r._dataQueue=t,r._addToEventQueueFunc=r._addToEventQueue.bind(PrintEventCollector_assertThisInitialized(r)),r._myAfterPrintFunc=r._myAfterPrint.bind(PrintEventCollector_assertThisInitialized(r)),r}return function PrintEventCollector_createClass(e,t,r){t&&PrintEventCollector_defineProperties(e.prototype,t),r&&PrintEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(PrintEventCollector,[{key:"_myAfterPrint",value:function _myAfterPrint(){self._addToEventQueueFunc(Jr),window.removeEventListener("focus",self._myAfterPrintFunc)}},{key:"_onBeforePrintEvent",value:function _onBeforePrintEvent(){self._addToEventQueueFunc(Yr),self._utils.addEventListener(window,"focus",self._myAfterPrintFunc.bind(self))}},{key:"_addToEventQueue",value:function _addToEventQueue(e){var t=self.getEventTimestamp(),r=self._utils.StorageUtils.getAndUpdateEventSequenceNumber();self._dataQueue.addToQueue("print_events",self._utils.convertToArrayByMap(Xr,{eventSequence:r,timestamp:t,printDialogState:e}))}},{key:"startFeature",value:function startFeature(){self._utils.addEventListener(window,"beforeprint",self._onBeforePrintEvent.bind(self))}},{key:"stopFeature",value:function stopFeature(){self._utils.removeEventListener(window,"beforeprint",self._onBeforePrintEvent.bind(self),!0)}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return Zr}}]),PrintEventCollector}();function LightSensorEventCollector_typeof(e){return(LightSensorEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function LightSensorEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function LightSensorEventCollector_setPrototypeOf(e,t){return(LightSensorEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function LightSensorEventCollector_createSuper(r){var n=function LightSensorEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=LightSensorEventCollector_getPrototypeOf(r);return function LightSensorEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===LightSensorEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function LightSensorEventCollector_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=LightSensorEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function LightSensorEventCollector_getPrototypeOf(e){return(LightSensorEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var en={configKey:"isLightSensor",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!1,isFrameRelated:!1,runInSlave:!1,runInUns:!1,isRunning:!1,instance:null},tn=5e3,rn=["eventSequence","timestamp","illuminance"],nn=function(){!function LightSensorEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&LightSensorEventCollector_setPrototypeOf(e,t)}(LightSensorEvents,de);var o=LightSensorEventCollector_createSuper(LightSensorEvents);function LightSensorEvents(e,t,r){var n;return function LightSensorEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,LightSensorEvents),(n=o.call(self))._dataQueue=e,n._utils=t,n._configurationRepository=r,n._eventThreshold=n._configurationRepository.get("lightSensorEventThreshold")||tn,n._lastTime=0,n}return function LightSensorEventCollector_createClass(e,t,r){t&&LightSensorEventCollector_defineProperties(e.prototype,t),r&&LightSensorEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(LightSensorEvents,[{key:"_onReadingSensor",value:function _onReadingSensor(){var e,t=self.getEventTimestamp();t-self._lastTime>self._eventThreshold&&(e=self._utils.StorageUtils.getAndUpdateEventSequenceNumber(),self._lastTime=t,self._dataQueue.addToQueue("ambient_light_level",self._utils.convertToArrayByMap(rn,{eventSequence:e,timestamp:t,illuminance:self._sensor.illuminance})))}},{key:"startFeature",value:function startFeature(){window.AmbientLightSensor?(w.info("AmbientLightSensor exists and collected"),self._sensor=new AmbientLightSensor,self._utils.addEventListener(self._sensor,"reading",self._onReadingSensor.bind(self)),self._utils.addEventListener(self._sensor,"error",LightSensorEvents._onSensorError),self._sensor.start()):w.debug("LightSensor does not exist, not collecting")}},{key:"stopFeature",value:function stopFeature(){self._sensor&&(self._utils.removeEventListener(self._sensor,"reading",self._onReadingSensor.bind(self)),self._utils.removeEventListener(self._sensor,"error",LightSensorEvents._onSensorError),self._sensor=null)}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){self._eventThreshold=self._configurationRepository.get("lightSensorEventThreshold")?self._configurationRepository.get("lightSensorEventThreshold"):self._eventThreshold}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return en}},{key:"_onSensorError",value:function _onSensorError(e){w.debug("Error connecting LightSensor ".concat(e.error))}}]),LightSensorEvents}();function MouseEventCollector_typeof(e){return(MouseEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function MouseEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function MouseEventCollector_setPrototypeOf(e,t){return(MouseEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function MouseEventCollector_createSuper(r){var n=function MouseEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=MouseEventCollector_getPrototypeOf(r);return function MouseEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===MouseEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return MouseEventCollector_assertThisInitialized(e)}(self,n?(e=MouseEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function MouseEventCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function MouseEventCollector_getPrototypeOf(e){return(MouseEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function MouseEventCollector_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var on={configKey:"isMouseEvents",isDefault:!0,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!0,runInSlave:!0,runInUns:!1,isRunning:!1,instance:null},sn={mousemove:0,mousedown:1,mouseup:2,click:3,dblclick:4,mouseleave:5,mouseenter:6,wheel:7,mouseout:8,mouseover:9},an=function(){!function MouseEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&MouseEventCollector_setPrototypeOf(e,t)}(MouseEventCollector,de);var o=MouseEventCollector_createSuper(MouseEventCollector);function MouseEventCollector(e,t,r,n){var i;return function MouseEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,MouseEventCollector),MouseEventCollector_defineProperty(MouseEventCollector_assertThisInitialized(i=o.call(self)),"_lastButton",void 0),MouseEventCollector_defineProperty(MouseEventCollector_assertThisInitialized(i),"_getMouseEvent",function(e){var t=e.which;"mouseup"===e.type?i._lastButton=t:"click"===e.type&&0===t&&(t=i._lastButton);var r=sn[e.type];i._utils.isUndefinedNull(r)&&(r=-1);var n=e.deltaY||e.deltaX||e.deltaZ||e.wheelDelta||0,o=i.getTimestampFromEvent(e);i._dataQueue.addToQueue("mouse_events",[null,i._utils.StorageUtils.getAndUpdateEventSequenceNumber(),i.getEventTimestamp(e),r,he[e.isTrusted],"mousemove"===e.type?0:i._elements.getElement(e.target),e.pageX?Math.round(e.pageX):-1,e.pageY?Math.round(e.pageY):-1,e.screenX?Math.round(e.screenX):-1,e.screenY?Math.round(e.screenY):-1,null==t?-1:t,Math.round(n),e.clientX?Math.round(e.clientX):-1,e.clientY?Math.round(e.clientY):-1,e.detail||0,null===e.button||void 0===e.button?-1:e.button,o])}),i._utils=e,i._domUtils=t,i._elements=r,i._dataQueue=n,i}return function MouseEventCollector_createClass(e,t,r){t&&MouseEventCollector_defineProperties(e.prototype,t),r&&MouseEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(MouseEventCollector,[{key:"startFeature",value:function startFeature(e){var t=self;try{var r=e.getDocument();self._domUtils.addEventListener(r,"mousemove",self._getMouseEvent,!0),self._domUtils.addEventListener(r,"mousedown",self._getMouseEvent,!0),self._domUtils.addEventListener(r,"mouseup",self._getMouseEvent,!0),self._domUtils.addEventListener(r,"click",self._getMouseEvent,!0),self._domUtils.addEventListener(r,"dblclick",self._getMouseEvent,!0),self._isIE=!!r.documentMode||/edge/.test(window.navigator.userAgent.toLowerCase()),self._isIE?self._domUtils.onDocumentBody(e.Context,function(){t._domUtils.addEventListener(r.body,"mouseleave",t._getMouseEvent),t._domUtils.addEventListener(r.body,"mouseenter",t._getMouseEvent)}):(self._domUtils.addEventListener(r,"mouseleave",self._getMouseEvent),self._domUtils.addEventListener(r,"mouseenter",self._getMouseEvent)),self._domUtils.addEventListener(r,"wheel",self._getMouseEvent,!0)}catch(e){w.error("MouseEvents:startFeature failed. msg: ".concat(e.message),e)}}},{key:"stopFeature",value:function stopFeature(e){try{var t=e.getDocument();self._domUtils.removeEventListener(t,"mousemove",self._getMouseEvent,!0),self._domUtils.removeEventListener(t,"mousedown",self._getMouseEvent,!0),self._domUtils.removeEventListener(t,"mouseup",self._getMouseEvent,!0),self._domUtils.removeEventListener(t,"click",self._getMouseEvent,!0),self._domUtils.removeEventListener(t,"dblclick",self._getMouseEvent,!0),self._isIE?(self._domUtils.removeEventListener(t.body,"mouseleave",self._getMouseEvent),self._domUtils.removeEventListener(t.body,"mouseenter",self._getMouseEvent)):(self._domUtils.removeEventListener(t,"mouseleave",self._getMouseEvent),self._domUtils.removeEventListener(t,"mouseenter",self._getMouseEvent)),self._domUtils.removeEventListener(t,"wheel",self._getMouseEvent,!0)}catch(e){w.error("MouseEvents:stopFeature failed. msg: ".concat(e.message),e)}}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return on}}]),MouseEventCollector}();function TabEventCollector_typeof(e){return(TabEventCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function TabEventCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function TabEventCollector_setPrototypeOf(e,t){return(TabEventCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function TabEventCollector_createSuper(r){var n=function TabEventCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=TabEventCollector_getPrototypeOf(r);return function TabEventCollector_possibleConstructorReturn(e,t){{if(t&&("object"===TabEventCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function TabEventCollector_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=TabEventCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function TabEventCollector_getPrototypeOf(e){return(TabEventCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var un={configKey:"isTabsEvents",isDefault:!0,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!1,runInSlave:!1,runInUns:!1,isRunning:!1,instance:null},cn=0,ln=1,fn=2,pn=["eventSequence","timestamp","type","id","href","referrer","currentTabsList"],dn=function(){!function TabEventCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&TabEventCollector_setPrototypeOf(e,t)}(TabEventCollector,de);var n=TabEventCollector_createSuper(TabEventCollector);function TabEventCollector(e,t){var r;return function TabEventCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,TabEventCollector),(r=n.call(self))._utils=e,r._currState=null,r._dataQueue=t,r._tabData={id:"",openTabTS:0},r}return function TabEventCollector_createClass(e,t,r){t&&TabEventCollector_defineProperties(e.prototype,t),r&&TabEventCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(TabEventCollector,[{key:"startFeature",value:function startFeature(){w.info("Starting tab events feature"),self._initTabInfo(),self._utils.addEventListener(window,"beforeunload",self._onUnloadTab.bind(self))}},{key:"stopFeature",value:function stopFeature(){w.info("Stopping tab events feature"),self._utils.removeEventListener(window,"beforeunload",self._onUnloadTab.bind(self))}},{key:"_initTabInfo",value:function _initTabInfo(){var e=(e=self._utils.StorageUtils.getFromLocalStorage("cdTabList"))||[],t=cn;self._tabData=self._utils.StorageUtils.getFromSessionStorage("cdTabData")||self._tabData.id,self._tabData||(self._updateTabData(),t=ln);for(var r=-1,n=0,o=e.length;n<o;n++)if(e[n][0]===self._tabData.id){r=n;break}-1!==r&&r!==e.length||(e.push([self._tabData.id,self._tabData.openTabTS]),self._utils.StorageUtils.saveToLocalStorage("cdTabList",e),w.debug("added tab to list. "+self._tabData.id+", tab index="+e.length));var i=self._utils.getDocUrl(),s=self._utils.StorageUtils.getAndUpdateEventSequenceNumber(),a=JSON.stringify(e);self._dataQueue.addToQueue("tab_events",self._utils.convertToArrayByMap(pn,{eventSequence:s,timestamp:self._tabData.openTabTS,type:t,id:self._tabData.id||"",href:i||"",referrer:self._utils.clearTextFromNumbers(document.referrer),currentTabsList:a||""}))}},{key:"_onUnloadTab",value:function _onUnloadTab(){var e=(e=self._utils.StorageUtils.getFromLocalStorage("cdTabList"))||[],t=self.getEventTimestamp(),r=self._utils.StorageUtils.getAndUpdateEventSequenceNumber(),n=self._utils.getDocUrl(),o=fn,i=JSON.stringify(e);w.debug("removing tab from list. id:".concat(self._tabData.id,", timestamp:").concat(t)),self._dataQueue.addToQueue("tab_events",self._utils.convertToArrayByMap(pn,{eventSequence:r,timestamp:t,type:o,id:self._tabData.id||"",href:n||"",referrer:self._utils.clearTextFromNumbers(document.referrer),currentTabsList:i||""}),!0,!0);for(var s=0,a=e.length;s<a;s++)if(e[s][0]===self._tabData.id){e.splice(s,1);break}self._utils.StorageUtils.saveToLocalStorage("cdTabList",e)}},{key:"_updateTabData",value:function _updateTabData(){self._tabData={},self._tabData={id:self._utils.generateUUID(),openTabTS:self.getEventTimestamp()},w.debug("initialize tab data: id:".concat(self._tabData.id,", timestamp:").concat(self._tabData.openTabTS)),self._utils.StorageUtils.saveToSessionStorage("cdTabData",self._tabData)}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return un}}]),TabEventCollector}();function LocationCollector_typeof(e){return(LocationCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function LocationCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function LocationCollector_setPrototypeOf(e,t){return(LocationCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function LocationCollector_createSuper(r){var n=function LocationCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=LocationCollector_getPrototypeOf(r);return function LocationCollector_possibleConstructorReturn(e,t){{if(t&&("object"===LocationCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return LocationCollector_assertThisInitialized(e)}(self,n?(e=LocationCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function LocationCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function LocationCollector_getPrototypeOf(e){return(LocationCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function LocationCollector_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var hn={configKey:"isLocationEvents",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!0,shouldRun:!1,isFrameRelated:!1,runInSlave:!1,runInUns:!1,isRunning:!1,instance:null},vn=["eventSequence","timestamp","longitude","latitude","accuracy","speed","provider"],yn=function(){!function LocationCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&LocationCollector_setPrototypeOf(e,t)}(LocationCollector,de);var i=LocationCollector_createSuper(LocationCollector);function LocationCollector(e,t,r){var n,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:window.navigator;return function LocationCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,LocationCollector),LocationCollector_defineProperty(LocationCollector_assertThisInitialized(n=i.call(self)),"_subscribeForLocationEvents",function(){n._unsubscribeFromLocationEvents(),n._watcherID=n._navigator.geolocation.watchPosition(n._onGeoLocationPositionEvent,n._onGeoLocationPositionError),n._clearLocationEventsTimeout(),n._locationEventsTimeoutID=setTimeout(function(){n._unsubscribeFromLocationEvents()})}),LocationCollector_defineProperty(LocationCollector_assertThisInitialized(n),"_unsubscribeFromLocationEvents",function(){n._clearLocationEventsTimeout(),n._watcherID&&(n._navigator.geolocation.clearWatch(n._watcherID),n._watcherID=null)}),LocationCollector_defineProperty(LocationCollector_assertThisInitialized(n),"_onGeoLocationPositionEvent",function(e){n._sendData(e)}),LocationCollector_defineProperty(LocationCollector_assertThisInitialized(n),"_onGeoLocationPositionError",function(e){w.warn("Failed getting geolocation with code ".concat(e.code,". ").concat(e.message))}),n._configurationRepository=r,n._locationEventsTimeoutMsec=n._configurationRepository.get(C.locationEventsTimeoutMsec),n._utils=t,n._dataQ=e,n._navigator=o,n._watcherID=null,n._locationEventsTimeoutID=null,n}return function LocationCollector_createClass(e,t,r){t&&LocationCollector_defineProperties(e.prototype,t),r&&LocationCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(LocationCollector,[{key:"startFeature",value:function startFeature(){self._subscribeForLocationIfPermissionGranted()}},{key:"stopFeature",value:function stopFeature(){self._unsubscribeFromLocationEvents()}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){try{self._configurationRepository.get(C.locationEventsTimeoutMsec)!==self._locationEventsTimeoutMsec&&(self._locationEventsTimeoutMsec=self._configurationRepository.get(C.locationEventsTimeoutMsec))}catch(e){w.error("LocationEvents: updateFeatureConfig failed, msg: ".concat(e.message),e)}}},{key:"_subscribeForLocationIfPermissionGranted",value:function _subscribeForLocationIfPermissionGranted(){var t=self;self._navigator.permissions&&self._navigator.permissions.query&&self._navigator.permissions.query({name:"geolocation"}).then(function(e){"granted"===e.state?t._subscribeForLocationEvents():w.info("location permission is denied. Location data will not be collected")}).catch(function(e){w.error("Failed querying for geolocation permission. ".concat(e.message))})}},{key:"_clearLocationEventsTimeout",value:function _clearLocationEventsTimeout(){self._locationEventsTimeoutID&&clearTimeout(self._locationEventsTimeoutID),self._locationEventsTimeoutID=null}},{key:"_sendData",value:function _sendData(e){var t=e.coords,r=self._utils.StorageUtils.getAndUpdateEventSequenceNumber(),e=self.getEventTimestamp();self._dataQ.addToQueue("location_events",self._utils.convertToArrayByMap(vn,{eventSequence:r,timestamp:e,longitude:t.longitude||-1,latitude:t.latitude||-1,accuracy:t.accuracy||-1,speed:t.speed||-1,provider:""}))}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return hn}}]),LocationCollector}();function StaticContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var _n=function(){function StaticContract(){!function StaticContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,StaticContract)}return function StaticContract_createClass(e,t,r){t&&StaticContract_defineProperties(e.prototype,t),r&&StaticContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(StaticContract,[{key:"validateParams",value:function validateParams(){throw new Error("_validateParams should be overridden")}},{key:"buildQueueMessage",value:function buildQueueMessage(){throw new Error("buildQueueMessage should be overridden")}},{key:"validateMessage",value:function validateMessage(){throw new Error("_validateMessage should be overridden")}},{key:"getName",value:function getName(){throw new Error("_getName should be overridden")}}]),StaticContract}();function BrowserDetectContract_typeof(e){return(BrowserDetectContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function BrowserDetectContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function BrowserDetectContract_setPrototypeOf(e,t){return(BrowserDetectContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function BrowserDetectContract_createSuper(r){var n=function BrowserDetectContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=BrowserDetectContract_getPrototypeOf(r);return function BrowserDetectContract_possibleConstructorReturn(e,t){{if(t&&("object"===BrowserDetectContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function BrowserDetectContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=BrowserDetectContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function BrowserDetectContract_getPrototypeOf(e){return(BrowserDetectContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var gn=function(){!function BrowserDetectContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&BrowserDetectContract_setPrototypeOf(e,t)}(BrowserDetectContract,_n);var u=BrowserDetectContract_createSuper(BrowserDetectContract);function BrowserDetectContract(e,t,r,n,o,i,s){var a;return function BrowserDetectContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,BrowserDetectContract),(a=u.call(self)).validateParams(e,t,r,n,o,i,s),a.isChrome=e,a.isFirefox=t,a.isEdge=r,a.isIE=n,a.isSafari=o,a.isOpera=i,a.isBlink=s,a}return function BrowserDetectContract_createClass(e,t,r){t&&BrowserDetectContract_defineProperties(e.prototype,t),r&&BrowserDetectContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(BrowserDetectContract,[{key:"validateParams",value:function validateParams(e,t,r,n,o,i,s){"boolean"==typeof e&&"boolean"==typeof t&&"boolean"==typeof r&&"boolean"==typeof n&&"boolean"==typeof o&&"boolean"==typeof i&&"boolean"==typeof s||w.warn("wrong type in Per, BrowserDetectContract, parameters. isChrome : {expected: boolean, received: ".concat(BrowserDetectContract_typeof(e),"},\n            isFirefox : {expected: boolean, received: ").concat(BrowserDetectContract_typeof(t),"},isEdge : {expected: boolean, received: ").concat(BrowserDetectContract_typeof(r),"},isIE : {expected: boolean, received: ").concat(BrowserDetectContract_typeof(n),"},\n            isSafari : {expected: boolean, received: ").concat(BrowserDetectContract_typeof(o),"},isOpera : {expected: boolean, received: ").concat(BrowserDetectContract_typeof(i),"} ,isBlink : {expected: boolean, received: ").concat(BrowserDetectContract_typeof(s),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),[self.isChrome,self.isFirefox,self.isEdge,self.isIE,self.isSafari,self.isOpera,self.isBlink]];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&Array.isArray(e[1])&&7===e[1].length||w.warn("BrowserDetect - Contract verification failed")}},{key:"getName",value:function getName(){return"browser_spoofing"}}]),BrowserDetectContract}();function BrowserDetect_typeof(e){return(BrowserDetect_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function BrowserDetect_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function BrowserDetect_setPrototypeOf(e,t){return(BrowserDetect_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function BrowserDetect_createSuper(r){var n=function BrowserDetect_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=BrowserDetect_getPrototypeOf(r);return function BrowserDetect_possibleConstructorReturn(e,t){{if(t&&("object"===BrowserDetect_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function BrowserDetect_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=BrowserDetect_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function BrowserDetect_getPrototypeOf(e){return(BrowserDetect_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var mn={configKey:"isBrowserDetect",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!0,shouldRun:!0,isFrameRelated:!1,runInUns:!0,runInSlave:!1,isRunning:!1,instance:null},bn=function(){!function BrowserDetect_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&BrowserDetect_setPrototypeOf(e,t)}(BrowserDetect,de);var r=BrowserDetect_createSuper(BrowserDetect);function BrowserDetect(e){var t;return function BrowserDetect_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,BrowserDetect),(t=r.call(self))._dataQ=e,t}return function BrowserDetect_createClass(e,t,r){t&&BrowserDetect_defineProperties(e.prototype,t),r&&BrowserDetect_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(BrowserDetect,[{key:"startFeature",value:function startFeature(){var e=!!window.opr&&!!opr.addons||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),t="undefined"!=typeof InstallTrigger,r=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString(),n=!!document.documentMode,o=!n&&!!window.StyleMedia,i=!!window.chrome&&!!window.chrome.webstore,s=(i||e)&&!!window.CSS,s=new gn(i,t,o,n,r,e,s).buildQueueMessage();self._dataQ.addToQueue("static_fields",s,!1)}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return mn}}]),BrowserDetect}();function VersionClientBrowserPropsContract_typeof(e){return(VersionClientBrowserPropsContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function VersionClientBrowserPropsContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function VersionClientBrowserPropsContract_setPrototypeOf(e,t){return(VersionClientBrowserPropsContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function VersionClientBrowserPropsContract_createSuper(r){var n=function VersionClientBrowserPropsContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=VersionClientBrowserPropsContract_getPrototypeOf(r);return function VersionClientBrowserPropsContract_possibleConstructorReturn(e,t){{if(t&&("object"===VersionClientBrowserPropsContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function VersionClientBrowserPropsContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=VersionClientBrowserPropsContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function VersionClientBrowserPropsContract_getPrototypeOf(e){return(VersionClientBrowserPropsContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Cn=function(){!function VersionClientBrowserPropsContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&VersionClientBrowserPropsContract_setPrototypeOf(e,t)}(VersionClientBrowserPropsContract,_n);var r=VersionClientBrowserPropsContract_createSuper(VersionClientBrowserPropsContract);function VersionClientBrowserPropsContract(e){var t;return function VersionClientBrowserPropsContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,VersionClientBrowserPropsContract),(t=r.call(self)).validateParams(e),t.scriptVersion=e,t}return function VersionClientBrowserPropsContract_createClass(e,t,r){t&&VersionClientBrowserPropsContract_defineProperties(e.prototype,t),r&&VersionClientBrowserPropsContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(VersionClientBrowserPropsContract,[{key:"validateParams",value:function validateParams(e){"string"==typeof e||w.warn(" wrong type in VersionClient, BrowserProps parameters. scriptVersion : {expected: string, received: ".concat(VersionClientBrowserPropsContract_typeof(e),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.scriptVersion];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"string"==typeof e[1]||w.warn("version_client, BrowserPropsContract - Contract verification failed")}},{key:"getName",value:function getName(){return"version_client"}}]),VersionClientBrowserPropsContract}();function DeviceSourceBrowserPropsContract_typeof(e){return(DeviceSourceBrowserPropsContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function DeviceSourceBrowserPropsContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function DeviceSourceBrowserPropsContract_setPrototypeOf(e,t){return(DeviceSourceBrowserPropsContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function DeviceSourceBrowserPropsContract_createSuper(r){var n=function DeviceSourceBrowserPropsContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=DeviceSourceBrowserPropsContract_getPrototypeOf(r);return function DeviceSourceBrowserPropsContract_possibleConstructorReturn(e,t){{if(t&&("object"===DeviceSourceBrowserPropsContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function DeviceSourceBrowserPropsContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=DeviceSourceBrowserPropsContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function DeviceSourceBrowserPropsContract_getPrototypeOf(e){return(DeviceSourceBrowserPropsContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var wn=function(){!function DeviceSourceBrowserPropsContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&DeviceSourceBrowserPropsContract_setPrototypeOf(e,t)}(DeviceSourceBrowserPropsContract,_n);var r=DeviceSourceBrowserPropsContract_createSuper(DeviceSourceBrowserPropsContract);function DeviceSourceBrowserPropsContract(e){var t;return function DeviceSourceBrowserPropsContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,DeviceSourceBrowserPropsContract),(t=r.call(self)).validateParams(e),t.source=e,t}return function DeviceSourceBrowserPropsContract_createClass(e,t,r){t&&DeviceSourceBrowserPropsContract_defineProperties(e.prototype,t),r&&DeviceSourceBrowserPropsContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(DeviceSourceBrowserPropsContract,[{key:"validateParams",value:function validateParams(e){"string"==typeof e||w.warn(" wrong type in DeviceSource, BrowserProps parameters. source : {expected: string, received: ".concat(DeviceSourceBrowserPropsContract_typeof(e),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.source];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"string"==typeof e[1]||w.warn("device_source, BrowserPropsContract - Contract verification failed")}},{key:"getName",value:function getName(){return"device_source"}}]),DeviceSourceBrowserPropsContract}();function OSBrowserPropsContract_typeof(e){return(OSBrowserPropsContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function OSBrowserPropsContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function OSBrowserPropsContract_setPrototypeOf(e,t){return(OSBrowserPropsContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function OSBrowserPropsContract_createSuper(r){var n=function OSBrowserPropsContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=OSBrowserPropsContract_getPrototypeOf(r);return function OSBrowserPropsContract_possibleConstructorReturn(e,t){{if(t&&("object"===OSBrowserPropsContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function OSBrowserPropsContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=OSBrowserPropsContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function OSBrowserPropsContract_getPrototypeOf(e){return(OSBrowserPropsContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var En=function(){!function OSBrowserPropsContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&OSBrowserPropsContract_setPrototypeOf(e,t)}(OSBrowserPropsContract,_n);var r=OSBrowserPropsContract_createSuper(OSBrowserPropsContract);function OSBrowserPropsContract(e){var t;return function OSBrowserPropsContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,OSBrowserPropsContract),(t=r.call(self)).validateParams(e),t.platform=e,t}return function OSBrowserPropsContract_createClass(e,t,r){t&&OSBrowserPropsContract_defineProperties(e.prototype,t),r&&OSBrowserPropsContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(OSBrowserPropsContract,[{key:"validateParams",value:function validateParams(e){"string"==typeof e||w.warn(" wrong type in OS, BrowserProps parameters. platform : {expected: string, received: ".concat(OSBrowserPropsContract_typeof(e),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.platform];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"string"==typeof e[1]||w.warn("os, BrowserPropsContract - Contract verification failed")}},{key:"getName",value:function getName(){return"os"}}]),OSBrowserPropsContract}();function OSVersionBrowserPropsContract_typeof(e){return(OSVersionBrowserPropsContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function OSVersionBrowserPropsContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function OSVersionBrowserPropsContract_setPrototypeOf(e,t){return(OSVersionBrowserPropsContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function OSVersionBrowserPropsContract_createSuper(r){var n=function OSVersionBrowserPropsContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=OSVersionBrowserPropsContract_getPrototypeOf(r);return function OSVersionBrowserPropsContract_possibleConstructorReturn(e,t){{if(t&&("object"===OSVersionBrowserPropsContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function OSVersionBrowserPropsContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=OSVersionBrowserPropsContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function OSVersionBrowserPropsContract_getPrototypeOf(e){return(OSVersionBrowserPropsContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Pn=function(){!function OSVersionBrowserPropsContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&OSVersionBrowserPropsContract_setPrototypeOf(e,t)}(OSVersionBrowserPropsContract,_n);var r=OSVersionBrowserPropsContract_createSuper(OSVersionBrowserPropsContract);function OSVersionBrowserPropsContract(e){var t;return function OSVersionBrowserPropsContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,OSVersionBrowserPropsContract),(t=r.call(self)).validateParams(e),t.version=e,t}return function OSVersionBrowserPropsContract_createClass(e,t,r){t&&OSVersionBrowserPropsContract_defineProperties(e.prototype,t),r&&OSVersionBrowserPropsContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(OSVersionBrowserPropsContract,[{key:"validateParams",value:function validateParams(e){"number"==typeof e||null===e||w.warn(" wrong type in OSVersion, BrowserProps parameters. version : {expected: number, received: ".concat(OSVersionBrowserPropsContract_typeof(e),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.version];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&("number"==typeof e[1]||null===e[1])||w.warn("os_version, BrowserPropsContract - Contract verification failed")}},{key:"getName",value:function getName(){return"os_version"}}]),OSVersionBrowserPropsContract}();function OSFamilyBrowserPropsContract_typeof(e){return(OSFamilyBrowserPropsContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function OSFamilyBrowserPropsContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function OSFamilyBrowserPropsContract_setPrototypeOf(e,t){return(OSFamilyBrowserPropsContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function OSFamilyBrowserPropsContract_createSuper(r){var n=function OSFamilyBrowserPropsContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=OSFamilyBrowserPropsContract_getPrototypeOf(r);return function OSFamilyBrowserPropsContract_possibleConstructorReturn(e,t){{if(t&&("object"===OSFamilyBrowserPropsContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function OSFamilyBrowserPropsContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=OSFamilyBrowserPropsContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function OSFamilyBrowserPropsContract_getPrototypeOf(e){return(OSFamilyBrowserPropsContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Sn=function(){!function OSFamilyBrowserPropsContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&OSFamilyBrowserPropsContract_setPrototypeOf(e,t)}(OSFamilyBrowserPropsContract,_n);var r=OSFamilyBrowserPropsContract_createSuper(OSFamilyBrowserPropsContract);function OSFamilyBrowserPropsContract(e){var t;return function OSFamilyBrowserPropsContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,OSFamilyBrowserPropsContract),(t=r.call(self)).validateParams(e),t.osName=e,t}return function OSFamilyBrowserPropsContract_createClass(e,t,r){t&&OSFamilyBrowserPropsContract_defineProperties(e.prototype,t),r&&OSFamilyBrowserPropsContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(OSFamilyBrowserPropsContract,[{key:"validateParams",value:function validateParams(e){"string"==typeof e||w.warn(" wrong type in OSFamily, BrowserProps parameters. osName : {expected: string, received: ".concat(OSFamilyBrowserPropsContract_typeof(e),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.osName];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"string"==typeof e[1]||w.warn("os_family, BrowserPropsContract - Contract verification failed")}},{key:"getName",value:function getName(){return"os_family"}}]),OSFamilyBrowserPropsContract}();function InputMechBrowserPropsContract_typeof(e){return(InputMechBrowserPropsContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function InputMechBrowserPropsContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function InputMechBrowserPropsContract_setPrototypeOf(e,t){return(InputMechBrowserPropsContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function InputMechBrowserPropsContract_createSuper(r){var n=function InputMechBrowserPropsContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=InputMechBrowserPropsContract_getPrototypeOf(r);return function InputMechBrowserPropsContract_possibleConstructorReturn(e,t){{if(t&&("object"===InputMechBrowserPropsContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function InputMechBrowserPropsContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=InputMechBrowserPropsContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function InputMechBrowserPropsContract_getPrototypeOf(e){return(InputMechBrowserPropsContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var kn=function(){!function InputMechBrowserPropsContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&InputMechBrowserPropsContract_setPrototypeOf(e,t)}(InputMechBrowserPropsContract,_n);var n=InputMechBrowserPropsContract_createSuper(InputMechBrowserPropsContract);function InputMechBrowserPropsContract(e,t){var r;return function InputMechBrowserPropsContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,InputMechBrowserPropsContract),(r=n.call(self)).validateParams(e,t),r.pointer=e,r.hover=t,r}return function InputMechBrowserPropsContract_createClass(e,t,r){t&&InputMechBrowserPropsContract_defineProperties(e.prototype,t),r&&InputMechBrowserPropsContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(InputMechBrowserPropsContract,[{key:"validateParams",value:function validateParams(e,t){("number"!=typeof e||1!==e&&2!==e&&3!==e&&4!==e&&5!==e||"number"!=typeof t||1!==t&&2!==t&&3!==t&&4!==t&&5!==t)&&w.warn(" wrong type in InputMech, BrowserProps parameters. pointer : {expected: number, received: ".concat(InputMechBrowserPropsContract_typeof(e),"}, hover : {expected: number, received: ").concat(InputMechBrowserPropsContract_typeof(t),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),[self.pointer,self.hover]];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&Array.isArray(e[1])&&2===e[1].length||w.warn("input_mech, BrowserPropsContract - Contract verification failed")}},{key:"getName",value:function getName(){return"input_mech"}}]),InputMechBrowserPropsContract}();function CoresBrowserPropsContract_typeof(e){return(CoresBrowserPropsContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function CoresBrowserPropsContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function CoresBrowserPropsContract_setPrototypeOf(e,t){return(CoresBrowserPropsContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function CoresBrowserPropsContract_createSuper(r){var n=function CoresBrowserPropsContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=CoresBrowserPropsContract_getPrototypeOf(r);return function CoresBrowserPropsContract_possibleConstructorReturn(e,t){{if(t&&("object"===CoresBrowserPropsContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function CoresBrowserPropsContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=CoresBrowserPropsContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function CoresBrowserPropsContract_getPrototypeOf(e){return(CoresBrowserPropsContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var On=function(){!function CoresBrowserPropsContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&CoresBrowserPropsContract_setPrototypeOf(e,t)}(CoresBrowserPropsContract,_n);var r=CoresBrowserPropsContract_createSuper(CoresBrowserPropsContract);function CoresBrowserPropsContract(e){var t;return function CoresBrowserPropsContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CoresBrowserPropsContract),(t=r.call(self)).validateParams(e),t.hardwareConcurrency=e,t}return function CoresBrowserPropsContract_createClass(e,t,r){t&&CoresBrowserPropsContract_defineProperties(e.prototype,t),r&&CoresBrowserPropsContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CoresBrowserPropsContract,[{key:"validateParams",value:function validateParams(e){"number"==typeof e||w.warn("wrong type in cores, BrowserProps parameters. hardwareConcurrency : {expected: number, received: ".concat(CoresBrowserPropsContract_typeof(e),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.hardwareConcurrency];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"number"==typeof e[1]||w.warn("cores,BrowserPropsContract - Contract verification failed")}},{key:"getName",value:function getName(){return"cores"}}]),CoresBrowserPropsContract}();function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function _unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(e,t)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var i=0,r=function F(){};return{s:r,n:function n(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,c=!1;return{s:function s(){o=o.call(t)},n:function n(){var e=o.next();return u=e.done,e},e:function e(t){c=!0,a=t},f:function f(){try{u||null==o.return||o.return()}finally{if(c)throw a}}}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function PluginsBrowserPropsContract_typeof(e){return(PluginsBrowserPropsContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function PluginsBrowserPropsContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function PluginsBrowserPropsContract_setPrototypeOf(e,t){return(PluginsBrowserPropsContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function PluginsBrowserPropsContract_createSuper(r){var n=function PluginsBrowserPropsContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=PluginsBrowserPropsContract_getPrototypeOf(r);return function PluginsBrowserPropsContract_possibleConstructorReturn(e,t){{if(t&&("object"===PluginsBrowserPropsContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function PluginsBrowserPropsContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=PluginsBrowserPropsContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function PluginsBrowserPropsContract_getPrototypeOf(e){return(PluginsBrowserPropsContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Bn=function(){!function PluginsBrowserPropsContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&PluginsBrowserPropsContract_setPrototypeOf(e,t)}(PluginsBrowserPropsContract,_n);var r=PluginsBrowserPropsContract_createSuper(PluginsBrowserPropsContract);function PluginsBrowserPropsContract(e){var t;return function PluginsBrowserPropsContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,PluginsBrowserPropsContract),(t=r.call(self)).validateParams(e),t.plugins=e,t}return function PluginsBrowserPropsContract_createClass(e,t,r){t&&PluginsBrowserPropsContract_defineProperties(e.prototype,t),r&&PluginsBrowserPropsContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(PluginsBrowserPropsContract,[{key:"validateParams",value:function validateParams(e){Array.isArray(e)&&self._eachPluginIsValid(e)||w.warn(" wrong type in plugins, BrowserProps parameters. plugins : {expected: [[...string]], received: ".concat(PluginsBrowserPropsContract_typeof(e),"}"))}},{key:"_eachPluginIsValid",value:function _eachPluginIsValid(e){var t=!0,r=!0,n=!0,o=_createForOfIteratorHelper(e);try{for(o.s();!(i=o.n()).done;){var i=i.value;if(Array.isArray(i)){4!==i.length&&(n=!1);var s,a=_createForOfIteratorHelper(i);try{for(a.s();!(s=a.n()).done;)"string"!=typeof s.value&&(r=!1)}catch(e){a.e(e)}finally{a.f()}}else t=!1}}catch(e){o.e(e)}finally{o.f()}return t&&n&&r}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.plugins];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&Array.isArray(e[1])||w.warn("plugins, BrowserPropsContract - Contract verification failed")}},{key:"getName",value:function getName(){return"plugins"}}]),PluginsBrowserPropsContract}();function JsUaBrowserPropsContract_typeof(e){return(JsUaBrowserPropsContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function JsUaBrowserPropsContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function JsUaBrowserPropsContract_setPrototypeOf(e,t){return(JsUaBrowserPropsContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function JsUaBrowserPropsContract_createSuper(r){var n=function JsUaBrowserPropsContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=JsUaBrowserPropsContract_getPrototypeOf(r);return function JsUaBrowserPropsContract_possibleConstructorReturn(e,t){{if(t&&("object"===JsUaBrowserPropsContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function JsUaBrowserPropsContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=JsUaBrowserPropsContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function JsUaBrowserPropsContract_getPrototypeOf(e){return(JsUaBrowserPropsContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Mn=function(){!function JsUaBrowserPropsContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&JsUaBrowserPropsContract_setPrototypeOf(e,t)}(JsUaBrowserPropsContract,_n);var r=JsUaBrowserPropsContract_createSuper(JsUaBrowserPropsContract);function JsUaBrowserPropsContract(e){var t;return function JsUaBrowserPropsContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,JsUaBrowserPropsContract),(t=r.call(self)).validateParams(e),t.userAgent=e,t}return function JsUaBrowserPropsContract_createClass(e,t,r){t&&JsUaBrowserPropsContract_defineProperties(e.prototype,t),r&&JsUaBrowserPropsContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(JsUaBrowserPropsContract,[{key:"validateParams",value:function validateParams(e){"string"==typeof e||w.warn("wrong type in JsUa, BrowserProps parameters. userAgent : {expected: string, received: ".concat(JsUaBrowserPropsContract_typeof(e),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.userAgent];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"string"==typeof e[1]||w.warn("js_ua, BrowserPropsContract - Contract verification failed")}},{key:"getName",value:function getName(){return"js_ua"}}]),JsUaBrowserPropsContract}();function TimeZoneBrowserPropsContract_typeof(e){return(TimeZoneBrowserPropsContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function TimeZoneBrowserPropsContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function TimeZoneBrowserPropsContract_setPrototypeOf(e,t){return(TimeZoneBrowserPropsContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function TimeZoneBrowserPropsContract_createSuper(r){var n=function TimeZoneBrowserPropsContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=TimeZoneBrowserPropsContract_getPrototypeOf(r);return function TimeZoneBrowserPropsContract_possibleConstructorReturn(e,t){{if(t&&("object"===TimeZoneBrowserPropsContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function TimeZoneBrowserPropsContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=TimeZoneBrowserPropsContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function TimeZoneBrowserPropsContract_getPrototypeOf(e){return(TimeZoneBrowserPropsContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Rn=function(){!function TimeZoneBrowserPropsContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&TimeZoneBrowserPropsContract_setPrototypeOf(e,t)}(TimeZoneBrowserPropsContract,_n);var r=TimeZoneBrowserPropsContract_createSuper(TimeZoneBrowserPropsContract);function TimeZoneBrowserPropsContract(e){var t;return function TimeZoneBrowserPropsContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,TimeZoneBrowserPropsContract),(t=r.call(self)).validateParams(e),t.tz=e,t}return function TimeZoneBrowserPropsContract_createClass(e,t,r){t&&TimeZoneBrowserPropsContract_defineProperties(e.prototype,t),r&&TimeZoneBrowserPropsContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(TimeZoneBrowserPropsContract,[{key:"validateParams",value:function validateParams(e){"number"==typeof e||w.warn("wrong type in TimeZone, BrowserProps parameters. tz : {expected: string, received: ".concat(TimeZoneBrowserPropsContract_typeof(e),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.tz];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"number"==typeof e[1]||w.warn("time_zone, BrowserPropsContract - Contract verification failed")}},{key:"getName",value:function getName(){return"time_zone"}}]),TimeZoneBrowserPropsContract}();function CookieEnabledBrowserPropsContract_typeof(e){return(CookieEnabledBrowserPropsContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function CookieEnabledBrowserPropsContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function CookieEnabledBrowserPropsContract_setPrototypeOf(e,t){return(CookieEnabledBrowserPropsContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function CookieEnabledBrowserPropsContract_createSuper(r){var n=function CookieEnabledBrowserPropsContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=CookieEnabledBrowserPropsContract_getPrototypeOf(r);return function CookieEnabledBrowserPropsContract_possibleConstructorReturn(e,t){{if(t&&("object"===CookieEnabledBrowserPropsContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function CookieEnabledBrowserPropsContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=CookieEnabledBrowserPropsContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function CookieEnabledBrowserPropsContract_getPrototypeOf(e){return(CookieEnabledBrowserPropsContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Dn=function(){!function CookieEnabledBrowserPropsContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&CookieEnabledBrowserPropsContract_setPrototypeOf(e,t)}(CookieEnabledBrowserPropsContract,_n);var r=CookieEnabledBrowserPropsContract_createSuper(CookieEnabledBrowserPropsContract);function CookieEnabledBrowserPropsContract(e){var t;return function CookieEnabledBrowserPropsContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CookieEnabledBrowserPropsContract),(t=r.call(self)).validateParams(e),t.isCookie=e,t}return function CookieEnabledBrowserPropsContract_createClass(e,t,r){t&&CookieEnabledBrowserPropsContract_defineProperties(e.prototype,t),r&&CookieEnabledBrowserPropsContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CookieEnabledBrowserPropsContract,[{key:"validateParams",value:function validateParams(e){"boolean"==typeof e||w.warn("wrong type in CookieEnabled, BrowserProps parameters. isCookie : {expected: boolean, received: ".concat(CookieEnabledBrowserPropsContract_typeof(e),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.isCookie];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"boolean"==typeof e[1]||w.warn("CookieEnabled,BrowserPropsContract - Contract verification failed")}},{key:"getName",value:function getName(){return"cookie_enabled"}}]),CookieEnabledBrowserPropsContract}();function DeviceMemoryBrowserPropsContract_typeof(e){return(DeviceMemoryBrowserPropsContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function DeviceMemoryBrowserPropsContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function DeviceMemoryBrowserPropsContract_setPrototypeOf(e,t){return(DeviceMemoryBrowserPropsContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function DeviceMemoryBrowserPropsContract_createSuper(r){var n=function DeviceMemoryBrowserPropsContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=DeviceMemoryBrowserPropsContract_getPrototypeOf(r);return function DeviceMemoryBrowserPropsContract_possibleConstructorReturn(e,t){{if(t&&("object"===DeviceMemoryBrowserPropsContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function DeviceMemoryBrowserPropsContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=DeviceMemoryBrowserPropsContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function DeviceMemoryBrowserPropsContract_getPrototypeOf(e){return(DeviceMemoryBrowserPropsContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Fn=function(){!function DeviceMemoryBrowserPropsContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&DeviceMemoryBrowserPropsContract_setPrototypeOf(e,t)}(DeviceMemoryBrowserPropsContract,_n);var r=DeviceMemoryBrowserPropsContract_createSuper(DeviceMemoryBrowserPropsContract);function DeviceMemoryBrowserPropsContract(e){var t;return function DeviceMemoryBrowserPropsContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,DeviceMemoryBrowserPropsContract),(t=r.call(self)).validateParams(e),t.memory=e,t}return function DeviceMemoryBrowserPropsContract_createClass(e,t,r){t&&DeviceMemoryBrowserPropsContract_defineProperties(e.prototype,t),r&&DeviceMemoryBrowserPropsContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(DeviceMemoryBrowserPropsContract,[{key:"validateParams",value:function validateParams(e){"number"==typeof e&&(.25===e||.5===e||1===e||2===e||4===e||8===e||0===e)||w.warn("wrong type in DeviceMemoryBrowser, BrowserProps parameters. memory : {expected: number in {0.25, 0.5, 1, 2, 4, 8, 0} received: type:".concat(DeviceMemoryBrowserPropsContract_typeof(e)," value:").concat(e,"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.memory];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"number"==typeof e[1]||w.warn("device_memory, BrowserPropsContract - Contract verification failed")}},{key:"getName",value:function getName(){return"device_memory"}}]),DeviceMemoryBrowserPropsContract}();function LangBrowserPropsContract_typeof(e){return(LangBrowserPropsContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function LangBrowserPropsContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function LangBrowserPropsContract_setPrototypeOf(e,t){return(LangBrowserPropsContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function LangBrowserPropsContract_createSuper(r){var n=function LangBrowserPropsContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=LangBrowserPropsContract_getPrototypeOf(r);return function LangBrowserPropsContract_possibleConstructorReturn(e,t){{if(t&&("object"===LangBrowserPropsContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function LangBrowserPropsContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=LangBrowserPropsContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function LangBrowserPropsContract_getPrototypeOf(e){return(LangBrowserPropsContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Tn=function(){!function LangBrowserPropsContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&LangBrowserPropsContract_setPrototypeOf(e,t)}(LangBrowserPropsContract,_n);var r=LangBrowserPropsContract_createSuper(LangBrowserPropsContract);function LangBrowserPropsContract(e){var t;return function LangBrowserPropsContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,LangBrowserPropsContract),(t=r.call(self)).validateParams(e),t.language=e,t}return function LangBrowserPropsContract_createClass(e,t,r){t&&LangBrowserPropsContract_defineProperties(e.prototype,t),r&&LangBrowserPropsContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(LangBrowserPropsContract,[{key:"validateParams",value:function validateParams(e){"string"==typeof e||w.warn(" wrong type in Lang, BrowserProps parameters. language : {expected: string, received: ".concat(LangBrowserPropsContract_typeof(e),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.language];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"string"==typeof e[1]||w.warn("main_lang, BrowserPropsContract - Contract verification failed")}},{key:"getName",value:function getName(){return"main_lang"}}]),LangBrowserPropsContract}();function LanguagesListBrowserPropsContract_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function LanguagesListBrowserPropsContract_unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return LanguagesListBrowserPropsContract_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return LanguagesListBrowserPropsContract_arrayLikeToArray(e,t)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var i=0,r=function F(){};return{s:r,n:function n(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,c=!1;return{s:function s(){o=o.call(t)},n:function n(){var e=o.next();return u=e.done,e},e:function e(t){c=!0,a=t},f:function f(){try{u||null==o.return||o.return()}finally{if(c)throw a}}}}function LanguagesListBrowserPropsContract_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function LanguagesListBrowserPropsContract_typeof(e){return(LanguagesListBrowserPropsContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function LanguagesListBrowserPropsContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function LanguagesListBrowserPropsContract_setPrototypeOf(e,t){return(LanguagesListBrowserPropsContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function LanguagesListBrowserPropsContract_createSuper(r){var n=function LanguagesListBrowserPropsContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=LanguagesListBrowserPropsContract_getPrototypeOf(r);return function LanguagesListBrowserPropsContract_possibleConstructorReturn(e,t){{if(t&&("object"===LanguagesListBrowserPropsContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function LanguagesListBrowserPropsContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=LanguagesListBrowserPropsContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function LanguagesListBrowserPropsContract_getPrototypeOf(e){return(LanguagesListBrowserPropsContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var In=function(){!function LanguagesListBrowserPropsContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&LanguagesListBrowserPropsContract_setPrototypeOf(e,t)}(LanguagesListBrowserPropsContract,_n);var r=LanguagesListBrowserPropsContract_createSuper(LanguagesListBrowserPropsContract);function LanguagesListBrowserPropsContract(e){var t;return function LanguagesListBrowserPropsContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,LanguagesListBrowserPropsContract),(t=r.call(self)).validateParams(e),t.languagesList=e,t}return function LanguagesListBrowserPropsContract_createClass(e,t,r){t&&LanguagesListBrowserPropsContract_defineProperties(e.prototype,t),r&&LanguagesListBrowserPropsContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(LanguagesListBrowserPropsContract,[{key:"validateParams",value:function validateParams(e){Array.isArray(e)&&self._eachLangIsValid(e)||w.warn(" wrong type in LanguagesList, BrowserProps parameters. languagesList : {expected: [...string], received: ".concat(LanguagesListBrowserPropsContract_typeof(e),"}"))}},{key:"_eachLangIsValid",value:function _eachLangIsValid(e){var t,r=!0,n=LanguagesListBrowserPropsContract_createForOfIteratorHelper(e);try{for(n.s();!(t=n.n()).done;)"string"!=typeof t.value&&(r=!1)}catch(e){n.e(e)}finally{n.f()}return r}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.languagesList];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&Array.isArray(e[1])||w.warn("languages, BrowserPropsContract - Contract verification failed")}},{key:"getName",value:function getName(){return"languages"}}]),LanguagesListBrowserPropsContract}();function BuildIDBrowserPropsContract_typeof(e){return(BuildIDBrowserPropsContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function BuildIDBrowserPropsContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function BuildIDBrowserPropsContract_setPrototypeOf(e,t){return(BuildIDBrowserPropsContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function BuildIDBrowserPropsContract_createSuper(r){var n=function BuildIDBrowserPropsContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=BuildIDBrowserPropsContract_getPrototypeOf(r);return function BuildIDBrowserPropsContract_possibleConstructorReturn(e,t){{if(t&&("object"===BuildIDBrowserPropsContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function BuildIDBrowserPropsContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=BuildIDBrowserPropsContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function BuildIDBrowserPropsContract_getPrototypeOf(e){return(BuildIDBrowserPropsContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var xn=function(){!function BuildIDBrowserPropsContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&BuildIDBrowserPropsContract_setPrototypeOf(e,t)}(BuildIDBrowserPropsContract,_n);var r=BuildIDBrowserPropsContract_createSuper(BuildIDBrowserPropsContract);function BuildIDBrowserPropsContract(e){var t;return function BuildIDBrowserPropsContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,BuildIDBrowserPropsContract),(t=r.call(self)).validateParams(e),t.buildID=e,t}return function BuildIDBrowserPropsContract_createClass(e,t,r){t&&BuildIDBrowserPropsContract_defineProperties(e.prototype,t),r&&BuildIDBrowserPropsContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(BuildIDBrowserPropsContract,[{key:"validateParams",value:function validateParams(e){void 0!==e&&"string"==typeof e||w.warn("The buildID is either undefined or of a wrong type. Expected string, received: ".concat(BuildIDBrowserPropsContract_typeof(e)))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.buildID];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"string"==typeof e[1]||w.warn("navigator_build_id, BrowserPropsContract - Contract verification failed")}},{key:"getName",value:function getName(){return"navigator_build_id"}}]),BuildIDBrowserPropsContract}();function MaxTouchPointsBrowserPropsContract_typeof(e){return(MaxTouchPointsBrowserPropsContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function MaxTouchPointsBrowserPropsContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function MaxTouchPointsBrowserPropsContract_setPrototypeOf(e,t){return(MaxTouchPointsBrowserPropsContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function MaxTouchPointsBrowserPropsContract_createSuper(r){var n=function MaxTouchPointsBrowserPropsContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=MaxTouchPointsBrowserPropsContract_getPrototypeOf(r);return function MaxTouchPointsBrowserPropsContract_possibleConstructorReturn(e,t){{if(t&&("object"===MaxTouchPointsBrowserPropsContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function MaxTouchPointsBrowserPropsContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=MaxTouchPointsBrowserPropsContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function MaxTouchPointsBrowserPropsContract_getPrototypeOf(e){return(MaxTouchPointsBrowserPropsContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ln=function(){!function MaxTouchPointsBrowserPropsContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&MaxTouchPointsBrowserPropsContract_setPrototypeOf(e,t)}(MaxTouchPointsBrowserPropsContract,_n);var r=MaxTouchPointsBrowserPropsContract_createSuper(MaxTouchPointsBrowserPropsContract);function MaxTouchPointsBrowserPropsContract(e){var t;return function MaxTouchPointsBrowserPropsContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,MaxTouchPointsBrowserPropsContract),(t=r.call(self)).validateParams(e),t.maxTouchPoints=e,t}return function MaxTouchPointsBrowserPropsContract_createClass(e,t,r){t&&MaxTouchPointsBrowserPropsContract_defineProperties(e.prototype,t),r&&MaxTouchPointsBrowserPropsContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(MaxTouchPointsBrowserPropsContract,[{key:"validateParams",value:function validateParams(e){void 0!==e&&"number"==typeof e||w.warn("wrong type in MaxTouchPointsContract parameters. Expected: number, received: ".concat(MaxTouchPointsBrowserPropsContract_typeof(e)))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.maxTouchPoints];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"number"==typeof e[1]||w.warn("navigator_max_touch_points, BrowserPropsContract - Contract verification failed")}},{key:"getName",value:function getName(){return"navigator_max_touch_points"}}]),MaxTouchPointsBrowserPropsContract}();function BrowserPropsFeature_typeof(e){return(BrowserPropsFeature_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function BrowserPropsFeature_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function BrowserPropsFeature_setPrototypeOf(e,t){return(BrowserPropsFeature_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function BrowserPropsFeature_createSuper(r){var n=function BrowserPropsFeature_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=BrowserPropsFeature_getPrototypeOf(r);return function BrowserPropsFeature_possibleConstructorReturn(e,t){{if(t&&("object"===BrowserPropsFeature_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function BrowserPropsFeature_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=BrowserPropsFeature_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function BrowserPropsFeature_getPrototypeOf(e){return(BrowserPropsFeature_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var jn={configKey:"collectBrowserProps",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!0,shouldRun:!0,isFrameRelated:!1,runInUns:!0,runInSlave:!1,isRunning:!1,instance:null},An=function(){!function BrowserPropsFeature_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&BrowserPropsFeature_setPrototypeOf(e,t)}(BrowserPropsFeature,de);var i=BrowserPropsFeature_createSuper(BrowserPropsFeature);function BrowserPropsFeature(e,t,r,n){var o;return function BrowserPropsFeature_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,BrowserPropsFeature),(o=i.call(self))._dataQ=e,o._pointerHoverDetector=t,o._utils=r,o._configurationRepository=n,o}return function BrowserPropsFeature_createClass(e,t,r){t&&BrowserPropsFeature_defineProperties(e.prototype,t),r&&BrowserPropsFeature_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(BrowserPropsFeature,[{key:"startFeature",value:function startFeature(){var t=self;w.info("Collecting Browser Props");var e=new Cn(self._utils.scriptVersion).buildQueueMessage();self._dataQ.addToQueue("static_fields",e,!1);e=new wn("js").buildQueueMessage();self._dataQ.addToQueue("static_fields",e,!1),w.info("SDK Version is ".concat(self._utils.scriptVersion));e=BrowserPropsFeature.getLanguage();e&&(self._configurationRepository.get("browserPropsShouldHashLanguageField")&&(w.debug("Hashing language field according to configuration"),e=self._utils.getHash(e).toString()),r=new Tn(e).buildQueueMessage(),self._dataQ.addToQueue("static_fields",r,!1));e=new En(window.navigator.platform).buildQueueMessage();self._dataQ.addToQueue("static_fields",e,!1);var r=BrowserPropsFeature.getOperatingSystem(),e=new Pn(r.version).buildQueueMessage();self._dataQ.addToQueue("static_fields",e,!1);r=new Sn(r.name).buildQueueMessage();self._dataQ.addToQueue("static_fields",r,!1);r=self._pointerHoverDetector.getPointerHover(),r=new kn(r.pointer,r.hover).buildQueueMessage();self._dataQ.addToQueue("static_fields",r,!1);r=new On(window.navigator.hardwareConcurrency||0).buildQueueMessage();self._dataQ.addToQueue("static_fields",r,!1),navigator.languages&&(n=navigator.languages,self._configurationRepository.get("browserPropsShouldHashLanguageField")&&(w.debug("Hashing languages field according to configuration"),n=Array.from(n,function(e){return t._utils.getHash(e).toString()})),n=new In(n).buildQueueMessage(),self._dataQ.addToQueue("static_fields",n,!1));var n=BrowserPropsFeature.getPlugins();n&&0<n.length&&(o=new Bn(n).buildQueueMessage(),self._dataQ.addToQueue("static_fields",o,!1));var o=new Mn(navigator.userAgent).buildQueueMessage();self._dataQ.addToQueue("static_fields",o,!1);o=-1*(new Date).getTimezoneOffset(),o=new Rn(o).buildQueueMessage();self._dataQ.addToQueue("static_fields",o,!1);o=BrowserPropsFeature.checkCookie(),o=new Dn(o).buildQueueMessage();self._dataQ.addToQueue("static_fields",o,!1);o=navigator.deviceMemory||0,o=new Fn(o).buildQueueMessage();self._dataQ.addToQueue("static_fields",o,!1);o=navigator.buildID;o&&(i=new xn(o).buildQueueMessage(),self._dataQ.addToQueue("static_fields",i,!1));var i=navigator.maxTouchPoints,i=new Ln(i).buildQueueMessage();self._dataQ.addToQueue("static_fields",i,!1),w.info("Browser Props collected")}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return jn}},{key:"getLanguage",value:function getLanguage(){if(navigator){if(navigator.language)return navigator.language;if(navigator.userLanguage)return navigator.userLanguage}}},{key:"getPlugins",value:function getPlugins(){try{var e=[];if(window.navigator.plugins&&0<window.navigator.plugins.length)for(var t=0,r=window.navigator.plugins.length;t<r;t++)e.push([window.navigator.plugins[t].name,window.navigator.plugins[t].filename,window.navigator.plugins[t].description,window.navigator.plugins[t].version||""]);else if(window.navigator.mimeTypes&&0<window.navigator.mimeTypes.length)for(var n=0;n<window.navigator.mimeTypes.length;n++)e.push([window.navigator.mimeTypes[n].type,"",window.navigator.mimeTypes[n].description,""]);var o=BrowserPropsFeature.isActiveXAndFlashEnabled;return BrowserPropsFeature.augmentWithFlashInIE(e,window.navigator.plugins,o),e}catch(e){w.warn("getPlugins error: ".concat(e.message),e)}}},{key:"checkCookie",value:function checkCookie(){var e=navigator.cookieEnabled;return e||(self._utils.StorageUtils.setCookie("testcookie","1",6e4),e=-1!==document.cookie.indexOf("testcookie")),e}},{key:"getOperatingSystem",value:function getOperatingSystem(){for(var e,t,r=[{name:"Windows Phone",value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",value:"iPad",version:"OS"},{name:"Kindle",value:"Silk",version:"Silk"},{name:"Android",value:"Android",version:"Android"},{name:"PlayBook",value:"PlayBook",version:"OS"},{name:"BlackBerry",value:"BlackBerry",version:"/"},{name:"Macintosh",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}],n=[navigator.platform,navigator.oscpu||navigator.appVersion].join(" "),o="",i="Unknown",s=0;s<r.length;s++)if(new RegExp(r[s].value,"i").test(n)){if(e=new RegExp(r[s].version+"[- /:;]([\\d._]+)","i"),t=n.match(e)){t[1]&&(t=t[1]),t=t.split(/[._]+/);for(var a=0;a<t.length;a++)o+=0===a?t[a]+".":t[a]}i=r[s].name;break}return{version:parseFloat(o)||null,name:i}}},{key:"isActiveXAndFlashEnabled",value:function isActiveXAndFlashEnabled(){try{return Boolean(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(e){return!1}}},{key:"augmentWithFlashInIE",value:function augmentWithFlashInIE(e,t,r){if("[object PluginArray]"===Object.prototype.toString.call(t))return e;return r()&&e.push(["Flash32_32_0_0_238.ocx",2,"Shockwave Flash","32.0.0.238"]),e}}]),BrowserPropsFeature}();function DoNotTrackContract_typeof(e){return(DoNotTrackContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function DoNotTrackContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function DoNotTrackContract_setPrototypeOf(e,t){return(DoNotTrackContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function DoNotTrackContract_createSuper(r){var n=function DoNotTrackContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=DoNotTrackContract_getPrototypeOf(r);return function DoNotTrackContract_possibleConstructorReturn(e,t){{if(t&&("object"===DoNotTrackContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function DoNotTrackContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=DoNotTrackContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function DoNotTrackContract_getPrototypeOf(e){return(DoNotTrackContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Un=function(){!function DoNotTrackContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&DoNotTrackContract_setPrototypeOf(e,t)}(DoNotTrackContract,_n);var r=DoNotTrackContract_createSuper(DoNotTrackContract);function DoNotTrackContract(e){var t;return function DoNotTrackContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,DoNotTrackContract),(t=r.call(self)).validateParams(e),t.dnt=e,t}return function DoNotTrackContract_createClass(e,t,r){t&&DoNotTrackContract_defineProperties(e.prototype,t),r&&DoNotTrackContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(DoNotTrackContract,[{key:"validateParams",value:function validateParams(e){"number"==typeof e&&(0===e||1===e||2===e)||w.warn("wrong type in DoNotTrackContract parameters. dnt : {expected: number in {0,1,2}, received: type: ".concat(DoNotTrackContract_typeof(e),", value: ").concat(e))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.dnt];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"number"==typeof e[1]||w.warn("DoNotTrack - Contract verification failed")}},{key:"getName",value:function getName(){return"dnt"}}]),DoNotTrackContract}();function DoNotTrackFeature_typeof(e){return(DoNotTrackFeature_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function DoNotTrackFeature_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function DoNotTrackFeature_setPrototypeOf(e,t){return(DoNotTrackFeature_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function DoNotTrackFeature_createSuper(r){var n=function DoNotTrackFeature_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=DoNotTrackFeature_getPrototypeOf(r);return function DoNotTrackFeature_possibleConstructorReturn(e,t){{if(t&&("object"===DoNotTrackFeature_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function DoNotTrackFeature_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=DoNotTrackFeature_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function DoNotTrackFeature_getPrototypeOf(e){return(DoNotTrackFeature_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Nn={configKey:"isDoNotTrack",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!0,shouldRun:!0,isFrameRelated:!1,runInUns:!0,runInSlave:!1,isRunning:!1,instance:null},Wn=function(){!function DoNotTrackFeature_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&DoNotTrackFeature_setPrototypeOf(e,t)}(DoNotTrackFeature,de);var r=DoNotTrackFeature_createSuper(DoNotTrackFeature);function DoNotTrackFeature(e){var t;return function DoNotTrackFeature_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,DoNotTrackFeature),(t=r.call(self))._dataQ=e,t}return function DoNotTrackFeature_createClass(e,t,r){t&&DoNotTrackFeature_defineProperties(e.prototype,t),r&&DoNotTrackFeature_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(DoNotTrackFeature,[{key:"startFeature",value:function startFeature(){var e=navigator.doNotTrack;void 0===e&&void 0===(e=window.doNotTrack)&&(e=navigator.msDoNotTrack);e=new Un(e=null===e||"unspecified"===e||"0"===e?0:"1"===e?1:2).buildQueueMessage();self._dataQ.addToQueue("static_fields",e,!1)}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return Nn}}]),DoNotTrackFeature}();function GraphicDetectContract_typeof(e){return(GraphicDetectContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function GraphicDetectContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function GraphicDetectContract_setPrototypeOf(e,t){return(GraphicDetectContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function GraphicDetectContract_createSuper(r){var n=function GraphicDetectContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=GraphicDetectContract_getPrototypeOf(r);return function GraphicDetectContract_possibleConstructorReturn(e,t){{if(t&&("object"===GraphicDetectContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function GraphicDetectContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=GraphicDetectContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function GraphicDetectContract_getPrototypeOf(e){return(GraphicDetectContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Hn=function(){!function GraphicDetectContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&GraphicDetectContract_setPrototypeOf(e,t)}(GraphicDetectContract,_n);var o=GraphicDetectContract_createSuper(GraphicDetectContract);function GraphicDetectContract(e,t,r){var n;return function GraphicDetectContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,GraphicDetectContract),(n=o.call(self)).validateParams(e,t,r),n.renderer=e,n.vendor=t,n.version=r,n}return function GraphicDetectContract_createClass(e,t,r){t&&GraphicDetectContract_defineProperties(e.prototype,t),r&&GraphicDetectContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(GraphicDetectContract,[{key:"validateParams",value:function validateParams(e,t,r){"string"==typeof e&&"string"==typeof t&&"string"==typeof r||w.warn("wrong type in GraphicDetectContract parameters. renderer: {expected: string, received: ".concat(GraphicDetectContract_typeof(e),"}, vendor: {expected: string, received: ").concat(GraphicDetectContract_typeof(t),"},\n            version: {expected: string, received: ").concat(GraphicDetectContract_typeof(r),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),[self.renderer,self.vendor,self.version]];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&Array.isArray(e[1])&&3===e[1].length||w.warn("GraphicDetect - Contract verification failed")}},{key:"getName",value:function getName(){return"grph_card"}}]),GraphicDetectContract}();function GraphicDetectFeature_typeof(e){return(GraphicDetectFeature_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function GraphicDetectFeature_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function GraphicDetectFeature_setPrototypeOf(e,t){return(GraphicDetectFeature_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function GraphicDetectFeature_createSuper(r){var n=function GraphicDetectFeature_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=GraphicDetectFeature_getPrototypeOf(r);return function GraphicDetectFeature_possibleConstructorReturn(e,t){{if(t&&("object"===GraphicDetectFeature_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function GraphicDetectFeature_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=GraphicDetectFeature_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function GraphicDetectFeature_getPrototypeOf(e){return(GraphicDetectFeature_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Qn={configKey:"isVMDetection",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!0,shouldRun:!0,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,instance:null},zn=function(){!function GraphicDetectFeature_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&GraphicDetectFeature_setPrototypeOf(e,t)}(GraphicDetectFeature,de);var r=GraphicDetectFeature_createSuper(GraphicDetectFeature);function GraphicDetectFeature(e){var t;return function GraphicDetectFeature_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,GraphicDetectFeature),(t=r.call(self))._dataQ=e,t.canvasId="cd_canvas",t}return function GraphicDetectFeature_createClass(e,t,r){t&&GraphicDetectFeature_defineProperties(e.prototype,t),r&&GraphicDetectFeature_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(GraphicDetectFeature,[{key:"startFeature",value:function startFeature(){try{self._getMappedRenderInfo()}catch(e){w.error("Failed collecting Graphic Card information. ".concat(e))}}},{key:"_getMappedRenderInfo",value:function _getMappedRenderInfo(){w.info("Collecting Graphic Card props");var e,t,r={renderer:"unknown",vendor:"",version:"unknown"};(window.WebGLRenderingContext||window.WebGL2RenderingContext)&&((t=document.createElement("canvas")).id=self.canvasId,!(e=t.getContext("experimental-webgl"))||null!=(t=e.getExtension("WEBGL_debug_renderer_info"))&&(r.renderer=e.getParameter(t.UNMASKED_RENDERER_WEBGL),r.vendor=e.getParameter(t.UNMASKED_VENDOR_WEBGL),-1<r.renderer.indexOf("Intel")&&-1<r.renderer.indexOf("HD Graphics")&&((t=r.renderer.match(/\d+/g))&&(500<(t=t[0])&&t<599&&(r.version="SKL (6th gen core)"),5300<t&&t<6999&&(r.version="BDW (5th gen core)")))));r=new Hn(r.renderer,r.vendor,r.version).buildQueueMessage();self._dataQ.addToQueue("static_fields",r,!1),w.info("Graphic Card props collected")}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return Qn}}]),GraphicDetectFeature}();function MediaDevicesContract_typeof(e){return(MediaDevicesContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function MediaDevicesContract_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function MediaDevicesContract_unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return MediaDevicesContract_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return MediaDevicesContract_arrayLikeToArray(e,t)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var i=0,r=function F(){};return{s:r,n:function n(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,c=!1;return{s:function s(){o=o.call(t)},n:function n(){var e=o.next();return u=e.done,e},e:function e(t){c=!0,a=t},f:function f(){try{u||null==o.return||o.return()}finally{if(c)throw a}}}}function MediaDevicesContract_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function MediaDevicesContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function MediaDevicesContract_setPrototypeOf(e,t){return(MediaDevicesContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function MediaDevicesContract_createSuper(r){var n=function MediaDevicesContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=MediaDevicesContract_getPrototypeOf(r);return function MediaDevicesContract_possibleConstructorReturn(e,t){{if(t&&("object"===MediaDevicesContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function MediaDevicesContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=MediaDevicesContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function MediaDevicesContract_getPrototypeOf(e){return(MediaDevicesContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var qn=function(){!function MediaDevicesContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&MediaDevicesContract_setPrototypeOf(e,t)}(MediaDevicesContract,_n);var r=MediaDevicesContract_createSuper(MediaDevicesContract);function MediaDevicesContract(e){var t;return function MediaDevicesContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,MediaDevicesContract),(t=r.call(self)).validateParams(e),t.mediaDevices=e,t}return function MediaDevicesContract_createClass(e,t,r){t&&MediaDevicesContract_defineProperties(e.prototype,t),r&&MediaDevicesContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(MediaDevicesContract,[{key:"validateParams",value:function validateParams(e){Array.isArray(e)&&self._eachDeviceIsValid(e)||w.warn(" wrong type in MediaDevicesContract parameters. mediaDevices : {expected: [[...string]], received: ".concat(e,"}"))}},{key:"_eachDeviceIsValid",value:function _eachDeviceIsValid(e){var t=!0,r=!0,n=!0,o=MediaDevicesContract_createForOfIteratorHelper(e);try{for(o.s();!(i=o.n()).done;){var i=i.value;if(Array.isArray(i)){4!==i.length&&(n=!1);var s,a=MediaDevicesContract_createForOfIteratorHelper(i);try{for(a.s();!(s=a.n()).done;)"string"!=typeof s.value&&(r=!1)}catch(e){a.e(e)}finally{a.f()}}else t=!1}}catch(e){o.e(e)}finally{o.f()}return t&&n&&r}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.mediaDevices];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&Array.isArray(e[1])||w.warn("MediaDevices - Contract verification failed")}},{key:"getName",value:function getName(){return"media_devices"}}]),MediaDevicesContract}();function MediaDevicesFeature_typeof(e){return(MediaDevicesFeature_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function MediaDevicesFeature_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function MediaDevicesFeature_setPrototypeOf(e,t){return(MediaDevicesFeature_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function MediaDevicesFeature_createSuper(r){var n=function MediaDevicesFeature_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=MediaDevicesFeature_getPrototypeOf(r);return function MediaDevicesFeature_possibleConstructorReturn(e,t){{if(t&&("object"===MediaDevicesFeature_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function MediaDevicesFeature_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=MediaDevicesFeature_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function MediaDevicesFeature_getPrototypeOf(e){return(MediaDevicesFeature_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Kn={configKey:"isMediaDevices",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!0,shouldRun:!0,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,instance:null},Vn=function(){!function MediaDevicesFeature_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&MediaDevicesFeature_setPrototypeOf(e,t)}(MediaDevicesFeature,de);var n=MediaDevicesFeature_createSuper(MediaDevicesFeature);function MediaDevicesFeature(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:window.navigator;return function MediaDevicesFeature_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,MediaDevicesFeature),(t=n.call(self))._dataQ=e,t._navigator=r,t._metric="MediaDevicesFeature",t}return function MediaDevicesFeature_createClass(e,t,r){t&&MediaDevicesFeature_defineProperties(e.prototype,t),r&&MediaDevicesFeature_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(MediaDevicesFeature,[{key:"startFeature",value:function startFeature(){var r=self;self._navigator.mediaDevices&&self._navigator.mediaDevices.enumerateDevices&&self._navigator.mediaDevices.enumerateDevices().then(function(e){var t=[];e.forEach(function(e){e=[e.kind||"",e.label||"",e.deviceId||"",e.groupId||""];t.push(e)});e=new qn(t).buildQueueMessage();r._dataQ.addToQueue("static_fields",e,!1)}).catch(function(e){r.cancelMonitor(r._metric),w.error("MediaDevicesFeature:startFeature failed to enumerateDevices: ".concat(e.message))})}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return Kn}}]),MediaDevicesFeature}();function PerUserPermissionContract_typeof(e){return(PerUserPermissionContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function PerUserPermissionContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function PerUserPermissionContract_setPrototypeOf(e,t){return(PerUserPermissionContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function PerUserPermissionContract_createSuper(r){var n=function PerUserPermissionContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=PerUserPermissionContract_getPrototypeOf(r);return function PerUserPermissionContract_possibleConstructorReturn(e,t){{if(t&&("object"===PerUserPermissionContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function PerUserPermissionContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=PerUserPermissionContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function PerUserPermissionContract_getPrototypeOf(e){return(PerUserPermissionContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Gn=function(){!function PerUserPermissionContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&PerUserPermissionContract_setPrototypeOf(e,t)}(PerUserPermissionContract,_n);var n=PerUserPermissionContract_createSuper(PerUserPermissionContract);function PerUserPermissionContract(e,t){var r;return function PerUserPermissionContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,PerUserPermissionContract),(r=n.call(self)).validateParams(e,t),r.per=e,r.state=t,r}return function PerUserPermissionContract_createClass(e,t,r){t&&PerUserPermissionContract_defineProperties(e.prototype,t),r&&PerUserPermissionContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(PerUserPermissionContract,[{key:"validateParams",value:function validateParams(e,t){"string"==typeof e&&"number"==typeof t||w.warn("wrong type in Per, UserPermissionContract, parameters. per : {expected: string, received: ".concat(PerUserPermissionContract_typeof(e),"}, state : {expected: number, received: ").concat(PerUserPermissionContract_typeof(t),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.state];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"number"==typeof e[1]||w.warn("per, UserPermissionContract - Contract verification failed")}},{key:"getName",value:function getName(){return"per_".concat(self.per)}}]),PerUserPermissionContract}();function PerStorageUserPermissionContract_typeof(e){return(PerStorageUserPermissionContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function PerStorageUserPermissionContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function PerStorageUserPermissionContract_setPrototypeOf(e,t){return(PerStorageUserPermissionContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function PerStorageUserPermissionContract_createSuper(r){var n=function PerStorageUserPermissionContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=PerStorageUserPermissionContract_getPrototypeOf(r);return function PerStorageUserPermissionContract_possibleConstructorReturn(e,t){{if(t&&("object"===PerStorageUserPermissionContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function PerStorageUserPermissionContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=PerStorageUserPermissionContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function PerStorageUserPermissionContract_getPrototypeOf(e){return(PerStorageUserPermissionContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Zn=function(){!function PerStorageUserPermissionContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&PerStorageUserPermissionContract_setPrototypeOf(e,t)}(PerStorageUserPermissionContract,_n);var r=PerStorageUserPermissionContract_createSuper(PerStorageUserPermissionContract);function PerStorageUserPermissionContract(e){var t;return function PerStorageUserPermissionContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,PerStorageUserPermissionContract),(t=r.call(self)).validateParams(e),t.persistent=e,t}return function PerStorageUserPermissionContract_createClass(e,t,r){t&&PerStorageUserPermissionContract_defineProperties(e.prototype,t),r&&PerStorageUserPermissionContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(PerStorageUserPermissionContract,[{key:"validateParams",value:function validateParams(e){"number"==typeof e||w.warn("wrong type in PerStorage , UserPermissionContract, parameters. persistent : {expected: number, received: ".concat(PerStorageUserPermissionContract_typeof(e),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.persistent];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"number"==typeof e[1]||w.warn("per_storage, UserPermissionContract - Contract verification failed")}},{key:"getName",value:function getName(){return"per_storage"}}]),PerStorageUserPermissionContract}();function PerKindUserPermissionContract_typeof(e){return(PerKindUserPermissionContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function PerKindUserPermissionContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function PerKindUserPermissionContract_setPrototypeOf(e,t){return(PerKindUserPermissionContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function PerKindUserPermissionContract_createSuper(r){var n=function PerKindUserPermissionContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=PerKindUserPermissionContract_getPrototypeOf(r);return function PerKindUserPermissionContract_possibleConstructorReturn(e,t){{if(t&&("object"===PerKindUserPermissionContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function PerKindUserPermissionContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=PerKindUserPermissionContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function PerKindUserPermissionContract_getPrototypeOf(e){return(PerKindUserPermissionContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Yn=function(){!function PerKindUserPermissionContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&PerKindUserPermissionContract_setPrototypeOf(e,t)}(PerKindUserPermissionContract,_n);var n=PerKindUserPermissionContract_createSuper(PerKindUserPermissionContract);function PerKindUserPermissionContract(e,t){var r;return function PerKindUserPermissionContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,PerKindUserPermissionContract),(r=n.call(self)).validateParams(e,t),r.kind=e,r.perm=t,r}return function PerKindUserPermissionContract_createClass(e,t,r){t&&PerKindUserPermissionContract_defineProperties(e.prototype,t),r&&PerKindUserPermissionContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(PerKindUserPermissionContract,[{key:"validateParams",value:function validateParams(e,t){"string"==typeof e&&"number"==typeof t||w.warn("wrong type in PerKind , UserPermissionContract, parameters. kind : {expected: string, received: ".concat(PerKindUserPermissionContract_typeof(e),"}, perm : {expected: number, received: ").concat(PerKindUserPermissionContract_typeof(t),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.perm];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"number"==typeof e[1]||w.warn("PerKind, UserPermissionContract - Contract verification failed")}},{key:"getName",value:function getName(){return"per_".concat(self.kind)}}]),PerKindUserPermissionContract}();function UserPermissions_typeof(e){return(UserPermissions_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function UserPermissions_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function UserPermissions_setPrototypeOf(e,t){return(UserPermissions_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function UserPermissions_createSuper(r){var n=function UserPermissions_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=UserPermissions_getPrototypeOf(r);return function UserPermissions_possibleConstructorReturn(e,t){{if(t&&("object"===UserPermissions_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function UserPermissions_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=UserPermissions_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function UserPermissions_getPrototypeOf(e){return(UserPermissions_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Jn={configKey:"isUserPermissions",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!0,shouldRun:!0,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,instance:null},Xn=function(){!function UserPermissions_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&UserPermissions_setPrototypeOf(e,t)}(UserPermissions,de);var n=UserPermissions_createSuper(UserPermissions);function UserPermissions(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:window.navigator;return function UserPermissions_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,UserPermissions),(t=n.call(self))._permDefs={granted:1,prompt:2,denied:3,true:1,false:3},t._permissions=["geolocation","midi","notifications","push"],t._dataQ=e,t._navigator=r,t}return function UserPermissions_createClass(e,t,r){t&&UserPermissions_defineProperties(e.prototype,t),r&&UserPermissions_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(UserPermissions,[{key:"startFeature",value:function startFeature(){self._reportQueryPermissions(),self._reportStoragePermission(),self._reportMicCameraPermissions()}},{key:"_reportQueryPermissions",value:function _reportQueryPermissions(){var n=self;self._navigator.permissions&&self._navigator.permissions.query&&function(){for(var r=w,e=function _loop(e){var t=n._permissions[e];n._navigator.permissions.query({name:t}).then(function(e){e=n._permDefs[e.state]||-1,e=new Gn(t,e).buildQueueMessage();n._dataQ.addToQueue("static_fields",e,!1)}).catch(function(e){r.debug("Failed querying for ".concat(t," permissions ").concat(e.message))})},t=0;t<n._permissions.length;t++)e(t)}()}},{key:"_reportStoragePermission",value:function _reportStoragePermission(){var t=self;self._navigator.storage&&self._navigator.storage.persisted&&self._navigator.storage.persisted().then(function(e){e=new Zn(t._permDefs[e]||-1).buildQueueMessage();t._dataQ.addToQueue("static_fields",e,!1)}).catch(function(e){w.debug("Failed to check storage persisted: ".concat(e.message))})}},{key:"_reportMicCameraPermissions",value:function _reportMicCameraPermissions(){var r=self,n={audio:!1,video:!1};self._navigator.mediaDevices&&self._navigator.mediaDevices.enumerateDevices&&self._navigator.mediaDevices.enumerateDevices().then(function(e){e.forEach(function(e){var t;!function isAlreadyReported(e){return e.includes("audio")&&n.audio||e.includes("video")&&n.video}(e.kind)&&(t=function updateReported(e){return e.includes("audio")?(n.audio=!0,"audio"):e.includes("video")?(n.video=!0,"video"):void 0}(e.kind),e=""!==e.label?r._permDefs.granted:r._permDefs.denied,e=new Yn(t,e).buildQueueMessage(),r._dataQ.addToQueue("static_fields",e,!1))})}).catch(function(e){w.debug("UserPermissions:startFeature failed to enumerateDevices: ".concat(e.message))})}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return Jn}}]),UserPermissions}();function IsPrivateBrowsingContract_typeof(e){return(IsPrivateBrowsingContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function IsPrivateBrowsingContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function IsPrivateBrowsingContract_setPrototypeOf(e,t){return(IsPrivateBrowsingContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function IsPrivateBrowsingContract_createSuper(r){var n=function IsPrivateBrowsingContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=IsPrivateBrowsingContract_getPrototypeOf(r);return function IsPrivateBrowsingContract_possibleConstructorReturn(e,t){{if(t&&("object"===IsPrivateBrowsingContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function IsPrivateBrowsingContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=IsPrivateBrowsingContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function IsPrivateBrowsingContract_getPrototypeOf(e){return(IsPrivateBrowsingContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var $n=function(){!function IsPrivateBrowsingContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&IsPrivateBrowsingContract_setPrototypeOf(e,t)}(IsPrivateBrowsingContract,_n);var r=IsPrivateBrowsingContract_createSuper(IsPrivateBrowsingContract);function IsPrivateBrowsingContract(e){var t;return function IsPrivateBrowsingContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,IsPrivateBrowsingContract),(t=r.call(self)).validateParams(e),t.isPrivate=e,t}return function IsPrivateBrowsingContract_createClass(e,t,r){t&&IsPrivateBrowsingContract_defineProperties(e.prototype,t),r&&IsPrivateBrowsingContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(IsPrivateBrowsingContract,[{key:"validateParams",value:function validateParams(e){"boolean"==typeof e||w.warn("wrong type in IsPrivateBrowsingContract parameters. isPrivate : {expected: boolean, received: ".concat(IsPrivateBrowsingContract_typeof(e),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.isPrivate];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"boolean"==typeof e[1]||w.warn("IsPrivateBrowsing - Contract verification failed")}},{key:"getName",value:function getName(){return"is_private_browsing"}}]),IsPrivateBrowsingContract}();function IsPrivateBrowsingFeature_typeof(e){return(IsPrivateBrowsingFeature_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function IsPrivateBrowsingFeature_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function IsPrivateBrowsingFeature_setPrototypeOf(e,t){return(IsPrivateBrowsingFeature_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function IsPrivateBrowsingFeature_createSuper(r){var n=function IsPrivateBrowsingFeature_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=IsPrivateBrowsingFeature_getPrototypeOf(r);return function IsPrivateBrowsingFeature_possibleConstructorReturn(e,t){{if(t&&("object"===IsPrivateBrowsingFeature_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function IsPrivateBrowsingFeature_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=IsPrivateBrowsingFeature_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function IsPrivateBrowsingFeature_getPrototypeOf(e){return(IsPrivateBrowsingFeature_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var eo={configKey:"isPrivateBrowsing",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!0,shouldRun:!0,isFrameRelated:!1,runInUns:!0,runInSlave:!1,isRunning:!1,instance:null},to=function(){!function IsPrivateBrowsingFeature_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&IsPrivateBrowsingFeature_setPrototypeOf(e,t)}(IsPrivateBrowsingFeature,de);var n=IsPrivateBrowsingFeature_createSuper(IsPrivateBrowsingFeature);function IsPrivateBrowsingFeature(e,t){var r;return function IsPrivateBrowsingFeature_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,IsPrivateBrowsingFeature),(r=n.call(self))._dataQ=e,r._privateBrowsingDetector=t,r}return function IsPrivateBrowsingFeature_createClass(e,t,r){t&&IsPrivateBrowsingFeature_defineProperties(e.prototype,t),r&&IsPrivateBrowsingFeature_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(IsPrivateBrowsingFeature,[{key:"startFeature",value:function startFeature(){var t=self;self._privateBrowsingDetector.detectPrivateMode(function(e){e=new $n(e).buildQueueMessage();t._dataQ.addToQueue("static_fields",e,!1)})}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return eo}}]),IsPrivateBrowsingFeature}();function LegacyFontsDetectionContract_typeof(e){return(LegacyFontsDetectionContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function LegacyFontsDetectionContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function LegacyFontsDetectionContract_setPrototypeOf(e,t){return(LegacyFontsDetectionContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function LegacyFontsDetectionContract_createSuper(r){var n=function LegacyFontsDetectionContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=LegacyFontsDetectionContract_getPrototypeOf(r);return function LegacyFontsDetectionContract_possibleConstructorReturn(e,t){{if(t&&("object"===LegacyFontsDetectionContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function LegacyFontsDetectionContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=LegacyFontsDetectionContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function LegacyFontsDetectionContract_getPrototypeOf(e){return(LegacyFontsDetectionContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ro=function(){!function LegacyFontsDetectionContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&LegacyFontsDetectionContract_setPrototypeOf(e,t)}(LegacyFontsDetectionContract,_n);var r=LegacyFontsDetectionContract_createSuper(LegacyFontsDetectionContract);function LegacyFontsDetectionContract(e){var t;return function LegacyFontsDetectionContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,LegacyFontsDetectionContract),(t=r.call(self)).validateParams(e),t.legacyFonts=e,t}return function LegacyFontsDetectionContract_createClass(e,t,r){t&&LegacyFontsDetectionContract_defineProperties(e.prototype,t),r&&LegacyFontsDetectionContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(LegacyFontsDetectionContract,[{key:"validateParams",value:function validateParams(e){"string"==typeof e||w.warn(" wrong type in LegacyFontsDetectionContract parameters. legacyFonts : {expected: string, received: ".concat(LegacyFontsDetectionContract_typeof(e),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.legacyFonts];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"string"==typeof e[1]||w.warn("legacy_fonts, FontsDetection - Contract verification failed")}},{key:"getName",value:function getName(){return"legacy_fonts"}}]),LegacyFontsDetectionContract}();function ProblematicFontsDetectionContract_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function ProblematicFontsDetectionContract_unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return ProblematicFontsDetectionContract_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ProblematicFontsDetectionContract_arrayLikeToArray(e,t)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var i=0,r=function F(){};return{s:r,n:function n(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,c=!1;return{s:function s(){o=o.call(t)},n:function n(){var e=o.next();return u=e.done,e},e:function e(t){c=!0,a=t},f:function f(){try{u||null==o.return||o.return()}finally{if(c)throw a}}}}function ProblematicFontsDetectionContract_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ProblematicFontsDetectionContract_typeof(e){return(ProblematicFontsDetectionContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ProblematicFontsDetectionContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ProblematicFontsDetectionContract_setPrototypeOf(e,t){return(ProblematicFontsDetectionContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function ProblematicFontsDetectionContract_createSuper(r){var n=function ProblematicFontsDetectionContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=ProblematicFontsDetectionContract_getPrototypeOf(r);return function ProblematicFontsDetectionContract_possibleConstructorReturn(e,t){{if(t&&("object"===ProblematicFontsDetectionContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function ProblematicFontsDetectionContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=ProblematicFontsDetectionContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function ProblematicFontsDetectionContract_getPrototypeOf(e){return(ProblematicFontsDetectionContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var no=function(){!function ProblematicFontsDetectionContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ProblematicFontsDetectionContract_setPrototypeOf(e,t)}(ProblematicFontsDetectionContract,_n);var r=ProblematicFontsDetectionContract_createSuper(ProblematicFontsDetectionContract);function ProblematicFontsDetectionContract(e){var t;return function ProblematicFontsDetectionContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ProblematicFontsDetectionContract),(t=r.call(self)).validateParams(e),t.allFontsDiffs=e,t}return function ProblematicFontsDetectionContract_createClass(e,t,r){t&&ProblematicFontsDetectionContract_defineProperties(e.prototype,t),r&&ProblematicFontsDetectionContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ProblematicFontsDetectionContract,[{key:"validateParams",value:function validateParams(e){Array.isArray(e)&&self._eachFontIsValid(e)||w.warn(" wrong type in ProblematicFontsDetectionContract parameters. allFontsDiffs : {expected: [[string, number,number]], received: ".concat(ProblematicFontsDetectionContract_typeof(e),"}"))}},{key:"_eachFontIsValid",value:function _eachFontIsValid(e){var t=!0,r=!0,n=!0,o=ProblematicFontsDetectionContract_createForOfIteratorHelper(e);try{for(o.s();!(i=o.n()).done;){var i=i.value;Array.isArray(i)?(3!==i.length&&(n=!1),r="string"==typeof i[0]&&"number"==typeof i[1]&&"number"==typeof i[2]):t=!1}}catch(e){o.e(e)}finally{o.f()}return t&&n&&r}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.allFontsDiffs];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&Array.isArray(e[1])||w.warn("problematic_fonts, FontsDetection - Contract verification failed")}},{key:"getName",value:function getName(){return"problematic_fonts"}}]),ProblematicFontsDetectionContract}();function FontsNotCachedFontsDetectionContract_typeof(e){return(FontsNotCachedFontsDetectionContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function FontsNotCachedFontsDetectionContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function FontsNotCachedFontsDetectionContract_setPrototypeOf(e,t){return(FontsNotCachedFontsDetectionContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function FontsNotCachedFontsDetectionContract_createSuper(r){var n=function FontsNotCachedFontsDetectionContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=FontsNotCachedFontsDetectionContract_getPrototypeOf(r);return function FontsNotCachedFontsDetectionContract_possibleConstructorReturn(e,t){{if(t&&("object"===FontsNotCachedFontsDetectionContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function FontsNotCachedFontsDetectionContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=FontsNotCachedFontsDetectionContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function FontsNotCachedFontsDetectionContract_getPrototypeOf(e){return(FontsNotCachedFontsDetectionContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var oo=function(){!function FontsNotCachedFontsDetectionContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&FontsNotCachedFontsDetectionContract_setPrototypeOf(e,t)}(FontsNotCachedFontsDetectionContract,_n);var r=FontsNotCachedFontsDetectionContract_createSuper(FontsNotCachedFontsDetectionContract);function FontsNotCachedFontsDetectionContract(e){var t;return function FontsNotCachedFontsDetectionContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,FontsNotCachedFontsDetectionContract),(t=r.call(self)).validateParams(e),t.fontListNotCached=e,t}return function FontsNotCachedFontsDetectionContract_createClass(e,t,r){t&&FontsNotCachedFontsDetectionContract_defineProperties(e.prototype,t),r&&FontsNotCachedFontsDetectionContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(FontsNotCachedFontsDetectionContract,[{key:"validateParams",value:function validateParams(e){"string"==typeof e||w.warn(" wrong type in FontsNotCachedFontsDetectionContract parameters. fontListNotCached : {expected: string, received: ".concat(FontsNotCachedFontsDetectionContract_typeof(e),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.fontListNotCached];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"string"==typeof e[1]||w.warn("fonts_not_cached, FontsDetection - Contract verification failed")}},{key:"getName",value:function getName(){return"fonts_not_cached"}}]),FontsNotCachedFontsDetectionContract}();function FontListFontsDetectionContract_typeof(e){return(FontListFontsDetectionContract_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function FontListFontsDetectionContract_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function FontListFontsDetectionContract_setPrototypeOf(e,t){return(FontListFontsDetectionContract_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function FontListFontsDetectionContract_createSuper(r){var n=function FontListFontsDetectionContract_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=FontListFontsDetectionContract_getPrototypeOf(r);return function FontListFontsDetectionContract_possibleConstructorReturn(e,t){{if(t&&("object"===FontListFontsDetectionContract_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function FontListFontsDetectionContract_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=FontListFontsDetectionContract_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function FontListFontsDetectionContract_getPrototypeOf(e){return(FontListFontsDetectionContract_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var io=function(){!function FontListFontsDetectionContract_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&FontListFontsDetectionContract_setPrototypeOf(e,t)}(FontListFontsDetectionContract,_n);var r=FontListFontsDetectionContract_createSuper(FontListFontsDetectionContract);function FontListFontsDetectionContract(e){var t;return function FontListFontsDetectionContract_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,FontListFontsDetectionContract),(t=r.call(self)).validateParams(e),t.fontListCached=e,t}return function FontListFontsDetectionContract_createClass(e,t,r){t&&FontListFontsDetectionContract_defineProperties(e.prototype,t),r&&FontListFontsDetectionContract_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(FontListFontsDetectionContract,[{key:"validateParams",value:function validateParams(e){"string"==typeof e||w.warn(" wrong type in FontListFontsDetectionContract parameters. fontListCached : {expected: string, received: ".concat(FontListFontsDetectionContract_typeof(e),"}"))}},{key:"buildQueueMessage",value:function buildQueueMessage(){var e=[self.getName(),self.fontListCached];return self.validateMessage(e),e}},{key:"validateMessage",value:function validateMessage(e){"string"==typeof e[0]&&"string"==typeof e[1]||w.warn("FontList, FontsDetection - Contract verification failed")}},{key:"getName",value:function getName(){return"fonts"}}]),FontListFontsDetectionContract}();function FontsDetectionFeature_typeof(e){return(FontsDetectionFeature_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function FontsDetectionFeature_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function FontsDetectionFeature_setPrototypeOf(e,t){return(FontsDetectionFeature_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function FontsDetectionFeature_createSuper(r){var n=function FontsDetectionFeature_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=FontsDetectionFeature_getPrototypeOf(r);return function FontsDetectionFeature_possibleConstructorReturn(e,t){{if(t&&("object"===FontsDetectionFeature_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function FontsDetectionFeature_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=FontsDetectionFeature_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function FontsDetectionFeature_getPrototypeOf(e){return(FontsDetectionFeature_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var so={configKey:"isFonts",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!0,shouldRun:!0,isFrameRelated:!1,runInUns:!0,runInSlave:!1,isRunning:!1,instance:null},ao=function(){!function FontsDetectionFeature_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&FontsDetectionFeature_setPrototypeOf(e,t)}(FontsDetectionFeature,de);var i=FontsDetectionFeature_createSuper(FontsDetectionFeature);function FontsDetectionFeature(e,t,r,n){var o;return function FontsDetectionFeature_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,FontsDetectionFeature),(o=i.call(self))._utils=e,o._domUtils=t,o._dataQ=r,o._fontDetectorCtor=n,o._storageKeyName="detectedFonts_2.1.5",o._legacyStorageKeyName="detectedFonts",o._serif_fonts=["adobe jenson","adobe text","albertus","aldus","alexandria","algerian","american typewriter","antiqua","arno","aster","aurora","baskerville","bell","bembo","bembo schoolbook","benguiat","berkeley old style","bernhard modern","bodoni","book antiqua","bookman","bordeaux roman","californian fb","calisto","capitals","cambria","cartier","caslon","caslon antique","catull","centaur","century old style","century schoolbook","new century schoolbook","chaparral","charis sil","cheltenham","clearface","cochin","colonna","computer modern","concrete roman","constantia","cooper black","corona","dejavu fonts","ecotype","elephant","espy serif","excelsior","fairfield","ff scala","footlight","freeserif","friz quadrata","garamond","gentium","georgia","gloucester","goudy old style","goudy schoolbook","goudy pro font","granjon","heather","hercules","high tower text","hiroshige","hoefler text","humana serif","imprint","ionic no. 5","janson","jenson","joanna","korinna","kursivschrift","legacy serif","lexicon","liberation fonts","linux libertine","literaturnaya","lucida","melior","memphis","miller","minion","didone","mona lisa","mrs eaves","ms serif","new york","nimbus roman","nps rawlinson roadway","ocr a extended","palatino","perpetua","plantin","plantin schoolbook","playbill","poor richard","rawlinson roadway","renault","requiem","roman","rotis serif","sabon","seagull","sistina","souvenir","stix","stone informal","stone serif","sylfaen","times new roman","times","trajan","trinité","trump mediaeval","utopia","vale type","bitstream vera","versailles","wanted","weiss","wide latin","windsor","xits","apex","archer","athens","city","cholla slab","clarendon","courier","egyptienne","guardian egyptian","lexia","museo slab","rockwell","nilland","skeleton antique","tower"],o._sans_serif_fonts=["abadi","agency fb","akzidenz grotesk","aptifer","arial","arial unicode ms","avant garde","avenir","bank gothic","barmeno","bauhaus","bell centennial","bell gothic","benguiat gothic","berlin sans","beteckna","brandon grotesque","cabin","cafeteria","calibri","century gothic","charcoal","chicago","clearface gothic","clearview","co headline","co text","compacta","corbel","ff dax","dotum","droid","dyslexie","ecofont","eras","espy sans","nu sans","eurocrat","eurostile","ff meta","flama","formata","freesans","franklin gothic","frutiger","futura","geneva","gill sans","gill sans schoolbook","gotham","handel gothic","denmark","haettenschweiler","hei","helvetica","helvetica neue","swiss 721","highway gothic","hiroshige sans","hobo","impact","industria","interstate","johnston","kabel","lato","legacy sans","lexia readable","meiryo","microgramma","motorway","ms sans serif","museo sans","myriad","neutraface","neuzeit s","news gothic","nimbus sans l","nina","optima","parisine","pricedown","prima sans","pt sans","rail alphabet","revue","roboto","rotis sans","ff scala sans","segoe","skia","souvenir gothic","stone sans","syntax","tahoma","template gothic","tiresias","trade gothic","transport alphabet","trebuchet ms","trump gothic","tw cen","twentieth century","ubuntu font family","univers","zurich","verdana","virtue"],o._monospace_fonts=["andale mono","anonymous","consolas","courierhp","courier new","courierps","fontcraft courier","everson mono","fedra mono","fixed","fixedsys","fixedsys excelsior","inconsolata","hyperfont","letter gothic","magnetic ink character recognition","menlo","miriam fixed","monaco","monofur","monospace","ms gothic","ms mincho","nimbus mono l","ocr-a","ocr-b","orator","ormaxx","pragmatapro","prestige elite","profont","proggy programming fonts","small fonts","sydnie","terminal","tex gyre cursor","um typewriter","william monospace","balloon","brush script","dragonwick","choc","dom casual","mistral","papyrus","tempus sans","amazone","ams euler","apple chancery","aristocrat","bickley script","civitype","codex","edwardian script","forte","french script","kuenstler script","monotype corsiva","old english text mt","palace script","park avenue","scriptina","shelley volante","vivaldi","vladimir script","zapf chancery","zapfino","andy","ashley script","chalkboard","comic sans","cezanne","fontoon","irregularis","jefferson","kristen","lucida handwriting","rage italic","rufscript","scribble","soupbone","tekton","alecko","cinderella","cupola","curlz","magnificat","script","american text","cloister black","fraktur","goudy text","old english text","wedding text","aegyptus","aharoni","aisha","amienne","batak script","chandas","hanacaraka","japanese gothic typeface","jomolhari","kochi font","lontara script","maiola","minchō","mona font","nassim","nastaliq navees","neacademia","perpetua greek","simsun","skolar","skolar devanagari","sundanese unicode","sutturah","tai le valentinium","tengwar","tibetan machine uni","tunga","wadalab","apple symbols","bookshelf symbol 7","braille","commercial pi","corel","erler dingbats","hm phonetic","mathematical pi","morse code","opensymbol","richstyle","symbol","symbolps","wingdings","wingdings 2","wingdings 3","webdings","zapf dingbats","abracadabra","ad lib","allegro","andreas","arnold böcklin","astur","balloon pop outlaw black","banco","beat","braggadocio","broadway","ellington","exablock","exocet","fig script","gigi","harlow solid","harrington","horizon","jim crow","jokerman","juice","lo-type","magneto","megadeth","neuland","peignot","ravie","san francisco","showcard gothic","snap","stencil","umbra","westminster","willow","bagel","lithos","aldhabi","andalus","angsana new","angsanaupc","aparajita","arabic typesetting","arial black","arial narrow","arial rounded mt bold","baskerville old face","batang","batangche","bauhaus 93","bell mt","berlin sans fb","berlin sans fb demi","bernard mt condensed","blackadder itc","bodoni mt","bodoni mt black","bodoni mt condensed","bodoni mt poster compressed","bookman old style","bradley hand itc","britannic bold","browallia new","browalliaupc","brush script mt","buxton sketch","calibri light","calisto mt","cambria math","candara","castellar","century","chiller","colonna mt","comic sans ms","copperplate gothic bold","copperplate gothic light","cordia new","cordiaupc","curlz mt","daunpenh","david","dfkai-sb","dilleniaupc","dokchampa","dotumche","ebrima","edwardian script itc","engravers mt","eras bold itc","eras demi itc","eras light itc","eras medium itc","estrangelo edessa","eucrosiaupc","euphemia","fangsong","felix titling","footlight mt light","franklin gothic book","franklin gothic demi","franklin gothic demi cond","franklin gothic heavy","franklin gothic medium","franklin gothic medium cond","frankruehl","freesiaupc","freestyle script","french script mt","gabriola","gadugi","gautami","gill sans mt","gill sans mt condensed","gill sans mt ext condensed bold","gill sans ultra bold","gill sans ultra bold condensed","gisha","gloucester mt extra condensed","goudy stout","gulim","gulimche","gungsuh","gungsuhche","harlow solid italic","imprint mt shadow","informal roman","irisupc","iskoola pota","jasmineupc","javanese text","juice itc","kaiti","kalinga","kartika","khmer ui","kodchiangupc","kokila","kristen itc","kunstler script","lao ui","latha","leelawadee","leelawadee ui","leelawadee ui semilight","levenim mt","lilyupc","lucida bright","lucida calligraphy","lucida console","lucida fax","lucida sans","lucida sans typewriter","lucida sans unicode","maiandra gd","malgun gothic","mangal","marlett","matura mt script capitals","meiryo ui","microsoft himalaya","microsoft jhenghei","microsoft jhenghei light","microsoft jhenghei ui","microsoft jhenghei ui light","microsoft new tai lue","microsoft phagspa","microsoft sans serif","microsoft tai le","microsoft uighur","microsoft yahei","microsoft yahei light","microsoft yahei ui","microsoft yahei ui light","microsoft yi baiti","mingliu","mingliu-extb","mingliu_hkscs","mingliu_hkscs-extb","miriam","modern","modern no. 20","mongolian baiti","moolboran","ms outlook","ms pgothic","ms pmincho","ms reference sans serif","ms reference specialty","ms ui gothic","mt extra","mv boli","myanmar text","narkisim","niagara engraved","niagara solid","nirmala ui","nirmala ui semilight","nsimsun","nyala","onyx","palace script mt","palatino linotype","parchment","perpetua titling mt","plantagenet cherokee","pmingliu","pmingliu-extb","pristina","raavi","rockwell condensed","rockwell extra bold","rod","sakkal majalla","script mt bold","segoe marker","segoe print","segoe script","segoe ui","segoe ui black","segoe ui emoji","segoe ui light","segoe ui semibold","segoe ui semilight","segoe ui symbol","shonar bangla","shruti","simhei","simplified arabic","simplified arabic fixed","simsun-extb","sitka banner","sitka display","sitka heading","sitka small","sitka subheading","sitka text","sketchflow print","snap itc","system","tempus sans itc","traditional arabic","tw cen mt","tw cen mt condensed","tw cen mt condensed extra bold","urdu typesetting","utsaah","vani","vijaya","viner hand itc","vrinda","yu gothic","yu gothic light","yu mincho","yu mincho demibold","yu mincho light"],o}return function FontsDetectionFeature_createClass(e,t,r){t&&FontsDetectionFeature_defineProperties(e.prototype,t),r&&FontsDetectionFeature_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(FontsDetectionFeature,[{key:"startFeature",value:function startFeature(){var t=self;w.info("Collecting Fonts");var r=(r=self._utils.StorageUtils.getFromLocalStorage(self._storageKeyName))||self._utils.StorageUtils.getFromLocalStorage(self._legacyStorageKeyName),n=self._utils.StorageUtils.getFromLocalStorage(self._legacyStorageKeyName,!1);n&&w.info("Detected legacy fonts data in the local storage. Will send them to server."),r&&self._utils.StorageUtils.saveToLocalStorage(self._storageKeyName,r),self._detectFonts(function(e){(!r||600<=r.split(",").length)&&(r=e,t._utils.StorageUtils.saveToLocalStorage(t._storageKeyName,r)),t._updateFonts(r,e,n),w.info("Fonts collected")})}},{key:"_detectFonts",value:function _detectFonts(o){var e=self;self._domUtils.onDocumentBody(window,function(){var n=new e._fontDetectorCtor(e._domUtils);n.init(function(){var t,r=e;r._utils.asyncCall.call(n.detectByChunksWithIndex,n,r._serif_fonts,2,function(e){t=e,r._utils.asyncCall.call(n.detectByChunksWithIndex,n,r._sans_serif_fonts,1,function(e){t=t.concat(e),r._utils.asyncCall.call(n.detectByChunksWithIndex,n,r._monospace_fonts,0,function(e){600<=(t=t.concat(e)).length?(e=n.getAllFontsDiffs(),e=new no(e).buildQueueMessage(),r._dataQ.addToQueue("static_fields",e,!1)):o(t.toString()),n.clear()})})})})})}},{key:"_updateFonts",value:function _updateFonts(e,t,r){e=new io(e).buildQueueMessage();self._dataQ.addToQueue("static_fields",e,!1);t=new oo(t).buildQueueMessage();self._dataQ.addToQueue("static_fields",t,!1),r&&(r=new ro(r).buildQueueMessage(),self._dataQ.addToQueue("static_fields",r,!1))}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return so}}]),FontsDetectionFeature}();function ContextPropsFeature_typeof(e){return(ContextPropsFeature_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ContextPropsFeature_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ContextPropsFeature_setPrototypeOf(e,t){return(ContextPropsFeature_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function ContextPropsFeature_createSuper(r){var n=function ContextPropsFeature_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=ContextPropsFeature_getPrototypeOf(r);return function ContextPropsFeature_possibleConstructorReturn(e,t){{if(t&&("object"===ContextPropsFeature_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return ContextPropsFeature_assertThisInitialized(e)}(self,n?(e=ContextPropsFeature_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function ContextPropsFeature_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function ContextPropsFeature_getPrototypeOf(e){return(ContextPropsFeature_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var uo={configKey:"isContextPropsFeature",isDefault:!1,shouldRunPerContext:!0,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!1,runInUns:!0,runInSlave:!1,isRunning:!1,instance:null},co=function(){!function ContextPropsFeature_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ContextPropsFeature_setPrototypeOf(e,t)}(ContextPropsFeature,de);var o=ContextPropsFeature_createSuper(ContextPropsFeature);function ContextPropsFeature(e,t,r){var n;return function ContextPropsFeature_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ContextPropsFeature),(n=o.call(self))._dataQ=e,n._domUtils=t,n._perfMonitor=r,n._observerCallback=n._observerCallback.bind(ContextPropsFeature_assertThisInitialized(n)),n.calcTime=n.calcTime.bind(ContextPropsFeature_assertThisInitialized(n)),n._getEntriesByType=n._getEntriesByType.bind(ContextPropsFeature_assertThisInitialized(n)),n}return function ContextPropsFeature_createClass(e,t,r){t&&ContextPropsFeature_defineProperties(e.prototype,t),r&&ContextPropsFeature_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ContextPropsFeature,[{key:"startFeature",value:function startFeature(){var e,t;self.screen&&(e=window.devicePixelRatio||-1,t=window.devicePixelRatio||-1,self._dataQ.addToQueue("static_fields",["display",[screen.colorDepth,screen.width,screen.height,screen.availHeight||-1,screen.availWidth||-1,e,t]],!1)),self.reportPageLoadTime()}},{key:"_observerCallback",value:function _observerCallback(e,t){e=e.getEntries()[0];e.duration&&(self.calcTime(e),"disconnect"in t&&t.disconnect())}},{key:"_isEntrySupportedByBrowser",value:function _isEntrySupportedByBrowser(e){return!("supportedEntryTypes"in window.PerformanceObserver)||PerformanceObserver.supportedEntryTypes.includes(e)}},{key:"_getEntriesByType",value:function _getEntriesByType(){var e;window.performance.timing&&window.performance.timing.loadEventEnd&&window.performance.timing.navigationStart&&(e={duration:window.performance.timing.loadEventEnd-window.performance.timing.navigationStart},self.calcTime(e))}},{key:"calcTime",value:function calcTime(e){S.isUndefinedNull(e)?w.warn("Context Props Feature: no entries of navigation timing were captured"):S.isUndefinedNull(e)||!S.isUndefinedNull(e.duration)?self._perfMonitor.reportMonitor("t.timeTillPageLoad",Math.round(e.duration)):w.warn("Context Props Feature: page duration loading was not calculated")}},{key:"reportPageLoadTime",value:function reportPageLoadTime(){if(window.performance&&"PerformanceNavigationTiming"in window){var e="navigation";if("PerformanceObserver"in window&&self._isEntrySupportedByBrowser(e)){var t=new PerformanceObserver(self._observerCallback);try{t.observe({type:e,buffered:!0})}catch(e){self.reportPageLoadTimeFallback()}}else self.reportPageLoadTimeFallback()}else self.reportPageLoadTimeFallback()}},{key:"reportPageLoadTimeFallback",value:function reportPageLoadTimeFallback(){var e=self;Rt.isWindowDocumentReady(window)?S.asyncCall.call(self._getEntriesByType):S.addEventListener(self,"load",function(){S.asyncCall.call(e._getEntriesByType)})}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return uo}}]),ContextPropsFeature}();function ScriptsFeature_typeof(e){return(ScriptsFeature_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ScriptsFeature_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ScriptsFeature_setPrototypeOf(e,t){return(ScriptsFeature_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function ScriptsFeature_createSuper(r){var n=function ScriptsFeature_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=ScriptsFeature_getPrototypeOf(r);return function ScriptsFeature_possibleConstructorReturn(e,t){{if(t&&("object"===ScriptsFeature_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return ScriptsFeature_assertThisInitialized(e)}(self,n?(e=ScriptsFeature_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function ScriptsFeature_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function ScriptsFeature_getPrototypeOf(e){return(ScriptsFeature_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var lo={configKey:"isScriptsFeature",isDefault:!1,shouldRunPerContext:!0,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!1,runInUns:!0,runInSlave:!1,isRunning:!1,instance:null},fo=function(){!function ScriptsFeature_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ScriptsFeature_setPrototypeOf(e,t)}(ScriptsFeature,de);var n=ScriptsFeature_createSuper(ScriptsFeature);function ScriptsFeature(e,t){var r;return function ScriptsFeature_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ScriptsFeature),(r=n.call(self))._dataQ=e,r._timeoutValue=1e3,r._scriptsRepository=t,r._runDetectionLoopBinded=r._runDetectionLoop.bind(ScriptsFeature_assertThisInitialized(r)),r}return function ScriptsFeature_createClass(e,t,r){t&&ScriptsFeature_defineProperties(e.prototype,t),r&&ScriptsFeature_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ScriptsFeature,[{key:"_checkScriptsData",value:function _checkScriptsData(){for(var e=document.scripts,t=0;t<e.length;t++){var r={src:e[t].src,text:e[t].text};self._scriptsRepository.exists(r)||(self._scriptsRepository.add(r),self._dataQ.addToQueue("scripts",[null,r.src,r.textHash]))}}},{key:"_runDetectionLoop",value:function _runDetectionLoop(){self._checkScriptsData(),self._timer=setTimeout(self._runDetectionLoopBinded,self._timeoutValue),self._timeoutValue<536870911&&(self._timeoutValue*=4)}},{key:"startFeature",value:function startFeature(){self._runDetectionLoop()}},{key:"stopFeature",value:function stopFeature(){self._timer&&clearTimeout(self._timer)}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return lo}}]),ScriptsFeature}();function FilesFeature_typeof(e){return(FilesFeature_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function FilesFeature_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function FilesFeature_setPrototypeOf(e,t){return(FilesFeature_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function FilesFeature_createSuper(r){var n=function FilesFeature_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=FilesFeature_getPrototypeOf(r);return function FilesFeature_possibleConstructorReturn(e,t){{if(t&&("object"===FilesFeature_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function FilesFeature_assertThisInitialized(e){if(void 0!==e)return e;throw new ReferenceError("self hasn't been initialised - super() hasn't been called")}(e)}(self,n?(e=FilesFeature_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function FilesFeature_getPrototypeOf(e){return(FilesFeature_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var po={configKey:"isFilesFeature",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!0,shouldRun:!0,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,instance:null},ho=function(){!function FilesFeature_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&FilesFeature_setPrototypeOf(e,t)}(FilesFeature,de);var s=FilesFeature_createSuper(FilesFeature);function FilesFeature(e,t,r,n,o){var i;return function FilesFeature_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,FilesFeature),(i=s.call(self))._utils=t,i._configurationRepository=e,i._sessionService=r,i._muidMgr=n,i._cidCache=o,i}return function FilesFeature_createClass(e,t,r){t&&FilesFeature_defineProperties(e.prototype,t),r&&FilesFeature_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(FilesFeature,[{key:"getFiles",value:function getFiles(){if(self._customerId&&self._muid&&self._sid&&self._addrList&&0<self._addrList.length)for(var e,t=0;t<self._addrList.length;t++)e=self._addrList[t]+"?cid="+self._customerId+"&snum="+self._sid+"&muid="+self._muid,self._utils.getPostUrl(e,"GET",null,null,null),self._isSent=!0}},{key:"startFeature",value:function startFeature(){self._isSent=!1;try{self._addrList=JSON.parse(self._configurationRepository.get("getAddrList"))}catch(e){self._addrList=""}self._customerId=self._cidCache.get()||"",self._muid=self._muidMgr.muid||"",self._sid=self._sessionService.sessionId||"",self.getFiles()}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){try{self._addrList=JSON.parse(self._configurationRepository.get("getAddrList"))}catch(e){self._addrList=""}self._customerId=self._cidCache.get()||"",self._muid=self._muidMgr.muid||"",self._sid=self._sessionService.sessionId||"",self._isSent||self.getFiles()}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return po}}]),FilesFeature}();function MetadataCollector_typeof(e){return(MetadataCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function MetadataCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function MetadataCollector_setPrototypeOf(e,t){return(MetadataCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function MetadataCollector_createSuper(r){var n=function MetadataCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=MetadataCollector_getPrototypeOf(r);return function MetadataCollector_possibleConstructorReturn(e,t){{if(t&&("object"===MetadataCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return MetadataCollector_assertThisInitialized(e)}(self,n?(e=MetadataCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function MetadataCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function MetadataCollector_getPrototypeOf(e){return(MetadataCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var vo={configKey:"isMetadataCollect",isDefault:!0,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!1,runInSlave:!0,runInUns:!1,isRunning:!1,instance:null},yo=function(){!function MetadataCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&MetadataCollector_setPrototypeOf(e,t)}(MetadataCollector,de);var i=MetadataCollector_createSuper(MetadataCollector);function MetadataCollector(e,t,r,n){var o;return function MetadataCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,MetadataCollector),(o=i.call(self))._configurationRepository=e,o._dataQ=t,o._metaDataSiteMapper=r,o._utils=n,o._metaDataSiteMapper.updateObserver(o.onSiteMapperMatch.bind(MetadataCollector_assertThisInitialized(o))),o}return function MetadataCollector_createClass(e,t,r){t&&MetadataCollector_defineProperties(e.prototype,t),r&&MetadataCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(MetadataCollector,[{key:"startFeature",value:function startFeature(){self._metaDataSiteMapper.initTracking()}},{key:"stopFeature",value:function stopFeature(){self._metaDataSiteMapper.stopTracking()}},{key:"onSiteMapperMatch",value:function onSiteMapperMatch(e){w.debug("Metadata Collector mapper match - ".concat(JSON.stringify(e))),e.metaVal&&self._dataQ.addToQueue("metadata_map",[null,e.metaVal,self._utils.dateNow()])}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){self._metaDataSiteMapper.onConfigUpdate(self._configurationRepository)}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){return vo}}]),MetadataCollector}(),_o=null,go=null,mo=null,bo=null;function _bindInputEvents(e){_o.removeElementEvents(e),_o.addElementEvents(e,!0)}function _bindOnClickEvents(e){go.removeElementEvents(e),go.addElementEvents(e,!0)}function _bindOnChangeEvents(e){mo.removeElementEvents(e),mo.addElementEvents(e,!0)}function _bindOnFormsEvents(e){bo.removeElementEvents(e),bo.addElementEvents(e,!0)}function CrossDomainMuidCollector_ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function CrossDomainMuidCollector_objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?CrossDomainMuidCollector_ownKeys(Object(r),!0).forEach(function(e){CrossDomainMuidCollector_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):CrossDomainMuidCollector_ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function CrossDomainMuidCollector_typeof(e){return(CrossDomainMuidCollector_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function CrossDomainMuidCollector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function CrossDomainMuidCollector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function CrossDomainMuidCollector_createClass(e,t,r){return t&&CrossDomainMuidCollector_defineProperties(e.prototype,t),r&&CrossDomainMuidCollector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function CrossDomainMuidCollector_setPrototypeOf(e,t){return(CrossDomainMuidCollector_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function CrossDomainMuidCollector_createSuper(r){var n=function CrossDomainMuidCollector_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=CrossDomainMuidCollector_getPrototypeOf(r);return function CrossDomainMuidCollector_possibleConstructorReturn(e,t){{if(t&&("object"===CrossDomainMuidCollector_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return CrossDomainMuidCollector_assertThisInitialized(e)}(self,n?(e=CrossDomainMuidCollector_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function CrossDomainMuidCollector_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function CrossDomainMuidCollector_getPrototypeOf(e){return(CrossDomainMuidCollector_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function CrossDomainMuidCollector_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Co={configKey:"isCrossdomain",isDefault:!1,shouldRunPerContext:!1,shouldRunPerSession:!1,shouldRun:!0,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,instance:null},wo={found:0,new:1},Eo=/(?=(child\-src)|(frame\-src))([^;]+)/gi,Po=/http[s]?:\/\/([^\/]+)/gi,So={resource:null,iframeElement:!1,blockedByCSP:!1,iframeLoaded:!1,ACKMessageSent:!1,ACKMessageRecieved:!1,unavailable:!1},ko=["eventSequence","timestamp","eventType","domainUrl","muid"],Oo=function(){!function CrossDomainMuidCollector_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&CrossDomainMuidCollector_setPrototypeOf(e,t)}(CrossDomainMuidCollector,de);var t=CrossDomainMuidCollector_createSuper(CrossDomainMuidCollector);function CrossDomainMuidCollector(e){var i;return CrossDomainMuidCollector_classCallCheck(self,CrossDomainMuidCollector),CrossDomainMuidCollector_defineProperty(CrossDomainMuidCollector_assertThisInitialized(i=t.call(self)),"startFeature",function(e){i._domainsResources=i._configurationRepository.get(C.crossDomainsList),i._crossDomainsTimeout=i._configurationRepository.get(C.crossDomainsTimeout),Array.isArray(i._domainsResources)&&0<i._domainsResources.length&&(i._windowMessageEmitter.startObserver(e),i._domainsResources.forEach(function(e){var t=e.match(Po);null!==t&&"string"==typeof t[0]&&(t=t[0],"object"!==CrossDomainMuidCollector_typeof(i._domainsStates[t])&&(i._domainsStates[t]=CrossDomainMuidCollector_objectSpread({},So),i._domainsStates[t].resource=e,i._domains.push(t)))}),Array.isArray(i._domains)&&0<i._domains.length&&(i.isBlockedByCSP(e,i._domains),i._domUtils.onDocumentBody(e.Context,function(){i.connectDomains(e)})))}),CrossDomainMuidCollector_defineProperty(CrossDomainMuidCollector_assertThisInitialized(i),"stopFeature",function(e){i._clearFeaturesObjects(e)}),CrossDomainMuidCollector_defineProperty(CrossDomainMuidCollector_assertThisInitialized(i),"_clearFeaturesObjects",function(t){i._windowMessageEmitter.stopObserver(t),Array.isArray(i._domains)&&0<i._domains.length&&(i._domains.forEach(function(e){i.clearDomElements(t,e)}),i._domains=[],i._domainsStates={})}),CrossDomainMuidCollector_defineProperty(CrossDomainMuidCollector_assertThisInitialized(i),"connectDomains",function(t){Array.isArray(i._domains)&&0<i._domains.length&&(i._domains.forEach(function(e){i._domainsStates[e].blockedByCSP||!1!==i._domainsStates[e].iframeElement||i.createIframe(t,e)}),i._domainsTimeoutFunc=setTimeout(function(){i._domains.forEach(function(e){"object"===CrossDomainMuidCollector_typeof(i._domainsStates[e])&&!1===i._domainsStates[e].ACKMessageRecieved&&!1===i._domainsStates[e].unavailable&&(w.warn("Cross Domain feature - domain ".concat(e," is unavailable")),i._domainsStates[e].unavailable=!0,i.clearDomElements(t,e))})},i._crossDomainsTimeout))}),CrossDomainMuidCollector_defineProperty(CrossDomainMuidCollector_assertThisInitialized(i),"createIframe",function(e,t){var r=e.getDocument().createElement("iframe");r.onload=function(){i.postNextMessage(t)},r.id=Re.ignorePrefixFrame+CrossDomainMuidCollector.generateRandomID(),r.src=i._domainsStates[t].resource,r.style.display="none",r.style.opacity="0",r.width="1",r.height="1",e.getDocument().body.appendChild(r),i._domainsStates[t].iframeElement=r}),CrossDomainMuidCollector_defineProperty(CrossDomainMuidCollector_assertThisInitialized(i),"clearDomElements",function(e,t){var r=i._domainsStates[t].iframeElement;"object"===CrossDomainMuidCollector_typeof(r)&&null!==e.getDocument().getElementById(i._domainsStates[t].iframeElement.id)&&e.getDocument().body.removeChild(r)}),CrossDomainMuidCollector_defineProperty(CrossDomainMuidCollector_assertThisInitialized(i),"postNextMessage",function(e){var t;!i._domainsStates[e].ACKMessageRecieved&&i._domainsStates[e].iframeElement&&(t={muid:i._generatedMUID},i._domainsStates[e].iframeElement.contentWindow.postMessage(JSON.stringify(t),e),i._domainsStates[e].ACKMessageSent=!0)}),CrossDomainMuidCollector_defineProperty(CrossDomainMuidCollector_assertThisInitialized(i),"isBlockedByCSP",function(e,r){if(!Array.isArray(r)||r.length<1)throw new Error("Domains are expected for content security policy assertion");var n=!1;[].slice.call(e.getDocument().getElementsByTagName("meta")).forEach(function(e){var t;if("Content-Security-Policy"===e.getAttribute("http-equiv")&&(n=!0,t=e.getAttribute("content").match(Eo),r.forEach(function(e){t&&-1===t[0].indexOf(e)&&"object"===CrossDomainMuidCollector_typeof(i._domainsStates[e])&&(i._domainsStates[e].blockedByCSP=!0,w.warn("Cross Domain feature - domain ".concat(e," is blocked by CSP")))})),n)return!1})}),CrossDomainMuidCollector_defineProperty(CrossDomainMuidCollector_assertThisInitialized(i),"windowMessageHandler",function(e){var t=e.message.origin;i._domainsStates.hasOwnProperty(t)&&!0!==i._domainsStates[t].ACKMessageRecieved&&(i._domainsStates[t].ACKMessageRecieved=!0,i.clearDomElements(new Te(e.message.currentTarget),t),e=e.message.data,i.sendToQueue(t,e))}),CrossDomainMuidCollector_defineProperty(CrossDomainMuidCollector_assertThisInitialized(i),"sendToQueue",function(e,n){var o=e.replace(/http[s]?:\/\//i,"");"object"===CrossDomainMuidCollector_typeof(n.found)&&Object.keys(n.found).forEach(function(e){var t=i._utils.StorageUtils.getAndUpdateEventSequenceNumber(),r=o,e=n.found[e].split("__"),e={eventType:i._eventType.found,eventSequence:t,domainUrl:r,muid:e[0],timestamp:e[1]};i._dataQ.addToQueue("crossmuid_event",i._utils.convertToArrayByMap(ko,e),!0)}),"object"===CrossDomainMuidCollector_typeof(n.new)&&Object.keys(n.new).forEach(function(e){var t=i._utils.StorageUtils.getAndUpdateEventSequenceNumber(),r=o,e=n.new[e].split("__"),e={eventType:i._eventType.new,eventSequence:t,domainUrl:r,muid:e[0],timestamp:e[1]};i._dataQ.addToQueue("crossmuid_event",i._utils.convertToArrayByMap(ko,e))}),"object"===CrossDomainMuidCollector_typeof(n.error_message)&&w.warn("Cross Domain feature - domain ".concat(o," error. Error Message: \n                ").concat(n.error_message," Code: ").concat(n.error_code))}),CrossDomainMuidCollector_defineProperty(CrossDomainMuidCollector_assertThisInitialized(i),"updateFeatureConfig",function(e){i._domainsResources=i._configurationRepository.get(C.crossDomainsList),i._crossDomainsTimeout=i._configurationRepository.get(C.crossDomainsTimeout),clearTimeout(i._domainsTimeoutFunc),i._domainsTimeoutFunc=null,i.updateDomainStates(e)}),CrossDomainMuidCollector_defineProperty(CrossDomainMuidCollector_assertThisInitialized(i),"updateDomainStates",function(e){Array.isArray(i._domainsResources)&&0<i._domainsResources.length&&(i._domains=[],i._domainsResources.forEach(function(e){var t=e.match(Po);null!==t&&"string"==typeof t[0]&&(t=t[0],"object"!==CrossDomainMuidCollector_typeof(i._domainsStates[t])&&(i._domainsStates[t]=CrossDomainMuidCollector_objectSpread({},So),i._domainsStates[t].resource=e),i._domains.push(t))}),Array.isArray(i._domains)&&0<i._domains.length&&(i.isBlockedByCSP(e,i._domains),i._domUtils.onDocumentBody(e.Context,function(){i.connectDomains(e)})))}),i._configurationRepository=e.configurationRepository,i._dataQ=e.dataQ,i._utils=e.utils,i._domUtils=e.domUtils,i._eventType=e.eventType,i._messageBus=e.messageBus,i._windowMessageEmitter=e.windowMessageEventEmitter,i._messageBus.subscribe(fe.WindowMessageEvent,i.windowMessageHandler),i._generatedMUID=i._utils.dateNow()+"-"+i._utils.generateUUID().toUpperCase(),i._domainsStates={},i._domainsResources=[],i._domains=[],i._domainsTimeoutFunc=null,i}return CrossDomainMuidCollector_createClass(CrossDomainMuidCollector,null,[{key:"getDefaultSettings",value:function getDefaultSettings(){return Co}},{key:"Builder",get:function get(){return function(){function Builder(e,t,r,n,o){CrossDomainMuidCollector_classCallCheck(self,Builder),self.configurationRepository=e,self.dataQ=t,self.utils=r,self.domUtils=n,self.eventType=o}return CrossDomainMuidCollector_createClass(Builder,[{key:"withMessageBus",value:function withMessageBus(e){return self.messageBus=e,self}},{key:"withWindowMessageEventEmitter",value:function withWindowMessageEventEmitter(e){return self.windowMessageEventEmitter=e,self}},{key:"build",value:function build(){return new CrossDomainMuidCollector(self)}}]),Builder}()}},{key:"generateRandomID",value:function generateRandomID(){for(var e="abcdefghijklmnopqrstuvwxyz0123456789",t="",r=0;r<16;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}}]),CrossDomainMuidCollector}();function Event_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Bo=function(){function Event(){!function Event_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,Event)}return function Event_createClass(e,t,r){t&&Event_defineProperties(e.prototype,t),r&&Event_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(Event,[{key:"getEventTimestamp",value:function getEventTimestamp(){return S.dateNow()}},{key:"getTimestampFromEvent",value:function getTimestampFromEvent(e){return e.timeStamp?S.cutDecimalPointDigits(e.timeStamp,3):0}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){}}]),Event}();function InputEvents_typeof(e){return(InputEvents_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function InputEvents_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function InputEvents_setPrototypeOf(e,t){return(InputEvents_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function InputEvents_createSuper(r){var n=function InputEvents_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=InputEvents_getPrototypeOf(r);return function InputEvents_possibleConstructorReturn(e,t){{if(t&&("object"===InputEvents_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return InputEvents_assertThisInitialized(e)}(self,n?(e=InputEvents_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function InputEvents_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function InputEvents_getPrototypeOf(e){return(InputEvents_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function InputEvents_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function re(s){return{applyAction:function _applyAction(e,t,r){if(!["start","stop"].includes(t))return!1;for(var n=[],o=e.getDocument().querySelectorAll(Mo),i=0;i<o.length;i++)n.push(o[i]);0<n.length&&s[t](n,e.Context,r)}}}var Mo="input:not([type='color']):not([type='hidden']):not([type='file']):not([type='image']):not([type='button']):not([type='radio']):not([type='checkbox']), textarea",Ro=function(){!function InputEvents_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&InputEvents_setPrototypeOf(e,t)}(InputEvents,Bo);var c=InputEvents_createSuper(InputEvents);function InputEvents(e,t,r,n,o,i,s,a){var u;return function InputEvents_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,InputEvents),InputEvents_defineProperty(InputEvents_assertThisInitialized(u=c.call(self)),"handleInputEvents",function(e){"InputEvent"===e.constructor.name&&u._inputEventsPerElement.set(e.target,{});var t=e.target.value||"";""!==t&&(t=u._maskingService.maskText(t)),u._sendToQueue(e,{length:t?t.length:0,elementValues:t,selected:-1})}),InputEvents_defineProperty(InputEvents_assertThisInitialized(u),"handleFocusBlurEvents",function(e){u._sendToQueue(e,{length:0,selected:-1,elementValues:""})}),InputEvents_defineProperty(InputEvents_assertThisInitialized(u),"handleSyntheticInputEvents",function(e){var t;u._inputEventsPerElement.has(e.target)&&(void 0===e.jQueryMask||"autotab"!==e.jQueryMask&&"prasleyValidator"!==e.jQueryMask)||(""!==(t=e.target.value||"")&&(t=u._maskingService.maskText(t)),u._sendToQueue(e,{length:t?t.length:0,elementValues:t,selected:-1}))}),u._elements=e,u._sendToQueue=t,u._messageBus=n,u._CDUtils=r,u._StandardInputEventsEmitter=o,u._SyntheticMaskInputEventsHandler=i,u._SyntheticAutotabInputEventsHandler=s,u._maskingService=a,u._inputEventsPerElement=new WeakMap,u}return function InputEvents_createClass(e,t,r){t&&InputEvents_defineProperties(e.prototype,t),r&&InputEvents_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(InputEvents,[{key:"bind",value:function bind(e){self._messageBus.subscribe(fe.StandardInputEvent,self.handleInputEvents),self._messageBus.subscribe(fe.StandardInputFocusEvent,self.handleFocusBlurEvents),self._messageBus.subscribe(fe.StandardInputBlurEvent,self.handleFocusBlurEvents),self._messageBus.subscribe(fe.SyntheticInputMaskEvent,self.handleSyntheticInputEvents),re(self._StandardInputEventsEmitter).applyAction(e,"start"),re(self._SyntheticMaskInputEventsHandler).applyAction(e,"start"),re(self._SyntheticAutotabInputEventsHandler).applyAction(e,"start")}},{key:"unbind",value:function unbind(e){re(self._StandardInputEventsEmitter).applyAction(e,"stop"),re(self._SyntheticMaskInputEventsHandler).applyAction(e,"stop"),re(self._SyntheticAutotabInputEventsHandler).applyAction(e,"stop"),self._messageBus.unsubscribe(fe.StandardInputEvent,self.handleInputEvents),self._messageBus.unsubscribe(fe.StandardInputFocusEvent,self.handleFocusBlurEvents),self._messageBus.unsubscribe(fe.StandardInputBlurEvent,self.handleFocusBlurEvents),self._messageBus.unsubscribe(fe.SyntheticInputMaskEvent,self.handleSyntheticInputEvents)}},{key:"addOnLoadInputData",value:function addOnLoadInputData(e,t){for(var r=e.getDocument().querySelectorAll(Mo),n=0;n<r.length;n++){var o=r[n];self._elements.isListed(o)?t||self._elements.resendElementPerContext(o):self._elements.getElement(o,!1)}}}]),InputEvents}();function ClickEvents_typeof(e){return(ClickEvents_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ClickEvents_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ClickEvents_setPrototypeOf(e,t){return(ClickEvents_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function ClickEvents_createSuper(r){var n=function ClickEvents_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=ClickEvents_getPrototypeOf(r);return function ClickEvents_possibleConstructorReturn(e,t){{if(t&&("object"===ClickEvents_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return ClickEvents_assertThisInitialized(e)}(self,n?(e=ClickEvents_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function ClickEvents_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function ClickEvents_getPrototypeOf(e){return(ClickEvents_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Do="input[type='button'], input[type='radio'], input[type='checkbox'], button",Fo=function(){!function ClickEvents_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ClickEvents_setPrototypeOf(e,t)}(ClickEvents,Bo);var s=ClickEvents_createSuper(ClickEvents);function ClickEvents(e,t,r,n,o){var i;return function ClickEvents_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ClickEvents),function ClickEvents_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(ClickEvents_assertThisInitialized(i=s.call(self)),"handleOnClickEvents",function(e){var t=e.target,r=t.value||t.innerHTML||"",r=i._shouldMaskValueField?i._CDUtils.maskText(r):i._CDUtils.clearTextFromNumbers(r);i._sendToQueue(e,{length:r.length,elementValues:r,selected:void 0===t.checked?-1:t.checked?1:0})}),i._sendToQueue=e,i._CDUtils=t,i._messageBus=r,i._StandardOnClickEventsEmitter=o,i._configurationRepository=n,i._shouldMaskValueField=n.get(C.shouldMaskClickEventValueField),i}return function ClickEvents_createClass(e,t,r){t&&ClickEvents_defineProperties(e.prototype,t),r&&ClickEvents_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ClickEvents,[{key:"bind",value:function bind(e){e=e.getDocument();self._messageBus.subscribe(fe.StandardOnClickEvent,self.handleOnClickEvents),self.addListenersBySelector(e)}},{key:"unbind",value:function unbind(e){for(var t=[],r=e.getDocument().querySelectorAll(Do),n=0;n<r.length;n++)t.push(r[n]);self._StandardOnClickEventsEmitter.stop(t),self._messageBus.unsubscribe(fe.StandardOnClickEvent,self.handleOnClickEvents)}},{key:"addListenersBySelector",value:function addListenersBySelector(e){for(var t=[],r=e.querySelectorAll(Do),n=0;n<r.length;n++)t.push(r[n]);self._StandardOnClickEventsEmitter.start(t)}},{key:"updateSettings",value:function updateSettings(){self._shouldMaskValueField=self._configurationRepository.get(C.shouldMaskClickEventValueField)}}]),ClickEvents}();function SelectElementEvents_typeof(e){return(SelectElementEvents_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function SelectElementEvents_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function SelectElementEvents_setPrototypeOf(e,t){return(SelectElementEvents_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function SelectElementEvents_createSuper(r){var n=function SelectElementEvents_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=SelectElementEvents_getPrototypeOf(r);return function SelectElementEvents_possibleConstructorReturn(e,t){{if(t&&("object"===SelectElementEvents_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return SelectElementEvents_assertThisInitialized(e)}(self,n?(e=SelectElementEvents_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function SelectElementEvents_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function SelectElementEvents_getPrototypeOf(e){return(SelectElementEvents_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function SelectElementEvents_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var To=function(){!function SelectElementEvents_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&SelectElementEvents_setPrototypeOf(e,t)}(SelectElementEvents,Bo);var u=SelectElementEvents_createSuper(SelectElementEvents);function SelectElementEvents(e,t,r,n,o,i,s){var a;return function SelectElementEvents_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,SelectElementEvents),SelectElementEvents_defineProperty(SelectElementEvents_assertThisInitialized(a=u.call(self)),"handleOnChangeEvents",function(e){var t=a._CDUtils.getDropDownListValues(e.target).join(";"),t=a._CDUtils.clearTextFromNumbers(t),r=e.target.selectedIndex,n=e.target.value.length;a._sendToQueue(e,{length:n,selected:r,elementValues:t})}),SelectElementEvents_defineProperty(SelectElementEvents_assertThisInitialized(a),"handleBlurEvent",function(e){a._sendToQueue(e,{length:0,selected:-1,elementValues:""})}),SelectElementEvents_defineProperty(SelectElementEvents_assertThisInitialized(a),"handleFocusEvent",function(e){a._sendToQueue(e,{length:0,selected:-1,elementValues:""})}),a._sendToQueue=e,a._CDUtils=t,a._messageBus=r,a._StandardOnChangeEventsEmitter=n,a._elementFocusEventEmitter=o,a._elementBlurEventEmitter=i,a._configurationRepository=s,a._collectSelectElementBlurAndFocusEvents=a._configurationRepository.get(C.collectSelectElementBlurAndFocusEvents),a}return function SelectElementEvents_createClass(e,t,r){t&&SelectElementEvents_defineProperties(e.prototype,t),r&&SelectElementEvents_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(SelectElementEvents,[{key:"bind",value:function bind(e){e=e.getDocument();self._messageBus.subscribe(fe.StandardOnSelectEvent,self.handleOnChangeEvents),self._messageBus.subscribe(fe.ElementFocusEvent,self.handleFocusEvent),self._messageBus.subscribe(fe.ElementBlurEvent,self.handleBlurEvent),self.addListenersBySelector(e)}},{key:"unbind",value:function unbind(e){e=e.getDocument(),e=self._getSelectElementsFromDoc(e);self._StandardOnChangeEventsEmitter.stop(e),self._elementFocusEventEmitter.stop(e),self._elementBlurEventEmitter.stop(e),self._messageBus.unsubscribe(fe.StandardOnSelectEvent,self.handleOnChangeEvents),self._messageBus.unsubscribe(fe.ElementFocusEvent,self.handleFocusEvent),self._messageBus.unsubscribe(fe.ElementBlurEvent,self.handleBlurEvent)}},{key:"addListenersBySelector",value:function addListenersBySelector(e){e=self._getSelectElementsFromDoc(e);self._StandardOnChangeEventsEmitter.start(e),self._collectSelectElementBlurAndFocusEvents&&(self._elementFocusEventEmitter.start(e),self._elementBlurEventEmitter.start(e))}},{key:"updateSettings",value:function updateSettings(e){self._collectSelectElementBlurAndFocusEvents=self._configurationRepository.get(C.collectSelectElementBlurAndFocusEvents),self._collectSelectElementBlurAndFocusEvents||(e=e.getDocument(),e=self._getSelectElementsFromDoc(e),self._elementFocusEventEmitter.stop(e),self._elementBlurEventEmitter.stop(e))}},{key:"_getSelectElementsFromDoc",value:function _getSelectElementsFromDoc(e){for(var t=[],r=e.querySelectorAll("select"),n=0;n<r.length;n++)t.push(r[n]);return t}}]),SelectElementEvents}();function FormEvents_typeof(e){return(FormEvents_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function FormEvents_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function FormEvents_setPrototypeOf(e,t){return(FormEvents_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function FormEvents_createSuper(r){var n=function FormEvents_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=FormEvents_getPrototypeOf(r);return function FormEvents_possibleConstructorReturn(e,t){{if(t&&("object"===FormEvents_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return FormEvents_assertThisInitialized(e)}(self,n?(e=FormEvents_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function FormEvents_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function FormEvents_getPrototypeOf(e){return(FormEvents_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Io="form",xo=function(){!function FormEvents_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&FormEvents_setPrototypeOf(e,t)}(FormEvents,Bo);var o=FormEvents_createSuper(FormEvents);function FormEvents(e,t,r){var n;return function FormEvents_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,FormEvents),function FormEvents_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(FormEvents_assertThisInitialized(n=o.call(self)),"handleOnFormEvents",function(e){w.trace("ElementEvents:_onFormSubmitEvent"),n._sendToQueue(e,{length:0,selected:-1,elementValues:""})}),n._sendToQueue=e,n._messageBus=t,n._StandardOnFormEventsEmitter=r,n}return function FormEvents_createClass(e,t,r){t&&FormEvents_defineProperties(e.prototype,t),r&&FormEvents_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(FormEvents,[{key:"bind",value:function bind(e){e=e.getDocument();self._messageBus.subscribe(fe.StandardOnFormSubmitEvent,self.handleOnFormEvents),self.addListenersBySelector(e)}},{key:"unbind",value:function unbind(e){for(var t=[],r=e.getDocument().querySelectorAll(Io),n=0;n<r.length;n++)t.push(r[n]);self._StandardOnFormEventsEmitter.stop(t),self._messageBus.unsubscribe(fe.StandardOnFormSubmitEvent,self.handleOnFormEvents)}},{key:"addListenersBySelector",value:function addListenersBySelector(e){for(var t=[],r=e.querySelectorAll(Io),n=0;n<r.length;n++)t.push(r[n]);self._StandardOnFormEventsEmitter.start(t)}}]),FormEvents}();function PrivateBrowsingDetector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Lo=function(){function PrivateBrowsingDetector(){!function PrivateBrowsingDetector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,PrivateBrowsingDetector)}return function PrivateBrowsingDetector_createClass(e,t,r){t&&PrivateBrowsingDetector_defineProperties(e.prototype,t),r&&PrivateBrowsingDetector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(PrivateBrowsingDetector,[{key:"detectPrivateMode",value:function detectPrivateMode(e){self._isWebkitBrowser()?self._detectPrivateBrowsingOnWebkit(e):self._isMozillaBrowser()?self._detectPrivateBrowsingOnMozilla(e):self._isIE10OrLater(window.navigator.userAgent)?self._detectPrivateBrowsingOnIESinceVersion10(e):window.localStorage&&/Safari/.test(window.navigator.userAgent)?self._detectPrivateBrowsingOnSafari(e):e(null)}},{key:"_isWebkitBrowser",value:function _isWebkitBrowser(){return!!window.webkitRequestFileSystem}},{key:"_isMozillaBrowser",value:function _isMozillaBrowser(){return"MozAppearance"in document.documentElement.style}},{key:"_isIE10OrLater",value:function _isIE10OrLater(e){var t=e.toLowerCase();if(0===t.indexOf("msie")&&0===t.indexOf("trident"))return!1;var r=/(?:msie|rv:)\s?([\d\.]+)/.exec(t);if(r&&10<=parseInt(r[1],10))return!0;if((r="documentElement"in document&&("filters"in document.documentElement||"documentMode"in document),r&&document.documentMode)&&10<=parseFloat((t.match(/.+(?:ie|rv)[\/: ]([\d.]+)/)||[])[1]))return!0;r=/edge/.test(t);e=!!t.match(/trident\/7\./);if((r||e)&&10<=parseFloat((t.match(/.+(?:edge|rv)[\/: ]([\d.]+)/)||[])[1]))return!0;return!1}},{key:"_detectPrivateBrowsingOnWebkit",value:function _detectPrivateBrowsingOnWebkit(e){void 0!==navigator.storage&&"function"==typeof navigator.storage.estimate?self._storageEstimateDetectionOnWebkit(e):self._fileSystemDetectionOnWebkit(e)}},{key:"_fileSystemDetectionOnWebkit",value:function _fileSystemDetectionOnWebkit(e){window.webkitRequestFileSystem(window.TEMPORARY,1,function(){e(!1)},function(){e(!0)})}},{key:"_storageEstimateDetectionOnWebkit",value:function _storageEstimateDetectionOnWebkit(t){navigator.storage.estimate().then(function(e){e=e.quota;t(e<12e7)}).catch(function(e){w.error("failed to detect private browsing",e)})}},{key:"_detectPrivateBrowsingOnMozilla",value:function _detectPrivateBrowsingOnMozilla(t){try{var e=(indexedDB||window.indexedDB).open("test");e.onerror=function(){t(!0)},e.onsuccess=function(){t(!1)}}catch(e){t(!0)}}},{key:"_detectPrivateBrowsingOnIESinceVersion10",value:function _detectPrivateBrowsingOnIESinceVersion10(e){var t=!1;try{window.indexedDB||(t=!0)}catch(e){t=!0}e(t)}},{key:"_detectPrivateBrowsingOnSafari",value:function _detectPrivateBrowsingOnSafari(e){var t;try{window.openDatabase(null,null,null,null)}catch(e){t=!0}try{window.localStorage.setItem("test",1)}catch(e){t=!0}t||(t=!1,window.localStorage.removeItem("test")),e(t)}}]),PrivateBrowsingDetector}();function PointerHoverDetector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var jo=1,Ao=2,Uo=3,No=4,Wo=5,Ho=1,Qo=2,zo=3,qo=4,Ko=function(){function PointerHoverDetector(){!function PointerHoverDetector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,PointerHoverDetector)}return function PointerHoverDetector_createClass(e,t,r){t&&PointerHoverDetector_defineProperties(e.prototype,t),r&&PointerHoverDetector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(PointerHoverDetector,null,[{key:"getPointerHover",value:function getPointerHover(){var e,t={pointer:Wo,hover:Wo};return window.matchMedia&&((e=window.matchMedia)("( any-pointer: fine )").matches?t.pointer=jo:e("( any-pointer: coarse )").matches?t.pointer=Ao:e("( any-pointer: none )").matches?t.pointer=Uo:e("( any-pointer )").matches&&(t.pointer=No),e("( any-hover: hover )").matches?t.hover=Ho:e("( any-hover: on-demand )").matches?t.hover=Qo:e("( any-hove: none )").matches?t.hover=zo:window.matchMedia("( any-hover )").matches&&(t.hover=qo)),t}}]),PointerHoverDetector}();function FontsDetector_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Vo=function(){function FontsDetector(e){!function FontsDetector_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,FontsDetector),self._domUtils=e,self._baseFonts=["monospace","sans-serif","serif"],self._testString="mmmmmmmmmmlli",self._testSize="72px",self._chunkSize=30,self._defaultWidth={},self._defaultHeight={},self._body=null,self._iframe=null,self._spanArray=null,self._allFontsDiffs=[]}return function FontsDetector_createClass(e,t,r){t&&FontsDetector_defineProperties(e.prototype,t),r&&FontsDetector_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(FontsDetector,[{key:"clear",value:function clear(){self._body.removeChild(self._iframe),self._iframe=null,self._spanArray=null,self._allFontsDiffs=[]}},{key:"init",value:function init(e){var t=self;if(self._body=document.body,!self._body)return"";self._iframe=document.createElement("iframe"),self._iframe.setAttribute("sandbox","allow-same-origin"),self._iframe.id=Re.fontDetectionFrame,self._iframe.style.visibility="hidden",self._iframe.style.zIndex="-1",self._iframe.style.width=0,self._iframe.style.height=0,self._body.appendChild(self._iframe),self._iframe.contentDocument.body||(self._iframe.style.width=null,self._iframe.style.height=null,self._iframe.contentDocument.appendChild(document.createElement("body"))),self._domUtils.onWindowDocumentReady(self._iframe.contentWindow,function(){t._createCalculationElements(e)})}},{key:"_createCalculationElements",value:function _createCalculationElements(e){var t=document.createElement("span");t.style.fontSize=self._testSize,t.style.visibility="hidden",t.style.position="absolute",t.style.zIndex="-1",t.style.lineHeight="normal",t.innerHTML=self._testString;for(var r=0;r<self._baseFonts.length;r++)t.style.fontFamily=self._baseFonts[r],self._iframe.contentDocument.body.appendChild(t),self._defaultWidth[self._baseFonts[r]]=t.offsetWidth,self._defaultHeight[self._baseFonts[r]]=t.offsetHeight,self._iframe.contentDocument.body.removeChild(t);w.debug("FontsDetector:init - base fonts width: \n                ".concat(self._baseFonts[0],":").concat(self._defaultWidth[self._baseFonts[0]],";\n                ").concat(self._baseFonts[1],":").concat(self._defaultWidth[self._baseFonts[1]],";\n                ").concat(self._baseFonts[2],":").concat(self._defaultWidth[self._baseFonts[2]])),w.debug("FontsDetector:init - base fonts height: \n                ".concat(self._baseFonts[0],":").concat(self._defaultHeight[self._baseFonts[0]],";\n                ").concat(self._baseFonts[1],":").concat(self._defaultHeight[self._baseFonts[1]],";\n                ").concat(self._baseFonts[2],":").concat(self._defaultHeight[self._baseFonts[2]])),self._createSpanArray(),e()}},{key:"_createSpanArray",value:function _createSpanArray(){var e=document.createElement("div");e.id="currentDiv",e.style.position="absolute",e.style.visibility="hidden";for(var t=0;t<self._chunkSize;t++){var r=document.createElement("span");r.style.lineHeight="normal",r.style.position="absolute",r.style.zIndex="-1",r.style.fontSize=self._testSize,r.innerHTML=self._testString,e.appendChild(r);r=document.createElement("br");e.appendChild(r)}self._iframe.contentDocument.body.appendChild(e),self._spanArray=e}},{key:"detectByChunksWithIndex",value:function detectByChunksWithIndex(e,t,r){var n=[],o=0,i=0;if(!self._spanArray)return n;for(var s=self._spanArray.getElementsByTagName("span"),a=self._defaultWidth[self._baseFonts[t]],u=self._defaultHeight[self._baseFonts[t]],c=0;c<e.length;c++){if(i>=self._chunkSize)for(var l=i=0;l<s.length;l++){var f=Math.abs(s[l].offsetWidth-a),p=Math.abs(s[l].offsetHeight-u);self._allFontsDiffs.push([s[l].id,f,p]),(1<f||1<p)&&(n[o]=s[l].id,o++)}s[i].style.fontFamily=e[c]+","+self._baseFonts[t],s[i].id=e[c],i++}r(n)}},{key:"getAllFontsDiffs",value:function getAllFontsDiffs(){return self._allFontsDiffs}}]),FontsDetector}();function ScriptsRepository_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Go=function(){function ScriptsRepository(e){!function ScriptsRepository_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ScriptsRepository),self._utils=e,self._scriptList=[]}return function ScriptsRepository_createClass(e,t,r){t&&ScriptsRepository_defineProperties(e.prototype,t),r&&ScriptsRepository_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ScriptsRepository,[{key:"count",value:function count(){return self._scriptList.length}},{key:"exists",value:function exists(e){/\d\d\d/.test(e.src)&&(e.src=self._utils.clearTextFromNumbers(e.src));for(var t=self._utils.getHash(e.text),r=0;r<self._scriptList.length;r++)if(e.src&&e.src===self._scriptList[r].src||t&&t===self._scriptList[r].textHash)return!0;return!1}},{key:"add",value:function add(e){e.textHash=self._utils.getHash(e.text),/\d\d\d/.test(e.src)&&(e.src=self._utils.clearTextFromNumbers(e.src)),self._scriptList.push({src:e.src,textHash:e.textHash})}}]),ScriptsRepository}();function MutationEmitter_typeof(e){return(MutationEmitter_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function MutationEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Zo=function(){function MutationEmitter(e){var r=self;if(!function MutationEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,MutationEmitter),function MutationEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleMutationEvent",function(e,t){e&&t&&r._messageBus.publish(fe.MutationSingleEvent,{mutation:e,browserContext:t})}),self._messageBus=e,"object"!==MutationEmitter_typeof(self._messageBus))throw new Error("Bootstrap aborted! MessageBus missing for MutationEmitter");self._documentObservers=new WeakMap}return function MutationEmitter_createClass(e,t,r){t&&MutationEmitter_defineProperties(e.prototype,t),r&&MutationEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(MutationEmitter,[{key:"startObserver",value:function startObserver(n){var e,o=self,t=n.getDocument();self._documentObservers.has(t)||((e=new window.MutationObserver(function(e){try{for(var t=0;t<e.length;t++){var r=e[t];if(0<r.addedNodes.length){o.handleMutationEvent(r,n);break}}}catch(e){w.error("An error has occurred: ".concat(e.message))}})).observe(t,{childList:!0,subtree:!0}),self._documentObservers.set(t,{instance:e}))}},{key:"stopObserver",value:function stopObserver(e){var t,e=e.getDocument();self._documentObservers.has(e)&&(t=self._documentObservers.get(e))&&(t.instance&&t.instance.disconnect(),self._documentObservers.delete(e))}}]),MutationEmitter}();function StandardInputEventsEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function StandardInputEventsEmitter_defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Yo=function(){function StandardInputEventsEmitter(e,t,r){var n=self;!function StandardInputEventsEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,StandardInputEventsEmitter),StandardInputEventsEmitter_defineProperty(self,"handleInputEvents",function(e){n._messageBus.publish(fe.StandardInputEvent,e)}),StandardInputEventsEmitter_defineProperty(self,"handleFocusEvents",function(e){n._messageBus.publish(fe.StandardInputFocusEvent,e)}),StandardInputEventsEmitter_defineProperty(self,"handleBlurEvents",function(e){n._messageBus.publish(fe.StandardInputBlurEvent,e)}),self._messageBus=e,self._eventAggregator=t,self._elementBindingWMap=new WeakMap,self._utils=r,self.defaultInputEventListener=[{event:"input",handler:self.handleInputEvents},{event:"focus",handler:self.handleFocusEvents},{event:"blur",handler:self.handleBlurEvents}]}return function StandardInputEventsEmitter_createClass(e,t,r){t&&StandardInputEventsEmitter_defineProperties(e.prototype,t),r&&StandardInputEventsEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(StandardInputEventsEmitter,[{key:"start",value:function start(e,n,o){var i=self;e.forEach(function(t){var r;i._elementBindingWMap.has(t)||(r=[],void 0!==o?"function"==typeof o.func&&Array.isArray(o.allowedEvents)&&0<o.allowedEvents.length&&(o.func(n,t)?i.defaultInputEventListener.forEach(function(e){o.allowedEvents.includes(e.event)&&r.push(e)}):r=Array.from(i.defaultInputEventListener)):r=Array.from(i.defaultInputEventListener),r.forEach(function(e){i._eventAggregator.addEventListener(t,e.event,e.handler)}),i._elementBindingWMap.set(t,{isBinded:!0,listeners:[i.handleInputEvents,i.handleFocusEvents,i.handleBlurEvents],isUsingJQuery:!1}))})}},{key:"stop",value:function stop(e){var r=self;e.forEach(function(t){var e=r._elementBindingWMap.get(t);e&&e.isBinded&&(r.defaultInputEventListener.forEach(function(e){r._eventAggregator.removeEventListener(t,e.event,e.handler)}),r._elementBindingWMap.delete(t))})}},{key:"addElementEvents",value:function addElementEvents(t){var r=self,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!self._elementBindingWMap.has(t)){if(e){if(!self._utils.JQueryUtils.isJQueryAvailable())return void w.error("Unable to add event listeners for element using jQuery because jQuery is not available");self.defaultInputEventListener.forEach(function(e){r._utils.JQueryUtils.addEventListener(t,e.event,e.handler)})}else self.defaultInputEventListener.forEach(function(e){r._eventAggregator.addEventListener(t,e.event,e.handler)});self._elementBindingWMap.set(t,{isBinded:!0,listeners:[self.handleInputEvents,self.handleFocusEvents,self.handleBlurEvents],isUsingJQuery:e})}}},{key:"removeElementEvents",value:function removeElementEvents(t){var r=self,e=self._elementBindingWMap.get(t);if(e&&e.isBinded){if(e.isUsingJQuery){if(!self._utils.JQueryUtils.isJQueryAvailable())return void w.error("Unable to remove event listeners for element using jQuery because jQuery is not available");self.defaultInputEventListener.forEach(function(e){r._utils.JQueryUtils.removeEventListener(t,e.event,e.handler)})}else self.defaultInputEventListener.forEach(function(e){r._eventAggregator.removeEventListener(elements,e.event,e.handler)});self._elementBindingWMap.delete(t)}}}]),StandardInputEventsEmitter}();function EventAggregator_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Jo=!1;!function(){try{var e=Object.defineProperty({},"passive",{get:function get(){Jo=!0}});window.addEventListener("test",null,e)}catch(e){}}();var Xo=function(){function EventAggregator(){!function EventAggregator_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,EventAggregator)}return function EventAggregator_createClass(e,t,r){t&&EventAggregator_defineProperties(e.prototype,t),r&&EventAggregator_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(EventAggregator,null,[{key:"addEventListener",value:function addEventListener(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],i=5<arguments.length&&void 0!==arguments[5]&&arguments[5];Jo?e.addEventListener(t,r,{capture:n,passive:o,once:i}):e.addEventListener?e.addEventListener(t,r,n):e.attachEvent("on"+t,r)}},{key:"removeEventListener",value:function removeEventListener(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3];e.removeEventListener?e.removeEventListener(t,r,n):e.detachEvent("on"+t,r)}}]),EventAggregator}();function StandardOnClickEventsEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var $o=function(){function StandardOnClickEventsEmitter(e,t,r){var n=self;!function StandardOnClickEventsEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,StandardOnClickEventsEmitter),function StandardOnClickEventsEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleOnClickEvents",function(e){n._messageBus.publish(fe.StandardOnClickEvent,e)}),self._messageBus=e,self._eventAggregator=t,self._elementBindingWMap=new WeakMap,self._utils=r,self.defaultOnClickEventListener=[{event:"click",handler:self.handleOnClickEvents}]}return function StandardOnClickEventsEmitter_createClass(e,t,r){t&&StandardOnClickEventsEmitter_defineProperties(e.prototype,t),r&&StandardOnClickEventsEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(StandardOnClickEventsEmitter,[{key:"start",value:function start(e){var r=self;e.forEach(function(t){r._elementBindingWMap.has(t)||(r.defaultOnClickEventListener.forEach(function(e){r._eventAggregator.addEventListener(t,e.event,e.handler)}),r._elementBindingWMap.set(t,{isBinded:!0,listeners:[r.handleOnClickEvents],isUsingJQuery:!1}))})}},{key:"stop",value:function stop(e){var r=self;e.forEach(function(t){var e=r._elementBindingWMap.get(t);e&&e.isBinded&&(r.defaultOnClickEventListener.forEach(function(e){r._eventAggregator.removeEventListener(t,e.event,e.handler)}),r._elementBindingWMap.delete(t))})}},{key:"addElementEvents",value:function addElementEvents(t){var r=self,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!self._elementBindingWMap.has(t)){if(e){if(!self._utils.JQueryUtils.isJQueryAvailable())return void w.error("Unable to add event listeners for element using jQuery because jQuery is not available");self.defaultOnClickEventListener.forEach(function(e){r._utils.JQueryUtils.addEventListener(t,e.event,e.handler)})}else self.defaultOnClickEventListener.forEach(function(e){r._eventAggregator.addEventListener(t,e.event,e.handler)});self._elementBindingWMap.set(t,{isBinded:!0,listeners:[self.handleOnClickEvents],isUsingJQuery:e})}}},{key:"removeElementEvents",value:function removeElementEvents(t){var r=self,e=self._elementBindingWMap.get(t);if(e&&e.isBinded){if(e.isUsingJQuery){if(!self._utils.JQueryUtils.isJQueryAvailable())return void w.error("Unable to remove event listeners for element using jQuery because jQuery is not available");self.defaultOnClickEventListener.forEach(function(e){r._utils.JQueryUtils.removeEventListener(t,e.event,e.handler)})}else self.defaultOnClickEventListener.forEach(function(e){r._eventAggregator.removeEventListener(elements,e.event,e.handler)});self._elementBindingWMap.delete(t)}}}]),StandardOnClickEventsEmitter}();function StandardOnChangeEventsEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ei=function(){function StandardOnChangeEventsEmitter(e,t,r){var n=self;!function StandardOnChangeEventsEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,StandardOnChangeEventsEmitter),function StandardOnChangeEventsEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleOnChangeEvents",function(e){n._messageBus.publish(fe.StandardOnSelectEvent,e)}),self._messageBus=e,self._eventAggregator=t,self._elementBindingWMap=new WeakMap,self._utils=r,self.defaultOnChangeEventListener=[{event:"change",handler:self.handleOnChangeEvents}]}return function StandardOnChangeEventsEmitter_createClass(e,t,r){t&&StandardOnChangeEventsEmitter_defineProperties(e.prototype,t),r&&StandardOnChangeEventsEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(StandardOnChangeEventsEmitter,[{key:"start",value:function start(e){var r=self;e.forEach(function(t){r._elementBindingWMap.has(t)||(r.defaultOnChangeEventListener.forEach(function(e){r._eventAggregator.addEventListener(t,e.event,e.handler)}),r._elementBindingWMap.set(t,{isBinded:!0,listeners:[r.handleOnChangeEvents],isUsingJQuery:!1}))})}},{key:"stop",value:function stop(e){var r=self;e.forEach(function(t){var e=r._elementBindingWMap.get(t);e&&e.isBinded&&(r.defaultOnChangeEventListener.forEach(function(e){r._eventAggregator.removeEventListener(t,e.event,e.handler)}),r._elementBindingWMap.delete(t))})}},{key:"addElementEvents",value:function addElementEvents(t){var r=self,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!self._elementBindingWMap.has(t)){if(e){if(!self._utils.JQueryUtils.isJQueryAvailable())return void w.error("Unable to add event listeners for element using jQuery because jQuery is not available");self.defaultOnChangeEventListener.forEach(function(e){r._utils.JQueryUtils.addEventListener(t,e.event,e.handler)})}else self.defaultOnChangeEventListener.forEach(function(e){r._eventAggregator.addEventListener(t,e.event,e.handler)});self._elementBindingWMap.set(t,{isBinded:!0,listeners:[self.handleOnChangeEvents],isUsingJQuery:e})}}},{key:"removeElementEvents",value:function removeElementEvents(t){var r=self,e=self._elementBindingWMap.get(t);if(e&&e.isBinded){if(e.isUsingJQuery){if(!self._utils.JQueryUtils.isJQueryAvailable())return void w.error("Unable to remove event listeners for element using jQuery because jQuery is not available");self.defaultOnChangeEventListener.forEach(function(e){r._utils.JQueryUtils.removeEventListener(t,e.event,e.handler)})}else self.defaultOnChangeEventListener.forEach(function(e){r._eventAggregator.removeEventListener(elements,e.event,e.handler)});self._elementBindingWMap.delete(t)}}}]),StandardOnChangeEventsEmitter}();function StandardOnFormEventsEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ti=function(){function StandardOnFormEventsEmitter(e,t,r){var n=self;!function StandardOnFormEventsEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,StandardOnFormEventsEmitter),function StandardOnFormEventsEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleOnFormSubmitEvents",function(e){n._messageBus.publish(fe.StandardOnFormSubmitEvent,e)}),self._messageBus=e,self._eventAggregator=t,self._elementBindingWMap=new WeakMap,self._utils=r,self.defaultOnFormEventListener=[{event:"submit",handler:self.handleOnFormSubmitEvents}]}return function StandardOnFormEventsEmitter_createClass(e,t,r){t&&StandardOnFormEventsEmitter_defineProperties(e.prototype,t),r&&StandardOnFormEventsEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(StandardOnFormEventsEmitter,[{key:"start",value:function start(e){var r=self;e.forEach(function(t){r._elementBindingWMap.has(t)||(r.defaultOnFormEventListener.forEach(function(e){r._eventAggregator.addEventListener(t,e.event,e.handler)}),r._elementBindingWMap.set(t,{isBinded:!0,listeners:[r.handleOnFormSubmitEvents],isUsingJQuery:!1}))})}},{key:"stop",value:function stop(e){var r=self;e.forEach(function(t){var e=r._elementBindingWMap.get(t);e&&e.isBinded&&(r.defaultOnFormEventListener.forEach(function(e){r._eventAggregator.removeEventListener(t,e.event,e.handler)}),r._elementBindingWMap.delete(t))})}},{key:"addElementEvents",value:function addElementEvents(t){var r=self,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!self._elementBindingWMap.has(t)){if(e){if(!self._utils.JQueryUtils.isJQueryAvailable())return void w.error("Unable to add event listeners for element using jQuery because jQuery is not available");self.defaultOnFormEventListener.forEach(function(e){r._utils.JQueryUtils.addEventListener(t,e.event,e.handler)})}else self.defaultOnFormEventListener.forEach(function(e){r._eventAggregator.addEventListener(t,e.event,e.handler)});self._elementBindingWMap.set(t,{isBinded:!0,listeners:[self.handleOnFormSubmitEvents],isUsingJQuery:e})}}},{key:"removeElementEvents",value:function removeElementEvents(t){var r=self,e=self._elementBindingWMap.get(t);if(e&&e.isBinded){if(e.isUsingJQuery){if(!self._utils.JQueryUtils.isJQueryAvailable())return void w.error("Unable to remove event listeners for element using jQuery because jQuery is not available");self.defaultOnFormEventListener.forEach(function(e){r._utils.JQueryUtils.removeEventListener(t,e.event,e.handler)})}else self.defaultOnFormEventListener.forEach(function(e){r._eventAggregator.removeEventListener(elements,e.event,e.handler)});self._elementBindingWMap.delete(t)}}}]),StandardOnFormEventsEmitter}();function SyntheticInputEventsHandlerBase_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ri=function(){function SyntheticInputEventsHandlerBase(e,t,r){!function SyntheticInputEventsHandlerBase_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,SyntheticInputEventsHandlerBase),function SyntheticInputEventsHandlerBase_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"isJQueryDataSupported",function(e){return!(!e.jQuery||!e.jQuery._data)}),self._messageBus=e,self._eventAggregator=t,self._elementBindingWMap=new WeakMap,self._utils=r,self.defaultEventListener=[{event:"keypress",handler:self.handleKeypressEvents}]}return function SyntheticInputEventsHandlerBase_createClass(e,t,r){t&&SyntheticInputEventsHandlerBase_defineProperties(e.prototype,t),r&&SyntheticInputEventsHandlerBase_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(SyntheticInputEventsHandlerBase,[{key:"registerElement",value:function registerElement(e,r){var n,o=self;self._elementBindingWMap.has(e)||(n={},self.defaultEventListener.forEach(function(t){function IWa(e){t.handler(e,r)}n[t.event]=IWa,o._eventAggregator.addEventListener(e,t.event,IWa)}),self._elementBindingWMap.set(e,{isBinded:!0,listeners:n}))}},{key:"unregisterElements",value:function unregisterElements(e){var n=self;e.forEach(function(t){var r=n._elementBindingWMap.get(t);r&&r.isBinded&&(n.defaultEventListener.forEach(function(e){n._eventAggregator.removeEventListener(t,e.event,r.listeners[e.event])}),n._elementBindingWMap.delete(t))})}},{key:"publishEvent",value:function publishEvent(e,t,r,n){e={bubbles:!0,cancelBubble:!1,cancelable:!1,composed:!0,currentTarget:null,data:n,dataTransfer:null,defaultPrevented:!1,detail:0,eventPhase:0,inputType:r,isComposing:!1,isTrusted:!0,jqueryMask:t,returnValue:!0,sourceCapabilities:null,srcElement:Object.assign(e.target||e.srcElement,{}),target:Object.assign(e.target,{}),timeStamp:e.timeStamp,type:"input",view:null,which:0};self._messageBus.publish(fe.SyntheticInputMaskEvent,e)}}]),SyntheticInputEventsHandlerBase}();function SyntheticMaskInputEventsHandler_typeof(e){return(SyntheticMaskInputEventsHandler_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function SyntheticMaskInputEventsHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function SyntheticMaskInputEventsHandler_setPrototypeOf(e,t){return(SyntheticMaskInputEventsHandler_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function SyntheticMaskInputEventsHandler_createSuper(r){var n=function SyntheticMaskInputEventsHandler_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=SyntheticMaskInputEventsHandler_getPrototypeOf(r);return function SyntheticMaskInputEventsHandler_possibleConstructorReturn(e,t){{if(t&&("object"===SyntheticMaskInputEventsHandler_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return SyntheticMaskInputEventsHandler_assertThisInitialized(e)}(self,n?(e=SyntheticMaskInputEventsHandler_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function SyntheticMaskInputEventsHandler_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function SyntheticMaskInputEventsHandler_getPrototypeOf(e){return(SyntheticMaskInputEventsHandler_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ni=function(){!function SyntheticMaskInputEventsHandler_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&SyntheticMaskInputEventsHandler_setPrototypeOf(e,t)}(SyntheticMaskInputEventsHandler,ri);var o=SyntheticMaskInputEventsHandler_createSuper(SyntheticMaskInputEventsHandler);function SyntheticMaskInputEventsHandler(){var r;!function SyntheticMaskInputEventsHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,SyntheticMaskInputEventsHandler);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function SyntheticMaskInputEventsHandler_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(SyntheticMaskInputEventsHandler_assertThisInitialized(r=o.call.apply(o,[self].concat(t))),"handleKeypressEvents",function(e,t){r.isJQueryDataSupported(t)&&r.hasMaskEventSupported(e.target,t)&&(t=e.key,r.publishEvent(e,"maskedInput","insertText",t))}),r}return function SyntheticMaskInputEventsHandler_createClass(e,t,r){t&&SyntheticMaskInputEventsHandler_defineProperties(e.prototype,t),r&&SyntheticMaskInputEventsHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(SyntheticMaskInputEventsHandler,[{key:"start",value:function start(e,t){var r=self;t=t||window.self,e.forEach(function(e){r.isJQueryDataSupported(t)&&r.hasMaskEventSupported(e,t)&&r.registerElement(e,t)})}},{key:"stop",value:function stop(e){self.unregisterElements(e)}},{key:"hasMaskEventSupported",value:function hasMaskEventSupported(e,t){e=t.jQuery._data(e,"events");if(void 0===e)return!1;for(var r=Object.keys(e),n=0;n<r.length;n++)if("unmask"===r[n])return!0;return!1}}]),SyntheticMaskInputEventsHandler}();function SyntheticAutotabInputEventsHandler_typeof(e){return(SyntheticAutotabInputEventsHandler_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function SyntheticAutotabInputEventsHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function SyntheticAutotabInputEventsHandler_setPrototypeOf(e,t){return(SyntheticAutotabInputEventsHandler_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function SyntheticAutotabInputEventsHandler_createSuper(r){var n=function SyntheticAutotabInputEventsHandler_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function _createSuperInternal(){var e,t=SyntheticAutotabInputEventsHandler_getPrototypeOf(r);return function SyntheticAutotabInputEventsHandler_possibleConstructorReturn(e,t){{if(t&&("object"===SyntheticAutotabInputEventsHandler_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return SyntheticAutotabInputEventsHandler_assertThisInitialized(e)}(self,n?(e=SyntheticAutotabInputEventsHandler_getPrototypeOf(self).constructor,Reflect.construct(t,arguments,e)):t.apply(self,arguments))}}function SyntheticAutotabInputEventsHandler_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("self hasn't been initialised - super() hasn't been called");return e}function SyntheticAutotabInputEventsHandler_getPrototypeOf(e){return(SyntheticAutotabInputEventsHandler_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var oi=function(){!function SyntheticAutotabInputEventsHandler_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&SyntheticAutotabInputEventsHandler_setPrototypeOf(e,t)}(SyntheticAutotabInputEventsHandler,ri);var o=SyntheticAutotabInputEventsHandler_createSuper(SyntheticAutotabInputEventsHandler);function SyntheticAutotabInputEventsHandler(){var r;!function SyntheticAutotabInputEventsHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,SyntheticAutotabInputEventsHandler);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function SyntheticAutotabInputEventsHandler_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(SyntheticAutotabInputEventsHandler_assertThisInitialized(r=o.call.apply(o,[self].concat(t))),"handleKeypressEvents",function(e,t){r.isJQueryDataSupported(t)&&r.hasjQueryAutoTab(e.target,t)&&(t=e.key,8!==e.keyCode&&r.publishEvent(e,"autotab","insertText",t))}),r}return function SyntheticAutotabInputEventsHandler_createClass(e,t,r){t&&SyntheticAutotabInputEventsHandler_defineProperties(e.prototype,t),r&&SyntheticAutotabInputEventsHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(SyntheticAutotabInputEventsHandler,[{key:"start",value:function start(e,t){var r=self;e.forEach(function(e){r.isJQueryDataSupported(t)&&r.hasjQueryAutoTab(e,t)&&r.registerElement(e,t)})}},{key:"stop",value:function stop(e){self.unregisterElements(e)}},{key:"hasjQueryAutoTab",value:function hasjQueryAutoTab(e,t){if(void 0===t.jQuery._data(e,"events"))return!1;for(var r=Object.keys(t.jQuery._data(e,"events")),n=0;n<r.length;n++)if(-1!==r[n].indexOf("autotab"))return!0;return!1}}]),SyntheticAutotabInputEventsHandler}();function FocusEventEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ii=function(){function FocusEventEmitter(e,t){var r=self;!function FocusEventEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,FocusEventEmitter),function FocusEventEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleFocusEvent",function(e){r._messageBus.publish(fe.FocusEvent,e)}),self._messageBus=e,self._eventAggregator=t}return function FocusEventEmitter_createClass(e,t,r){t&&FocusEventEmitter_defineProperties(e.prototype,t),r&&FocusEventEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(FocusEventEmitter,[{key:"start",value:function start(e){if(!e)throw new Error("invalid window parameter");self._eventAggregator.addEventListener(e,"focus",self.handleFocusEvent,!1,!0)}},{key:"stop",value:function stop(e){if(!e)throw new Error("invalid window parameter");self._eventAggregator.removeEventListener(e,"focus",self.handleFocusEvent)}}]),FocusEventEmitter}();function BlurEventEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var si=function(){function BlurEventEmitter(e,t){var r=self;!function BlurEventEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,BlurEventEmitter),function BlurEventEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleBlurEvent",function(e){r._messageBus.publish(fe.BlurEvent,e)}),self._messageBus=e,self._eventAggregator=t}return function BlurEventEmitter_createClass(e,t,r){t&&BlurEventEmitter_defineProperties(e.prototype,t),r&&BlurEventEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(BlurEventEmitter,[{key:"start",value:function start(e){if(!e)throw new Error("invalid window parameter");self._eventAggregator.addEventListener(e,"blur",self.handleBlurEvent,!1,!0)}},{key:"stop",value:function stop(e){if(!e)throw new Error("invalid window parameter");self._eventAggregator.removeEventListener(e,"blur",self.handleBlurEvent)}}]),BlurEventEmitter}();function ResizeEventEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ai=function(){function ResizeEventEmitter(e,t){var r=self;!function ResizeEventEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ResizeEventEmitter),function ResizeEventEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleResizeEvent",function(e){r._messageBus.publish(fe.ResizeEvent,e)}),self._messageBus=e,self._eventAggregator=t}return function ResizeEventEmitter_createClass(e,t,r){t&&ResizeEventEmitter_defineProperties(e.prototype,t),r&&ResizeEventEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ResizeEventEmitter,[{key:"start",value:function start(e){if(!e)throw new Error("invalid window parameter");self._eventAggregator.addEventListener(e,"resize",self.handleResizeEvent,!1,!0)}},{key:"stop",value:function stop(e){if(!e)throw new Error("invalid window parameter");self._eventAggregator.removeEventListener(e,"resize",self.handleResizeEvent)}}]),ResizeEventEmitter}();function DOMContentLoadedEventEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ui=function(){function DOMContentLoadedEventEmitter(e,t){var r=self;!function DOMContentLoadedEventEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,DOMContentLoadedEventEmitter),function DOMContentLoadedEventEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleDOMContentLoadedEvent",function(e){r._messageBus.publish(fe.DOMContentLoadedEvent,e)}),self._messageBus=e,self._eventAggregator=t}return function DOMContentLoadedEventEmitter_createClass(e,t,r){t&&DOMContentLoadedEventEmitter_defineProperties(e.prototype,t),r&&DOMContentLoadedEventEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(DOMContentLoadedEventEmitter,[{key:"start",value:function start(e){if(!e)throw new Error("invalid document parameter");self._eventAggregator.addEventListener(e,"DOMContentLoaded",self.handleDOMContentLoadedEvent)}},{key:"stop",value:function stop(e){if(!e)throw new Error("invalid document parameter");self._eventAggregator.removeEventListener(e,"DOMContentLoaded",self.handleDOMContentLoadedEvent)}}]),DOMContentLoadedEventEmitter}();function VisibilityChangeEventEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ci=function(){function VisibilityChangeEventEmitter(e,t){var r=self;!function VisibilityChangeEventEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,VisibilityChangeEventEmitter),function VisibilityChangeEventEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleVisibilityChangeEvent",function(e){r._messageBus.publish(fe.VisibilityChangeEvent,e)}),self._messageBus=e,self._eventAggregator=t}return function VisibilityChangeEventEmitter_createClass(e,t,r){t&&VisibilityChangeEventEmitter_defineProperties(e.prototype,t),r&&VisibilityChangeEventEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(VisibilityChangeEventEmitter,[{key:"start",value:function start(e){if(!e)throw new Error("invalid document parameter");self._eventAggregator.addEventListener(e,"visibilitychange",self.handleVisibilityChangeEvent,!1,!0)}},{key:"stop",value:function stop(e){if(!e)throw new Error("invalid document parameter");self._eventAggregator.removeEventListener(e,"visibilitychange",self.handleVisibilityChangeEvent)}}]),VisibilityChangeEventEmitter}();function ScrollEventEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var li=function(){function ScrollEventEmitter(e,t){var r=self;!function ScrollEventEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ScrollEventEmitter),function ScrollEventEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleScrollEvent",function(e){r._messageBus.publish(fe.ScrollEvent,e)}),self._messageBus=e,self._eventAggregator=t}return function ScrollEventEmitter_createClass(e,t,r){t&&ScrollEventEmitter_defineProperties(e.prototype,t),r&&ScrollEventEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ScrollEventEmitter,[{key:"start",value:function start(e){if(!e)throw new Error("invalid window parameter");self._eventAggregator.addEventListener(e,"scroll",self.handleScrollEvent,!1,!0)}},{key:"stop",value:function stop(e){if(!e)throw new Error("invalid window parameter");self._eventAggregator.removeEventListener(e,"scroll",self.handleScrollEvent)}}]),ScrollEventEmitter}();function WindowMessageEventEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var fi=function(){function WindowMessageEventEmitter(e,t){var r=self;!function WindowMessageEventEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WindowMessageEventEmitter),function WindowMessageEventEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleWindowMessage",function(e){e&&r._messageBus.publish(fe.WindowMessageEvent,{message:e})}),self._messageBus=e,self._EventAggregator=t,self._windowListeners=new WeakMap,self.defaultPostMessageEventListener=[{event:"message",handler:self.handleWindowMessage}]}return function WindowMessageEventEmitter_createClass(e,t,r){t&&WindowMessageEventEmitter_defineProperties(e.prototype,t),r&&WindowMessageEventEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WindowMessageEventEmitter,[{key:"startObserver",value:function startObserver(t){var r=self;self._windowListeners.has(t.Context)||(self.defaultPostMessageEventListener.forEach(function(e){r._EventAggregator.addEventListener(t.Context,e.event,e.handler)}),self._windowListeners.set(t.Context,{isBinded:!0,listeners:[self.handleWindowMessage]}))}},{key:"stopObserver",value:function stopObserver(t){var r=self,e=self._windowListeners.get(t.Context);e&&e.isBinded&&(self.defaultPostMessageEventListener.forEach(function(e){r._EventAggregator.removeEventListener(t.Context,e.event,e.handler)}),self._windowListeners.delete(t.Context))}}]),WindowMessageEventEmitter}();function DeviceOrientationEventEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var pi=function(){function DeviceOrientationEventEmitter(e,t){var r=self;!function DeviceOrientationEventEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,DeviceOrientationEventEmitter),function DeviceOrientationEventEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleDeviceOrientationEvent",function(e){r._messageBus.publish(fe.DeviceOrientationEvent,e)}),self._messageBus=e,self._eventAggregator=t}return function DeviceOrientationEventEmitter_createClass(e,t,r){t&&DeviceOrientationEventEmitter_defineProperties(e.prototype,t),r&&DeviceOrientationEventEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(DeviceOrientationEventEmitter,[{key:"start",value:function start(){self._eventAggregator.addEventListener(window,"deviceorientation",self.handleDeviceOrientationEvent)}},{key:"stop",value:function stop(){self._eventAggregator.removeEventListener(window,"deviceorientation",self.handleDeviceOrientationEvent)}}]),DeviceOrientationEventEmitter}();function BeforeInstallPromptEventEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var di=function(){function BeforeInstallPromptEventEmitter(e,t){var r=self;!function BeforeInstallPromptEventEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,BeforeInstallPromptEventEmitter),function BeforeInstallPromptEventEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleBeforeInstallPrompt",function(e){r._messageBus.publish(fe.BeforeInstallPromptEvent,e)}),self._messageBus=e,self._eventAggregator=t}return function BeforeInstallPromptEventEmitter_createClass(e,t,r){t&&BeforeInstallPromptEventEmitter_defineProperties(e.prototype,t),r&&BeforeInstallPromptEventEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(BeforeInstallPromptEventEmitter,[{key:"start",value:function start(e){if(!e)throw new Error("invalid window parameter");self._eventAggregator.addEventListener(e,"beforeinstallprompt",self.handleBeforeInstallPrompt)}},{key:"stop",value:function stop(e){if(!e)throw new Error("invalid window parameter");self._eventAggregator.removeEventListener(e,"beforeinstallprompt",self.handleBeforeInstallPrompt)}}]),BeforeInstallPromptEventEmitter}();function CutEventEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var hi=function(){function CutEventEmitter(e,t){var r=self;!function CutEventEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CutEventEmitter),function CutEventEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleCutEvent",function(e){r._messageBus.publish(fe.CutEvent,e)}),self._messageBus=e,self._eventAggregator=t}return function CutEventEmitter_createClass(e,t,r){t&&CutEventEmitter_defineProperties(e.prototype,t),r&&CutEventEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CutEventEmitter,[{key:"start",value:function start(e){if(!e)throw new Error("invalid document parameter");self._eventAggregator.addEventListener(e,"cut",self.handleCutEvent)}},{key:"stop",value:function stop(e){if(!e)throw new Error("invalid document parameter");self._eventAggregator.removeEventListener(e,"cut",self.handleCutEvent)}}]),CutEventEmitter}();function CopyEventEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var vi=function(){function CopyEventEmitter(e,t){var r=self;!function CopyEventEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CopyEventEmitter),function CopyEventEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleCopyEvent",function(e){r._messageBus.publish(fe.CopyEvent,e)}),self._messageBus=e,self._eventAggregator=t}return function CopyEventEmitter_createClass(e,t,r){t&&CopyEventEmitter_defineProperties(e.prototype,t),r&&CopyEventEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CopyEventEmitter,[{key:"start",value:function start(e){if(!e)throw new Error("invalid document parameter");self._eventAggregator.addEventListener(e,"copy",self.handleCopyEvent)}},{key:"stop",value:function stop(e){if(!e)throw new Error("invalid document parameter");self._eventAggregator.removeEventListener(e,"copy",self.handleCopyEvent)}}]),CopyEventEmitter}();function PasteEventEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var yi=function(){function PasteEventEmitter(e,t){var r=self;!function PasteEventEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,PasteEventEmitter),function PasteEventEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handlePasteEvent",function(e){r._messageBus.publish(fe.PasteEvent,e)}),self._messageBus=e,self._eventAggregator=t}return function PasteEventEmitter_createClass(e,t,r){t&&PasteEventEmitter_defineProperties(e.prototype,t),r&&PasteEventEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(PasteEventEmitter,[{key:"start",value:function start(e){if(!e)throw new Error("invalid document parameter");self._eventAggregator.addEventListener(e,"paste",self.handlePasteEvent)}},{key:"stop",value:function stop(e){if(!e)throw new Error("invalid document parameter");self._eventAggregator.removeEventListener(e,"paste",self.handlePasteEvent)}}]),PasteEventEmitter}();function ElementFocusEventEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var _i=function(){function ElementFocusEventEmitter(e,t){var r=self;!function ElementFocusEventEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ElementFocusEventEmitter),function ElementFocusEventEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleElementFocusEvents",function(e){r._messageBus.publish(fe.ElementFocusEvent,e)}),self._messageBus=e,self._eventAggregator=t}return function ElementFocusEventEmitter_createClass(e,t,r){t&&ElementFocusEventEmitter_defineProperties(e.prototype,t),r&&ElementFocusEventEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ElementFocusEventEmitter,[{key:"start",value:function start(e){var t=self;e.forEach(function(e){t._eventAggregator.addEventListener(e,"focus",t.handleElementFocusEvents)})}},{key:"stop",value:function stop(e){var t=self;e.forEach(function(e){t._eventAggregator.removeEventListener(e,"focus",t.handleElementFocusEvents)})}}]),ElementFocusEventEmitter}();function ElementBlurEventEmitter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var gi=function(){function ElementBlurEventEmitter(e,t){var r=self;!function ElementBlurEventEmitter_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ElementBlurEventEmitter),function ElementBlurEventEmitter_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(self,"handleElementBlurEvents",function(e){r._messageBus.publish(fe.ElementBlurEvent,e)}),self._messageBus=e,self._eventAggregator=t}return function ElementBlurEventEmitter_createClass(e,t,r){t&&ElementBlurEventEmitter_defineProperties(e.prototype,t),r&&ElementBlurEventEmitter_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ElementBlurEventEmitter,[{key:"start",value:function start(e){var t=self;e.forEach(function(e){t._eventAggregator.addEventListener(e,"blur",t.handleElementBlurEvents)})}},{key:"stop",value:function stop(e){var t=self;e.forEach(function(e){t._eventAggregator.removeEventListener(e,"blur",t.handleElementBlurEvents)})}}]),ElementBlurEventEmitter}();function FeaturesList_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var mi=[{name:"MouseEvents",className:an,init:function init(){return function(){self._features.list.MouseEvents.instance=new an(self._utils,Rt,self._elements,self._dataQ)}}},{name:"KeyEvents",className:ke,init:function init(){return function(){self._features.list.KeyEvents.instance=new ke(self._configurationRepository,self._utils,self._elements,self._dataQ,self._msgBus,self._sameCharService,self._maskingService)}}},{name:"TouchEvents",className:me,init:function init(){return function(){self._features.list.TouchEvents.instance=new me(self._utils,self._elements,self._dataQ,self._msgBus)}}},{name:"ClipboardEvents",className:cr,init:function init(){return function(){var e=new cr.Builder(self._utils,self._elements,self._dataQ),t=new hi(self._msgBus,Xo),r=new vi(self._msgBus,Xo),n=new yi(self._msgBus,Xo);e.withMessageBus(self._msgBus).withCutEventEmitter(t).withCopyEventEmitter(r).withPasteEventEmitter(n),self._features.list.ClipboardEvents.instance=e.build()}}},{name:"ElementEvents",className:ir,init:function init(){return function(){var e=new Yo(self._msgBus,Xo,self._utils),t=new $o(self._msgBus,Xo,self._utils),r=new ei(self._msgBus,Xo,self._utils),n=new _i(self._msgBus,Xo,self._utils),o=new gi(self._msgBus,Xo,self._utils),i=new ti(self._msgBus,Xo,self._utils),s=new ee(MutationObserver,self._utils,Rt,"jQueryElementListenerConfig",null,!1),a=function JqueryElementsHandler(e,t,r,n){return _o=e,go=t,mo=r,bo=n,{bindInputEvents:_bindInputEvents,bindOnClickEvents:_bindOnClickEvents,bindOnChangeEvents:_bindOnChangeEvents,bindOnFormsEvents:_bindOnFormsEvents}}(e,t,r,i),u=new ir.Builder(self._configurationRepository,self._utils,Rt,self._elements,self._dataQ),c=new Zo(self._msgBus),l=new ni(self._msgBus,Xo,self._utils),f=new oi(self._msgBus,Xo,self._utils);u.withjQueryElementListenerSiteMapper(s),u.withMessageBus(self._msgBus),u.withMutationEmitter(c),u.withjQueryElementsHandler(a),u.withInputEvents(Ro,Mo,self._maskingService),u.withStandardInputEventsEmitter(e),u.withSyntheticMaskInputEventsHandler(l),u.withSyntheticAutotabInputEventsHandler(f),u.withClickEvents(Fo,Do),u.withStandardOnClickEventsEmitter(t),u.withSelectElementEvents(To,"select"),u.withElementFocusEventsEmitter(n),u.withElementBlurEventsEmitter(o),u.withStandardOnChangeEventsEmitter(r),u.withFormEvents(xo,Io),u.withStandardOnFormEventsEmitter(i),self._features.list.ElementEvents.instance=u.build()}}},{name:"WindowEvents",className:gr,init:function init(){return function(){var e=new gr.Builder(self._configurationRepository,S,self._dataQ),t=new ii(self._msgBus,Xo),r=new si(self._msgBus,Xo),n=new ai(self._msgBus,Xo),o=new ui(self._msgBus,Xo),i=new ci(self._msgBus,Xo),s=new li(self._msgBus,Xo);e.withMessageBus(self._msgBus),e.withFocusEventEmitter(t),e.withBlurEventEmitter(r),e.withResizeEventEmitter(n),e.withDOMContentLoadedEventEmitter(o),e.withVisibilityChangeEventEmitter(i),e.withScrollEventEmitter(s),self._features.list.WindowEvents.instance=e.build()}}},{name:"MetadataCollector",className:yo,init:function init(){return function(){var e=new ee(MutationObserver,self._utils,Rt,"metadataConfig",null,!1);self._features.list.MetadataCollector.instance=new yo(self._configurationRepository,self._dataQ,e,self._utils)}}},{name:"TabsEvents",className:dn,init:function init(){return function(){self._features.list.TabsEvents.instance=new dn(self._utils,self._dataQ)}}},{name:"DoNotTrack",className:Wn,init:function init(){return function(){self._features.list.DoNotTrack.instance=new Wn(self._dataQ)}}},{name:"BrowserProps",className:An,init:function init(){return function(){self._features.list.BrowserProps.instance=new An(self._dataQ,Ko,self._utils,self._configurationRepository)}}},{name:"IsPrivateBrowsing",className:to,init:function init(){return function(){var e=new Lo;self._features.list.IsPrivateBrowsing.instance=new to(self._dataQ,e)}}},{name:"FontsDetectionFeature",className:ao,init:function init(){return function(){self._features.list.FontsDetectionFeature.instance=new ao(S,Rt,self._dataQ,Vo)}}},{name:"GraphicDetectFeature",className:zn,init:function init(){return function(){self._features.list.GraphicDetectFeature.instance=new zn(self._dataQ)}}},{name:"BrowserDetect",className:bn,init:function init(){return function(){self._features.list.BrowserDetect.instance=new bn(self._dataQ)}}},{name:"FilesFeature",className:ho,init:function init(){return function(){self._features.list.FilesFeature.instance=new ho(self._configurationRepository,self._utils,self._sessionService,self._muidMgr,self._cidCache)}}},{name:"UserPermissions",className:Xn,init:function init(){return function(){self._features.list.UserPermissions.instance=new Xn(self._dataQ)}}},{name:"MediaDevicesFeature",className:Vn,init:function init(){return function(){self._features.list.MediaDevicesFeature.instance=new Vn(self._dataQ)}}},{name:"ContextPropsFeature",className:co,init:function init(){return function(){self._features.list.ContextPropsFeature.instance=new co(self._dataQ,Rt,self._perfMonitor)}}},{name:"ScriptsFeature",className:fo,init:function init(){return function(){var e=new Go(self._utils);self._features.list.ScriptsFeature.instance=new fo(self._dataQ,e)}}},{name:"AccelerometerEvents",className:br,init:function init(){return function(){self._features.list.AccelerometerEvents.instance=new br(self._configurationRepository,self._utils,self._sensorDataQ)}}},{name:"PinchZoomEvents",className:kr,init:function init(){return function(){self._features.list.PinchZoomEvents.instance=new kr(self._utils,self._elements,self._dataQ,self._msgBus)}}},{name:"ScriptEvents",className:Dr,init:function init(){return function(){self._features.list.ScriptEvents.instance=new Dr(self._utils,self._dataQ)}}},{name:"NetInfoEvents",className:Ir,init:function init(){return function(){self._features.list.NetInfoEvents.instance=new Ir(self._utils,self._dataQ)}}},{name:"DeviceOrientationCollector",className:Ar,init:function init(){return function(){self._features.list.DeviceOrientationCollector.instance=new Ar(self._utils,self._dataQ)}}},{name:"TapEvents",className:zr,init:function init(){return function(){self._features.list.TapEvents.instance=new zr(self._configurationRepository,self._utils,self._elements,self._dataQ)}}},{name:"LocationEvents",className:yn,init:function init(){return function(){self._features.list.LocationEvents.instance=new yn(self._dataQ,self._utils,self._configurationRepository)}}},{name:"StorageEvents",className:Gr,init:function init(){return function(){self._features.list.StorageEvents.instance=new Gr(self._utils,self._elements,self._dataQ,self._msgBus)}}},{name:"PrintEvents",className:$r,init:function init(){return function(){self._features.list.PrintEvents.instance=new $r(self._utils,self._dataQ)}}},{name:"LightSensorEvents",className:nn,init:function init(){return function(){self._features.list.LightSensorEvents.instance=new nn(self._dataQ,self._utils,self._configurationRepository)}}},{name:"CrossDomain",className:Oo,init:function init(){return function(){var e=new Oo.Builder(self._configurationRepository,self._dataQ,self._utils,Rt,wo),t=new fi(self._msgBus,Xo);e.withMessageBus(self._msgBus),e.withWindowMessageEventEmitter(t),self._features.list.CrossDomain.instance=e.build()}}},{name:"OrientationEvents",className:fr,init:function init(){return function(){var e=new pi(self._msgBus,Xo);self._features.list.OrientationEvents.instance=new fr(self._configurationRepository,self._utils,self._sensorDataQ,self._msgBus,e)}}},{name:"BeforeInstallPromptEvents",className:hr,init:function init(){return function(){var e=new di(self._msgBus,Xo);self._features.list.BeforeInstallPromptEvents.instance=new hr(self._dataQ,self._utils,self._msgBus,e)}}}],bi=function(){function FeaturesList(){!function FeaturesList_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,FeaturesList)}return function FeaturesList_createClass(e,t,r){t&&FeaturesList_defineProperties(e.prototype,t),r&&FeaturesList_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(FeaturesList,null,[{key:"register",value:function register(){var t=self;FeaturesList.list={},mi.forEach(function(e){t._addFeature(e)})}},{key:"getDefaultFeatures",value:function getDefaultFeatures(){return self.getFeaturesByCondition(function(e){return e.isDefault})}},{key:"getPerContextFeatures",value:function getPerContextFeatures(){return self.getFeaturesByCondition(function(e){return e.shouldRunPerContext})}},{key:"getPerSessionFeatures",value:function getPerSessionFeatures(){return self.getFeaturesByCondition(function(e){return e.shouldRunPerSession})}},{key:"getNonDefaultFeatures",value:function getNonDefaultFeatures(){return self.getFeaturesByCondition(function(e){return!e.isDefault&&!e.shouldRunPerContext&&!e.shouldRunPerSession})}},{key:"getFeaturesByCondition",value:function getFeaturesByCondition(r){var n={};return Object.keys(FeaturesList.list).forEach(function(e){var t=FeaturesList.list[e];r(t)&&(n[e]=t)}),n}},{key:"_addFeature",value:function _addFeature(e){var t=e.className.getDefaultSettings(),r=e.name;t.init=e.init(),FeaturesList.list[r]=t}}]),FeaturesList}();function Client_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}!function FeaturesList_defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(bi,"list",void 0);var Ci=function(){function Client(){!function Client_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,Client)}return function Client_createClass(e,t,r){t&&Client_defineProperties(e.prototype,t),r&&Client_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(Client,[{key:"start",value:function start(e,t,r){self._cdApiFacade=e,self._startupConfigurations=t,self._configurationLoadedCallback=r,self.systemBootstrapper=new tr,bi.register(),self.systemBootstrapper.start(bi,e,t),w.info("Got server address: ".concat(t.getWupServerURL()));e=self.systemBootstrapper.getPerfMonitor();e.startMonitor("t.timeTillServerConfig"),e.startMonitor("t.timeTillDataCollect"),self.configurationService=self.systemBootstrapper.getConfigurationService(),self.sessionService=self.systemBootstrapper.getSessionService(),self.configurationService.setConfigurationLoadedCallback(r),self.systemBootstrapper.getFeatureService().buildFrameRelatedLists(),self.systemBootstrapper.getFeatureBuilder().buildFeatures(),w.info("Started default features collection"),self.systemBootstrapper.getFeatureService().runDefault(),self.systemBootstrapper.getApiBridge().enableApi(),self.systemBootstrapper.getContextMgr().initContextHandling(),self.systemBootstrapper.registerPostLoadEvents(),self.systemBootstrapper.getMuidMgr().initMuid(),self.configurationService.setServerUrl(t.getWupServerURL()),self.sessionService.resumeOrStartSession()}},{key:"stop",value:function stop(){self.systemBootstrapper.stop()}},{key:"restart",value:function restart(){self.stop(),self.start(self._cdApiFacade,self._startupConfigurations,self._configurationLoadedCallback)}},{key:"flush",value:function flush(){self.systemBootstrapper.flushAllMessages()}},{key:"submitCustomElement",value:function submitCustomElement(e){self.systemBootstrapper.getMessageBus().publish(fe.CustomElementSubmitted,e)}}]),Client}();function StartPoint_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var wi=function(){function StartPoint(){!function StartPoint_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,StartPoint)}return function StartPoint_createClass(e,t,r){t&&StartPoint_defineProperties(e.prototype,t),r&&StartPoint_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(StartPoint,[{key:"start",value:function start(e,r){if(F.isSupported()){var n=new D,o=new Ci;return n.getConfigurations(function(e){if(!e)throw w.error("Failed starting the JS SDK. Received invalid start configurations"),new Error("Failed starting the JS SDK. Received invalid start configurations");if(!e.getWupServerURL())throw w.error("Missing server URL. Unable to start the library."),new Error("Missing server URL. Unable to start the library.");if(e.getUseUrlWorker()&&""===e.getWorkerUrl())throw w.error("Failed starting the JS SDK. Received invalid WorkerUrl configuration"),new Error("Failed starting the JS SDK. Received invalid WorkerUrl configuration");var t=e.getClientSettings();t&&n.createClientInterface(o,t),o.start(n,e,r)}),o.systemBootstrapper}}}]),StartPoint}();function Application_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ei={Application:function(){function Application(){!function Application_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,Application),function PolyfillsApplier_apply(){apply(self),Polyfills_apply(),WeakMapPolyfill_apply("undefined"!=typeof self?self:"undefined"!=typeof window?window:self)}()}return function Application_createClass(e,t,r){t&&Application_defineProperties(e.prototype,t),r&&Application_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(Application,[{key:"start",value:function start(e,t){return(new wi).start(e,t)}}]),Application}()}},599:function(e,t,r){e.exports=function(){return r(855)('!function(){var r={563:function(e,t,m){var g,w;function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}w=function(){return function t(s,a,o){function i(r,e){if(!a[r]){if(!s[r]){if(0,u)return u(r,!0);var n=new Error("Cannot find module \'"+r+"\'");throw n.code="MODULE_NOT_FOUND",n}n=a[r]={exports:{}};s[r][0].call(n.exports,function(e){var t=s[r][1][e];return i(t||e)},n,n.exports,t,s,a,o)}return a[r].exports}for(var u=void 0,e=0;e<o.length;e++)i(o[e]);return i}({1:[function(e,t,r){r.encode=e("./encode").encode,r.decode=e("./decode").decode,r.Encoder=e("./encoder").Encoder,r.Decoder=e("./decoder").Decoder,r.createCodec=e("./ext").createCodec,r.codec=e("./codec").codec},{"./codec":10,"./decode":12,"./decoder":13,"./encode":15,"./encoder":16,"./ext":20}],2:[function(e,r,n){(function(e){function t(e){return e&&e.isBuffer&&e}r.exports=t(void 0!==e&&e)||t(self.Buffer)||t("undefined"!=typeof window&&window.Buffer)||self.Buffer}).call(self,e("buffer").Buffer)},{buffer:29}],3:[function(e,t,r){r.copy=function o(e,t,r,n){var i;r=r||0,n||0===n||(n=self.length),t=t||0;var s=n-r;if(e===self&&r<t&&t<n)for(i=s-1;0<=i;i--)e[i+t]=self[i+r];else for(i=0;i<s;i++)e[i+t]=self[i+r];return s},r.toString=function i(e,t,r){var n=self,s=0|t;r=r||n.length;for(var a="",o=0;s<r;)(o=n[s++])<128?a+=String.fromCharCode(o):(192==(224&o)?o=(31&o)<<6|63&n[s++]:224==(240&o)?o=(15&o)<<12|(63&n[s++])<<6|63&n[s++]:240==(248&o)&&(o=(7&o)<<18|(63&n[s++])<<12|(63&n[s++])<<6|63&n[s++]),65536<=o?(o-=65536,a+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):a+=String.fromCharCode(o));return a},r.write=function n(e,t){for(var r=self,i=t||(t|=0),s=e.length,a=0,o=0;o<s;)(a=e.charCodeAt(o++))<128?r[i++]=a:(a<2048?r[i++]=192|a>>>6:(a<55296||57343<a?r[i++]=224|a>>>12:(a=65536+(a-55296<<10|e.charCodeAt(o++)-56320),r[i++]=240|a>>>18,r[i++]=128|a>>>12&63),r[i++]=128|a>>>6&63),r[i++]=128|63&a);return i-t}},{}],4:[function(e,t,r){function n(e){return new Array(e)}var s=e("./bufferish");(r=t.exports=n(0)).alloc=n,r.concat=s.concat,r.from=function i(e){if(!s.isBuffer(e)&&s.isView(e))e=s.Uint8Array.from(e);else if(s.isArrayBuffer(e))e=new Uint8Array(e);else{if("string"==typeof e)return s.from.call(r,e);if("number"==typeof e)throw new TypeError(\'"value" argument must not be a number\')}return Array.prototype.slice.call(e)}},{"./bufferish":8}],5:[function(e,t,r){function n(e){return new a(e)}var s=e("./bufferish"),a=s.global;(r=t.exports=s.hasBuffer?n(0):[]).alloc=s.hasBuffer&&a.alloc||n,r.concat=s.concat,r.from=function i(e){if(!s.isBuffer(e)&&s.isView(e))e=s.Uint8Array.from(e);else if(s.isArrayBuffer(e))e=new Uint8Array(e);else{if("string"==typeof e)return s.from.call(r,e);if("number"==typeof e)throw new TypeError(\'"value" argument must not be a number\')}return a.from&&1!==a.from.length?a.from(e):new a(e)}},{"./bufferish":8}],6:[function(e,t,s){function n(e,t,r,n){var s=l.isBuffer(self),a=l.isBuffer(e);if(s&&a)return self.copy(e,t,r,n);if(c||s||a||!l.isView(self)||!l.isView(e))return u.copy.call(self,e,t,r,n);n=r||null!=n?i.call(self,r,n):self;return e.set(n,t),n.length}function i(e,t){var r=self.slice||!c&&self.subarray;if(r)return r.call(self,e,t);r=l.alloc.call(self,t-e);return n.call(self,r,0,e,t),r}var u=e("./buffer-lite");s.copy=n,s.slice=i,s.toString=function o(e,t,r){return(!a&&l.isBuffer(self)?self:u).toString.apply(self,arguments)},s.write=function f(e){return function r(){return(self[e]||u[e]).apply(self,arguments)}}("write");var l=e("./bufferish"),e=l.global,a=l.hasBuffer&&"TYPED_ARRAY_SUPPORT"in e,c=a&&!e.TYPED_ARRAY_SUPPORT},{"./buffer-lite":3,"./bufferish":8}],7:[function(e,t,s){function n(e){return new Uint8Array(e)}var a=e("./bufferish");(s=t.exports=a.hasArrayBuffer?n(0):[]).alloc=n,s.concat=a.concat,s.from=function i(e){if(a.isView(e)){var t=e.byteOffset,r=e.byteLength;(e=e.buffer).byteLength!==r&&(e.slice?e=e.slice(t,t+r):(e=new Uint8Array(e)).byteLength!==r&&(e=Array.prototype.slice.call(e,t,t+r)))}else{if("string"==typeof e)return a.from.call(s,e);if("number"==typeof e)throw new TypeError(\'"value" argument must not be a number\')}return new Uint8Array(e)}},{"./bufferish":8}],8:[function(e,t,l){function i(e){return a(self).alloc(e)}function a(e){return g(e)?m:_(e)?y:p(e)?v:h?m:d?y:v}function s(){return!1}function c(t,r){return t="[object "+t+"]",function(e){return null!=e&&{}.toString.call(r?e[r]:e)===t}}var r=l.global=e("./buffer-global"),h=l.hasBuffer=r&&!!r.isBuffer,d=l.hasArrayBuffer="undefined"!=typeof ArrayBuffer,p=l.isArray=e("isarray");l.isArrayBuffer=d?function f(e){return e instanceof ArrayBuffer||b(e)}:s;var g=l.isBuffer=h?r.isBuffer:s,_=l.isView=d?ArrayBuffer.isView||c("ArrayBuffer","buffer"):s;l.alloc=i,l.concat=function o(e,t){t||(t=0,Array.prototype.forEach.call(e,function n(e){t+=e.length}));var r=self!==l&&self||e[0],s=i.call(r,t),a=0;return Array.prototype.forEach.call(e,function o(e){a+=w.copy.call(e,s,a)}),s},l.from=function n(e){return"string"==typeof e?function u(e){var t=3*e.length,r=i.call(self,t),e=w.write.call(r,e);return t!==e&&(r=w.slice.call(r,0,e)),r}.call(self,e):a(self).from(e)};var v=l.Array=e("./bufferish-array"),m=l.Buffer=e("./bufferish-buffer"),y=l.Uint8Array=e("./bufferish-uint8array"),w=l.prototype=e("./bufferish-proto"),b=c("ArrayBuffer")},{"./buffer-global":2,"./bufferish-array":4,"./bufferish-buffer":5,"./bufferish-proto":6,"./bufferish-uint8array":7,isarray:34}],9:[function(e,t,r){function n(e){return self instanceof n?(self.options=e,void self.init()):new n(e)}function a(e){return new n(e)}var s=e("isarray");r.createCodec=a,r.install=function i(e){for(var t in e)n.prototype[t]=function o(t,r){return t&&r?function e(){return t.apply(self,arguments),r.apply(self,arguments)}:t||r}(n.prototype[t],e[t])},r.filter=function u(e){return s(e)?function f(t){function r(e,t){return t(e)}return t=t.slice(),function(e){return t.reduce(r,e)}}(e):e};var o=e("./bufferish");n.prototype.init=function(){var e=self.options;return e&&e.uint8array&&(self.bufferish=o.Uint8Array),self},r.preset=a({preset:!0})},{"./bufferish":8,isarray:34}],10:[function(e,t,r){e("./read-core"),e("./write-core"),r.codec={preset:e("./codec-base").preset}},{"./codec-base":9,"./read-core":22,"./write-core":25}],11:[function(e,t,r){function n(e){if(!(self instanceof n))return new n(e);e&&(self.options=e).codec&&((e=self.codec=e.codec).bufferish&&(self.bufferish=e.bufferish))}r.DecodeBuffer=n;r=e("./read-core").preset;e("./flex-buffer").FlexDecoder.mixin(n.prototype),n.prototype.codec=r,n.prototype.fetch=function(){return self.codec.decode(self)}},{"./flex-buffer":21,"./read-core":22}],12:[function(e,t,r){r.decode=function n(e,t){return(t=new i(t)).write(e),t.read()};var i=e("./decode-buffer").DecodeBuffer},{"./decode-buffer":11}],13:[function(e,t,r){function n(e){return self instanceof n?void i.call(self,e):new n(e)}r.Decoder=n;var r=e("event-lite"),i=e("./decode-buffer").DecodeBuffer;n.prototype=new i,r.mixin(n.prototype),n.prototype.decode=function(e){arguments.length&&self.write(e),self.flush()},n.prototype.push=function(e){self.emit("data",e)},n.prototype.end=function(e){self.decode(e),self.emit("end")}},{"./decode-buffer":11,"event-lite":31}],14:[function(e,t,r){function n(e){if(!(self instanceof n))return new n(e);e&&(self.options=e).codec&&((e=self.codec=e.codec).bufferish&&(self.bufferish=e.bufferish))}r.EncodeBuffer=n;r=e("./write-core").preset;e("./flex-buffer").FlexEncoder.mixin(n.prototype),n.prototype.codec=r,n.prototype.write=function(e){self.codec.encode(self,e)}},{"./flex-buffer":21,"./write-core":25}],15:[function(e,t,r){r.encode=function n(e,t){return(t=new i(t)).write(e),t.read()};var i=e("./encode-buffer").EncodeBuffer},{"./encode-buffer":14}],16:[function(e,t,r){function n(e){return self instanceof n?void i.call(self,e):new n(e)}r.Encoder=n;var r=e("event-lite"),i=e("./encode-buffer").EncodeBuffer;n.prototype=new i,r.mixin(n.prototype),n.prototype.encode=function(e){self.write(e),self.emit("data",self.read())},n.prototype.end=function(e){arguments.length&&self.encode(e),self.flush(),self.emit("end")}},{"./encode-buffer":14,"event-lite":31}],17:[function(e,t,r){r.ExtBuffer=function n(e,t){return self instanceof n?(self.buffer=i.from(e),void(self.type=t)):new n(e,t)};var i=e("./bufferish")},{"./bufferish":8}],18:[function(t,e,r){function i(e){return(s=s||t("./encode").encode)(e)}function o(e){return e.valueOf()}function f(e){(e=RegExp.prototype.toString.call(e).split("/")).shift();var t=[e.pop()];return t.unshift(e.join("/")),t}function u(e){var t,r={};for(t in h)r[t]=e[t];return r}r.setExtPackers=function n(e){e.addExtPacker(14,Error,[u,i]),e.addExtPacker(1,EvalError,[u,i]),e.addExtPacker(2,RangeError,[u,i]),e.addExtPacker(3,ReferenceError,[u,i]),e.addExtPacker(4,SyntaxError,[u,i]),e.addExtPacker(5,TypeError,[u,i]),e.addExtPacker(6,URIError,[u,i]),e.addExtPacker(10,RegExp,[f,i]),e.addExtPacker(11,Boolean,[o,i]),e.addExtPacker(12,String,[o,i]),e.addExtPacker(13,Date,[Number,i]),e.addExtPacker(15,Number,[o,i]),"undefined"!=typeof Uint8Array&&(e.addExtPacker(17,Int8Array,c),e.addExtPacker(18,Uint8Array,c),e.addExtPacker(19,Int16Array,c),e.addExtPacker(20,Uint16Array,c),e.addExtPacker(21,Int32Array,c),e.addExtPacker(22,Uint32Array,c),e.addExtPacker(23,Float32Array,c),"undefined"!=typeof Float64Array&&e.addExtPacker(24,Float64Array,c),"undefined"!=typeof Uint8ClampedArray&&e.addExtPacker(25,Uint8ClampedArray,c),e.addExtPacker(26,ArrayBuffer,c),e.addExtPacker(29,DataView,c)),a.hasBuffer&&e.addExtPacker(27,l,a.from)};var s,a=t("./bufferish"),l=a.global,c=a.Uint8Array.from,h={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1}},{"./bufferish":8,"./encode":15}],19:[function(t,e,r){function i(e){return(s=s||t("./decode").decode)(e)}function o(e){return RegExp.apply(null,e)}function f(n){return function(e){var t,r=new n;for(t in h)r[t]=e[t];return r}}function u(t){return function(e){return new t(e)}}function a(e){return new Uint8Array(e).buffer}r.setExtUnpackers=function n(e){e.addExtUnpacker(14,[i,f(Error)]),e.addExtUnpacker(1,[i,f(EvalError)]),e.addExtUnpacker(2,[i,f(RangeError)]),e.addExtUnpacker(3,[i,f(ReferenceError)]),e.addExtUnpacker(4,[i,f(SyntaxError)]),e.addExtUnpacker(5,[i,f(TypeError)]),e.addExtUnpacker(6,[i,f(URIError)]),e.addExtUnpacker(10,[i,o]),e.addExtUnpacker(11,[i,u(Boolean)]),e.addExtUnpacker(12,[i,u(String)]),e.addExtUnpacker(13,[i,u(Date)]),e.addExtUnpacker(15,[i,u(Number)]),"undefined"!=typeof Uint8Array&&(e.addExtUnpacker(17,u(Int8Array)),e.addExtUnpacker(18,u(Uint8Array)),e.addExtUnpacker(19,[a,u(Int16Array)]),e.addExtUnpacker(20,[a,u(Uint16Array)]),e.addExtUnpacker(21,[a,u(Int32Array)]),e.addExtUnpacker(22,[a,u(Uint32Array)]),e.addExtUnpacker(23,[a,u(Float32Array)]),"undefined"!=typeof Float64Array&&e.addExtUnpacker(24,[a,u(Float64Array)]),"undefined"!=typeof Uint8ClampedArray&&e.addExtUnpacker(25,u(Uint8ClampedArray)),e.addExtUnpacker(26,a),e.addExtUnpacker(29,[a,u(DataView)])),l.hasBuffer&&e.addExtUnpacker(27,u(c))};var s,l=t("./bufferish"),c=l.global,h={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1}},{"./bufferish":8,"./decode":12}],20:[function(e,t,r){e("./read-core"),e("./write-core"),r.createCodec=e("./codec-base").createCodec},{"./codec-base":9,"./read-core":22,"./write-core":25}],21:[function(d,p,g){function n(){if(!(self instanceof n))return new n}function i(){if(!(self instanceof i))return new i}function u(){throw new Error("method not implemented: write()")}function a(){throw new Error("method not implemented: fetch()")}function s(){return self.buffers&&self.buffers.length?(self.flush(),self.pull()):self.fetch()}function c(e){(self.buffers||(self.buffers=[])).push(e)}function h(){return(self.buffers||(self.buffers=[])).shift()}function l(n){return function r(e){for(var t in n)e[t]=n[t];return e}}g.FlexDecoder=n,g.FlexEncoder=i;var _=d("./bufferish"),v="BUFFER_SHORTAGE";n.mixin=l(function o(){return{bufferish:_,write:function t(e){var r=self.offset?_.prototype.slice.call(self.buffer,self.offset):self.buffer;self.buffer=r?e?self.bufferish.concat([r,e]):r:e,self.offset=0},fetch:a,flush:function r(){for(;self.offset<self.buffer.length;){var e,t=self.offset;try{e=self.fetch()}catch(e){if(e&&e.message!=v)throw e;self.offset=t;break}self.push(e)}},push:c,pull:h,read:s,reserve:function e(t){var r=self.offset;if((t=r+t)>self.buffer.length)throw new Error(v);return self.offset=t,r},offset:0}}()),n.mixin(n.prototype),i.mixin=l(function f(){return{bufferish:_,write:u,fetch:function t(){var e=self.start;if(e<self.offset){var r=self.start=self.offset;return _.prototype.slice.call(self.buffer,e,r)}},flush:function r(){for(;self.start<self.offset;){var e=self.fetch();e&&self.push(e)}},push:c,pull:function e(){var t=self.buffers||(self.buffers=[]),r=1<t.length?self.bufferish.concat(t):t[0];return t.length=0,r},read:s,reserve:function n(e){var t=0|e;if(self.buffer){var r=self.buffer.length,i=0|self.offset,s=i+t;if(s<r)return self.offset=s,i;self.flush(),e=Math.max(e,Math.min(2*r,self.maxBufferSize))}return e=Math.max(e,self.minBufferSize),self.buffer=self.bufferish.alloc(e),self.start=0,self.offset=t,0},send:function i(e){var t=e.length;t>self.minBufferSize?(self.flush(),self.push(e)):(t=self.reserve(t),_.prototype.copy.call(e,self.buffer,t))},maxBufferSize:65536,minBufferSize:2048,offset:0,start:0}}()),i.mixin(i.prototype)},{"./bufferish":8}],22:[function(e,t,s){function n(e){var i=c.getReadToken(e);return function r(e){var t=l(e),n=i[t];if(!n)throw new Error("Invalid type: "+(t&&"0x"+t.toString(16)));return n(e)}}function i(){var e=self.options;return self.decode=n(e),e&&e.preset&&u.setExtUnpackers(self),self}var a=e("./ext-buffer").ExtBuffer,u=e("./ext-unpacker"),l=e("./read-format").readUint8,c=e("./read-token"),h=e("./codec-base");h.install({addExtUnpacker:function o(e,t){(self.extUnpackers||(self.extUnpackers=[]))[e]=h.filter(t)},getExtUnpacker:function f(t){return(self.extUnpackers||(self.extUnpackers=[]))[t]||function r(e){return new a(e,t)}},init:i}),s.preset=i.call(h.preset)},{"./codec-base":9,"./ext-buffer":17,"./ext-unpacker":19,"./read-format":23,"./read-token":24}],23:[function(e,t,r){function i(e,t){for(var r={},n=new Array(t),i=new Array(t),s=e.codec.decode,a=0;a<t;a++)n[a]=s(e),i[a]=s(e);for(a=0;a<t;a++)r[n[a]]=i[a];return r}function o(e,t){for(var r=new Map,n=new Array(t),i=new Array(t),s=e.codec.decode,a=0;a<t;a++)n[a]=s(e),i[a]=s(e);for(a=0;a<t;a++)r.set(n[a],i[a]);return r}function f(e,t){for(var r=new Array(t),n=e.codec.decode,i=0;i<t;i++)r[i]=n(e);return r}function u(e,t){var r=e.reserve(t),t=r+t;return B.toString.call(e.buffer,"utf-8",r,t)}function a(e,t){var r=e.reserve(t),t=r+t,t=B.slice.call(e.buffer,r,t);return R.from(t)}function s(e,t){var r=e.reserve(t),t=r+t,t=B.slice.call(e.buffer,r,t);return R.Uint8Array.from(t).buffer}function c(e,t){var r=e.reserve(t+1),n=e.buffer[r++],i=r+t,t=e.codec.getExtUnpacker(n);if(!t)throw new Error("Invalid ext type: "+(n&&"0x"+n.toString(16)));return t(B.slice.call(e.buffer,r,i))}function h(e){var t=e.reserve(1);return e.buffer[t]}function l(e){var t=e.reserve(1),t=e.buffer[t];return 128&t?t-256:t}function p(e){var t=e.reserve(2),e=e.buffer;return e[t++]<<8|e[t]}function d(e){var t=e.reserve(2),e=e.buffer,t=e[t++]<<8|e[t];return 32768&t?t-65536:t}function y(e){var t=e.reserve(4),e=e.buffer;return 16777216*e[t++]+(e[t++]<<16)+(e[t++]<<8)+e[t]}function v(e){var t=e.reserve(4),e=e.buffer;return e[t++]<<24|e[t++]<<16|e[t++]<<8|e[t]}function g(r,n){return function(e){var t=e.reserve(r);return n.call(e.buffer,t,M)}}function b(e){return new k(self,e).toNumber()}function w(e){return new C(self,e).toNumber()}function E(e){return new k(self,e)}function A(e){return new C(self,e)}function m(e){return _.read(self,e,!1,23,4)}function x(e){return _.read(self,e,!1,52,8)}var _=e("ieee754"),S=e("int64-buffer"),k=S.Uint64BE,C=S.Int64BE;r.getReadFormat=function n(e){var t=R.hasArrayBuffer&&e&&e.binarraybuffer,r=e&&e.int64;return{map:P&&e&&e.usemap?o:i,array:f,str:u,bin:t?s:a,ext:c,uint8:h,uint16:p,uint32:y,uint64:g(8,r?E:b),int8:l,int16:d,int32:v,int64:g(8,r?A:w),float32:g(4,m),float64:g(8,x)}},r.readUint8=h;var R=e("./bufferish"),B=e("./bufferish-proto"),P="undefined"!=typeof Map,M=!0},{"./bufferish":8,"./bufferish-proto":6,ieee754:32,"int64-buffer":33}],24:[function(e,t,r){function i(e){for(var t=new Array(256),r=0;r<=127;r++)t[r]=f(r);for(r=128;r<=143;r++)t[r]=a(r-128,e.map);for(r=144;r<=159;r++)t[r]=a(r-144,e.array);for(r=160;r<=191;r++)t[r]=a(r-160,e.str);for(t[192]=f(null),t[193]=null,t[194]=f(!1),t[195]=f(!0),t[196]=u(e.uint8,e.bin),t[197]=u(e.uint16,e.bin),t[198]=u(e.uint32,e.bin),t[199]=u(e.uint8,e.ext),t[200]=u(e.uint16,e.ext),t[201]=u(e.uint32,e.ext),t[202]=e.float32,t[203]=e.float64,t[204]=e.uint8,t[205]=e.uint16,t[206]=e.uint32,t[207]=e.uint64,t[208]=e.int8,t[209]=e.int16,t[210]=e.int32,t[211]=e.int64,t[212]=a(1,e.ext),t[213]=a(2,e.ext),t[214]=a(4,e.ext),t[215]=a(8,e.ext),t[216]=a(16,e.ext),t[217]=u(e.uint8,e.str),t[218]=u(e.uint16,e.str),t[219]=u(e.uint32,e.str),t[220]=u(e.uint16,e.array),t[221]=u(e.uint32,e.array),t[222]=u(e.uint16,e.map),t[223]=u(e.uint32,e.map),r=224;r<=255;r++)t[r]=f(r-256);return t}function f(e){return function(){return e}}function u(r,n){return function(e){var t=r(e);return n(e,t)}}function a(t,r){return function(e){return r(e,t)}}var s=e("./read-format");r.getReadToken=function n(e){var t=s.getReadFormat(e);return(e&&e.useraw?function o(e){var t,r=i(e).slice();for(r[217]=r[196],r[218]=r[197],r[219]=r[198],t=160;t<=191;t++)r[t]=a(t-160,e.bin);return r}:i)(t)}},{"./read-format":23}],25:[function(e,t,r){function n(e){var i=u.getWriteType(e);return function r(e,t){var n=i[_typeof(t)];if(!n)throw new Error(\'Unsupported type "\'+_typeof(t)+\'": \'+t);n(e,t)}}function i(){var e=self.options;return self.encode=n(e),e&&e.preset&&a.setExtPackers(self),self}var s=e("./ext-buffer").ExtBuffer,a=e("./ext-packer"),u=e("./write-type"),f=e("./codec-base");f.install({addExtPacker:function o(t,e,r){function n(e){return r&&(e=r(e)),new s(e,t)}r=f.filter(r);var i=e.name;i&&"Object"!==i?(self.extPackers||(self.extPackers={}))[i]=n:(self.extEncoderList||(self.extEncoderList=[])).unshift([e,n])},getExtPacker:function f(e){var t=self.extPackers||(self.extPackers={}),r=e.constructor;if(t=r&&r.name&&t[r.name])return t;for(var n=self.extEncoderList||(self.extEncoderList=[]),i=n.length,s=0;s<i;s++){var a=n[s];if(r===a[0])return a[1]}},init:i}),r.preset=i.call(f.preset)},{"./codec-base":9,"./ext-buffer":17,"./ext-packer":18,"./write-type":27}],26:[function(e,t,r){function o(){var e=y.slice();return e[196]=u(196),e[197]=a(197),e[198]=s(198),e[199]=u(199),e[200]=a(200),e[201]=s(201),e[202]=c(202,4,k.writeFloatBE||p,!0),e[203]=c(203,8,k.writeDoubleBE||d,!0),e[204]=u(204),e[205]=a(205),e[206]=s(206),e[207]=c(207,8,h),e[208]=u(208),e[209]=a(209),e[210]=s(210),e[211]=c(211,8,l),e[217]=u(217),e[218]=a(218),e[219]=s(219),e[220]=a(220),e[221]=s(221),e[222]=a(222),e[223]=s(223),e}function u(n){return function(e,t){var r=e.reserve(2),e=e.buffer;e[r++]=n,e[r]=t}}function a(n){return function(e,t){var r=e.reserve(3),e=e.buffer;e[r++]=n,e[r++]=t>>>8,e[r]=t}}function s(n){return function(e,t){var r=e.reserve(5),e=e.buffer;e[r++]=n,e[r++]=t>>>24,e[r++]=t>>>16,e[r++]=t>>>8,e[r]=t}}function c(n,i,s,a){return function(e,t){var r=e.reserve(i+1);e.buffer[r++]=n,s.call(e.buffer,t,r,a)}}function h(e,t){new v(self,t,e)}function l(e,t){new m(self,t,e)}function p(e,t){g.write(self,e,t,!1,23,4)}function d(e,t){g.write(self,e,t,!1,52,8)}var g=e("ieee754"),_=e("int64-buffer"),v=_.Uint64BE,m=_.Int64BE,y=e("./write-uint8").uint8,w=e("./bufferish"),b=w.global,S=w.hasBuffer&&"TYPED_ARRAY_SUPPORT"in b&&!b.TYPED_ARRAY_SUPPORT,k=w.hasBuffer&&b.prototype||{};r.getWriteToken=function n(e){return(e&&e.uint8array?function i(){var e=o();return e[202]=c(202,4,p),e[203]=c(203,8,d),e}:S||w.hasBuffer&&e&&e.safe?function f(){var e=y.slice();return e[196]=c(196,1,b.prototype.writeUInt8),e[197]=c(197,2,b.prototype.writeUInt16BE),e[198]=c(198,4,b.prototype.writeUInt32BE),e[199]=c(199,1,b.prototype.writeUInt8),e[200]=c(200,2,b.prototype.writeUInt16BE),e[201]=c(201,4,b.prototype.writeUInt32BE),e[202]=c(202,4,b.prototype.writeFloatBE),e[203]=c(203,8,b.prototype.writeDoubleBE),e[204]=c(204,1,b.prototype.writeUInt8),e[205]=c(205,2,b.prototype.writeUInt16BE),e[206]=c(206,4,b.prototype.writeUInt32BE),e[207]=c(207,8,h),e[208]=c(208,1,b.prototype.writeInt8),e[209]=c(209,2,b.prototype.writeInt16BE),e[210]=c(210,4,b.prototype.writeInt32BE),e[211]=c(211,8,l),e[217]=c(217,1,b.prototype.writeUInt8),e[218]=c(218,2,b.prototype.writeUInt16BE),e[219]=c(219,4,b.prototype.writeUInt32BE),e[220]=c(220,2,b.prototype.writeUInt16BE),e[221]=c(221,4,b.prototype.writeUInt32BE),e[222]=c(222,2,b.prototype.writeUInt16BE),e[223]=c(223,4,b.prototype.writeUInt32BE),e}:o)()}},{"./bufferish":8,"./write-uint8":28,ieee754:32,"int64-buffer":33}],27:[function(e,t,i){var c=e("isarray"),s=e("int64-buffer"),h=s.Uint64BE,d=s.Int64BE,p=e("./bufferish"),g=e("./bufferish-proto"),_=e("./write-token"),v=e("./write-uint8").uint8,y=e("./ext-buffer").ExtBuffer,S="undefined"!=typeof Uint8Array,C="undefined"!=typeof Map,M=[];M[1]=212,M[2]=213,M[4]=214,M[8]=215,M[16]=216,i.getWriteType=function n(t){function w(e,t){if(null===t)return A(e,t);if(a(t))return u(e,t);if(c(t))return function m(e,t){var r=t.length;f[r<16?144+r:r<=65535?220:221](e,r);for(var n=e.codec.encode,i=0;i<r;i++)n(e,t[i])}(e,t);if(h.isUint64BE(t))return function n(e,t){f[207](e,t.toArray())}(e,t);if(d.isInt64BE(t))return function o(e,t){f[211](e,t.toArray())}(e,t);var r=e.codec.getExtPacker(t);return r&&(t=r(t)),t instanceof y?function U(e,t){var r=t.buffer,n=r.length,i=M[n]||(n<255?199:n<=65535?200:201);f[i](e,n),v[t.type](e),e.send(r)}(e,t):void l(e,t)}function A(e,t){f[192](e,t)}function x(e,t){var r=t.length;f[r<255?196:r<=65535?197:198](e,r),e.send(t)}function P(t,r){var e=Object.keys(r),n=e.length;f[n<16?128+n:n<=65535?222:223](t,n);var i=t.codec.encode;e.forEach(function(e){i(t,e),i(t,r[e])})}var f=_.getWriteToken(t),i=t&&t.useraw,s=S&&t&&t.binarraybuffer,a=s?p.isArrayBuffer:p.isBuffer,u=s?function B(e,t){x(e,new Uint8Array(t))}:x,l=C&&t&&t.usemap?function R(n,e){if(!(e instanceof Map))return P(n,e);var t=e.size;f[t<16?128+t:t<=65535?222:223](n,t);var i=n.codec.encode;e.forEach(function(e,t,r){i(n,t),i(n,e)})}:P;return{boolean:function r(e,t){f[t?195:194](e,t)},function:A,number:function e(t,r){var n=0|r;return r!==n?void f[203](t,r):void f[-32<=n&&n<=127?255&n:0<=n?n<=255?204:n<=65535?205:206:-128<=n?208:-32768<=n?209:210](t,n)},object:i?function E(e,t){return a(t)?function k(e,t){var r=t.length;f[r<32?160+r:r<=65535?218:219](e,r),e.send(t)}(e,t):void w(e,t)}:w,string:function b(u){return function r(e,t){var n=5+3*(o=t.length);e.offset=e.reserve(n);var i=e.buffer,s=u(o),a=e.offset+s,o=g.write.call(i,t,a),n=u(o);s!==n&&(t=a+n-s,s=a+o,g.copy.call(i,i,t,a,s)),f[1===n?160+o:n<=3?215+n:219](e,o),e.offset+=o}}(i?function g(e){return e<32?1:e<=65535?3:5}:function v(e){return e<32?1:e<=255?2:e<=65535?3:5}),symbol:A,undefined:A}}},{"./bufferish":8,"./bufferish-proto":6,"./ext-buffer":17,"./write-token":26,"./write-uint8":28,"int64-buffer":33,isarray:34}],28:[function(e,t,r){for(var n=r.uint8=new Array(256),i=0;i<=255;i++)n[i]=function n(r){return function(e){var t=e.reserve(1);e.buffer[t]=r}}(i)},{}],29:[function(r,e,n){(function(e){"use strict";function i(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(i()<t)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Buffer.prototype:(null===e&&(e=new Buffer(t)),e.length=t),e}function Buffer(e,t,r){if(!(Buffer.TYPED_ARRAY_SUPPORT||self instanceof Buffer))return new Buffer(e,t,r);if("number"!=typeof e)return f(self,e,t,r);if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return s(self,e)}function f(e,t,r,n){if("number"==typeof t)throw new TypeError(\'"value" argument must not be a number\');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function l(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("\'offset\' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("\'length\' is out of bounds");return t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),Buffer.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Buffer.prototype:e=h(e,t),e}(e,t,r,n):"string"==typeof t?function c(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!Buffer.isEncoding(r))throw new TypeError(\'"encoding" must be a valid string encoding\');var n=0|v(t,r),r=(e=o(e,n)).write(t,r);return r!==n&&(e=e.slice(0,r)),e}(e,t,r):function p(e,t){if(Buffer.isBuffer(t)){var r=0|d(t.length);return 0===(e=o(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function H(e){return e!=e}(t.length)?o(e,0):h(e,t);if("Buffer"===t.type&&I(t.data))return h(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError(\'"size" argument must be a number\');if(e<0)throw new RangeError(\'"size" argument must not be negative\')}function s(e,t){if(u(t),e=o(e,t<0?0:0|d(t)),!Buffer.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function h(e,t){var r=t.length<0?0:0|d(t.length);e=o(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function d(e){if(e>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|e}function v(e,t){if(Buffer.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return q(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return X(e).length;default:if(n)return q(e).length;t=(""+t).toLowerCase(),n=!0}}function g(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>self.length)return"";if((void 0===r||r>self.length)&&(r=self.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":return function I(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||n<r)&&(r=n);for(var i="",s=t;s<r;++s)i+=function V(e){return e<16?"0"+e.toString(16):e.toString(16)}(e[s]);return i}(self,t,r);case"utf8":case"utf-8":return k(self,t,r);case"ascii":return function T(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(self,t,r);case"latin1":case"binary":return function S(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(self,t,r);case"base64":return function R(e,t,r){return 0===t&&r===e.length?S.fromByteArray(e):S.fromByteArray(e.slice(t,r))}(self,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function Y(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}(self,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function b(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function w(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=Buffer.from(t,n)),Buffer.isBuffer(t))return 0===t.length?-1:E(e,t,r,n,i);if("number"==typeof t)return t&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?(i?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,r):E(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function E(e,t,r,n,i){function o(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var s=1,a=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a/=s=2,u/=2,r/=2}if(i)for(var f=-1,l=r;l<a;l++)if(o(e,l)===o(t,-1===f?0:l-f)){if(-1===f&&(f=l),l-f+1===u)return f*s}else-1!==f&&(l-=l-f),f=-1;else for(a<r+u&&(r=a-u),l=r;0<=l;l--){for(var c=!0,h=0;h<u;h++)if(o(e,l+h)!==o(t,h)){c=!1;break}if(c)return l}return-1}function x(e,t,r,n){return G(function W(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function P(e,t,r,n){return G(function J(e,t){for(var r,n,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,n=n%256,i.push(n),i.push(r);return i}(t,e.length-r),e,r,n)}function k(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,a,o,u,f=e[i],l=null,c=239<f?4:223<f?3:191<f?2:1;if(i+c<=r)switch(c){case 1:f<128&&(l=f);break;case 2:128==(192&(s=e[i+1]))&&(127<(u=(31&f)<<6|63&s)&&(l=u));break;case 3:s=e[i+1],a=e[i+2],128==(192&s)&&128==(192&a)&&(2047<(u=(15&f)<<12|(63&s)<<6|63&a)&&(u<55296||57343<u)&&(l=u));break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],128==(192&s)&&128==(192&a)&&128==(192&o)&&(65535<(u=(15&f)<<18|(63&s)<<12|(63&a)<<6|63&o)&&u<1114112&&(l=u))}null===l?(l=65533,c=1):65535<l&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=c}return function _(e){var t=e.length;if(t<=A)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=A));return r}(n)}function C(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(r<e+t)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,r,n,i,s){if(!Buffer.isBuffer(e))throw new TypeError(\'"buffer" argument must be a Buffer instance\');if(i<t||t<s)throw new RangeError(\'"value" argument is out of bounds\');if(r+n>e.length)throw new RangeError("Index out of range")}function O(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,s=Math.min(e.length-r,2);i<s;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function L(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,s=Math.min(e.length-r,4);i<s;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function M(e,t,r,n){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function N(e,t,r,n,i){return i||M(e,0,r,4),B.write(e,t,r,n,23,4),r+4}function F(e,t,r,n,i){return i||M(e,0,r,8),B.write(e,t,r,n,52,8),r+8}function j(e){if((e=function z(e){return e.trim?e.trim():e.replace(/^\\s+|\\s+$/g,"")}(e).replace(t,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function q(e,t){t=t||1/0;for(var r,n=e.length,i=null,s=[],a=0;a<n;++a){if(55295<(r=e.charCodeAt(a))&&r<57344){if(!i){if(56319<r){-1<(t-=3)&&s.push(239,191,189);continue}if(a+1===n){-1<(t-=3)&&s.push(239,191,189);continue}i=r;continue}if(r<56320){-1<(t-=3)&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&-1<(t-=3)&&s.push(239,191,189);if(i=null,r<128){if(--t<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function X(e){return S.toByteArray(j(e))}function G(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}var S=r("base64-js"),B=r("ieee754"),I=r("isarray");n.Buffer=Buffer,n.SlowBuffer=function y(e){return+e!=e&&(e=0),Buffer.alloc(+e)},n.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function n(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function foo(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),n.kMaxLength=i(),Buffer.poolSize=8192,Buffer._augment=function(e){return e.__proto__=Buffer.prototype,e},Buffer.from=function(e,t,r){return f(null,e,t,r)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(e,t,r){return function a(e,t,r,n){return u(t),!(t<=0)&&void 0!==r?"string"==typeof n?o(e,t).fill(r,n):o(e,t).fill(r):o(e,t)}(null,e,t,r)},Buffer.allocUnsafe=function(e){return s(null,e)},Buffer.allocUnsafeSlow=function(e){return s(null,e)},Buffer.isBuffer=function(e){return!(null==e||!e._isBuffer)},Buffer.compare=function(e,t){if(!Buffer.isBuffer(e)||!Buffer.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},Buffer.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(e,t){if(!I(e))throw new TypeError(\'"list" argument must be an Array of Buffers\');if(0===e.length)return Buffer.alloc(0);if(void 0===t)for(i=t=0;i<e.length;++i)t+=e[i].length;for(var r=Buffer.allocUnsafe(t),n=0,i=0;i<e.length;++i){var s=e[i];if(!Buffer.isBuffer(s))throw new TypeError(\'"list" argument must be an Array of Buffers\');s.copy(r,n),n+=s.length}return r},Buffer.byteLength=v,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var e=self.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)b(self,t,t+1);return self},Buffer.prototype.swap32=function(){var e=self.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)b(self,t,t+3),b(self,t+1,t+2);return self},Buffer.prototype.swap64=function(){var e=self.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)b(self,t,t+7),b(self,t+1,t+6),b(self,t+2,t+5),b(self,t+3,t+4);return self},Buffer.prototype.toString=function(){var e=0|self.length;return 0==e?"":0===arguments.length?k(self,0,e):g.apply(self,arguments)},Buffer.prototype.equals=function(e){if(!Buffer.isBuffer(e))throw new TypeError("Argument must be a Buffer");return self===e||0===Buffer.compare(self,e)},Buffer.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return 0<self.length&&(e=self.toString("hex",0,t).match(/.{2}/g).join(" "),self.length>t&&(e+=" ... ")),"<Buffer "+e+">"},Buffer.prototype.compare=function(e,t,r,n,i){if(!Buffer.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=self.length),t<0||r>e.length||n<0||i>self.length)throw new RangeError("out of range index");if(i<=n&&r<=t)return 0;if(i<=n)return-1;if(r<=t)return 1;if(self===e)return 0;for(var s=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0),o=Math.min(s,a),u=self.slice(n,i),f=e.slice(t,r),l=0;l<o;++l)if(u[l]!==f[l]){s=u[l],a=f[l];break}return s<a?-1:a<s?1:0},Buffer.prototype.includes=function(e,t,r){return-1!==self.indexOf(e,t,r)},Buffer.prototype.indexOf=function(e,t,r){return w(self,e,t,r,!0)},Buffer.prototype.lastIndexOf=function(e,t,r){return w(self,e,t,r,!1)},Buffer.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=self.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=self.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=self.length-t;if((void 0===r||i<r)&&(r=i),0<e.length&&(r<0||t<0)||t>self.length)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(var s=!1;;)switch(n){case"hex":return function A(e,t,r,n){r=Number(r)||0;var i=e.length-r;if(n?i<(n=Number(n))&&(n=i):n=i,(i=t.length)%2!=0)throw new TypeError("Invalid hex string");i/2<n&&(n=i/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}(self,e,t,r);case"utf8":case"utf-8":return function m(e,t,r,n){return G(q(t,e.length-r),e,r,n)}(self,e,t,r);case"ascii":return x(self,e,t,r);case"latin1":case"binary":return x(self,e,t,r);case"base64":return function U(e,t,r,n){return G(X(t),e,r,n)}(self,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(self,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(self._arr||self,0)}};var A=4096;Buffer.prototype.slice=function(e,t){var r=self.length;if((e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),t<e&&(t=e),Buffer.TYPED_ARRAY_SUPPORT)(i=self.subarray(e,t)).__proto__=Buffer.prototype;else for(var n=t-e,i=new Buffer(n,void 0),s=0;s<n;++s)i[s]=self[s+e];return i},Buffer.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||C(e,t,self.length);for(var n=self[e],i=1,s=0;++s<t&&(i*=256);)n+=self[e+s]*i;return n},Buffer.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||C(e,t,self.length);for(var n=self[e+--t],i=1;0<t&&(i*=256);)n+=self[e+--t]*i;return n},Buffer.prototype.readUInt8=function(e,t){return t||C(e,1,self.length),self[e]},Buffer.prototype.readUInt16LE=function(e,t){return t||C(e,2,self.length),self[e]|self[e+1]<<8},Buffer.prototype.readUInt16BE=function(e,t){return t||C(e,2,self.length),self[e]<<8|self[e+1]},Buffer.prototype.readUInt32LE=function(e,t){return t||C(e,4,self.length),(self[e]|self[e+1]<<8|self[e+2]<<16)+16777216*self[e+3]},Buffer.prototype.readUInt32BE=function(e,t){return t||C(e,4,self.length),16777216*self[e]+(self[e+1]<<16|self[e+2]<<8|self[e+3])},Buffer.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||C(e,t,self.length);for(var n=self[e],i=1,s=0;++s<t&&(i*=256);)n+=self[e+s]*i;return(i*=128)<=n&&(n-=Math.pow(2,8*t)),n},Buffer.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||C(e,t,self.length);for(var n=t,i=1,s=self[e+--n];0<n&&(i*=256);)s+=self[e+--n]*i;return(i*=128)<=s&&(s-=Math.pow(2,8*t)),s},Buffer.prototype.readInt8=function(e,t){return t||C(e,1,self.length),128&self[e]?-1*(255-self[e]+1):self[e]},Buffer.prototype.readInt16LE=function(e,t){t||C(e,2,self.length);e=self[e]|self[e+1]<<8;return 32768&e?4294901760|e:e},Buffer.prototype.readInt16BE=function(e,t){t||C(e,2,self.length);e=self[e+1]|self[e]<<8;return 32768&e?4294901760|e:e},Buffer.prototype.readInt32LE=function(e,t){return t||C(e,4,self.length),self[e]|self[e+1]<<8|self[e+2]<<16|self[e+3]<<24},Buffer.prototype.readInt32BE=function(e,t){return t||C(e,4,self.length),self[e]<<24|self[e+1]<<16|self[e+2]<<8|self[e+3]},Buffer.prototype.readFloatLE=function(e,t){return t||C(e,4,self.length),B.read(self,e,!0,23,4)},Buffer.prototype.readFloatBE=function(e,t){return t||C(e,4,self.length),B.read(self,e,!1,23,4)},Buffer.prototype.readDoubleLE=function(e,t){return t||C(e,8,self.length),B.read(self,e,!0,52,8)},Buffer.prototype.readDoubleBE=function(e,t){return t||C(e,8,self.length),B.read(self,e,!1,52,8)},Buffer.prototype.writeUIntLE=function(e,t,r,n){e=+e,t|=0,r|=0,n||D(self,e,t,r,Math.pow(2,8*r)-1,0);var i=1,s=0;for(self[t]=255&e;++s<r&&(i*=256);)self[t+s]=e/i&255;return t+r},Buffer.prototype.writeUIntBE=function(e,t,r,n){e=+e,t|=0,r|=0,n||D(self,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,s=1;for(self[t+i]=255&e;0<=--i&&(s*=256);)self[t+i]=e/s&255;return t+r},Buffer.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||D(self,e,t,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),self[t]=255&e,t+1},Buffer.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||D(self,e,t,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(self[t]=255&e,self[t+1]=e>>>8):O(self,e,t,!0),t+2},Buffer.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||D(self,e,t,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(self[t]=e>>>8,self[t+1]=255&e):O(self,e,t,!1),t+2},Buffer.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||D(self,e,t,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(self[t+3]=e>>>24,self[t+2]=e>>>16,self[t+1]=e>>>8,self[t]=255&e):L(self,e,t,!0),t+4},Buffer.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||D(self,e,t,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(self[t]=e>>>24,self[t+1]=e>>>16,self[t+2]=e>>>8,self[t+3]=255&e):L(self,e,t,!1),t+4},Buffer.prototype.writeIntLE=function(e,t,r,n){e=+e,t|=0,n||D(self,e,t,r,(n=Math.pow(2,8*r-1))-1,-n);var i=0,s=1,a=0;for(self[t]=255&e;++i<r&&(s*=256);)e<0&&0===a&&0!==self[t+i-1]&&(a=1),self[t+i]=(e/s>>0)-a&255;return t+r},Buffer.prototype.writeIntBE=function(e,t,r,n){e=+e,t|=0,n||D(self,e,t,r,(n=Math.pow(2,8*r-1))-1,-n);var i=r-1,s=1,a=0;for(self[t+i]=255&e;0<=--i&&(s*=256);)e<0&&0===a&&0!==self[t+i+1]&&(a=1),self[t+i]=(e/s>>0)-a&255;return t+r},Buffer.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||D(self,e,t,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),self[t]=255&e,t+1},Buffer.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||D(self,e,t,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(self[t]=255&e,self[t+1]=e>>>8):O(self,e,t,!0),t+2},Buffer.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||D(self,e,t,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(self[t]=e>>>8,self[t+1]=255&e):O(self,e,t,!1),t+2},Buffer.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||D(self,e,t,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(self[t]=255&e,self[t+1]=e>>>8,self[t+2]=e>>>16,self[t+3]=e>>>24):L(self,e,t,!0),t+4},Buffer.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||D(self,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Buffer.TYPED_ARRAY_SUPPORT?(self[t]=e>>>24,self[t+1]=e>>>16,self[t+2]=e>>>8,self[t+3]=255&e):L(self,e,t,!1),t+4},Buffer.prototype.writeFloatLE=function(e,t,r){return N(self,e,t,!0,r)},Buffer.prototype.writeFloatBE=function(e,t,r){return N(self,e,t,!1,r)},Buffer.prototype.writeDoubleLE=function(e,t,r){return F(self,e,t,!0,r)},Buffer.prototype.writeDoubleBE=function(e,t,r){return F(self,e,t,!1,r)},Buffer.prototype.copy=function(e,t,r,n){if(r=r||0,n||0===n||(n=self.length),t>=e.length&&(t=e.length),t=t||0,0<n&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===self.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=self.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>self.length&&(n=self.length),e.length-t<n-r&&(n=e.length-t+r);var i,s=n-r;if(self===e&&r<t&&t<n)for(i=s-1;0<=i;--i)e[i+t]=self[i+r];else if(s<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)e[i+t]=self[i+r];else Uint8Array.prototype.set.call(e,self.subarray(r,r+s),t);return s},Buffer.prototype.fill=function(e,t,r,n){if("string"==typeof e){var i;if("string"==typeof t?(n=t,t=0,r=self.length):"string"==typeof r&&(n=r,r=self.length),1===e.length&&(i=e.charCodeAt(0))<256&&(e=i),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||self.length<t||self.length<r)throw new RangeError("Out of range index");if(r<=t)return self;if(t>>>=0,r=void 0===r?self.length:r>>>0,"number"==typeof(e=e||0))for(o=t;o<r;++o)self[o]=e;else for(var s=Buffer.isBuffer(e)?e:q(new Buffer(e,n).toString()),a=s.length,o=0;o<r-t;++o)self[o+t]=s[o%a];return self};var t=/[^+\\/0-9A-Za-z-_]/g}).call(self,void 0!==m.g?m.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":30,ieee754:32,isarray:34}],30:[function(e,t,r){"use strict";function n(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function u(e,t,r){for(var n,i=[],s=t;s<r;s+=3)n=(e[s]<<16)+(e[s+1]<<8)+e[s+2],i.push(function f(e){return l[e>>18&63]+l[e>>12&63]+l[e>>6&63]+l[63&e]}(n));return i.join("")}r.byteLength=function i(e){return 3*e.length/4-n(e)},r.toByteArray=function o(e){for(var t,r=e.length,i=n(e),s=new h(3*r/4-i),a=0<i?r-4:r,u=0,f=0;f<a;f+=4,0)t=c[e.charCodeAt(f)]<<18|c[e.charCodeAt(f+1)]<<12|c[e.charCodeAt(f+2)]<<6|c[e.charCodeAt(f+3)],s[u++]=t>>16&255,s[u++]=t>>8&255,s[u++]=255&t;return 2===i?(t=c[e.charCodeAt(f)]<<2|c[e.charCodeAt(f+1)]>>4,s[u++]=255&t):1===i&&(t=c[e.charCodeAt(f)]<<10|c[e.charCodeAt(f+1)]<<4|c[e.charCodeAt(f+2)]>>2,s[u++]=t>>8&255,s[u++]=255&t),s},r.fromByteArray=function a(e){for(var t,r=e.length,n=r%3,i="",s=[],o=0,f=r-n;o<f;o+=16383)s.push(u(e,o,f<o+16383?f:o+16383));return 1==n?(t=e[r-1],i+=l[t>>2],i+=l[t<<4&63],i+="=="):2==n&&(t=(e[r-2]<<8)+e[r-1],i+=l[t>>10],i+=l[t>>4&63],i+=l[t<<2&63],i+="="),s.push(i),s.join("")};for(var l=[],c=[],h="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0,p=s.length;d<p;++d)l[d]=s[d],c[s.charCodeAt(d)]=d;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},{}],31:[function(t,a,r){!function(t){function e(e){for(var t in r)e[t]=r[t];return e}function o(t,r){var n,i=self;if(arguments.length){if(r){if(n=u(i,t,!0)){if(!(n=n.filter(function e(t){return t!==r&&t.originalListener!==r})).length)return o.call(i,t);i[s][t]=n}}else if((n=i[s])&&(delete n[t],!Object.keys(n).length))return o.call(i)}else delete i[s];return i}function u(e,t,r){if(!r||e[s]){e=e[s]||(e[s]={});return e[t]||(e[t]=[])}}void 0!==a&&(a.exports=t);var s="listeners",r={on:function n(e,t){return u(self,e).push(t),self},once:function i(t,r){function e(){o.call(n,t,e),r.apply(self,arguments)}var n=self;return e.originalListener=r,u(n,t).push(e),n},off:o,emit:function f(t,r){var s=self,a=u(s,t,!0);if(!a)return!1;var o,l=arguments.length;return 1===l?a.forEach(function e(t){t.call(s)}):2===l?a.forEach(function n(e){e.call(s,r)}):(o=Array.prototype.slice.call(arguments,1),a.forEach(function i(e){e.apply(s,o)})),!!a.length}};e(t.prototype),t.mixin=e}(function n(){if(!(self instanceof n))return new n})},{}],32:[function(e,t,r){r.read=function(e,t,r,n,i){var s,a,o=8*i-n-1,u=(1<<o)-1,f=u>>1,l=-7,c=r?i-1:0,h=r?-1:1,r=e[t+c];for(c+=h,s=r&(1<<-l)-1,r>>=-l,l+=o;0<l;s=256*s+e[t+c],c+=h,l-=8);for(a=s&(1<<-l)-1,s>>=-l,l+=n;0<l;a=256*a+e[t+c],c+=h,l-=8);if(0===s)s=1-f;else{if(s===u)return a?NaN:1/0*(r?-1:1);a+=Math.pow(2,n),s-=f}return(r?-1:1)*a*Math.pow(2,s-n)},r.write=function(e,t,r,n,i,s){var a,o,u=8*s-i-1,f=(1<<u)-1,l=f>>1,c=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:s-1,d=n?1:-1,s=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=f):(a=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-a))<1&&(a--,n*=2),2<=(t+=1<=a+l?c/n:c*Math.pow(2,1-l))*n&&(a++,n/=2),f<=a+l?(o=0,a=f):1<=a+l?(o=(t*n-1)*Math.pow(2,i),a+=l):(o=t*Math.pow(2,l-1)*Math.pow(2,i),a=0));8<=i;e[r+h]=255&o,h+=d,o/=256,i-=8);for(a=a<<i|o,u+=i;0<u;e[r+h]=255&a,h+=d,a/=256,u-=8);e[r+h-d]|=128*s}},{}],33:[function(e,t,r){(function(n){var D,I,A,W,T,L,U,g,O;function o(e,t,g){function i(e,t,r,n){return self instanceof i?function v(e,t,r,n,i){if(T&&L&&(t instanceof L&&(t=new T(t)),n instanceof L&&(n=new T(n))),!(t||r||n||I))return void(e.buffer=h(U,0));{var a;s(t,r)||(a=I||Array,i=r,n=t,r=0,t=new a(8))}e.buffer=t,e.offset=r|=0,A!==_typeof(n)&&("string"==typeof n?function x(e,t,r,n){var i=0,s=r.length,a=0,o=0;"-"===r[0]&&i++;for(var u=i;i<s;){var f=parseInt(r[i++],n);if(!(0<=f))break;o=o*n+f,a=a*n+Math.floor(o/O),o%=O}u&&(a=~a,o?o=O-o:a++),k(e,t+m,a),k(e,t+w,o)}(t,r,n,i||10):s(n,i)?c(t,r,n,i):"number"==typeof i?(k(t,r+m,n),k(t,r+w,i)):0<n?E(t,r,n):n<0?B(t,r,n):c(t,r,U,0))}(self,e,t,r,n):new i(e,t,r,n)}function P(){var e=self.buffer,t=self.offset,r=_(e,t+m),t=_(e,t+w);return g||(r|=0),r?r*O+t:t}function k(e,t,r){e[t+C]=255&r,r>>=8,e[t+S]=255&r,r>>=8,e[t+b]=255&r,r>>=8,e[t+n]=255&r}function _(e,t){return 16777216*e[t+n]+(e[t+b]<<16)+(e[t+S]<<8)+e[t+C]}var m=t?0:4,w=t?4:0,n=t?0:3,b=t?1:2,S=t?2:1,C=t?3:0,E=t?l:d,B=t?p:y,r=i.prototype,t="is"+e,M="_"+t;return r.buffer=void 0,r.offset=0,r[M]=!0,r.toNumber=P,r.toString=function R(e){var t=self.buffer,r=self.offset,n=_(t,r+m),i=_(t,r+w),s="";for((r=!g&&2147483648&n)&&(n=~n,i=O-i),e=e||10;;){var a=n%e*O+i,n=Math.floor(n/e),i=Math.floor(a/e),s=(a%e).toString(e)+s;if(!n&&!i)break}return r&&(s="-"+s),s},r.toJSON=P,r.toArray=f,W&&(r.toBuffer=u),T&&(r.toArrayBuffer=a),i[t]=function o(e){return!(!e||!e[M])},D[e]=i}function f(e){var t=self.buffer,r=self.offset;return I=null,!1!==e&&0===r&&8===t.length&&g(t)?t:h(t,r)}function u(e){var t=self.buffer,r=self.offset;if(I=W,!1!==e&&0===r&&8===t.length&&n.isBuffer(t))return t;e=new W(8);return c(e,0,t,r),e}function a(e){var t=self.buffer,r=self.offset,n=t.buffer;if(I=T,!1!==e&&0===r&&n instanceof L&&8===n.byteLength)return n;n=new T(8);return c(n,0,t,r),n.buffer}function s(e,t){var r=e&&e.length;return t|=0,r&&t+8<=r&&"string"!=typeof e[t]}function c(e,t,r,n){t|=0,n|=0;for(var i=0;i<8;i++)e[t++]=255&r[n++]}function h(e,t){return Array.prototype.slice.call(e,t,t+8)}function l(e,t,r){for(var n=t+8;t<n;)e[--n]=255&r,r/=256}function p(e,t,r){var n=t+8;for(r++;t<n;)e[--n]=255&-r^255,r/=256}function d(e,t,r){for(var n=t+8;t<n;)e[t++]=255&r,r/=256}function y(e,t,r){var n=t+8;for(r++;t<n;)e[t++]=255&-r^255,r/=256}D="object"==_typeof(r)&&"string"!=typeof r.nodeName?r:self||{},W=(A="undefined")!==_typeof(n)&&n,T=A!==("undefined"==typeof Uint8Array?"undefined":_typeof(Uint8Array))&&Uint8Array,L=A!==("undefined"==typeof ArrayBuffer?"undefined":_typeof(ArrayBuffer))&&ArrayBuffer,U=[0,0,0,0,0,0,0,0],g=Array.isArray||function v(e){return!!e&&"[object Array]"==Object.prototype.toString.call(e)},O=4294967296,o("Uint64BE",!0,!0),o("Int64BE",!0,!1),o("Uint64LE",!1,!0),o("Int64LE",!1,!1)}).call(self,e("buffer").Buffer)},{buffer:29}],34:[function(e,t,r){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}]},{},[1])(1)},"object"==_typeof(t)?e.exports=w():(g=[],void 0===(w="function"==typeof(w=w)?w.apply(t,g):w)||(e.exports=w))},12:function(e,t){var r,n;function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n=function(){return function r(i,s,a){function h(t,e){if(!s[t]){if(!i[t]){if(0,o)return o(t,!0);var n=new Error("Cannot find module \'"+t+"\'");throw n.code="MODULE_NOT_FOUND",n}n=s[t]={exports:{}};i[t][0].call(n.exports,function(e){return h(i[t][1][e]||e)},n,n.exports,r,i,s,a)}return s[t].exports}for(var o=void 0,e=0;e<a.length;e++)h(a[e]);return h}({1:[function(e,t,r){"use strict";var a=e("./zlib/deflate"),o=e("./utils/common"),u=e("./utils/strings"),n=e("./zlib/messages"),s=e("./zlib/zstream"),f=Object.prototype.toString,l=0,h=-1,d=0,p=8;function c(e){if(!(self instanceof c))return new c(e);self.options=o.assign({level:h,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},e||{});var t=self.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),self.err=0,self.msg="",self.ended=!1,self.chunks=[],self.strm=new s,self.strm.avail_out=0;e=a.deflateInit2(self.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==l)throw new Error(n[e]);if(t.header&&a.deflateSetHeader(self.strm,t.header),t.dictionary){t="string"==typeof t.dictionary?u.string2buf(t.dictionary):"[object ArrayBuffer]"===f.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary;if((e=a.deflateSetDictionary(self.strm,t))!==l)throw new Error(n[e]);self._dict_set=!0}}function i(e,t){t=new c(t);if(t.push(e,!0),t.err)throw t.msg||n[t.err];return t.result}c.prototype.push=function(e,t){var r,n,i=self.strm,s=self.options.chunkSize;if(self.ended)return!1;n=t===~~t?t:!0===t?4:0,"string"==typeof e?i.input=u.string2buf(e):"[object ArrayBuffer]"===f.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new o.Buf8(s),i.next_out=0,i.avail_out=s),1!==(r=a.deflate(i,n))&&r!==l)return self.onEnd(r),!(self.ended=!0)}while(0!==i.avail_out&&(0!==i.avail_in||4!==n&&2!==n)||("string"===self.options.to?self.onData(u.buf2binstring(o.shrinkBuf(i.output,i.next_out))):self.onData(o.shrinkBuf(i.output,i.next_out))),(0<i.avail_in||0===i.avail_out)&&1!==r);return 4===n?(r=a.deflateEnd(self.strm),self.onEnd(r),self.ended=!0,r===l):2!==n||(self.onEnd(l),!(i.avail_out=0))},c.prototype.onData=function(e){self.chunks.push(e)},c.prototype.onEnd=function(e){e===l&&("string"===self.options.to?self.result=self.chunks.join(""):self.result=o.flattenChunks(self.chunks)),self.chunks=[],self.err=e,self.msg=self.strm.msg},r.Deflate=c,r.deflate=i,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,i(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,i(e,t)}},{"./utils/common":3,"./utils/strings":4,"./zlib/deflate":8,"./zlib/messages":13,"./zlib/zstream":15}],2:[function(e,t,r){"use strict";var c=e("./zlib/inflate"),h=e("./utils/common"),d=e("./utils/strings"),p=e("./zlib/constants"),n=e("./zlib/messages"),i=e("./zlib/zstream"),a=e("./zlib/gzheader"),g=Object.prototype.toString;function s(e){if(!(self instanceof s))return new s(e);self.options=h.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=self.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),self.err=0,self.msg="",self.ended=!1,self.chunks=[],self.strm=new i,self.strm.avail_out=0;e=c.inflateInit2(self.strm,t.windowBits);if(e!==p.Z_OK)throw new Error(n[e]);if(self.header=new a,c.inflateGetHeader(self.strm,self.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=d.string2buf(t.dictionary):"[object ArrayBuffer]"===g.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=c.inflateSetDictionary(self.strm,t.dictionary))!==p.Z_OK))throw new Error(n[e])}function o(e,t){t=new s(t);if(t.push(e,!0),t.err)throw t.msg||n[t.err];return t.result}s.prototype.push=function(e,t){var r,n,i,s,a,o=self.strm,u=self.options.chunkSize,f=self.options.dictionary,l=!1;if(self.ended)return!1;n=t===~~t?t:!0===t?p.Z_FINISH:p.Z_NO_FLUSH,"string"==typeof e?o.input=d.binstring2buf(e):"[object ArrayBuffer]"===g.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new h.Buf8(u),o.next_out=0,o.avail_out=u),(r=c.inflate(o,p.Z_NO_FLUSH))===p.Z_NEED_DICT&&f&&(r=c.inflateSetDictionary(self.strm,f)),r===p.Z_BUF_ERROR&&!0===l&&(r=p.Z_OK,l=!1),r!==p.Z_STREAM_END&&r!==p.Z_OK)return self.onEnd(r),!(self.ended=!0)}while(o.next_out&&(0!==o.avail_out&&r!==p.Z_STREAM_END&&(0!==o.avail_in||n!==p.Z_FINISH&&n!==p.Z_SYNC_FLUSH)||("string"===self.options.to?(i=d.utf8border(o.output,o.next_out),s=o.next_out-i,a=d.buf2string(o.output,i),o.next_out=s,o.avail_out=u-s,s&&h.arraySet(o.output,o.output,i,s,0),self.onData(a)):self.onData(h.shrinkBuf(o.output,o.next_out)))),0===o.avail_in&&0===o.avail_out&&(l=!0),(0<o.avail_in||0===o.avail_out)&&r!==p.Z_STREAM_END);return r===p.Z_STREAM_END&&(n=p.Z_FINISH),n===p.Z_FINISH?(r=c.inflateEnd(self.strm),self.onEnd(r),self.ended=!0,r===p.Z_OK):n!==p.Z_SYNC_FLUSH||(self.onEnd(p.Z_OK),!(o.avail_out=0))},s.prototype.onData=function(e){self.chunks.push(e)},s.prototype.onEnd=function(e){e===p.Z_OK&&("string"===self.options.to?self.result=self.chunks.join(""):self.result=h.flattenChunks(self.chunks)),self.chunks=[],self.err=e,self.msg=self.strm.msg},r.Inflate=s,r.inflate=o,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,o(e,t)},r.ungzip=o},{"./utils/common":3,"./utils/strings":4,"./zlib/constants":6,"./zlib/gzheader":9,"./zlib/inflate":11,"./zlib/messages":13,"./zlib/zstream":15}],3:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=_typeof(r))throw new TypeError(r+"must be non-object");for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function arraySet(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var s=0;s<n;s++)e[i+s]=t[r+s]},flattenChunks:function flattenChunks(e){for(var t,r,n,i,s=t=0,a=e.length;s<a;s++)t+=e[s].length;for(i=new Uint8Array(t),s=r=0,a=e.length;s<a;s++)n=e[s],i.set(n,r),r+=n.length;return i}},s={arraySet:function arraySet(e,t,r,n,i){for(var s=0;s<n;s++)e[i+s]=t[r+s]},flattenChunks:function flattenChunks(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,s))},r.setTyped(n)},{}],4:[function(e,t,r){"use strict";var u=e("./common"),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){s=!1}for(var f=new u.Buf8(256),n=0;n<256;n++)f[n]=252<=n?6:248<=n?5:240<=n?4:224<=n?3:192<=n?2:1;function d(e,t){if(t<65534&&(e.subarray&&s||!e.subarray&&i))return String.fromCharCode.apply(null,u.shrinkBuf(e,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}f[254]=f[254]=1,r.string2buf=function(e){for(var t,r,n,i,s=e.length,a=0,o=0;o<s;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),a+=r<128?1:r<2048?2:r<65536?3:4;for(t=new u.Buf8(a),o=i=0;i<a;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),r<128?t[i++]=r:(r<2048?t[i++]=192|r>>>6:(r<65536?t[i++]=224|r>>>12:(t[i++]=240|r>>>18,t[i++]=128|r>>>12&63),t[i++]=128|r>>>6&63),t[i++]=128|63&r);return t},r.buf2binstring=function(e){return d(e,e.length)},r.binstring2buf=function(e){for(var t=new u.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){for(var r,n,i,s=t||e.length,a=new Array(2*s),o=r=0;o<s;)if((n=e[o++])<128)a[r++]=n;else if(4<(i=f[n]))a[r++]=65533,o+=i-1;else{for(n&=2===i?31:3===i?15:7;1<i&&o<s;)n=n<<6|63&e[o++],i--;1<i?a[r++]=65533:n<65536?a[r++]=n:(n-=65536,a[r++]=55296|n>>10&1023,a[r++]=56320|1023&n)}return d(a,r)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return!(r<0)&&0!==r&&r+f[e[r]]>t?r:t}},{"./common":3}],5:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){for(var i=65535&e|0,s=e>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;s=s+(i=i+t[n++]|0)|0,--a;);i%=65521,s%=65521}return i|s<<16|0}},{}],6:[function(e,t,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],7:[function(e,t,r){"use strict";var o=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,r,n){var i=o,s=n+r;e^=-1;for(var a=n;a<s;a++)e=e>>>8^i[255&(e^t[a])];return-1^e}},{}],8:[function(e,t,r){"use strict";var o,c=e("../utils/common"),u=e("./trees"),h=e("./adler32"),d=e("./crc32"),n=e("./messages"),f=0,l=0,p=-2,i=2,g=8,s=286,a=30,_=19,v=2*s+1,m=15,y=3,w=258,b=w+y+1,S=42,k=113;function N(e,t){return e.msg=n[t],t}function O(e){return(e<<1)-(4<e?9:0)}function D(e){for(var t=e.length;0<=--t;)e[t]=0}function I(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(c.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function U(e,t){u._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,I(e.strm)}function T(e,t){e.pending_buf[e.pending++]=t}function F(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function L(e,t){var r,n,i=e.max_chain_length,s=e.strstart,a=e.prev_length,o=e.nice_match,u=e.strstart>e.w_size-b?e.strstart-(e.w_size-b):0,f=e.window,l=e.w_mask,c=e.prev,h=e.strstart+w,d=f[s+a-1],p=f[s+a];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(f[(r=t)+a]===p&&f[r+a-1]===d&&f[r]===f[s]&&f[++r]===f[s+1]){for(s+=2,r++;f[++s]===f[++r]&&f[++s]===f[++r]&&f[++s]===f[++r]&&f[++s]===f[++r]&&f[++s]===f[++r]&&f[++s]===f[++r]&&f[++s]===f[++r]&&f[++s]===f[++r]&&s<h;);if(n=w-(h-s),s=h-w,a<n){if(e.match_start=t,o<=(a=n))break;d=f[s+a-1],p=f[s+a]}}}while((t=c[t&l])>u&&0!=--i);return a<=e.lookahead?a:e.lookahead}function H(e){var t,r,n,i,s,a,o,u,f,l=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=l+(l-b)){for(c.arraySet(e.window,e.window,l,l,0),e.match_start-=l,e.strstart-=l,e.block_start-=l,t=r=e.hash_size;n=e.head[--t],e.head[t]=l<=n?n-l:0,--r;);for(t=r=l;n=e.prev[--t],e.prev[t]=l<=n?n-l:0,--r;);i+=l}if(0===e.strm.avail_in)break;if(a=e.strm,o=e.window,u=e.strstart+e.lookahead,f=void 0,i<(f=a.avail_in)&&(f=i),r=0===f?0:(a.avail_in-=f,c.arraySet(o,a.input,a.next_in,f,u),1===a.state.wrap?a.adler=h(a.adler,o,f,u):2===a.state.wrap&&(a.adler=d(a.adler,o,f,u)),a.next_in+=f,a.total_in+=f,f),e.lookahead+=r,e.lookahead+e.insert>=y)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+y-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<y)););}while(e.lookahead<b&&0!==e.strm.avail_in)}function j(e,t){for(var r,n;;){if(e.lookahead<b){if(H(e),e.lookahead<b&&t===f)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=y&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+y-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-b&&(e.match_length=L(e,r)),e.match_length>=y)if(n=u._tr_tally(e,e.strstart-e.match_start,e.match_length-y),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=y){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+y-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(U(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<y-1?e.strstart:y-1,4===t?(U(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(U(e,!1),0===e.strm.avail_out)?1:2}function K(e,t){for(var r,n,i;;){if(e.lookahead<b){if(H(e),e.lookahead<b&&t===f)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=y&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+y-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=y-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-b&&(e.match_length=L(e,r),e.match_length<=5&&(1===e.strategy||e.match_length===y&&4096<e.strstart-e.match_start)&&(e.match_length=y-1)),e.prev_length>=y&&e.match_length<=e.prev_length){for(i=e.strstart+e.lookahead-y,n=u._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-y),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+y-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=y-1,e.strstart++,n&&(U(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((n=u._tr_tally(e,0,e.window[e.strstart-1]))&&U(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=u._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<y-1?e.strstart:y-1,4===t?(U(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(U(e,!1),0===e.strm.avail_out)?1:2}function M(e,t,r,n,i){self.good_length=e,self.max_lazy=t,self.nice_length=r,self.max_chain=n,self.func=i}function P(){self.strm=null,self.status=0,self.pending_buf=null,self.pending_buf_size=0,self.pending_out=0,self.pending=0,self.wrap=0,self.gzhead=null,self.gzindex=0,self.method=g,self.last_flush=-1,self.w_size=0,self.w_bits=0,self.w_mask=0,self.window=null,self.window_size=0,self.prev=null,self.head=null,self.ins_h=0,self.hash_size=0,self.hash_bits=0,self.hash_mask=0,self.hash_shift=0,self.block_start=0,self.match_length=0,self.prev_match=0,self.match_available=0,self.strstart=0,self.match_start=0,self.lookahead=0,self.prev_length=0,self.max_chain_length=0,self.max_lazy_match=0,self.level=0,self.strategy=0,self.good_match=0,self.nice_match=0,self.dyn_ltree=new c.Buf16(2*v),self.dyn_dtree=new c.Buf16(2*(2*a+1)),self.bl_tree=new c.Buf16(2*(2*_+1)),D(self.dyn_ltree),D(self.dyn_dtree),D(self.bl_tree),self.l_desc=null,self.d_desc=null,self.bl_desc=null,self.bl_count=new c.Buf16(m+1),self.heap=new c.Buf16(2*s+1),D(self.heap),self.heap_len=0,self.heap_max=0,self.depth=new c.Buf16(2*s+1),D(self.depth),self.l_buf=0,self.lit_bufsize=0,self.last_lit=0,self.d_buf=0,self.opt_len=0,self.static_len=0,self.matches=0,self.insert=0,self.bi_buf=0,self.bi_valid=0}function Y(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=i,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?S:k,e.adler=2===t.wrap?0:1,t.last_flush=f,u._tr_init(t),l):N(e,p)}function q(e){var t=Y(e);return t===l&&((e=e.state).window_size=2*e.w_size,D(e.head),e.max_lazy_match=o[e.level].max_lazy,e.good_match=o[e.level].good_length,e.nice_match=o[e.level].nice_length,e.max_chain_length=o[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=y-1,e.match_available=0,e.ins_h=0),t}function G(e,t,r,n,i,s){if(!e)return p;var a=1;if(-1===t&&(t=6),n<0?(a=0,n=-n):15<n&&(a=2,n-=16),i<1||9<i||r!==g||n<8||15<n||t<0||9<t||s<0||4<s)return N(e,p);8===n&&(n=9);var o=new P;return(e.state=o).strm=e,o.wrap=a,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+y-1)/y),o.window=new c.Buf8(2*o.w_size),o.head=new c.Buf16(o.hash_size),o.prev=new c.Buf16(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new c.Buf8(o.pending_buf_size),o.d_buf=+o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=s,o.method=r,q(e)}o=[new M(0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(H(e),0===e.lookahead&&t===f)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,U(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-b&&(U(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(U(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(U(e,!1),e.strm.avail_out),1)}),new M(4,4,8,4,j),new M(4,5,16,8,j),new M(4,6,32,32,j),new M(4,4,16,16,K),new M(8,16,32,32,K),new M(8,16,128,128,K),new M(8,32,128,256,K),new M(32,128,258,1024,K),new M(32,258,258,4096,K)],r.deflateInit=function(e,t){return G(e,t,g,15,8,0)},r.deflateInit2=G,r.deflateReset=q,r.deflateResetKeep=Y,r.deflateSetHeader=function(e,t){return!e||!e.state||2!==e.state.wrap?p:(e.state.gzhead=t,l)},r.deflate=function(e,t){var r,n,i,s;if(!e||!e.state||5<t||t<0)return e?N(e,p):p;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||666===r.status&&4!==t)return N(e,0===e.avail_out?-5:p);if(r.strm=e,a=r.last_flush,r.last_flush=t,r.status===S&&(2===r.wrap?(e.adler=0,T(r,31),T(r,139),T(r,8),r.gzhead?(T(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),T(r,255&r.gzhead.time),T(r,r.gzhead.time>>8&255),T(r,r.gzhead.time>>16&255),T(r,r.gzhead.time>>24&255),T(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),T(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(T(r,255&r.gzhead.extra.length),T(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=d(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(T(r,0),T(r,0),T(r,0),T(r,0),T(r,0),T(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),T(r,3),r.status=k)):(s=g+(r.w_bits-8<<4)<<8,s|=(2<=r.strategy||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(s|=32),s+=31-s%31,r.status=k,F(r,s),0!==r.strstart&&(F(r,e.adler>>>16),F(r,65535&e.adler)),e.adler=1)),69===r.status)if(r.gzhead.extra){for(n=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>n&&(e.adler=d(e.adler,r.pending_buf,r.pending-n,n)),I(e),n=r.pending,r.pending!==r.pending_buf_size));)T(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>n&&(e.adler=d(e.adler,r.pending_buf,r.pending-n,n)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(e.adler=d(e.adler,r.pending_buf,r.pending-n,n)),I(e),n=r.pending,r.pending===r.pending_buf_size)){i=1;break}}while(T(r,i=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0),0!==i);r.gzhead.hcrc&&r.pending>n&&(e.adler=d(e.adler,r.pending_buf,r.pending-n,n)),0===i&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(e.adler=d(e.adler,r.pending_buf,r.pending-n,n)),I(e),n=r.pending,r.pending===r.pending_buf_size)){i=1;break}}while(T(r,i=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0),0!==i);r.gzhead.hcrc&&r.pending>n&&(e.adler=d(e.adler,r.pending_buf,r.pending-n,n)),0===i&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&I(e),r.pending+2<=r.pending_buf_size&&(T(r,255&e.adler),T(r,e.adler>>8&255),e.adler=0,r.status=k)):r.status=k),0!==r.pending){if(I(e),0===e.avail_out)return r.last_flush=-1,l}else if(0===e.avail_in&&O(t)<=O(a)&&4!==t)return N(e,-5);if(666===r.status&&0!==e.avail_in)return N(e,-5);if(0!==e.avail_in||0!==r.lookahead||t!==f&&666!==r.status){var a=2===r.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(H(e),0===e.lookahead)){if(t===f)return 1;break}if(e.match_length=0,r=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(U(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(U(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(U(e,!1),0===e.strm.avail_out)?1:2}(r,t):3===r.strategy?function(e,t){for(var r,n,i,s,a=e.window;;){if(e.lookahead<=w){if(H(e),e.lookahead<=w&&t===f)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=y&&0<e.strstart&&(n=a[i=e.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i]){for(s=e.strstart+w;n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<s;);e.match_length=w-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=y?(r=u._tr_tally(e,1,e.match_length-y),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(U(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(U(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(U(e,!1),0===e.strm.avail_out)?1:2}(r,t):o[r.level].func(r,t);if(3!==a&&4!==a||(r.status=666),1===a||3===a)return 0===e.avail_out&&(r.last_flush=-1),l;if(2===a&&(1===t?u._tr_align(r):5!==t&&(u._tr_stored_block(r,0,0,!1),3===t&&(D(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),I(e),0===e.avail_out))return r.last_flush=-1,l}return 4!==t?l:r.wrap<=0?1:(2===r.wrap?(T(r,255&e.adler),T(r,e.adler>>8&255),T(r,e.adler>>16&255),T(r,e.adler>>24&255),T(r,255&e.total_in),T(r,e.total_in>>8&255),T(r,e.total_in>>16&255),T(r,e.total_in>>24&255)):(F(r,e.adler>>>16),F(r,65535&e.adler)),I(e),0<r.wrap&&(r.wrap=-r.wrap),0!==r.pending?l:1)},r.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==S&&69!==t&&73!==t&&91!==t&&103!==t&&t!==k&&666!==t?N(e,p):(e.state=null,t===k?N(e,-3):l):p},r.deflateSetDictionary=function(e,t){var r,n,i,s,a,o,u,f=t.length;if(!e||!e.state)return p;if(2===(s=(r=e.state).wrap)||1===s&&r.status!==S||r.lookahead)return p;for(1===s&&(e.adler=h(e.adler,t,f,0)),r.wrap=0,f>=r.w_size&&(0===s&&(D(r.head),r.strstart=0,r.block_start=0,r.insert=0),u=new c.Buf8(r.w_size),c.arraySet(u,t,f-r.w_size,r.w_size,0),t=u,f=r.w_size),a=e.avail_in,o=e.next_in,u=e.input,e.avail_in=f,e.next_in=0,e.input=t,H(r);r.lookahead>=y;){for(n=r.strstart,i=r.lookahead-(y-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+y-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++,--i;);r.strstart=n,r.lookahead=y-1,H(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=y-1,r.match_available=0,e.next_in=o,e.input=u,e.avail_in=a,r.wrap=s,l},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./messages":13,"./trees":14}],9:[function(e,t,r){"use strict";t.exports=function(){self.text=0,self.time=0,self.xflags=0,self.os=0,self.extra=null,self.extra_len=0,self.name="",self.comment="",self.hcrc=0,self.done=!1}},{}],10:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n,i,s,a,o,u=e.state,f=e.next_in,l=e.input,c=f+(e.avail_in-5),h=e.next_out,d=e.output,p=h-(t-e.avail_out),g=h+(e.avail_out-257),_=u.dmax,v=u.wsize,m=u.whave,y=u.wnext,w=u.window,b=u.hold,S=u.bits,k=u.lencode,C=u.distcode,E=(1<<u.lenbits)-1,R=(1<<u.distbits)-1;e:do{S<15&&(b+=l[f++]<<S,S+=8,b+=l[f++]<<S,S+=8),r=k[b&E];t:for(;;){if(b>>>=n=r>>>24,S-=n,0==(n=r>>>16&255))d[h++]=65535&r;else{if(!(16&n)){if(0==(64&n)){r=k[(65535&r)+(b&(1<<n)-1)];continue t}if(32&n){u.mode=12;break e}e.msg="invalid literal/length code",u.mode=30;break e}i=65535&r,(n&=15)&&(S<n&&(b+=l[f++]<<S,S+=8),i+=b&(1<<n)-1,b>>>=n,S-=n),S<15&&(b+=l[f++]<<S,S+=8,b+=l[f++]<<S,S+=8),r=C[b&R];r:for(;;){if(b>>>=n=r>>>24,S-=n,!(16&(n=r>>>16&255))){if(0==(64&n)){r=C[(65535&r)+(b&(1<<n)-1)];continue r}e.msg="invalid distance code",u.mode=30;break e}if(s=65535&r,S<(n&=15)&&(b+=l[f++]<<S,(S+=8)<n&&(b+=l[f++]<<S,S+=8)),_<(s+=b&(1<<n)-1)){e.msg="invalid distance too far back",u.mode=30;break e}if(b>>>=n,S-=n,(n=h-p)<s){if(m<(n=s-n)&&u.sane){e.msg="invalid distance too far back",u.mode=30;break e}if(o=w,(a=0)===y){if(a+=v-n,n<i){for(i-=n;d[h++]=w[a++],--n;);a=h-s,o=d}}else if(y<n){if(a+=v+y-n,(n-=y)<i){for(i-=n;d[h++]=w[a++],--n;);if(a=0,y<i){for(i-=n=y;d[h++]=w[a++],--n;);a=h-s,o=d}}}else if(a+=y-n,n<i){for(i-=n;d[h++]=w[a++],--n;);a=h-s,o=d}for(;2<i;)d[h++]=o[a++],d[h++]=o[a++],d[h++]=o[a++],i-=3;i&&(d[h++]=o[a++],1<i&&(d[h++]=o[a++]))}else{for(a=h-s;d[h++]=d[a++],d[h++]=d[a++],d[h++]=d[a++],2<(i-=3););i&&(d[h++]=d[a++],1<i&&(d[h++]=d[a++]))}break}}break}}while(f<c&&h<g);f-=i=S>>3,b&=(1<<(S-=i<<3))-1,e.next_in=f,e.next_out=h,e.avail_in=f<c?c-f+5:5-(f-c),e.avail_out=h<g?g-h+257:257-(h-g),u.hold=b,u.bits=S}},{}],11:[function(e,t,n){"use strict";var M=e("../utils/common"),D=e("./adler32"),x=e("./crc32"),I=e("./inffast"),A=e("./inftrees"),W=1,T=2,U=0,O=-2,F=1,i=852,a=592;function L(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function r(){self.mode=0,self.last=!1,self.wrap=0,self.havedict=!1,self.flags=0,self.dmax=0,self.check=0,self.total=0,self.head=null,self.wbits=0,self.wsize=0,self.whave=0,self.wnext=0,self.window=null,self.hold=0,self.bits=0,self.length=0,self.offset=0,self.extra=0,self.lencode=null,self.distcode=null,self.lenbits=0,self.distbits=0,self.ncode=0,self.nlen=0,self.ndist=0,self.have=0,self.next=null,self.lens=new M.Buf16(320),self.work=new M.Buf16(288),self.lendyn=null,self.distdyn=null,self.sane=0,self.back=0,self.was=0}function s(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=F,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new M.Buf32(i),t.distcode=t.distdyn=new M.Buf32(a),t.sane=1,t.back=-1,U):O}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,s(e)):O}function l(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?O:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,o(e))):O}function h(e,t){var n;return e?(n=new r,(e.state=n).window=null,(t=l(e,t))!==U&&(e.state=null),t):O}var N,z,q=!0;function j(e,t,r,n){var i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new M.Buf8(i.wsize)),n>=i.wsize?(M.arraySet(i.window,t,r-i.wsize,i.wsize,0),i.wnext=0,i.whave=i.wsize):(n<(e=i.wsize-i.wnext)&&(e=n),M.arraySet(i.window,t,r-n,e,i.wnext),(n-=e)?(M.arraySet(i.window,t,r-n,n,0),i.wnext=n,i.whave=i.wsize):(i.wnext+=e,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=e))),0}n.inflateReset=o,n.inflateReset2=l,n.inflateResetKeep=s,n.inflateInit=function(e){return h(e,15)},n.inflateInit2=h,n.inflate=function(e,t){var r,n,i,s,a,o,u,f,l,c,h,d,p,g,_,v,m,y,w,b,S,k,C,E,R=0,B=new M.Buf8(4),P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return O;12===(r=e.state).mode&&(r.mode=13),a=e.next_out,i=e.output,u=e.avail_out,s=e.next_in,n=e.input,o=e.avail_in,f=r.hold,l=r.bits,c=o,h=u,k=U;e:for(;;)switch(r.mode){case F:if(0===r.wrap){r.mode=13;break}for(;l<16;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}if(2&r.wrap&&35615===f){B[r.check=0]=255&f,B[1]=f>>>8&255,r.check=x(r.check,B,2,0),l=f=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&f)){e.msg="unknown compression method",r.mode=30;break}if(l-=4,S=8+(15&(f>>>=4)),0===r.wbits)r.wbits=S;else if(S>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<S,e.adler=r.check=1,r.mode=512&f?10:12,l=f=0;break;case 2:for(;l<16;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}if(r.flags=f,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=f>>8&1),512&r.flags&&(B[0]=255&f,B[1]=f>>>8&255,r.check=x(r.check,B,2,0)),l=f=0,r.mode=3;case 3:for(;l<32;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}r.head&&(r.head.time=f),512&r.flags&&(B[0]=255&f,B[1]=f>>>8&255,B[2]=f>>>16&255,B[3]=f>>>24&255,r.check=x(r.check,B,4,0)),l=f=0,r.mode=4;case 4:for(;l<16;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}r.head&&(r.head.xflags=255&f,r.head.os=f>>8),512&r.flags&&(B[0]=255&f,B[1]=f>>>8&255,r.check=x(r.check,B,2,0)),l=f=0,r.mode=5;case 5:if(1024&r.flags){for(;l<16;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}r.length=f,r.head&&(r.head.extra_len=f),512&r.flags&&(B[0]=255&f,B[1]=f>>>8&255,r.check=x(r.check,B,2,0)),l=f=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(o<(d=r.length)&&(d=o),d&&(r.head&&(S=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),M.arraySet(r.head.extra,n,s,d,S)),512&r.flags&&(r.check=x(r.check,n,d,s)),o-=d,s+=d,r.length-=d),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===o)break e;for(d=0;S=n[s+d++],r.head&&S&&r.length<65536&&(r.head.name+=String.fromCharCode(S)),S&&d<o;);if(512&r.flags&&(r.check=x(r.check,n,d,s)),o-=d,s+=d,S)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===o)break e;for(d=0;S=n[s+d++],r.head&&S&&r.length<65536&&(r.head.comment+=String.fromCharCode(S)),S&&d<o;);if(512&r.flags&&(r.check=x(r.check,n,d,s)),o-=d,s+=d,S)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;l<16;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}if(f!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}l=f=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;l<32;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}e.adler=r.check=L(f),l=f=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=a,e.avail_out=u,e.next_in=s,e.avail_in=o,r.hold=f,r.bits=l,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){f>>>=7&l,l-=7&l,r.mode=27;break}for(;l<3;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}switch(r.last=1&f,--l,3&(f>>>=1)){case 0:r.mode=14;break;case 1:if(function H(e){if(q){var t;for(N=new M.Buf32(512),z=new M.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(A(W,e.lens,0,288,N,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;A(T,e.lens,0,32,z,0,e.work,{bits:5}),q=!1}e.lencode=N,e.lenbits=9,e.distcode=z,e.distbits=5}(r),r.mode=20,6!==t)break;f>>>=2,l-=2;break e;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}f>>>=2,l-=2;break;case 14:for(f>>>=7&l,l-=7&l;l<32;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}if((65535&f)!=(f>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&f,l=f=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(d=r.length){if(o<d&&(d=o),u<d&&(d=u),0===d)break e;M.arraySet(i,n,s,d,a),o-=d,s+=d,u-=d,a+=d,r.length-=d;break}r.mode=12;break;case 17:for(;l<14;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}if(r.nlen=257+(31&f),f>>>=5,l-=5,r.ndist=1+(31&f),f>>>=5,l-=5,r.ncode=4+(15&f),f>>>=4,l-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;l<3;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}r.lens[P[r.have++]]=7&f,f>>>=3,l-=3}for(;r.have<19;)r.lens[P[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,C={bits:r.lenbits},k=A(0,r.lens,0,19,r.lencode,0,r.work,C),r.lenbits=C.bits,k){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;v=(R=r.lencode[f&(1<<r.lenbits)-1])>>>16&255,m=65535&R,!((_=R>>>24)<=l);){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}if(m<16)f>>>=_,l-=_,r.lens[r.have++]=m;else{if(16===m){for(E=_+2;l<E;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}if(f>>>=_,l-=_,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}S=r.lens[r.have-1],d=3+(3&f),f>>>=2,l-=2}else if(17===m){for(E=_+3;l<E;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}l-=_,S=0,d=3+(7&(f>>>=_)),f>>>=3,l-=3}else{for(E=_+7;l<E;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}l-=_,S=0,d=11+(127&(f>>>=_)),f>>>=7,l-=7}if(r.have+d>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;d--;)r.lens[r.have++]=S}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,C={bits:r.lenbits},k=A(W,r.lens,0,r.nlen,r.lencode,0,r.work,C),r.lenbits=C.bits,k){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,C={bits:r.distbits},k=A(T,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,C),r.distbits=C.bits,k){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=o&&258<=u){e.next_out=a,e.avail_out=u,e.next_in=s,e.avail_in=o,r.hold=f,r.bits=l,I(e,h),a=e.next_out,i=e.output,u=e.avail_out,s=e.next_in,n=e.input,o=e.avail_in,f=r.hold,l=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;v=(R=r.lencode[f&(1<<r.lenbits)-1])>>>16&255,m=65535&R,!((_=R>>>24)<=l);){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}if(v&&0==(240&v)){for(y=_,w=v,b=m;v=(R=r.lencode[b+((f&(1<<y+w)-1)>>y)])>>>16&255,m=65535&R,!(y+(_=R>>>24)<=l);){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}f>>>=y,l-=y,r.back+=y}if(f>>>=_,l-=_,r.back+=_,r.length=m,0===v){r.mode=26;break}if(32&v){r.back=-1,r.mode=12;break}if(64&v){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&v,r.mode=22;case 22:if(r.extra){for(E=r.extra;l<E;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}r.length+=f&(1<<r.extra)-1,f>>>=r.extra,l-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;v=(R=r.distcode[f&(1<<r.distbits)-1])>>>16&255,m=65535&R,!((_=R>>>24)<=l);){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}if(0==(240&v)){for(y=_,w=v,b=m;v=(R=r.distcode[b+((f&(1<<y+w)-1)>>y)])>>>16&255,m=65535&R,!(y+(_=R>>>24)<=l);){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}f>>>=y,l-=y,r.back+=y}if(f>>>=_,l-=_,r.back+=_,64&v){e.msg="invalid distance code",r.mode=30;break}r.offset=m,r.extra=15&v,r.mode=24;case 24:if(r.extra){for(E=r.extra;l<E;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}r.offset+=f&(1<<r.extra)-1,f>>>=r.extra,l-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===u)break e;if(d=h-u,r.offset>d){if((d=r.offset-d)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}p=d>r.wnext?(d-=r.wnext,r.wsize-d):r.wnext-d,d>r.length&&(d=r.length),g=r.window}else g=i,p=a-r.offset,d=r.length;for(u<d&&(d=u),u-=d,r.length-=d;i[a++]=g[p++],--d;);0===r.length&&(r.mode=21);break;case 26:if(0===u)break e;i[a++]=r.length,u--,r.mode=21;break;case 27:if(r.wrap){for(;l<32;){if(0===o)break e;o--,f|=n[s++]<<l,l+=8}if(h-=u,e.total_out+=h,r.total+=h,h&&(e.adler=r.check=(r.flags?x:D)(r.check,i,h,a-h)),h=u,(r.flags?f:L(f))!==r.check){e.msg="incorrect data check",r.mode=30;break}l=f=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;l<32;){if(0===o)break e;o--,f+=n[s++]<<l,l+=8}if(f!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}l=f=0}r.mode=29;case 29:k=1;break e;case 30:k=-3;break e;case 31:return-4;case 32:default:return O}return e.next_out=a,e.avail_out=u,e.next_in=s,e.avail_in=o,r.hold=f,r.bits=l,(r.wsize||h!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&j(e,e.output,e.next_out,h-e.avail_out)?(r.mode=31,-4):(c-=e.avail_in,h-=e.avail_out,e.total_in+=c,e.total_out+=h,r.total+=h,r.wrap&&h&&(e.adler=r.check=(r.flags?x:D)(r.check,i,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==c&&0===h||4===t)&&k===U&&(k=-5),k)},n.inflateEnd=function(e){if(!e||!e.state)return O;var t=e.state;return t.window&&(t.window=null),e.state=null,U},n.inflateGetHeader=function(e,t){var r;return!e||!e.state||0==(2&(r=e.state).wrap)?O:((r.head=t).done=!1,U)},n.inflateSetDictionary=function(e,t){var r,n=t.length;return!e||!e.state||0!==(r=e.state).wrap&&11!==r.mode?O:11===r.mode&&D(1,t,n,0)!==r.check?-3:j(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,U)},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./inffast":10,"./inftrees":12}],12:[function(e,t,r){"use strict";var W=e("../utils/common"),T=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],L=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],U=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],O=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,n,i,s,a,o){for(var u,f,l,c,h,d,p,g,_,v=o.bits,m=0,y=0,w=0,b=0,S=0,k=0,C=0,E=0,R=0,B=0,P=null,M=0,D=new W.Buf16(16),x=new W.Buf16(16),I=null,A=0,m=0;m<=15;m++)D[m]=0;for(y=0;y<n;y++)D[t[r+y]]++;for(S=v,b=15;1<=b&&0===D[b];b--);if(b<S&&(S=b),0===b)return i[s++]=20971520,i[s++]=20971520,o.bits=1,0;for(w=1;w<b&&0===D[w];w++);for(S<w&&(S=w),m=E=1;m<=15;m++)if(E<<=1,(E-=D[m])<0)return-1;if(0<E&&(0===e||1!==b))return-1;for(x[1]=0,m=1;m<15;m++)x[m+1]=x[m]+D[m];for(y=0;y<n;y++)0!==t[r+y]&&(a[x[t[r+y]]++]=y);if(d=0===e?(P=I=a,19):1===e?(P=T,M-=257,I=L,A-=257,256):(P=U,I=O,-1),m=w,h=s,C=y=B=0,l=-1,c=(R=1<<(k=S))-1,1===e&&852<R||2===e&&592<R)return 1;for(;;){for(p=m-C,_=a[y]<d?(g=0,a[y]):a[y]>d?(g=I[A+a[y]],P[M+a[y]]):(g=96,0),u=1<<m-C,w=f=1<<k;i[h+(B>>C)+(f-=u)]=p<<24|g<<16|_|0,0!==f;);for(u=1<<m-1;B&u;)u>>=1;if(0!==u?(B&=u-1,B+=u):B=0,y++,0==--D[m]){if(m===b)break;m=t[r+a[y]]}if(S<m&&(B&c)!==l){for(0===C&&(C=S),h+=w,E=1<<(k=m-C);k+C<b&&!((E-=D[k+C])<=0);)k++,E<<=1;if(R+=1<<k,1===e&&852<R||2===e&&592<R)return 1;i[l=B&c]=S<<24|k<<16|h-s|0}}return 0!==B&&(i[h+B]=m-C<<24|64<<16|0),o.bits=S,0}},{"../utils/common":3}],13:[function(e,t,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],14:[function(e,t,n){"use strict";var s=e("../utils/common");function i(e){for(var t=e.length;0<=--t;)e[t]=0}var _=15,a=16,u=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],f=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],l=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],c=new Array(576);i(c);var h=new Array(60);i(h);var d=new Array(512);i(d);var p=new Array(256);i(p);var g=new Array(29);i(g);var v,m,y,w=new Array(30);function I(e,t,r,n,i){self.static_tree=e,self.extra_bits=t,self.extra_base=r,self.elems=n,self.max_length=i,self.has_stree=e&&e.length}function r(e,t){self.dyn_tree=e,self.max_code=0,self.stat_desc=t}function U(e){return e<256?d[e]:d[256+(e>>>7)]}function T(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function F(e,t,r){e.bi_valid>a-r?(e.bi_buf|=t<<e.bi_valid&65535,T(e,e.bi_buf),e.bi_buf=t>>a-e.bi_valid,e.bi_valid+=r-a):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function L(e,t,r){F(e,r[2*t],r[2*t+1])}function H(e,t){for(var r=0;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1}function j(e,t,r){for(var n,i=new Array(_+1),s=0,a=1;a<=_;a++)i[a]=s=s+r[a-1]<<1;for(n=0;n<=t;n++){var o=e[2*n+1];0!==o&&(e[2*n]=H(i[o]++,o))}}function K(e){for(var t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function M(e){8<e.bi_valid?T(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function P(e,t,r,n){var i=2*t,s=2*r;return e[i]<e[s]||e[i]===e[s]&&n[t]<=n[r]}function Y(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&P(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!P(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function q(e,t,r){var n,i,s,a,o=0;if(0!==e.last_lit)for(;n=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],i=e.pending_buf[e.l_buf+o],o++,0==n?L(e,i,t):(L(e,(s=p[i])+256+1,t),0!==(a=u[s])&&F(e,i-=g[s],a),L(e,s=U(--n),r),0!==(a=f[s])&&F(e,n-=w[s],a)),o<e.last_lit;);L(e,256,t)}function G(e,g){var t,r,n,i=g.dyn_tree,s=g.stat_desc.static_tree,a=g.stat_desc.has_stree,o=g.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,t=0;t<o;t++)0!==i[2*t]?(e.heap[++e.heap_len]=u=t,e.depth[t]=0):i[2*t+1]=0;for(;e.heap_len<2;)i[2*(n=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[n]=0,e.opt_len--,a&&(e.static_len-=s[2*n+1]);for(g.max_code=u,t=e.heap_len>>1;1<=t;t--)Y(e,i,t);for(n=o;t=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Y(e,i,1),r=e.heap[1],e.heap[--e.heap_max]=t,e.heap[--e.heap_max]=r,i[2*n]=i[2*t]+i[2*r],e.depth[n]=(e.depth[t]>=e.depth[r]?e.depth[t]:e.depth[r])+1,i[2*t+1]=i[2*r+1]=n,e.heap[1]=n++,Y(e,i,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e){for(var t,r,n,i,s,a=g.dyn_tree,o=g.max_code,u=g.stat_desc.static_tree,f=g.stat_desc.has_stree,l=g.stat_desc.extra_bits,c=g.stat_desc.extra_base,h=g.stat_desc.max_length,d=0,p=0;p<=_;p++)e.bl_count[p]=0;for(a[2*e.heap[e.heap_max]+1]=0,t=e.heap_max+1;t<573;t++)h<(p=a[2*a[2*(r=e.heap[t])+1]+1]+1)&&(p=h,d++),a[2*r+1]=p,o<r||(e.bl_count[p]++,i=0,c<=r&&(i=l[r-c]),s=a[2*r],e.opt_len+=s*(p+i),f&&(e.static_len+=s*(u[2*r+1]+i)));if(0!==d){do{for(p=h-1;0===e.bl_count[p];)p--}while(e.bl_count[p]--,e.bl_count[p+1]+=2,e.bl_count[h]--,0<(d-=2));for(p=h;0!==p;p--)for(r=e.bl_count[p];0!==r;)o<(n=e.heap[--t])||(a[2*n+1]!==p&&(e.opt_len+=(p-a[2*n+1])*a[2*n],a[2*n+1]=p),r--)}}(e),j(i,u,e.bl_count)}function X(e,t,r){var n,i,s=-1,a=t[1],o=0,u=7,f=4;for(0===a&&(u=138,f=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=t[2*(n+1)+1],++o<u&&i===a||(o<f?e.bl_tree[2*i]+=o:0!==i?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=i,f=(o=0)===a?(u=138,3):i===a?(u=6,3):(u=7,4))}function W(e,t,r){var n,i,s=-1,a=t[1],o=0,u=7,f=4;for(0===a&&(u=138,f=3),n=0;n<=r;n++)if(i=a,a=t[2*(n+1)+1],!(++o<u&&i===a)){if(o<f)for(;L(e,i,e.bl_tree),0!=--o;);else 0!==i?(i!==s&&(L(e,i,e.bl_tree),o--),L(e,16,e.bl_tree),F(e,o-3,2)):o<=10?(L(e,17,e.bl_tree),F(e,o-3,3)):(L(e,18,e.bl_tree),F(e,o-11,7));s=i,f=(o=0)===a?(u=138,3):i===a?(u=6,3):(u=7,4)}}i(w);var b=!1;function Q(e,t,r,n){F(e,0+(n?1:0),3),t=t,r=r,M(e=e),T(e,r),T(e,~r),s.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}n._tr_init=function(e){b||(function(){for(var e,t,r,n,i=new Array(_+1),s=r=0;s<28;s++)for(g[s]=r,e=0;e<1<<u[s];e++)p[r++]=s;for(p[r-1]=s,s=n=0;s<16;s++)for(w[s]=n,e=0;e<1<<f[s];e++)d[n++]=s;for(n>>=7;s<30;s++)for(w[s]=n<<7,e=0;e<1<<f[s]-7;e++)d[256+n++]=s;for(t=0;t<=_;t++)i[t]=0;for(e=0;e<=143;)c[2*e+1]=8,e++,i[8]++;for(;e<=255;)c[2*e+1]=9,e++,i[9]++;for(;e<=279;)c[2*e+1]=7,e++,i[7]++;for(;e<=287;)c[2*e+1]=8,e++,i[8]++;for(j(c,287,i),e=0;e<30;e++)h[2*e+1]=5,h[2*e]=H(e,5);v=new I(c,u,257,286,_),m=new I(h,f,0,30,_),y=new I(new Array(0),o,0,19,7)}(),b=!0),e.l_desc=new r(e.dyn_ltree,v),e.d_desc=new r(e.dyn_dtree,m),e.bl_desc=new r(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,K(e)},n._tr_stored_block=Q,n._tr_flush_block=function(e,t,r,n){var i,s,a=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){for(var t=4093624447,r=0;r<=31;r++,t>>>=1)if(1&t&&0!==e.dyn_ltree[2*r])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(r=32;r<256;r++)if(0!==e.dyn_ltree[2*r])return 1;return 0}(e)),G(e,e.l_desc),G(e,e.d_desc),a=function(e){var t;for(X(e,e.dyn_ltree,e.l_desc.max_code),X(e,e.dyn_dtree,e.d_desc.max_code),G(e,e.bl_desc),t=18;3<=t&&0===e.bl_tree[2*l[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(s=e.static_len+3+7>>>3)<=i&&(i=s)):i=s=r+5,r+4<=i&&-1!==t?Q(e,t,r,n):4===e.strategy||s===i?(F(e,2+(n?1:0),3),q(e,c,h)):(F(e,4+(n?1:0),3),function(e,t,r,n){var i;for(F(e,t-257,5),F(e,r-1,5),F(e,n-4,4),i=0;i<n;i++)F(e,e.bl_tree[2*l[i]+1],3);W(e,e.dyn_ltree,t-1),W(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),q(e,e.dyn_ltree,e.dyn_dtree)),K(e),n&&M(e)},n._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(p[r]+256+1)]++,e.dyn_dtree[2*U(t)]++),e.last_lit===e.lit_bufsize-1},n._tr_align=function(e){F(e,2,3),L(e,256,c),16===(e=e).bi_valid?(T(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}},{"../utils/common":3}],15:[function(e,t,r){"use strict";t.exports=function(){self.input=null,self.next_in=0,self.avail_in=0,self.total_in=0,self.output=null,self.next_out=0,self.avail_out=0,self.total_out=0,self.msg="",self.state=null,self.data_type=2,self.adler=0}},{}],"/":[function(e,t,r){"use strict";var n={};(0,e("./lib/utils/common").assign)(n,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=n},{"./lib/deflate":1,"./lib/inflate":2,"./lib/utils/common":3,"./lib/zlib/constants":6}]},{},[])("/")},"object"==_typeof(t)?e.exports=n():(r=[],void 0===(n="function"==typeof(n=n)?n.apply(t,r):n)||(e.exports=n))}},n={};function __webpack_require__(e){var t=n[e];if(void 0!==t)return t.exports;t=n[e]={exports:{}};return r[e](t,t.exports,__webpack_require__),t.exports}__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return self||new Function("return self")()}catch(e){if("object"==typeof window)return window}}(),function(){"use strict";function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var e=function(){function CDMap(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CDMap),self._pairs=[],self.size=0}return function _createClass(e,t,r){t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CDMap,[{key:"has",value:function has(e){return-1<self._indexOf(e)}},{key:"get",value:function get(e){e=self._indexOf(e);if(-1<e)return self._pairs[e][1]}},{key:"set",value:function set(e,t){var r=self._indexOf(e);-1<r?self._pairs[r][1]=t:(self._pairs.push([e,t]),self.size++)}},{key:"delete",value:function _delete(e){e=self._indexOf(e);return-1<e&&(self._pairs.splice(e,1),self.size--,!0)}},{key:"forEach",value:function forEach(e){for(var t=0;t<self._pairs.length;t++)e(self._pairs[t][1],self._pairs[t][0])}},{key:"clear",value:function clear(){self._pairs=[]}},{key:"_indexOf",value:function _indexOf(e){for(var t=0;t<self._pairs.length;t++)if(self._pairs[t][0]===e)return t;return-1}}]),CDMap}(),t=function create(){return new(self.Map||e)};function CDSet_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function HI(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=new(self.Set||n),r=0;r<e.length;r++)t.add(e[r]);return t}var n=function(){function CDSet(){!function CDSet_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CDSet),self._set=[],self.size=0}return function CDSet_createClass(e,t,r){t&&CDSet_defineProperties(e.prototype,t),r&&CDSet_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CDSet,[{key:"add",value:function add(e){return self._set.push(e),self.size++,self}},{key:"has",value:function has(e){return-1<self._set.indexOf(e)}},{key:"delete",value:function _delete(e){for(var t=0;t<self._set.length;t++)if(self._set[t]===e)return self._set.splice(t,1),self.size--,!0;return!1}},{key:"forEach",value:function forEach(e){for(var t=0;t<self._set.length;t++)e(self._set[t])}},{key:"clear",value:function clear(){self._set=[]}}]),CDSet}();function WorkerCommunicator_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(){function WorkerCommunicator(){!function WorkerCommunicator_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WorkerCommunicator),self._msgListeners=t()}return function WorkerCommunicator_createClass(e,t,r){t&&WorkerCommunicator_defineProperties(e.prototype,t),r&&WorkerCommunicator_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WorkerCommunicator,[{key:"setMessagingPort",value:function setMessagingPort(e){var i=self;(self._messagePort=e).setonmessage(function(e){var t=e.data,r=[],n=i._msgListeners.get(t.msgType);n&&n.forEach(function(e){e.callback(t.data),e.isOneTime&&r.push(e)}),r.forEach(function(e){n.delete(e)})})}},{key:"sendAsync",value:function sendAsync(e,t,r,n,i){n&&r&&self.addMessageListener(r,n,i),self._messagePort.postMessage({msgType:e,data:t})}},{key:"addMessageListener",value:function addMessageListener(e,t,r){var n=null;self._msgListeners.has(e)?n=self._msgListeners.get(e):(n=HI(),self._msgListeners.set(e,n)),n.add({callback:t,isOneTime:r})}}]),WorkerCommunicator}(),o={resetSessionApiThreshold:"resetSessionApiThreshold",dataWupDispatchRateSettings:"dataWupDispatchRateSettings",logWupDispatchRateSettings:"logWupDispatchRateSettings",forceDynamicDataWupDispatchSettings:"forceDynamicDataWupDispatchSettings",wupStatisticsLogIntervalMs:"wupStatisticsLogIntervalMs",serverCommunicationSettings:"serverCommunicationSettings",wupResponseTimeout:"wupResponseTimeout",wupMessageRequestTimeout:"wupMessageRequestTimeout",logMessageRequestTimeout:"logMessageRequestTimeout",collectKeyRegionValue:"collectKeyRegionValue",crossDomainsList:"crossDomainsList",crossDomainsTimeout:"crossDomainsTimeout",isMutationObserver:"isMutationObserver",isEnabled:"isEnabled",slaveChannelHandshakeTimeout:"slaveChannelHandshakeTimeout",slaveAliveMessageInterval:"slaveAliveMessageInterval",collectCustomElementAttribute:"collectCustomElementAttribute",customElementAttribute:"customElementAttribute",enableFramesProcessing:"enableFramesProcessing",enableSameSiteNoneAndSecureCookies:"enableSameSiteNoneAndSecureCookies",wupServerURL:"wupServerURL",logAddress:"logAddress",shouldMaskClickEventValueField:"shouldMaskClickEventValueField",isCaptureKeyEvents:"isCaptureKeyEvents",locationEventsTimeoutMsec:"locationEventsTimeoutMsec",heartBeatMessageInterval:"heartBeatMessageInterval",isMotionAroundTouchEnabled:"isMotionAroundTouchEnabled",motionPaddingAroundTouchMSec:"motionPaddingAroundTouchMSec",isMotionOnSessionStart:"isMotionOnSessionStart",motionPaddingOnSessionStartMSec:"motionPaddingOnSessionStartMSec",isVMDetection:"isVMDetection",isScrollCollect:"isScrollCollect",isContextPropsFeature:"isContextPropsFeature",isCrossDomain:"isCrossdomain",gyroEventsThreshold:"gyroEventsThreshold",gyroEventsSamplePeriod:"gyroEventsSamplePeriod",dataQPassWorkerInterval:"dataQPassWorkerInterval",accelerometerEventsSamplePeriod:"accelerometerEventsSamplePeriod",orientationEventsThreshold:"orientationEventsThreshold",orientationEventsSamplePeriod:"orientationEventsSamplePeriod",isAudioDetection:"isAudioDetection",stateChangeEnabled:"stateChangeEnabled",logLevel:"logLevel",enableCustomElementsProcessing:"enableCustomElementsProcessing",keyEventsMaskSpecialChars:"keyEventsMaskSpecialChars",collectSelectElementBlurAndFocusEvents:"collectSelectElementBlurAndFocusEvents",allowedUnmaskedValuesList:"allowedUnmaskedValuesList",enableUnmaskedValues:"enableUnmaskedValues",wupMessageNumToRetry:"wupMessageNumToRetry",wupMessageRetryInterval:"wupMessageRetryInterval",wupIncrementalGrowthBetweenFailures:"wupIncrementalGrowthBetweenFailures",wupMaxIntervalBetweenFailures:"wupMaxIntervalBetweenFailures",logMessageNumToRetry:"logMessageNumToRetry",logMessageRetryInterval:"logMessageRetryInterval",logIncrementalGrowthBetweenFailures:"logIncrementalGrowthBetweenFailures",logMaxIntervalBetweenFailures:"logMaxIntervalBetweenFailures",cdsNumExpirationTime:"cdsNumExpirationTime",maskElementsAttributes:"maskElementsAttributes"},r="NewSessionStartedEvent",s="ConfigurationLoadedEvent",a="ServerStateUpdatedEvent",u="HeartBeatStatusEvent",f="ServerRestoredMuidEvent",l={DEBUG:10,INFO:20,WARN:30,ERROR:40,CRITICAL:50,OFF:80};function ConfigurationRepository_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c={defaultDynamicWupDispatchRateConfiguration:{type:"dynamic"},defaultIncrementalWupDispatchRateConfiguration:{type:"incremental",initialRateValueMs:500,incrementStepMs:500,incrementStopMs:5e3,incrementStartWupSendCount:20}},h=function(){function ConfigurationRepository(){!function ConfigurationRepository_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ConfigurationRepository),self._requireParseFields=t(),self._requireParseFields.set(o.dataWupDispatchRateSettings,o.dataWupDispatchRateSettings),self._requireParseFields.set(o.logWupDispatchRateSettings,o.logWupDispatchRateSettings),self._requireParseFields.set(o.crossDomainsList,o.crossDomainsList),self._requireParseFields.set(o.allowedUnmaskedValuesList,o.allowedUnmaskedValuesList),self._requireParseFields.set(o.serverCommunicationSettings,o.serverCommunicationSettings),self._configurationList={},self.configDefault={logLevel:l.INFO,isCrossdomain:!1,crossDomainsList:[],crossDomainsTimeout:5e3,orientationEventsSamplePeriod:300,orientationEventsThreshold:1,stateChangeEnabled:!1,accelerometerEventsSamplePeriod:0,dataQPassWorkerInterval:500,gyroEventsSamplePeriod:0,gyroEventsThreshold:.3,isContextPropsFeature:!0,isEnabled:!0,isResetEveryLoad:!1,isScrollCollect:!0,isVMDetection:!0,isAudioDetection:!1,wupStatisticsLogIntervalMs:3e4,heartBeatMessageInterval:5e3,resetSessionApiThreshold:2e4,wupMessageRequestTimeout:5e3,logMessageRequestTimeout:5e3,slaveChannelHandshakeTimeout:6e4,slaveAliveMessageInterval:100,forceDynamicDataWupDispatchSettings:!0,dataWupDispatchRateSettings:c.defaultDynamicWupDispatchRateConfiguration,logWupDispatchRateSettings:{type:"constant",initialRateValueMs:2500},serverCommunicationSettings:{queueLoadThreshold:100},collectKeyRegionValue:!1,isMutationObserver:!0,collectCustomElementAttribute:!0,shouldMaskClickEventValueField:!0,isCaptureKeyEvents:!1,locationEventsTimeoutMsec:1e4,isMotionAroundTouchEnabled:!0,motionPaddingAroundTouchMSec:3e3,isMotionOnSessionStart:!0,motionPaddingOnSessionStartMSec:2e4,keyEventsMaskSpecialChars:!1,collectSelectElementBlurAndFocusEvents:!1,enableUnmaskedValues:!1,allowedUnmaskedValuesList:[],wupMessageNumToRetry:5,wupMessageRetryInterval:1e3,wupIncrementalGrowthBetweenFailures:3500,wupMaxIntervalBetweenFailures:16e3,logMessageNumToRetry:5,logMessageRetryInterval:1e3,logIncrementalGrowthBetweenFailures:3500,logMaxIntervalBetweenFailures:16e3,cdsNumExpirationTime:60},self.loadConfigurations(self.configDefault)}return function ConfigurationRepository_createClass(e,t,r){t&&ConfigurationRepository_defineProperties(e.prototype,t),r&&ConfigurationRepository_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ConfigurationRepository,[{key:"isConfigurationUpdatedFromServer",value:function isConfigurationUpdatedFromServer(){return!self._isDefaultConfiguration}},{key:"loadConfigurations",value:function loadConfigurations(n){var i=self;n&&(self._isDefaultConfiguration=n===self.configDefault,Object.keys(n).forEach(function(e){var t,r=n[e];!i._requireParseFields.has(e)||(t=i._tryParseConfigurationValue(r))&&(r=t),i._configurationList[e]=r}))}},{key:"get",value:function get(e){return self._configurationList[e]}},{key:"set",value:function set(e,t){self._configurationList[e]=t}},{key:"getAll",value:function getAll(){return self._configurationList}},{key:"_tryParseConfigurationValue",value:function _tryParseConfigurationValue(e){if("string"!=typeof e)return null;try{return JSON.parse(e)}catch(e){}return null}}]),ConfigurationRepository}();function CDEvent_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var d=function(){function CDEvent(){!function CDEvent_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CDEvent),self._listeners=[]}return function CDEvent_createClass(e,t,r){t&&CDEvent_defineProperties(e.prototype,t),r&&CDEvent_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CDEvent,[{key:"subscribe",value:function subscribe(e){self._listeners.push(e)}},{key:"publish",value:function publish(e){for(var t=0,r=self._listeners.length;t<r;t++)self._listeners[t](e)}},{key:"unsubscribe",value:function unsubscribe(e){for(var t=0,r=self._listeners.length;t<r;t++)if(e===self._listeners[t]){self._listeners.splice(t,1);break}}}]),CDEvent}();function Logger_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Logger_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Logger_createClass(e,t,r){return t&&Logger_defineProperties(e.prototype,t),r&&Logger_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var p=function(){function Log(){Logger_classCallCheck(self,Log)}return Logger_createClass(Log,null,[{key:"setLogger",value:function setLogger(e){self._logger=e}},{key:"isDebug",value:function isDebug(){if(self._logger)return self._logger.isDebug()}},{key:"error",value:function error(e,t){self._logger&&self._logger.error(e,t||null)}},{key:"warn",value:function warn(e,t){self._logger&&self._logger.warn(e,t||null)}},{key:"trace",value:function trace(e){self._logger&&self._logger.trace(e)}},{key:"debug",value:function debug(e){self._logger&&self._logger.debug(e)}},{key:"info",value:function info(e){self._logger&&self._logger.info(e)}}]),Log}(),g=function(){function Logger(e,t){Logger_classCallCheck(self,Logger),self._logBridge=e,self._logLevel=t||l.INFO}return Logger_createClass(Logger,[{key:"trace",value:function trace(e){self._sendToLogBridge(e,l.DEBUG)}},{key:"debug",value:function debug(e){self._sendToLogBridge(e,l.DEBUG)}},{key:"info",value:function info(e){self._sendToLogBridge(e,l.INFO)}},{key:"warn",value:function warn(e,t){self._sendToLogBridge(e,l.WARN,t)}},{key:"error",value:function error(e,t){self._sendToLogBridge(e,l.ERROR,t)}},{key:"isDebug",value:function isDebug(){return self._logLevel===l.DEBUG}},{key:"updateLogConfig",value:function updateLogConfig(e){self._logLevel=e.get(o.logLevel)||self._logLevel,self._logBridge.setLogLevel(self._logLevel),self._logBridge.clearLogEntriesByLogLevel(self._logLevel)}},{key:"_sendToLogBridge",value:function _sendToLogBridge(e,t,r){t>=self._logLevel&&(r&&r.stack&&(e+=" ;stack: ".concat(r.stack)),self._logBridge.log(e,t))}}]),Logger}();function WupServerSessionState_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var _=function(){function WupServerSessionState(){!function WupServerSessionState_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WupServerSessionState),self.onServerStateUpdated=new d,self.reset()}return function WupServerSessionState_createClass(e,t,r){t&&WupServerSessionState_defineProperties(e.prototype,t),r&&WupServerSessionState_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WupServerSessionState,[{key:"getSts",value:function getSts(){return self._sts}},{key:"getStd",value:function getStd(){return self._std}},{key:"getSid",value:function getSid(){return self._sid}},{key:"getCsid",value:function getCsid(){return self._csid}},{key:"getPsid",value:function getPsid(){return self._psid}},{key:"getMuid",value:function getMuid(){return self._muid}},{key:"getContextName",value:function getContextName(){return self._contextName}},{key:"getRequestId",value:function getRequestId(){return self._requestId}},{key:"getWupDispatchRate",value:function getWupDispatchRate(){return self._wupDispatchRate}},{key:"getBrand",value:function getBrand(){return self._brand}},{key:"setSts",value:function setSts(e){self._sts=e}},{key:"setStd",value:function setStd(e){self._std=e}},{key:"setSid",value:function setSid(e){self._sid=e}},{key:"setCsid",value:function setCsid(e){self._csid=e}},{key:"setPsid",value:function setPsid(e){self._psid=e}},{key:"setMuid",value:function setMuid(e){self._muid=e}},{key:"setContextName",value:function setContextName(e){self._contextName=e}},{key:"setRequestId",value:function setRequestId(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return self._requestId=e,t&&self._publish(),self._requestId}},{key:"setWupDispatchRate",value:function setWupDispatchRate(e){e?self._wupDispatchRate=e:p.warn("Wup dispatch rate of ".concat(e," is invalid. Ignoring update"))}},{key:"setBrand",value:function setBrand(e){self._brand=e}},{key:"markConfigurationRequested",value:function markConfigurationRequested(){self._hasConfiguration?p.warn("We already have configuration. Ignoring the attempt to mark a pending configuration request."):self._hasPendingConfigurationRequest=!0}},{key:"markConfigurationReceived",value:function markConfigurationReceived(){self._hasConfiguration?p.warn("Marking that we received configuration although we already received configuration from the server. We shouldn\'t have received it again."):self._hasPendingConfigurationRequest||p.warn("Marking that we received configurations although we didn\'t have a pending request for configurations."),self._hasPendingConfigurationRequest=!1,self._hasConfiguration=!0}},{key:"getHasConfiguration",value:function getHasConfiguration(){return self._hasConfiguration}},{key:"getHasPendingConfigurationRequest",value:function getHasPendingConfigurationRequest(){return self._hasPendingConfigurationRequest}},{key:"incrementRequestId",value:function incrementRequestId(){return self._requestId++,self._publish(),self._requestId}},{key:"resetRequestId",value:function resetRequestId(){self._requestId=0}},{key:"reset",value:function reset(){self._sts=null,self._std=null,self._sid=null,self._csid=null,self._muid=null,self._contextName=null,self._requestId=0,self._wupDispatchRate=5e3,self._hasConfiguration=!1,self._hasPendingConfigurationRequest=!1,self._brand=null}},{key:"_publish",value:function _publish(){self.onServerStateUpdated.publish({requestId:self._requestId,sid:self._sid,sts:self._sts,std:self._std})}}]),WupServerSessionState}();function LogRequestBodyBuilder_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var v=function(){function LogRequestBodyBuilder(){!function LogRequestBodyBuilder_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,LogRequestBodyBuilder)}return function LogRequestBodyBuilder_createClass(e,t,r){t&&LogRequestBodyBuilder_defineProperties(e.prototype,t),r&&LogRequestBodyBuilder_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(LogRequestBodyBuilder,[{key:"build",value:function build(e){return e.getInternalMessage()}}]),LogRequestBodyBuilder}();function Queue_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var m=function(){function Queue(){!function Queue_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,Queue),self._buffer=[]}return function Queue_createClass(e,t,r){t&&Queue_defineProperties(e.prototype,t),r&&Queue_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(Queue,[{key:"hasItems",value:function hasItems(){return 0<self.length()}},{key:"length",value:function length(){return self._buffer.length}},{key:"enqueue",value:function enqueue(e){self._buffer.push(e)}},{key:"enqueueToHead",value:function enqueueToHead(e){self._buffer.unshift(e)}},{key:"dequeue",value:function dequeue(){return self._buffer.shift()}},{key:"getItem",value:function getItem(e){return self._buffer[e]}}]),Queue}();function DOMUtils_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var y=function(){function DOMUtils(){!function DOMUtils_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,DOMUtils)}return function DOMUtils_createClass(e,t,r){t&&DOMUtils_defineProperties(e.prototype,t),r&&DOMUtils_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(DOMUtils,null,[{key:"addEventListener",value:function addEventListener(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],s=5<arguments.length&&void 0!==arguments[5]&&arguments[5];self.isPassiveSupported?e.addEventListener(t,r,{capture:n,passive:i,once:s}):e.addEventListener?e.addEventListener(t,r,n):e.attachEvent("on"+t,r)}},{key:"removeEventListener",value:function removeEventListener(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3];e.removeEventListener?e.removeEventListener(t,r,n):e.detachEvent("on"+t,r)}},{key:"outerHTML",value:function outerHTML(e){return e.outerHTML||(new XMLSerializer).serializeToString(e)}},{key:"onDocumentBody",value:function onDocumentBody(e,t){e.document.body?t():window.addEventListener?window.addEventListener("DOMContentLoaded",t,!0):window.attachEvent("onload",t)}},{key:"onPageLoad",value:function onPageLoad(e,t){DOMUtils.addEventListener(e,"load",t,!0),(e.contentWindow&&"complete"===e.contentWindow.document.readyState||e.document&&"complete"===e.document.readyState)&&t()}},{key:"waitUntilDocumentIsReady",value:function waitUntilDocumentIsReady(r){var n=self;return new Promise(function(e,t){try{n.onWindowDocumentReady(r,function(){e()})}catch(e){t(e)}})}},{key:"onWindowDocumentReady",value:function onWindowDocumentReady(e,t){var r,n=window.addEventListener?"DOMContentLoaded":"load";"complete"===e.document.readyState||"interactive"===e.document.readyState?t():(r=function onLoadedWindowEvent(){DOMUtils.removeEventListener(e,n,r,!0),t()},DOMUtils.addEventListener(e,n,r,!0))}},{key:"isWindowDocumentReady",value:function isWindowDocumentReady(e){return e&&"complete"===e.document.readyState}},{key:"canAccessIFrame",value:function canAccessIFrame(e){var t=null;try{t=(e.contentDocument||e.contentWindow.document).body.innerHTML}catch(e){}return null!==t}},{key:"matches",value:function matches(e,t){return(e.matches||e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){var t=self.document||self.ownerDocument;if(!t)return!1;for(var r=t.querySelectorAll(e),n=r.length;0<=--n;)if((r.item?r.item(n):r[n])===self)break;return-1<n}).call(e,t)}},{key:"isWebWorkerFetchSupported",value:function isWebWorkerFetchSupported(){var e="Request"in self,t="fetch"in self;if(!e)return!1;e="keepalive"in Request.prototype;return t&&e}}]),DOMUtils}();function ServerCommunicator_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}!function _defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(y,"isPassiveSupported",function isPassiveSupported(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function get(){e=!0}});window.addEventListener("test",null,t)}catch(e){}return e}());var w=function(){function ServerCommunicator(e,t,r,n){var i=4<arguments.length&&void 0!==arguments[4]&&arguments[4],s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"";!function ServerCommunicator_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ServerCommunicator),self._requestBodyBuilder=e,self.updateSettings(t),self._workerUtils=r,self._acceptNoResponse=i,self._messageDescriptor=s,self.retryMessage=n,self._dataQueue=new m,self._awaitingServerResponse=!1,self._currentSentItem=null,self._sendRetryTimeoutId=null,self._shouldRetryToSendMessage=!1,self._messageIdentifier=0}return function ServerCommunicator_createClass(e,t,r){t&&ServerCommunicator_defineProperties(e.prototype,t),r&&ServerCommunicator_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ServerCommunicator,[{key:"setServerUrl",value:function setServerUrl(e){self.wupUrl=e}},{key:"updateSettings",value:function updateSettings(e){self._queueLoadThershold=e.queueLoadThreshold}},{key:"getRetryMessage",value:function getRetryMessage(){return self.retryMessage}},{key:"sendMessage",value:function sendMessage(e,t,r,n,i,s,a){function IO(e){o._onMessageSendSuccess(e,i)}function JO(e,t,r){o._onMessageSendFailure(e,t,r,s,a)}var o=self;self._enqueueMessage(e,t,r,n,IO,JO)}},{key:"flush",value:function flush(){self._flushData()}},{key:"isReadyToSendData",value:function isReadyToSendData(){return!!self.wupUrl}},{key:"_onMessageSendSuccess",value:function _onMessageSendSuccess(e,t){self._awaitingServerResponse=!1,self._currentSentItem=null,self._shouldRetryToSendMessage=!1,self.retryMessage.restartMessageSettings(),t(e),self._processNextQueueItem()}},{key:"_onMessageSendFailure",value:function _onMessageSendFailure(e,t,r,n,i){if(!self._currentSentItem)return p.error("An unexpected error has occurred while handling a ".concat(self._messageDescriptor," message send failure. Could not find sent item value. Moving to next queued item")),void self._processNextQueueItem();p.warn("Failed sending ".concat(self._messageDescriptor," message #").concat(self._currentSentItem.identifier,". ").concat(self._buildFailureLog(e,t,r))),self._awaitingServerResponse=!1;r=0===self._currentSentItem.maxNumberOfSendAttempts;self.retryMessage.shouldReMessage(r)?(self._shouldRetryToSendMessage=!0,p.info("Trying to send ".concat(self._messageDescriptor," message #").concat(self._currentSentItem.identifier," again. Number of send failures is ").concat(self.retryMessage.getNumberOfSendFailures())),self._prepareMessageForSendRetry(),n&&n(self.retryMessage.getNumberOfSendFailures())):(self._shouldRetryToSendMessage=!1,self.retryMessage.restartMessageSettings(),p.warn("Discarding ".concat(self._messageDescriptor," message #").concat(self._currentSentItem.identifier," after ").concat(self.retryMessage.getNumberOfSendFailures()," failed send attempts.")),n&&n(self.retryMessage.getNumberOfSendFailures()),self._currentSentItem=null,i&&i(e),self._processNextQueueItem())}},{key:"_enqueueMessage",value:function _enqueueMessage(e,t,r,n,i,s){self._dataQueue.enqueue({identifier:self._messageIdentifier++,messageToSend:e,onSuccess:i,onError:s,timeout:t,maxNumberOfSendAttempts:r}),self._shouldRetryToSendMessage||(self._clearRetryTimeout(),n&&self._flushData(),self._awaitingServerResponse||self._processNextQueueItem(n))}},{key:"_processNextQueueItem",value:function _processNextQueueItem(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(self._dataQueue.hasItems()||!t){var r=null;t?(r=self._dataQueue.dequeue(),self._currentSentItem=r):r=self._currentSentItem;t=self._requestBodyBuilder.build(r.messageToSend,e);if(y.isWebWorkerFetchSupported()&&e)return self._currentSentItem=null,self.fetch(self.wupUrl,{method:"POST",keepalive:!0,body:t}),void p.info("Flush data was sent by fetch");self._awaitingServerResponse=!0,self._workerUtils.getPostUrl(self.wupUrl,"POST",t,r.onSuccess,r.onError,self._acceptNoResponse,r.timeout),self._dataQueue.length()>self._queueLoadThershold&&p.warn("Data queue has ".concat(self._dataQueue.length()," items in queue. Might indicate slow\\\\unstable communication issues."))}}},{key:"_flushData",value:function _flushData(){for(;self._dataQueue.hasItems();)self._processNextQueueItem(!0)}},{key:"_prepareMessageForSendRetry",value:function _prepareMessageForSendRetry(){var e=self;self._clearRetryTimeout(),self.retryMessage.updateRetryInterval();var t=self.retryMessage.getNextInterval();self._sendRetryTimeoutId=setTimeout(function(){e._processNextQueueItem(!1,!1)},t)}},{key:"_clearRetryTimeout",value:function _clearRetryTimeout(){self._sendRetryTimeoutId&&clearTimeout(self._sendRetryTimeoutId)}},{key:"_buildFailureLog",value:function _buildFailureLog(e,t,r){var n="";return e&&(n+="Response Text: ".concat(e,".")),t&&(n+="Status: ".concat(t,".")),r&&(n+="Status Text: ".concat(r,".")),n}}]),ServerCommunicator}();function LogMessage_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var b=function(){function LogMessage(){!function LogMessage_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,LogMessage)}return function LogMessage_createClass(e,t,r){t&&LogMessage_defineProperties(e.prototype,t),r&&LogMessage_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(LogMessage,[{key:"setData",value:function setData(e){self._data=e}},{key:"getInternalMessage",value:function getInternalMessage(){return self._data}}]),LogMessage}();function LogMessageBuilder_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var S=function(){function LogMessageBuilder(e){!function LogMessageBuilder_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,LogMessageBuilder),self._dataPacker=e}return function LogMessageBuilder_createClass(e,t,r){t&&LogMessageBuilder_defineProperties(e.prototype,t),r&&LogMessageBuilder_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(LogMessageBuilder,[{key:"build",value:function build(e){var t=new b;return t.setData(self._dataPacker.pack(e)),t}}]),LogMessageBuilder}(),k=self.btoa?self.btoa.bind(self):function(e){for(var t,r,n=String(e),i="",s=0,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.charAt(0|s)||(a="=",s%1);i+=a.charAt(63&t>>8-s%1*8)){if(255<(r=n.charCodeAt(s+=.75)))throw new Error("\'btoa\' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|r}return i};function DataPacker_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var C=__webpack_require__(563),E=__webpack_require__(12),R=function(){function DataPacker(){!function DataPacker_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,DataPacker),self._compressData=function(e){e=C.encode(e),e=E.deflateRaw(e,{to:"string"});return k(e)}}return function DataPacker_createClass(e,t,r){t&&DataPacker_defineProperties(e.prototype,t),r&&DataPacker_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(DataPacker,[{key:"pack",value:function pack(e){return self._getCompressedData(e)}},{key:"_getCompressedData",value:function _getCompressedData(e){return self._compressData(e)}}]),DataPacker}(),B=5,P=1,M=1e3,D=1e3,x=100,I=1e4,A=3500,W=0,T=1e4,L=16e3,U=100,O=3e5;function ReMessageSettings_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var F=function(){function ReMessageSettings(e,t,r,n){!function ReMessageSettings_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ReMessageSettings),self.messageNumToRetry=e,self.messageRetryInterval=t,self.incrementalGrowthBetweenFailures=r,self.maxIntervalBetweenFailures=n,self.init()}return function ReMessageSettings_createClass(e,t,r){t&&ReMessageSettings_defineProperties(e.prototype,t),r&&ReMessageSettings_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ReMessageSettings,[{key:"init",value:function init(){self._validateReMessageSettings()}},{key:"getMessageNumToRetry",value:function getMessageNumToRetry(){return self.messageNumToRetry}},{key:"getMessageRetryInterval",value:function getMessageRetryInterval(){return self.messageRetryInterval}},{key:"getMaxIntervalBetweenFailures",value:function getMaxIntervalBetweenFailures(){return self.maxIntervalBetweenFailures}},{key:"getIncrementalGrowthBetweenFailures",value:function getIncrementalGrowthBetweenFailures(){return self.incrementalGrowthBetweenFailures}},{key:"_validateReMessageSettings",value:function _validateReMessageSettings(){var e,t="The provided configuration is invalid, it must be  ";isNaN(self.messageNumToRetry)?(p.warn("".concat(t," a number. setting to default: ").concat(B)),self.messageNumToRetry=B):(e=parseInt(self.messageNumToRetry),self.messageNumToRetry=e),(self.messageNumToRetry<P||self.messageNumToRetry>M)&&(p.warn("messageNumToRetry - ".concat(t," in the following range: \\n            ").concat(P," - ").concat(M," setting to default: ").concat(B)),self.messageNumToRetry=B),(self.messageRetryInterval<x||self.messageRetryInterval>I)&&(p.warn("messageRetryInterval - ".concat(t," in the following range: \\n            [").concat(x," - ").concat(I,"], \\n            setting to default: ").concat(D)),self.messageRetryInterval=D),(self.incrementalGrowthBetweenFailures<W||self.incrementalGrowthBetweenFailures>T)&&(p.warn("incrementalGrowthBetweenFailures - ".concat(t," in the following range: \\n            [").concat(W," - ").concat(T,"],\\n                setting to default: ").concat(A)),self.incrementalGrowthBetweenFailures=A),(self.maxIntervalBetweenFailures<U||self.maxIntervalBetweenFailures>O)&&(p.warn("maxIntervalBetweenFailures - ".concat(t," in the following range: \\n            [").concat(U," - ").concat(O,"]\\n                setting to default: ").concat(L)),self.maxIntervalBetweenFailures=L),self.maxIntervalBetweenFailures<self.messageRetryInterval&&(p.warn(" maxIntervalBetweenFailures - ".concat(t," greater than minimum interval: \\n            [").concat(U,"], setting to defaults:\\n                ").concat(L)),self.maxIntervalBetweenFailures=L,self.messageRetryInterval=D)}}]),ReMessageSettings}();function ConfigurationWrapperLogMessage_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var N=function(){function ConfigurationWrapperLogMessage(e){!function ConfigurationWrapperLogMessage_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ConfigurationWrapperLogMessage),self.logMessageNumToRetry=e.get(o.logMessageNumToRetry),self.logMessageRetryInterval=e.get(o.logMessageRetryInterval),self.logIncrementalGrowthBetweenFailures=e.get(o.logIncrementalGrowthBetweenFailures),self.logMaxIntervalBetweenFailures=e.get(o.logMaxIntervalBetweenFailures)}return function ConfigurationWrapperLogMessage_createClass(e,t,r){t&&ConfigurationWrapperLogMessage_defineProperties(e.prototype,t),r&&ConfigurationWrapperLogMessage_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ConfigurationWrapperLogMessage,[{key:"createReMessageSettings",value:function createReMessageSettings(){return new F(self.logMessageNumToRetry,self.logMessageRetryInterval,self.logIncrementalGrowthBetweenFailures,self.logMaxIntervalBetweenFailures)}}]),ConfigurationWrapperLogMessage}();function LogServerClient_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var z=function(){function LogServerClient(e,t,r){!function LogServerClient_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,LogServerClient),self._serverCommunicator=e,self._logMessageBuilder=t,self._configurationRepository=r,self._MESSAGE_SEND_RETRIES=5,self._requestTimeout=self._configurationRepository.get(o.logMessageRequestTimeout)}return function LogServerClient_createClass(e,t,r){t&&LogServerClient_defineProperties(e.prototype,t),r&&LogServerClient_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(LogServerClient,[{key:"setServerUrl",value:function setServerUrl(e){self._serverCommunicator.setServerUrl(e)}},{key:"sendData",value:function sendData(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e=self._logMessageBuilder.build(e);self._serverCommunicator.sendMessage(e,self._requestTimeout,self._serverCommunicator.getRetryMessage().getMessageNumToRetry(),t,self._onSendDataSuccess.bind(self),self._onSendDataFailure.bind(self)),t&&self._serverCommunicator.flush()}},{key:"isReady",value:function isReady(){return self._serverCommunicator.isReadyToSendData()}},{key:"setRequestTimeout",value:function setRequestTimeout(e){self._requestTimeout=e}},{key:"setConfigurationLogMessage",value:function setConfigurationLogMessage(){self._configurationWraperLogMessage=new N(self._configurationRepository),self._reLogMessageSettings=self._configurationWraperLogMessage.createReMessageSettings(),self._serverCommunicator.getRetryMessage().updateSettings(self._reLogMessageSettings)}},{key:"_onSendDataSuccess",value:function _onSendDataSuccess(){}},{key:"_onSendDataFailure",value:function _onSendDataFailure(e){p.warn("Failed sending log message. Error: ".concat(e,"."))}}]),LogServerClient}();function WupStatisticsService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var q=function(){function WupStatisticsService(e){!function WupStatisticsService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WupStatisticsService),self._statisticsLogIntervalMs=e,self.resetCounters(),self._setPeriodicStatisticsLog()}return function WupStatisticsService_createClass(e,t,r){t&&WupStatisticsService_defineProperties(e.prototype,t),r&&WupStatisticsService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WupStatisticsService,[{key:"getSentWupsCount",value:function getSentWupsCount(){return self._sentWupsCount}},{key:"incrementSentWupCount",value:function incrementSentWupCount(){self._sentWupsCount++,self._sentWupsInCurrentIntervalCount++}},{key:"updateSettings",value:function updateSettings(e){self._statisticsLogIntervalMs=e,self._setPeriodicStatisticsLog()}},{key:"resetCounters",value:function resetCounters(){self._sentWupsCount=0,self._sentWupsInCurrentIntervalCount=0}},{key:"stop",value:function stop(){self._stopPeriodicStatisticsLog()}},{key:"_writeStatisticsLog",value:function _writeStatisticsLog(){0!==self._sentWupsInCurrentIntervalCount&&(p.info("Sent ".concat(self._sentWupsInCurrentIntervalCount," wup in the last ").concat(self._statisticsLogIntervalMs," ms. Sent a total of ").concat(self._sentWupsCount," in the session")),self._sentWupsInCurrentIntervalCount=0)}},{key:"_stopPeriodicStatisticsLog",value:function _stopPeriodicStatisticsLog(){self._periodicLogIntervalId&&clearInterval(self._periodicLogIntervalId)}},{key:"_setPeriodicStatisticsLog",value:function _setPeriodicStatisticsLog(){self._stopPeriodicStatisticsLog(),self._periodicLogIntervalId=setInterval(self._writeStatisticsLog.bind(self),self._statisticsLogIntervalMs)}}]),WupStatisticsService}(),j="incremental",H="constant",Y="dynamic";function WupDispatchConstantRateCalculator_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var G=function(){function WupDispatchConstantRateCalculator(e){!function WupDispatchConstantRateCalculator_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WupDispatchConstantRateCalculator),self.updateSettings(e)}return function WupDispatchConstantRateCalculator_createClass(e,t,r){t&&WupDispatchConstantRateCalculator_defineProperties(e.prototype,t),r&&WupDispatchConstantRateCalculator_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WupDispatchConstantRateCalculator,[{key:"getRate",value:function getRate(){return self._currentRate}},{key:"updateSettings",value:function updateSettings(e){if(e.type!==H)throw new Error("Invalid settings provided to constant calculator");self._currentRate=e.initialRateValueMs}}]),WupDispatchConstantRateCalculator}();function WupDispatchIncrementalRateCalculator_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Z=function(){function WupDispatchIncrementalRateCalculator(e,t){!function WupDispatchIncrementalRateCalculator_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WupDispatchIncrementalRateCalculator),self._wupStatisticsService=t,self.updateSettings(e)}return function WupDispatchIncrementalRateCalculator_createClass(e,t,r){t&&WupDispatchIncrementalRateCalculator_defineProperties(e.prototype,t),r&&WupDispatchIncrementalRateCalculator_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WupDispatchIncrementalRateCalculator,[{key:"getRate",value:function getRate(){if(self._wupStatisticsService.getSentWupsCount()<self._incrementStartWupSendCount)return self._currentRate;var e=self._currentRate+self._incrementStepMs;return e<=self._incrementStopMs&&(self._currentRate=e),self._currentRate}},{key:"updateSettings",value:function updateSettings(e){if(e.type!==j)throw new Error("Invalid settings provided to incremental calculator");self._currentRate=e.initialRateValueMs,self._incrementStepMs=e.incrementStepMs,self._incrementStopMs=e.incrementStopMs,self._incrementStartWupSendCount=e.incrementStartWupSendCount}}]),WupDispatchIncrementalRateCalculator}();function WupDispatchDynamicRateCalculator_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var V=function(){function WupDispatchDynamicRateCalculator(e){!function WupDispatchDynamicRateCalculator_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WupDispatchDynamicRateCalculator),self._wupServerSessionState=e}return function WupDispatchDynamicRateCalculator_createClass(e,t,r){t&&WupDispatchDynamicRateCalculator_defineProperties(e.prototype,t),r&&WupDispatchDynamicRateCalculator_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WupDispatchDynamicRateCalculator,[{key:"getRate",value:function getRate(){return self._wupServerSessionState.getWupDispatchRate()}},{key:"updateSettings",value:function updateSettings(){}}]),WupDispatchDynamicRateCalculator}();function WupDispatchRateCalculatorFactory_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Q=function(){function WupDispatchRateCalculatorFactory(e,t){!function WupDispatchRateCalculatorFactory_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WupDispatchRateCalculatorFactory),self._wupStatisticsService=e,self._wupServerSessionState=t}return function WupDispatchRateCalculatorFactory_createClass(e,t,r){t&&WupDispatchRateCalculatorFactory_defineProperties(e.prototype,t),r&&WupDispatchRateCalculatorFactory_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WupDispatchRateCalculatorFactory,[{key:"create",value:function create(e){if(e.type===H)return new G(e);if(e.type===j)return new Z(e,self._wupStatisticsService);if(e.type===Y)return new V(self._wupServerSessionState);throw new Error("Unsupported dispatch rate type ".concat(e.type))}}]),WupDispatchRateCalculatorFactory}();function DataDispatcher_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var K=function(){function DataDispatcher(e,t,r,n){!function DataDispatcher_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,DataDispatcher),self._serverClient=e,self._aggregator=t,self._wupDispatchRateCalculatorFactory=r,self._wupDispatchRateSettings=n,self._wupDispatchRateCalculator=self._wupDispatchRateCalculatorFactory.create(self._wupDispatchRateSettings),self._sendToServerInterval=self._wupDispatchRateCalculator.getRate(),self._setDispatchInterval(self._sendToServerInterval)}return function DataDispatcher_createClass(e,t,r){t&&DataDispatcher_defineProperties(e.prototype,t),r&&DataDispatcher_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(DataDispatcher,[{key:"add",value:function add(e){self._aggregator.add(e)}},{key:"sendIfRequired",value:function sendIfRequired(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];0!==self._sendToServerInterval&&!e||self._sendToServer(e)}},{key:"updateByConfig",value:function updateByConfig(e){e&&(e.type!==self._wupDispatchRateSettings.type?self._wupDispatchRateCalculator=self._wupDispatchRateCalculatorFactory.create(e):self._wupDispatchRateCalculator.updateSettings(e),self._sendToServerInterval=self._wupDispatchRateCalculator.getRate(),self._setDispatchInterval(self._sendToServerInterval),self._wupDispatchRateSettings=e)}},{key:"scheduleNextDispatching",value:function scheduleNextDispatching(){var e=self._wupDispatchRateCalculator.getRate();e!==self._sendToServerInterval&&(self._sendToServerInterval=e,self._setDispatchInterval(self._sendToServerInterval))}},{key:"_sendToServer",value:function _sendToServer(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];p.debug("Sending a message to the server"),self._serverClient.isReady()?self._aggregator.isEmpty()||(self._serverClient.sendData(self._aggregator.take(),e),self.scheduleNextDispatching()):p.info("".concat(self._serverClient.constructor.name," is not ready. Message will not be sent to server"))}},{key:"_setDispatchInterval",value:function _setDispatchInterval(e){self._sendIntervalId&&(clearInterval(self._sendIntervalId),self._sendIntervalId=null),0!==e&&(self._sendIntervalId=setInterval(self._sendToServer.bind(self),e))}}]),DataDispatcher}();function LogAggregator_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var X=function(){function LogAggregator(){!function LogAggregator_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,LogAggregator),self.reset()}return function LogAggregator_createClass(e,t,r){t&&LogAggregator_defineProperties(e.prototype,t),r&&LogAggregator_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(LogAggregator,[{key:"setLogLevel",value:function setLogLevel(e){self._logLevel=e}},{key:"add",value:function add(e){e=e.data;if(!e)throw new Error("Unable to add log message. Missing data field");(!e.level||e.level>=self._logLevel)&&self._Q.push(e)}},{key:"take",value:function take(){var e=self._Q;return self.reset(),e}},{key:"reset",value:function reset(){self._Q=[],self.setLogLevel(l.INFO)}},{key:"isEmpty",value:function isEmpty(){return 0===self._Q.length}},{key:"filterOutByLogLevel",value:function filterOutByLogLevel(n){self._Q=self._Q.filter(function(e,t,r){return e.level>=n})}}]),LogAggregator}();function MessageProcessor_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var J=function(){function MessageProcessor(e){!function MessageProcessor_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,MessageProcessor),self._dataDispatcher=e}return function MessageProcessor_createClass(e,t,r){t&&MessageProcessor_defineProperties(e.prototype,t),r&&MessageProcessor_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(MessageProcessor,[{key:"process",value:function process(e){if(!e)throw new Error("Invalid message received for processing.");var t=!1;if(Array.isArray(e))for(var r=0,n=e.length;r<n;r++)t=self._processSingleMessage(e[r])||t;else t=self._processSingleMessage(e)||t;self._dataDispatcher.sendIfRequired(t)}},{key:"_processSingleMessage",value:function _processSingleMessage(e){if(self._isEmptyFlushMessage(e))return!0;var t=!1;if(e.shouldFlush&&(t=!0),self._isDataValid(e))return self._dataDispatcher.add(e),t;t="Received a message with invalid structure. Missing eventName or Data fields";throw p.error(t),new Error(t)}},{key:"_isEmptyFlushMessage",value:function _isEmptyFlushMessage(e){return"flushData"===e.eventName}},{key:"_isDataValid",value:function _isDataValid(e){return e.eventName&&e.data}}]),MessageProcessor}(),$="js";function WupMessage_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ee=function(){function WupMessage(){!function WupMessage_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WupMessage),self._messageStruct={ds:$}}return function WupMessage_createClass(e,t,r){t&&WupMessage_defineProperties(e.prototype,t),r&&WupMessage_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WupMessage,[{key:"getDataSource",value:function getDataSource(){return self._messageStruct.ds}},{key:"getSid",value:function getSid(){return self._messageStruct.cdsnum}},{key:"setSid",value:function setSid(e){self._messageStruct.cdsnum=e}},{key:"getCsid",value:function getCsid(){return self._messageStruct.csid}},{key:"setCsid",value:function setCsid(e){self._messageStruct.csid=e}},{key:"getPsid",value:function getPsid(){return self._messageStruct.psid}},{key:"setPsid",value:function setPsid(e){self._messageStruct.psid=e}},{key:"getMuid",value:function getMuid(){return self._messageStruct.muid}},{key:"setMuid",value:function setMuid(e){self._messageStruct.muid=e}},{key:"getContextName",value:function getContextName(){return self._messageStruct.context_name}},{key:"setContextName",value:function setContextName(e){self._messageStruct.context_name=e}},{key:"getRequestId",value:function getRequestId(){return self._messageStruct.requestId}},{key:"setRequestId",value:function setRequestId(e){self._messageStruct.requestId=e}},{key:"getSts",value:function getSts(){return self._messageStruct.sts}},{key:"setSts",value:function setSts(e){self._messageStruct.sts=e}},{key:"getStd",value:function getStd(){return self._messageStruct.std}},{key:"setStd",value:function setStd(e){self._messageStruct.std=e}},{key:"setFlush",value:function setFlush(e){self._messageStruct.f=e}},{key:"getConfigurationName",value:function getConfigurationName(){return self._messageStruct.c}},{key:"setConfigurationName",value:function setConfigurationName(e){self._messageStruct.c=e}},{key:"getData",value:function getData(){return self._messageStruct.d}},{key:"setData",value:function setData(e){self._messageStruct.d=e}},{key:"getInternalMessage",value:function getInternalMessage(){return self._messageStruct}}]),WupMessage}();function WupMessageBuilder_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var te=function(){function WupMessageBuilder(e,t){!function WupMessageBuilder_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WupMessageBuilder),self._wupServerSessionState=e,self._dataPacker=t}return function WupMessageBuilder_createClass(e,t,r){t&&WupMessageBuilder_defineProperties(e.prototype,t),r&&WupMessageBuilder_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WupMessageBuilder,[{key:"build",value:function build(e,t){var r=new ee;return self._updateDataWithBrand(t),r.setSid(self._wupServerSessionState.getSid()),r.setCsid(self._wupServerSessionState.getCsid()),r.setPsid(self._wupServerSessionState.getPsid()),r.setMuid(self._wupServerSessionState.getMuid()),r.setContextName(self._wupServerSessionState.getContextName()),r.setRequestId(self._wupServerSessionState.getRequestId()),self._wupServerSessionState.getSts()&&self._wupServerSessionState.getStd()&&(r.setSts(self._wupServerSessionState.getSts()),r.setStd(self._wupServerSessionState.getStd())),e===$?r.setConfigurationName(e):r.setData([self._dataPacker.pack(t)]),r}},{key:"_updateDataWithBrand",value:function _updateDataWithBrand(e){var t=self._wupServerSessionState.getBrand();t&&(e.static_fields||(e.static_fields=[]),e.static_fields.push(["brand",t]))}}]),WupMessageBuilder}();function WupRequestBodyBuilder_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var re=function(){function WupRequestBodyBuilder(e){!function WupRequestBodyBuilder_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WupRequestBodyBuilder),self._wupServerSessionState=e}return function WupRequestBodyBuilder_createClass(e,t,r){t&&WupRequestBodyBuilder_defineProperties(e.prototype,t),r&&WupRequestBodyBuilder_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WupRequestBodyBuilder,[{key:"build",value:function build(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return e.setSid(self._wupServerSessionState.getSid()),e.setSts(self._wupServerSessionState.getSts()),e.setStd(self._wupServerSessionState.getStd()),t&&e.setFlush($),JSON.stringify(e.getInternalMessage())}}]),WupRequestBodyBuilder}(),ne={TouchEvent:"touchEvent",KeyEvent:"keyEvent",ConfigurationLoadedEvent:"ConfigurationLoadedEvent",NewSessionStartedEvent:"NewSessionStartedEvent",WupDispatchRateUpdatedEvent:"WupDispatchRateUpdatedEvent",ApiContextChangeEvent:"ApiContextChangeEvent",ApiResetSessionEvent:"ApiResetSessionEvent",ApiCustomerMetadataEvent:"ApiCustomerMetadataEvent",ApiChangeStateEvent:"ApiChangeStateEvent",ApiSetCsidEvent:"ApiSetCsidEvent",ApiSetPsidEvent:"ApiSetPsidEvent",ApiSetCustomerBrand:"ApiSetCustomerBrand",ServerStateUpdatedEvent:"ServerStateUpdatedEvent",ServerRestoredMuidEvent:"ServerRestoredMuidEvent",StateChangedEvent:"StateChangedEvent",MutationSingleEvent:"MutationSingleEvent",MutationAddedNodes:"MutationAddedNodes",MutationRemovedNodes:"MutationRemovedNodes",StandardInputEvent:"StandardInputEvent",StandardInputFocusEvent:"StandardInputFocusEvent",StandardInputBlurEvent:"StandardInputBlurEvent",StandardOnClickEvent:"StandardOnClickEvent",StandardOnSelectEvent:"StandardOnSelectEvent",ElementFocusEvent:"ElementFocusEvent",ElementBlurEvent:"ElementBlurEvent",StandardOnFormSubmitEvent:"StandardOnFormSubmitEvent",SyntheticInputMaskEvent:"SyntheticInputMaskEvent",CutEvent:"CutEvent",CopyEvent:"CopyEvent",PasteEvent:"PasteEvent",DeviceOrientationEvent:"DeviceOrientationEvent",BeforeInstallPromptEvent:"BeforeInstallPromptEvent",FocusEvent:"FocusEvent",BlurEvent:"BlurEvent",ResizeEvent:"ResizeEvent",DOMContentLoadedEvent:"DOMContentLoadedEvent",VisibilityChangeEvent:"VisibilityChangeEvent",ScrollEvent:"ScrollEvent",WindowMessageEvent:"WindowMessageEvent",WorkerSystemStatusEvent:"WorkerSystemStatusEvent",CustomElementDetectedEvent:"CustomElementDetectedEvent",CustomElementAddedEvent:"CustomElementAddedEvent",CustomElementRemovedEvent:"CustomElementRemovedEvent",CustomElementInaccessible:"CustomElementInaccessible",CustomElementSubmitted:"CustomElementSubmitted",BrowserContextAdded:"BrowserContextAdded",RunDefaultFeatures:"RunDefaultFeatures",StopDefaultFeatures:"StopDefaultFeatures"};function WupResponseProcessor_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ie=function(){function WupResponseProcessor(e,t,r){!function WupResponseProcessor_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WupResponseProcessor),self._wupServerSessionState=e,self._messageBus=t,self._configurationRepository=r}return function WupResponseProcessor_createClass(e,t,r){t&&WupResponseProcessor_defineProperties(e.prototype,t),r&&WupResponseProcessor_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WupResponseProcessor,[{key:"process",value:function process(e,t){var r=!1;t&&(self._wupServerSessionState.markConfigurationReceived(),self._configurationRepository.loadConfigurations(e),r=!0),e.sts&&self._wupServerSessionState.setSts(e.sts),e.std&&self._wupServerSessionState.setStd(e.std),e.reset_session&&e.new_sid&&self._wupServerSessionState.setSid(e.new_sid),e.rmd&&self._wupServerSessionState.setMuid(e.rmd),self._messageBus.publish(ne.ServerStateUpdatedEvent,{requestId:self._wupServerSessionState.getRequestId(),sid:self._wupServerSessionState.getSid(),sts:self._wupServerSessionState.getSts(),std:self._wupServerSessionState.getStd()}),e.rmd&&self._messageBus.publish(ne.ServerRestoredMuidEvent,e.rmd),r&&self._messageBus.publish(ne.ConfigurationLoadedEvent,self._configurationRepository),e.reset_session&&(e.new_sid?self._messageBus.publish(ne.NewSessionStartedEvent,e.new_sid):p.warn("Received a reset session flag from the server without a new sid. Ignoring reset.")),e.nextWupInterval?e.nextWupInterval!==self._wupServerSessionState.getWupDispatchRate()&&(self._wupServerSessionState.setWupDispatchRate(e.nextWupInterval),self._messageBus.publish(ne.WupDispatchRateUpdatedEvent,self._wupServerSessionState.getWupDispatchRate())):p.warn("Received an invalid nextWupInterval value of ".concat(e.nextWupInterval,". Ignoring value."))}}]),WupResponseProcessor}(),se="701",ae="702",oe="703",ue="704";function HeartBeatEvent_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function HeartBeatEvent_createClass(e,t,r){return t&&HeartBeatEvent_defineProperties(e.prototype,t),r&&HeartBeatEvent_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var fe="oK",le="Error",ce=HeartBeatEvent_createClass(function HeartBeatEvent(e,t){!function HeartBeatEvent_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,HeartBeatEvent),self.category=e,self.status=t});function ConfigurationWrapperWupMessage_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var he=function(){function ConfigurationWrapperWupMessage(e){!function ConfigurationWrapperWupMessage_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,ConfigurationWrapperWupMessage),self.wupMessageNumToRetry=e.get(o.wupMessageNumToRetry),self.wupMessageRetryInterval=e.get(o.wupMessageRetryInterval),self.wupIncrementalGrowthBetweenFailures=e.get(o.wupIncrementalGrowthBetweenFailures),self.wupMaxIntervalBetweenFailures=e.get(o.wupMaxIntervalBetweenFailures)}return function ConfigurationWrapperWupMessage_createClass(e,t,r){t&&ConfigurationWrapperWupMessage_defineProperties(e.prototype,t),r&&ConfigurationWrapperWupMessage_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(ConfigurationWrapperWupMessage,[{key:"createReMessageSettings",value:function createReMessageSettings(){return new F(self.wupMessageNumToRetry,self.wupMessageRetryInterval,self.wupIncrementalGrowthBetweenFailures,self.wupMaxIntervalBetweenFailures)}}]),ConfigurationWrapperWupMessage}();function WupServerClient_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var de=function(){function WupServerClient(e,t,r,n,i,s,a){!function WupServerClient_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WupServerClient),self._serverCommunicator=e,self._wupMessageBuilder=t,self._wupServerSessionState=r,self._wupStatisticsService=n,self._wupResponseProcessor=i,self._configurationRepository=s,self._msgBus=a,self._INFINITE_MESSAGE_SEND_RETRIES=0,self._retryMessage=self._serverCommunicator.getRetryMessage(),self._MESSAGE_SEND_RETRIES=self._configurationRepository.get(o.wupMessageNumToRetry),self._requestTimeout=self._configurationRepository.get(o.wupMessageRequestTimeout)}return function WupServerClient_createClass(e,t,r){t&&WupServerClient_defineProperties(e.prototype,t),r&&WupServerClient_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WupServerClient,[{key:"startNewSession",value:function startNewSession(e,t,r,n,i){self._validateCommonSessionRelatedParameters(r,i),self._wupServerSessionState.setRequestId(0),self._wupServerSessionState.setBrand(null),self._sendSessionMessage(null,e,t,r,n,i,null,self._wupServerSessionState.getRequestId())}},{key:"_sendSessionMessage",value:function _sendSessionMessage(e,t,r,n,i,s,a,o){var u=self;self._initSession(e,t,r,n,i,s,a,o);var a=self._createStaticFieldsPart(),f=!self._wupServerSessionState.getHasConfiguration()&&!self._wupServerSessionState.getHasPendingConfigurationRequest();f&&self._wupServerSessionState.markConfigurationRequested();o=self._wupMessageBuilder.build(f?$:"0",a),a=function onSendSuccess(e){u._onSendDataSuccess(e,f)};self._serverCommunicator.sendMessage(o,self._requestTimeout,f?self._INFINITE_MESSAGE_SEND_RETRIES:self._MESSAGE_SEND_RETRIES,!1,a,self._onSendDataRetryFailure.bind(self),self._onSendDataFailure.bind(self))}},{key:"resumeSession",value:function resumeSession(e,t,r,n,i,s,a){self._validateResumeSessionRelatedParameters(e,n,s);var o=a&&a.requestId?self._wupServerSessionState.setRequestId(a.requestId+1):self._wupServerSessionState.setRequestId(0);self._sendSessionMessage(e,t,r,n,i,s,a,o)}},{key:"sendData",value:function sendData(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];self._wupServerSessionState.getSts()&&self._wupServerSessionState.getStd()?self._sendMessage(e,t):p.error("Unable to send data. sts or std are undefined")}},{key:"setRequestTimeout",value:function setRequestTimeout(e){self._requestTimeout=e}},{key:"setConfigurationWupMessage",value:function setConfigurationWupMessage(){self._configurationWrapperWupMessage=new he(self._configurationRepository),self._reWupMessageSettings=self._configurationWrapperWupMessage.createReMessageSettings(),self._retryMessage.updateSettings(self._reWupMessageSettings)}},{key:"_initSession",value:function _initSession(e,t,r,n,i,s,a,o){p.debug("Initializing session. wupUrl:".concat(s,", sid:").concat(e)),self._serverCommunicator.setServerUrl(s),self._wupServerSessionState.setSid(e),self._wupServerSessionState.setCsid(t),self._wupServerSessionState.setPsid(r),self._wupServerSessionState.setMuid(n),self._wupServerSessionState.setContextName(i||""),self._wupServerSessionState.setRequestId(o,!1),a?(self._wupServerSessionState.setSts(a.sts),self._wupServerSessionState.setStd(a.std)):(p.info("Resetting server state of server communicator. Deleting sts and std"),self._wupServerSessionState.setSts(null),self._wupServerSessionState.setStd(null),self._wupStatisticsService.resetCounters())}},{key:"updateCsid",value:function updateCsid(e){var t=self._wupServerSessionState.incrementRequestId()||0;self._wupServerSessionState.setCsid(e);e={static_fields:[]};e.static_fields.push(["requestId",t],["contextId",self._wupServerSessionState.getContextName()],["sessionId",self._wupServerSessionState.getSid()],["customerSessionId",self._wupServerSessionState.getCsid()],["partnerSessionId",self._wupServerSessionState.getPsid()],["muid",self._wupServerSessionState.getMuid()]),self._sendMessage(e)}},{key:"updatePsid",value:function updatePsid(e){var t=self._wupServerSessionState.incrementRequestId()||0;self._wupServerSessionState.setPsid(e);e={static_fields:[]};e.static_fields.push(["requestId",t],["contextId",self._wupServerSessionState.getContextName()],["sessionId",self._wupServerSessionState.getSid()],["customerSessionId",self._wupServerSessionState.getCsid()],["partnerSessionId",self._wupServerSessionState.getPsid()],["muid",self._wupServerSessionState.getMuid()]),self._sendMessage(e)}},{key:"updateBrand",value:function updateBrand(e){self._wupServerSessionState.setBrand(e)}},{key:"isReady",value:function isReady(){return!!(self._serverCommunicator.isReadyToSendData()&&self._wupServerSessionState.getStd()&&self._wupServerSessionState.getSts())}},{key:"_validateResumeSessionRelatedParameters",value:function _validateResumeSessionRelatedParameters(e,t,r){if(!e)throw new Error("Invalid sid parameter ".concat(e,". Unable to start new session"));self._validateCommonSessionRelatedParameters(t,r)}},{key:"_validateCommonSessionRelatedParameters",value:function _validateCommonSessionRelatedParameters(e,t){if(!e)throw new Error("Invalid muid parameter ".concat(e,". Unable to start new session"));if(!t)throw new Error("Invalid serverAddress parameter ".concat(t,". Unable to start new session"))}},{key:"_createStaticFieldsPart",value:function _createStaticFieldsPart(){var e={static_fields:[]};return e.static_fields.push(["requestId",self._wupServerSessionState.getRequestId()],["contextId",self._wupServerSessionState.getContextName()],["sessionId",self._wupServerSessionState.getSid()],["customerSessionId",self._wupServerSessionState.getCsid()],["partnerSessionId",self._wupServerSessionState.getPsid()],["muid",self._wupServerSessionState.getMuid()]),e}},{key:"_sendMessage",value:function _sendMessage(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e=self._wupMessageBuilder.build("0",e);self._serverCommunicator.sendMessage(e,self._requestTimeout,self._MESSAGE_SEND_RETRIES,t,self._onSendDataSuccess.bind(self),self._onSendDataRetryFailure.bind(self),self._onSendDataFailure.bind(self))}},{key:"_onSendDataSuccess",value:function _onSendDataSuccess(e,t){t=t||!1,self._publishWorkerSystemStatus(ue,fe),self._publishWorkerSystemStatus(ue,fe),self._handleSuccessResponse(e,t),self._wupStatisticsService.incrementSentWupCount()}},{key:"_onSendDataRetryFailure",value:function _onSendDataRetryFailure(e){e===self._MESSAGE_SEND_RETRIES&&self._publishWorkerSystemStatus(ue,le)}},{key:"_onSendDataFailure",value:function _onSendDataFailure(){}},{key:"_handleSuccessResponse",value:function _handleSuccessResponse(e,t){var r=t?ae:oe;try{var n=JSON.parse(e);self._wupResponseProcessor.process(n,t),self._publishWorkerSystemStatus(r,fe)}catch(e){self._publishWorkerSystemStatus(r,le);var i="Failed to parse message from server: ".concat(e.message);p.error(i,e)}}},{key:"_publishWorkerSystemStatus",value:function _publishWorkerSystemStatus(e,t){self._msgBus.publish(ne.WorkerSystemStatusEvent,new ce(e,t))}}]),WupServerClient}();function DataAggregator_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var pe=function(){function DataAggregator(e){!function DataAggregator_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,DataAggregator),self._wupServerSessionState=e,self.reset()}return function DataAggregator_createClass(e,t,r){t&&DataAggregator_defineProperties(e.prototype,t),r&&DataAggregator_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(DataAggregator,[{key:"add",value:function add(e){var t=e.eventName,e=e.data;if(!t)throw new Error("Unable to add data message. Missing eventName field");if(!e)throw new Error("Unable to add data message. Missing data field");self._isEmpty=!1,self._dataObj[t]=self._dataObj[t]||[],self._dataObj[t].push(e)}},{key:"take",value:function take(){self._isEmpty||self._dataObj.static_fields.push(["requestId",self._wupServerSessionState.incrementRequestId()]);var e=self._dataObj;return self.reset(),e}},{key:"reset",value:function reset(){self._isEmpty=!0,self._dataObj=self.getFreshDataObj()}},{key:"isEmpty",value:function isEmpty(){return self._isEmpty}},{key:"getFreshDataObj",value:function getFreshDataObj(){return{static_fields:[],key_events:[],mouse_events:[]}}}]),DataAggregator}();function WorkerConfigurationLoadedEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ge=function(){function WorkerConfigurationLoadedEventHandler(e,t,r,n,i,s,a,o,u){!function WorkerConfigurationLoadedEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WorkerConfigurationLoadedEventHandler),self._messageBus=e,self._wupStatisticsService=t,self._dataDispatcher=r,self._logDataDispatcher=n,self._serverCommunicator=i,self._wupServerClient=s,self._logServerClient=a,self._logger=o,self._mainCommunicator=u,self._messageBus.subscribe(ne.ConfigurationLoadedEvent,self._handle.bind(self))}return function WorkerConfigurationLoadedEventHandler_createClass(e,t,r){t&&WorkerConfigurationLoadedEventHandler_defineProperties(e.prototype,t),r&&WorkerConfigurationLoadedEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WorkerConfigurationLoadedEventHandler,[{key:"_handle",value:function _handle(e){self._wupStatisticsService.updateSettings(e.get(o.wupStatisticsLogIntervalMs));var t=e.get(o.forceDynamicDataWupDispatchSettings)?c.defaultDynamicWupDispatchRateConfiguration:e.get(o.dataWupDispatchRateSettings);self._dataDispatcher.updateByConfig(t),self._logDataDispatcher.updateByConfig(e.get(o.logWupDispatchRateSettings)),self._serverCommunicator.updateSettings(e.get(o.serverCommunicationSettings)),self._logger.updateLogConfig(e),self._wupServerClient.setRequestTimeout(e.get(o.wupMessageRequestTimeout)||e.get(o.wupResponseTimeout)),self._logServerClient.setRequestTimeout(e.get(o.logMessageRequestTimeout)),self._wupServerClient.setConfigurationWupMessage(),self._logServerClient.setConfigurationLogMessage(),self._mainCommunicator.sendAsync(s,e.getAll())}}]),WorkerConfigurationLoadedEventHandler}();function WorkerNewSessionStartedEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var _e=function(){function WorkerNewSessionStartedEventHandler(e,t,r){!function WorkerNewSessionStartedEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WorkerNewSessionStartedEventHandler),self._messageBus=e,self._logger=t,self._mainCommunicator=r,self._messageBus.subscribe(ne.NewSessionStartedEvent,self._handle.bind(self))}return function WorkerNewSessionStartedEventHandler_createClass(e,t,r){t&&WorkerNewSessionStartedEventHandler_defineProperties(e.prototype,t),r&&WorkerNewSessionStartedEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WorkerNewSessionStartedEventHandler,[{key:"_handle",value:function _handle(e){self._logger.info("Worker received a new session id ".concat(e," from server.")),self._mainCommunicator.sendAsync(r,e)}}]),WorkerNewSessionStartedEventHandler}();function WorkerServerStateUpdatedEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ve=function(){function WorkerServerStateUpdatedEventHandler(e,t,r){!function WorkerServerStateUpdatedEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WorkerServerStateUpdatedEventHandler),self._messageBus=e,self._logger=t,self._mainCommunicator=r,self._messageBus.subscribe(ne.ServerStateUpdatedEvent,self._handle.bind(self))}return function WorkerServerStateUpdatedEventHandler_createClass(e,t,r){t&&WorkerServerStateUpdatedEventHandler_defineProperties(e.prototype,t),r&&WorkerServerStateUpdatedEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WorkerServerStateUpdatedEventHandler,[{key:"_handle",value:function _handle(e){self._logger.debug("Worker received an updated server state."),self._mainCommunicator.sendAsync(a,e)}}]),WorkerServerStateUpdatedEventHandler}();function WorkerWupDispatchRateUpdatedEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var me=function(){function WorkerWupDispatchRateUpdatedEventHandler(e,t,r){!function WorkerWupDispatchRateUpdatedEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WorkerWupDispatchRateUpdatedEventHandler),self._messageBus=e,self._dataDispatcher=t,self._logger=r,self._messageBus.subscribe(ne.WupDispatchRateUpdatedEvent,self._handle.bind(self))}return function WorkerWupDispatchRateUpdatedEventHandler_createClass(e,t,r){t&&WorkerWupDispatchRateUpdatedEventHandler_defineProperties(e.prototype,t),r&&WorkerWupDispatchRateUpdatedEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WorkerWupDispatchRateUpdatedEventHandler,[{key:"_handle",value:function _handle(e){self._logger.info("Worker received a wup dispatch rate ".concat(e," from server.")),self._dataDispatcher.scheduleNextDispatching()}}]),WorkerWupDispatchRateUpdatedEventHandler}(),ye="startNewSessionCommand",we="resumeSessionCommand",be="changeContextCommand",Se="updateCsidCommand",ke="updatePsidCommand",Ce="updateLogUrl",Ee="sendDataCommand",Re="sendLogCommand",Be="updateBrandCommand";function WorkerService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Pe=function(){function WorkerService(e,t,r,n,i,s,a){!function WorkerService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WorkerService),self._mainCommunicator=e,self._wupServerClient=t,self._logServerClient=r,self._configurationRepository=n,self._messageProcessor=i,self._logMessageProcessor=s,self._wupServerSessionState=a}return function WorkerService_createClass(e,t,r){t&&WorkerService_defineProperties(e.prototype,t),r&&WorkerService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WorkerService,[{key:"start",value:function start(){p.debug("Starting Worker Service"),self._mainCommunicator.addMessageListener(ye,self._onStartNewSessionCommand.bind(self)),self._mainCommunicator.addMessageListener(we,self._onResumeSessionCommand.bind(self)),self._mainCommunicator.addMessageListener(be,self._onChangeContextCommand.bind(self)),self._mainCommunicator.addMessageListener(Se,self._onUpdateCsidCommand.bind(self)),self._mainCommunicator.addMessageListener(ke,self._onUpdatePsidCommand.bind(self)),self._mainCommunicator.addMessageListener(Ce,self._onUpdateLogUrlCommand.bind(self)),self._mainCommunicator.addMessageListener(Ee,self._onSendDataCommand.bind(self)),self._mainCommunicator.addMessageListener(Re,self._onSendLogCommand.bind(self)),self._mainCommunicator.addMessageListener(Be,self._onUpdateBrandCommand.bind(self))}},{key:"_onStartNewSessionCommand",value:function _onStartNewSessionCommand(e){self._wupServerClient.startNewSession(e.csid,e.psid,e.muid,e.contextName,e.serverAddress)}},{key:"_onResumeSessionCommand",value:function _onResumeSessionCommand(e){self._wupServerClient.resumeSession(e.cdsnum,e.csid,e.psid,e.muid,e.contextName,e.serverAddress,e.serverState)}},{key:"_onChangeContextCommand",value:function _onChangeContextCommand(e){p.debug("Worker received a ChangeContextCommand from main."),self._wupServerSessionState.setContextName(e.contextName)}},{key:"_onUpdateCsidCommand",value:function _onUpdateCsidCommand(e){p.debug("Worker received an UpdateCsidCommand from main. CSID: ".concat(e.csid,".")),self._wupServerClient.updateCsid(e.csid)}},{key:"_onUpdatePsidCommand",value:function _onUpdatePsidCommand(e){p.debug("Worker received an UpdatePsidCommand from main. PSID: ".concat(e.psid,".")),self._wupServerClient.updatePsid(e.psid)}},{key:"_onUpdateLogUrlCommand",value:function _onUpdateLogUrlCommand(e){self._logServerClient.setServerUrl(e.logAddress)}},{key:"_onSendDataCommand",value:function _onSendDataCommand(e){self._messageProcessor.process(e)}},{key:"_onSendLogCommand",value:function _onSendLogCommand(e){self._logMessageProcessor.process(e)}},{key:"_onUpdateBrandCommand",value:function _onUpdateBrandCommand(e){self._wupServerClient.updateBrand(e.brand)}}]),WorkerService}();function HttpRequestFactory_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Me=function(){function HttpRequestFactory(){!function HttpRequestFactory_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,HttpRequestFactory)}return function HttpRequestFactory_createClass(e,t,r){t&&HttpRequestFactory_defineProperties(e.prototype,t),r&&HttpRequestFactory_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(HttpRequestFactory,null,[{key:"create",value:function create(){if(self.XMLHttpRequest&&Object.prototype.hasOwnProperty.call(XMLHttpRequest.prototype,"withCredentials"))return new XMLHttpRequest;if(self.XDomainRequest)return new XDomainRequest;if(!self.XMLHttpRequest)throw new Error("There is no supported http request object");return new XMLHttpRequest}}]),HttpRequestFactory}();function WorkerUtils_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var De=function(){function WorkerUtils(){!function WorkerUtils_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WorkerUtils)}return function WorkerUtils_createClass(e,t,r){t&&WorkerUtils_defineProperties(e.prototype,t),r&&WorkerUtils_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WorkerUtils,null,[{key:"isUndefinedNull",value:function isUndefinedNull(e){return null==e||void 0===e}},{key:"getPostUrl",value:function getPostUrl(t,e,r,n,i,s,a){var o=Me.create();try{o instanceof self.XMLHttpRequest?(o.open(e,t,!0),o.timeout=a||12e3,o.onload=function(){200===o.status||204===o.status&&s?n&&n(o.responseText):i&&i(o.responseText,o.status,o.statusText)},o.onerror=function(){i&&i(o.responseText,o.status,o.statusText)},o.ontimeout=function(){i&&i("timeout")},o.onabort=function(){i&&i("abort")},o.send(r)):(o.onload=function(){n&&o.responseText&&n(o.responseText)},o.onerror=function(){i&&i(o.responseText,o.status,o.statusText)},o.onprogress=function(){},o.ontimeout=function(){i&&i("timeout")},o.open(e,t,!0),o.timeout=a||12e3,setTimeout(function(){o.send(r)},0))}catch(e){throw console.log("ERROR ERROR ERROR. URL: ".concat(t,". ").concat(e,".")),e}}}]),WorkerUtils}();function WorkerSystemStatusEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var xe=function(){function WorkerSystemStatusEventHandler(e,t,r){!function WorkerSystemStatusEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WorkerSystemStatusEventHandler),self._mainCommunicator=e,self._messageBus=t,self._logger=r,self.errors={},self._messageBus.subscribe(ne.WorkerSystemStatusEvent,self._handle.bind(self))}return function WorkerSystemStatusEventHandler_createClass(e,t,r){t&&WorkerSystemStatusEventHandler_defineProperties(e.prototype,t),r&&WorkerSystemStatusEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WorkerSystemStatusEventHandler,[{key:"_handle",value:function _handle(e){self._logger.debug("Sending new HeartBeatStatusEvent - ".concat(e.category,", ").concat(e.status)),self._mainCommunicator.sendAsync(u,e)}}]),WorkerSystemStatusEventHandler}();function LogBridge_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ie=function(){function LogBridge(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";!function LogBridge_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,LogBridge),self.sn=0,self.url=t,self.logAggregator=e,self.msgPrefix=r}return function LogBridge_createClass(e,t,r){t&&LogBridge_defineProperties(e.prototype,t),r&&LogBridge_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(LogBridge,[{key:"log",value:function log(e,t){self.logAggregator.add({eventName:"log",data:{msg:self.msgPrefix+e,url:self.url,level:t,sn:self.sn++}})}},{key:"setLogLevel",value:function setLogLevel(e){self.logAggregator instanceof X&&self.logAggregator.setLogLevel(e)}},{key:"clearLogEntriesByLogLevel",value:function clearLogEntriesByLogLevel(e){self.logAggregator.filterOutByLogLevel(e)}}]),LogBridge}();function RetryMessage_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ae=function(){function RetryMessage(e){!function RetryMessage_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,RetryMessage),self.currentMessageNumberOfSendFailures=0,self.reMessageSettings=e,self.currentInterval=self.getMessageRetryInterval()}return function RetryMessage_createClass(e,t,r){t&&RetryMessage_defineProperties(e.prototype,t),r&&RetryMessage_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(RetryMessage,[{key:"restartMessageSettings",value:function restartMessageSettings(){self.currentMessageNumberOfSendFailures=0,self.currentInterval=self.getMessageRetryInterval()}},{key:"updateSettings",value:function updateSettings(e){self.reMessageSettings=e}},{key:"updateAllSettings",value:function updateAllSettings(e){e.init(),self.reMessageSettings=e}},{key:"getNumberOfSendFailures",value:function getNumberOfSendFailures(){return self.currentMessageNumberOfSendFailures}},{key:"getNextInterval",value:function getNextInterval(){return self.currentInterval}},{key:"getMessageNumToRetry",value:function getMessageNumToRetry(){return self.reMessageSettings.getMessageNumToRetry()}},{key:"getMessageRetryInterval",value:function getMessageRetryInterval(){return self.reMessageSettings.getMessageRetryInterval()}},{key:"getMaxIntervalBetweenFailures",value:function getMaxIntervalBetweenFailures(){return self.reMessageSettings.getMaxIntervalBetweenFailures()}},{key:"getIncrementalGrowthBetweenFailures",value:function getIncrementalGrowthBetweenFailures(){return self.reMessageSettings.getIncrementalGrowthBetweenFailures()}},{key:"_incrementNumberOfSendFailures",value:function _incrementNumberOfSendFailures(){self.currentMessageNumberOfSendFailures++}},{key:"shouldReMessage",value:function shouldReMessage(e){return e||self.getNumberOfSendFailures()<self.getMessageNumToRetry()}},{key:"updateRetryInterval",value:function updateRetryInterval(){var e=self.currentInterval+self.currentMessageNumberOfSendFailures*self.getIncrementalGrowthBetweenFailures();e>self.getMaxIntervalBetweenFailures()?self.currentInterval=self.getMaxIntervalBetweenFailures():self.currentInterval=e,self._incrementNumberOfSendFailures()}}]),RetryMessage}();function WorkerServerRestoredMuidEventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var We=function(){function WorkerServerRestoredMuidEventHandler(e,t){!function WorkerServerRestoredMuidEventHandler_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WorkerServerRestoredMuidEventHandler),self._messageBus=e,self._mainCommunicator=t,self._messageBus.subscribe(ne.ServerRestoredMuidEvent,self._handler.bind(self),!0)}return function WorkerServerRestoredMuidEventHandler_createClass(e,t,r){t&&WorkerServerRestoredMuidEventHandler_defineProperties(e.prototype,t),r&&WorkerServerRestoredMuidEventHandler_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WorkerServerRestoredMuidEventHandler,[{key:"_handler",value:function _handler(e){self._mainCommunicator.sendAsync(f,e)}}]),WorkerServerRestoredMuidEventHandler}();function WorkerSysLoader_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Te=function(){function WorkerSysLoader(e,t){!function WorkerSysLoader_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WorkerSysLoader),self._mainCommunicator=e,self._msgBus=t,self._eventHandlers=[]}return function WorkerSysLoader_createClass(e,t,r){t&&WorkerSysLoader_defineProperties(e.prototype,t),r&&WorkerSysLoader_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WorkerSysLoader,[{key:"loadSystem",value:function loadSystem(){var t=self;self._configurationRepository=new h,self._wupServerSessionState=new _,self._logRequestBodyBuilder=new v,self._configurationWrapperLogMessage=new N(self._configurationRepository),self._logReMessageSettings=self._configurationWrapperLogMessage.createReMessageSettings(),self._logRetryMessage=new Ae(self._logReMessageSettings),self._logServerCommunicator=new w(self._logRequestBodyBuilder,self._configurationRepository.get(o.serverCommunicationSettings),De,self._logRetryMessage,!0,"log"),self._logMessageBuilder=new S(new R),self._logServerClient=new z(self._logServerCommunicator,self._logMessageBuilder,self._configurationRepository),self._wupStatisticsService=new q(self._configurationRepository.get(o.wupStatisticsLogIntervalMs)),self._wupDispatchRateCalculatorFactory=new Q(self._wupStatisticsService,self._wupServerSessionState);var e=new X;self._logDataDispatcher=new K(self._logServerClient,e,self._wupDispatchRateCalculatorFactory,self._configurationRepository.get(o.logWupDispatchRateSettings));var r=new Ie(e,"worker");self._logMessageProcessor=new J(self._logDataDispatcher);e=new g(r);p.setLogger(e),self._wupMessageBuilder=new te(self._wupServerSessionState,new R),self._wupRequestBodyBuilder=new re(self._wupServerSessionState),self._configurationWrapperWupMessage=new he(self._configurationRepository),self._wupReMessageSettings=self._configurationWrapperWupMessage.createReMessageSettings(),self._wupRetryMessage=new Ae(self._wupReMessageSettings),self._dataServerCommunicator=new w(self._wupRequestBodyBuilder,self._configurationRepository.get(o.serverCommunicationSettings),De,self._wupRetryMessage,!1,"wup"),self._wupResponseProcessor=new ie(self._wupServerSessionState,self._msgBus,self._configurationRepository),self._wupServerClient=new de(self._dataServerCommunicator,self._wupMessageBuilder,self._wupServerSessionState,self._wupStatisticsService,self._wupResponseProcessor,self._configurationRepository,self._msgBus);r=self._configurationRepository.get(o.forceDynamicDataWupDispatchSettings)?c.defaultDynamicWupDispatchRateConfiguration:self._configurationRepository.get(o.dataWupDispatchRateSettings);self._dataDispatcher=new K(self._wupServerClient,new pe(self._wupServerSessionState),self._wupDispatchRateCalculatorFactory,r),self._messageProcessor=new J(self._dataDispatcher),self._eventHandlers.push(new ge(self._msgBus,self._wupStatisticsService,self._dataDispatcher,self._logDataDispatcher,self._dataServerCommunicator,self._wupServerClient,self._logServerClient,e,self._mainCommunicator)),self._eventHandlers.push(new _e(self._msgBus,e,self._mainCommunicator)),self._eventHandlers.push(new ve(self._msgBus,e,self._mainCommunicator)),self._eventHandlers.push(new me(self._msgBus,self._dataDispatcher,e)),self._eventHandlers.push(new xe(self._mainCommunicator,self._msgBus,e)),self._eventHandlers.push(new We(self._msgBus,self._mainCommunicator)),self._wupServerSessionState.onServerStateUpdated.subscribe(function(e){t._mainCommunicator.sendAsync(a,e)}),self._mainCommunicator.addMessageListener("stateUpdateFromStorage",function(e){e&&e.requestId&&e.sts&&(t._wupServerSessionState.setRequestId(e.requestId,!1),t._wupServerSessionState.setSts(e.sts),t._wupServerSessionState.setStd(e.std))}),self._workerService=new Pe(self._mainCommunicator,self._wupServerClient,self._logServerClient,self._configurationRepository,self._messageProcessor,self._logMessageProcessor,self._wupServerSessionState),self._workerService.start(),p.info("Loaded worker")}}]),WorkerSysLoader}();function MessageBus_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Le=function(){function MessageBus(){!function MessageBus_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,MessageBus),self.subscribers=t()}return function MessageBus_createClass(e,t,r){t&&MessageBus_defineProperties(e.prototype,t),r&&MessageBus_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(MessageBus,[{key:"subscribe",value:function subscribe(e,t){var r,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=!1;self.subscribers.has(e)?(r=self.subscribers.get(e))&&r.forEach(function(e){t===e.handler&&(i=!0)}):(r=HI(),self.subscribers.set(e,r)),i||r.add({handler:t,isOneTime:n})}},{key:"unsubscribe",value:function unsubscribe(e,t){var r;e&&self.subscribers.has(e)&&((r=self.subscribers.get(e))&&r.forEach(function(e){t===e.handler&&r.delete(e)}),0===r.size&&self.subscribers.delete(e))}},{key:"publish",value:function publish(e,t){if(!e)throw new Error("invalid argument messageType must be defined");self._notifySubscribers(e,t)}},{key:"_notifySubscribers",value:function _notifySubscribers(e,t){var r=self.subscribers.get(e);r&&r.forEach(function(e){e.handler(t),e.isOneTime&&r.delete(e)})}}]),MessageBus}();function CDPort_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ue=function(){function CDPort(e){!function CDPort_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,CDPort),self._portNativeWorker=e}return function CDPort_createClass(e,t,r){t&&CDPort_defineProperties(e.prototype,t),r&&CDPort_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(CDPort,[{key:"postMessage",value:function postMessage(){self._portNativeWorker.postMessage.apply(self._portNativeWorker,arguments)}},{key:"close",value:function close(){self._portNativeWorker.terminate()}},{key:"setonmessage",value:function setonmessage(e){self._portNativeWorker.onmessage=e}}]),CDPort}();function WorkerStartPoint_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Oe=function(){function WorkerStartPoint(){!function WorkerStartPoint_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,WorkerStartPoint)}return function WorkerStartPoint_createClass(e,t,r){t&&WorkerStartPoint_defineProperties(e.prototype,t),r&&WorkerStartPoint_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(WorkerStartPoint,[{key:"start",value:function start(){var e=new i,t=new Le,r=new Te(e,t);self._loadWorkerSystem(e,t,r,new Ue(self))}},{key:"_loadWorkerSystem",value:function _loadWorkerSystem(e,t,r,n){try{e.setMessagingPort(n),r.loadSystem(),t.publish(ne.WorkerSystemStatusEvent,new ce(se,fe))}catch(e){t.publish(ne.WorkerSystemStatusEvent,new ce(se,le))}}}]),WorkerStartPoint}();function Application_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(new(function(){function Application(){!function Application_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self,Application)}return function Application_createClass(e,t,r){t&&Application_defineProperties(e.prototype,t),r&&Application_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(Application,[{key:"start",value:function start(){(new Oe).start()}}]),Application}())).start()}()}();',null)}},855:function(e){"use strict";var o=window.URL||window.webkitURL;e.exports=function(t,r){try{try{var n;try{(n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),n=n.getBlob()}catch(e){n=new Blob([t])}return new Worker(o.createObjectURL(n))}catch(e){return new Worker("data:application/javascript,"+encodeURIComponent(t))}}catch(e){if(!r)throw Error("Inline worker is not supported");return new Worker(r)}}}},n={};function __webpack_require__(e){var t=n[e];if(void 0!==t)return t.exports;t=n[e]={exports:{}};return r[e](t,t.exports,__webpack_require__),t.exports}__webpack_require__.amdO={},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=function(e,t){for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var e={};!function(){"use strict";__webpack_require__.r(e),(new(__webpack_require__(440).default.Application)).start()}(),cdwpb=e}();